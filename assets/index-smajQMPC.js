(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function hT(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var wx={exports:{}},Xe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fl=Symbol.for("react.element"),dT=Symbol.for("react.portal"),fT=Symbol.for("react.fragment"),pT=Symbol.for("react.strict_mode"),mT=Symbol.for("react.profiler"),gT=Symbol.for("react.provider"),vT=Symbol.for("react.context"),yT=Symbol.for("react.forward_ref"),_T=Symbol.for("react.suspense"),xT=Symbol.for("react.memo"),wT=Symbol.for("react.lazy"),Ng=Symbol.iterator;function ST(n){return n===null||typeof n!="object"?null:(n=Ng&&n[Ng]||n["@@iterator"],typeof n=="function"?n:null)}var Sx={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Mx=Object.assign,Ax={};function aa(n,e,t){this.props=n,this.context=e,this.refs=Ax,this.updater=t||Sx}aa.prototype.isReactComponent={};aa.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};aa.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function Tx(){}Tx.prototype=aa.prototype;function Fp(n,e,t){this.props=n,this.context=e,this.refs=Ax,this.updater=t||Sx}var Up=Fp.prototype=new Tx;Up.constructor=Fp;Mx(Up,aa.prototype);Up.isPureReactComponent=!0;var kg=Array.isArray,Ex=Object.prototype.hasOwnProperty,Op={current:null},bx={key:!0,ref:!0,__self:!0,__source:!0};function Cx(n,e,t){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)Ex.call(e,i)&&!bx.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(n&&n.defaultProps)for(i in a=n.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:Fl,type:n,key:s,ref:o,props:r,_owner:Op.current}}function MT(n,e){return{$$typeof:Fl,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Bp(n){return typeof n=="object"&&n!==null&&n.$$typeof===Fl}function AT(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var Fg=/\/+/g;function Oh(n,e){return typeof n=="object"&&n!==null&&n.key!=null?AT(""+n.key):e.toString(36)}function Jc(n,e,t,i,r){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Fl:case dT:o=!0}}if(o)return o=n,r=r(o),n=i===""?"."+Oh(o,0):i,kg(r)?(t="",n!=null&&(t=n.replace(Fg,"$&/")+"/"),Jc(r,e,t,"",function(c){return c})):r!=null&&(Bp(r)&&(r=MT(r,t+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(Fg,"$&/")+"/")+n)),e.push(r)),1;if(o=0,i=i===""?".":i+":",kg(n))for(var a=0;a<n.length;a++){s=n[a];var l=i+Oh(s,a);o+=Jc(s,e,t,l,r)}else if(l=ST(n),typeof l=="function")for(n=l.call(n),a=0;!(s=n.next()).done;)s=s.value,l=i+Oh(s,a++),o+=Jc(s,e,t,l,r);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Zl(n,e,t){if(n==null)return n;var i=[],r=0;return Jc(n,i,"","",function(s){return e.call(t,s,r++)}),i}function TT(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var xn={current:null},eu={transition:null},ET={ReactCurrentDispatcher:xn,ReactCurrentBatchConfig:eu,ReactCurrentOwner:Op};function Rx(){throw Error("act(...) is not supported in production builds of React.")}Xe.Children={map:Zl,forEach:function(n,e,t){Zl(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Zl(n,function(){e++}),e},toArray:function(n){return Zl(n,function(e){return e})||[]},only:function(n){if(!Bp(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Xe.Component=aa;Xe.Fragment=fT;Xe.Profiler=mT;Xe.PureComponent=Fp;Xe.StrictMode=pT;Xe.Suspense=_T;Xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ET;Xe.act=Rx;Xe.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var i=Mx({},n.props),r=n.key,s=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Op.current),e.key!==void 0&&(r=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)Ex.call(e,l)&&!bx.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:Fl,type:n.type,key:r,ref:s,props:i,_owner:o}};Xe.createContext=function(n){return n={$$typeof:vT,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:gT,_context:n},n.Consumer=n};Xe.createElement=Cx;Xe.createFactory=function(n){var e=Cx.bind(null,n);return e.type=n,e};Xe.createRef=function(){return{current:null}};Xe.forwardRef=function(n){return{$$typeof:yT,render:n}};Xe.isValidElement=Bp;Xe.lazy=function(n){return{$$typeof:wT,_payload:{_status:-1,_result:n},_init:TT}};Xe.memo=function(n,e){return{$$typeof:xT,type:n,compare:e===void 0?null:e}};Xe.startTransition=function(n){var e=eu.transition;eu.transition={};try{n()}finally{eu.transition=e}};Xe.unstable_act=Rx;Xe.useCallback=function(n,e){return xn.current.useCallback(n,e)};Xe.useContext=function(n){return xn.current.useContext(n)};Xe.useDebugValue=function(){};Xe.useDeferredValue=function(n){return xn.current.useDeferredValue(n)};Xe.useEffect=function(n,e){return xn.current.useEffect(n,e)};Xe.useId=function(){return xn.current.useId()};Xe.useImperativeHandle=function(n,e,t){return xn.current.useImperativeHandle(n,e,t)};Xe.useInsertionEffect=function(n,e){return xn.current.useInsertionEffect(n,e)};Xe.useLayoutEffect=function(n,e){return xn.current.useLayoutEffect(n,e)};Xe.useMemo=function(n,e){return xn.current.useMemo(n,e)};Xe.useReducer=function(n,e,t){return xn.current.useReducer(n,e,t)};Xe.useRef=function(n){return xn.current.useRef(n)};Xe.useState=function(n){return xn.current.useState(n)};Xe.useSyncExternalStore=function(n,e,t){return xn.current.useSyncExternalStore(n,e,t)};Xe.useTransition=function(){return xn.current.useTransition()};Xe.version="18.3.1";wx.exports=Xe;var te=wx.exports;const Ie=hT(te);var Px={exports:{}},Bn={},Lx={exports:{}},Ix={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(L,j){var Y=L.length;L.push(j);e:for(;0<Y;){var ee=Y-1>>>1,Q=L[ee];if(0<r(Q,j))L[ee]=j,L[Y]=Q,Y=ee;else break e}}function t(L){return L.length===0?null:L[0]}function i(L){if(L.length===0)return null;var j=L[0],Y=L.pop();if(Y!==j){L[0]=Y;e:for(var ee=0,Q=L.length,De=Q>>>1;ee<De;){var K=2*(ee+1)-1,ne=L[K],he=K+1,ce=L[he];if(0>r(ne,Y))he<Q&&0>r(ce,ne)?(L[ee]=ce,L[he]=Y,ee=he):(L[ee]=ne,L[K]=Y,ee=K);else if(he<Q&&0>r(ce,Y))L[ee]=ce,L[he]=Y,ee=he;else break e}}return j}function r(L,j){var Y=L.sortIndex-j.sortIndex;return Y!==0?Y:L.id-j.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,d=null,h=3,f=!1,m=!1,y=!1,g=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(L){for(var j=t(c);j!==null;){if(j.callback===null)i(c);else if(j.startTime<=L)i(c),j.sortIndex=j.expirationTime,e(l,j);else break;j=t(c)}}function x(L){if(y=!1,_(L),!m)if(t(l)!==null)m=!0,N(A);else{var j=t(c);j!==null&&G(x,j.startTime-L)}}function A(L,j){m=!1,y&&(y=!1,p(b),b=-1),f=!0;var Y=h;try{for(_(j),d=t(l);d!==null&&(!(d.expirationTime>j)||L&&!P());){var ee=d.callback;if(typeof ee=="function"){d.callback=null,h=d.priorityLevel;var Q=ee(d.expirationTime<=j);j=n.unstable_now(),typeof Q=="function"?d.callback=Q:d===t(l)&&i(l),_(j)}else i(l);d=t(l)}if(d!==null)var De=!0;else{var K=t(c);K!==null&&G(x,K.startTime-j),De=!1}return De}finally{d=null,h=Y,f=!1}}var M=!1,S=null,b=-1,T=5,w=-1;function P(){return!(n.unstable_now()-w<T)}function V(){if(S!==null){var L=n.unstable_now();w=L;var j=!0;try{j=S(!0,L)}finally{j?I():(M=!1,S=null)}}else M=!1}var I;if(typeof v=="function")I=function(){v(V)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,F=O.port2;O.port1.onmessage=V,I=function(){F.postMessage(null)}}else I=function(){g(V,0)};function N(L){S=L,M||(M=!0,I())}function G(L,j){b=g(function(){L(n.unstable_now())},j)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(L){L.callback=null},n.unstable_continueExecution=function(){m||f||(m=!0,N(A))},n.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<L?Math.floor(1e3/L):5},n.unstable_getCurrentPriorityLevel=function(){return h},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(L){switch(h){case 1:case 2:case 3:var j=3;break;default:j=h}var Y=h;h=j;try{return L()}finally{h=Y}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(L,j){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var Y=h;h=L;try{return j()}finally{h=Y}},n.unstable_scheduleCallback=function(L,j,Y){var ee=n.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?ee+Y:ee):Y=ee,L){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=Y+Q,L={id:u++,callback:j,priorityLevel:L,startTime:Y,expirationTime:Q,sortIndex:-1},Y>ee?(L.sortIndex=Y,e(c,L),t(l)===null&&L===t(c)&&(y?(p(b),b=-1):y=!0,G(x,Y-ee))):(L.sortIndex=Q,e(l,L),m||f||(m=!0,N(A))),L},n.unstable_shouldYield=P,n.unstable_wrapCallback=function(L){var j=h;return function(){var Y=h;h=j;try{return L.apply(this,arguments)}finally{h=Y}}}})(Ix);Lx.exports=Ix;var bT=Lx.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var CT=te,Un=bT;function se(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Dx=new Set,ul={};function Bs(n,e){Bo(n,e),Bo(n+"Capture",e)}function Bo(n,e){for(ul[n]=e,n=0;n<e.length;n++)Dx.add(e[n])}var cr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),mf=Object.prototype.hasOwnProperty,RT=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Ug={},Og={};function PT(n){return mf.call(Og,n)?!0:mf.call(Ug,n)?!1:RT.test(n)?Og[n]=!0:(Ug[n]=!0,!1)}function LT(n,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function IT(n,e,t,i){if(e===null||typeof e>"u"||LT(n,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function wn(n,e,t,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Qt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Qt[n]=new wn(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Qt[e]=new wn(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Qt[n]=new wn(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Qt[n]=new wn(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Qt[n]=new wn(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Qt[n]=new wn(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Qt[n]=new wn(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Qt[n]=new wn(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Qt[n]=new wn(n,5,!1,n.toLowerCase(),null,!1,!1)});var zp=/[\-:]([a-z])/g;function Vp(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(zp,Vp);Qt[e]=new wn(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(zp,Vp);Qt[e]=new wn(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(zp,Vp);Qt[e]=new wn(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Qt[n]=new wn(n,1,!1,n.toLowerCase(),null,!1,!1)});Qt.xlinkHref=new wn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Qt[n]=new wn(n,1,!1,n.toLowerCase(),null,!0,!0)});function Hp(n,e,t,i){var r=Qt.hasOwnProperty(e)?Qt[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(IT(e,t,r,i)&&(t=null),i||r===null?PT(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):r.mustUseProperty?n[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,i=r.attributeNamespace,t===null?n.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,i?n.setAttributeNS(i,e,t):n.setAttribute(e,t))))}var mr=CT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ql=Symbol.for("react.element"),co=Symbol.for("react.portal"),uo=Symbol.for("react.fragment"),Gp=Symbol.for("react.strict_mode"),gf=Symbol.for("react.profiler"),Nx=Symbol.for("react.provider"),kx=Symbol.for("react.context"),Wp=Symbol.for("react.forward_ref"),vf=Symbol.for("react.suspense"),yf=Symbol.for("react.suspense_list"),jp=Symbol.for("react.memo"),Cr=Symbol.for("react.lazy"),Fx=Symbol.for("react.offscreen"),Bg=Symbol.iterator;function va(n){return n===null||typeof n!="object"?null:(n=Bg&&n[Bg]||n["@@iterator"],typeof n=="function"?n:null)}var At=Object.assign,Bh;function Ba(n){if(Bh===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Bh=e&&e[1]||""}return`
`+Bh+n}var zh=!1;function Vh(n,e){if(!n||zh)return"";zh=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){i=c}n.call(e.prototype)}else{try{throw Error()}catch(c){i=c}n()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var l=`
`+r[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{zh=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Ba(n):""}function DT(n){switch(n.tag){case 5:return Ba(n.type);case 16:return Ba("Lazy");case 13:return Ba("Suspense");case 19:return Ba("SuspenseList");case 0:case 2:case 15:return n=Vh(n.type,!1),n;case 11:return n=Vh(n.type.render,!1),n;case 1:return n=Vh(n.type,!0),n;default:return""}}function _f(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case uo:return"Fragment";case co:return"Portal";case gf:return"Profiler";case Gp:return"StrictMode";case vf:return"Suspense";case yf:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case kx:return(n.displayName||"Context")+".Consumer";case Nx:return(n._context.displayName||"Context")+".Provider";case Wp:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case jp:return e=n.displayName||null,e!==null?e:_f(n.type)||"Memo";case Cr:e=n._payload,n=n._init;try{return _f(n(e))}catch{}}return null}function NT(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _f(e);case 8:return e===Gp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function qr(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Ux(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function kT(n){var e=Ux(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),i=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Jl(n){n._valueTracker||(n._valueTracker=kT(n))}function Ox(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return n&&(i=Ux(n)?n.checked?"true":"false":n.value),n=i,n!==t?(e.setValue(n),!0):!1}function gu(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function xf(n,e){var t=e.checked;return At({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function zg(n,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=qr(e.value!=null?e.value:t),n._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Bx(n,e){e=e.checked,e!=null&&Hp(n,"checked",e,!1)}function wf(n,e){Bx(n,e);var t=qr(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(i==="submit"||i==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Sf(n,e.type,t):e.hasOwnProperty("defaultValue")&&Sf(n,e.type,qr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Vg(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Sf(n,e,t){(e!=="number"||gu(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var za=Array.isArray;function Co(n,e,t,i){if(n=n.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<n.length;t++)r=e.hasOwnProperty("$"+n[t].value),n[t].selected!==r&&(n[t].selected=r),r&&i&&(n[t].defaultSelected=!0)}else{for(t=""+qr(t),e=null,r=0;r<n.length;r++){if(n[r].value===t){n[r].selected=!0,i&&(n[r].defaultSelected=!0);return}e!==null||n[r].disabled||(e=n[r])}e!==null&&(e.selected=!0)}}function Mf(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(se(91));return At({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Hg(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(se(92));if(za(t)){if(1<t.length)throw Error(se(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:qr(t)}}function zx(n,e){var t=qr(e.value),i=qr(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),i!=null&&(n.defaultValue=""+i)}function Gg(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function Vx(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Af(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?Vx(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var ec,Hx=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,i,r){MSApp.execUnsafeLocalFunction(function(){return n(e,t,i,r)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(ec=ec||document.createElement("div"),ec.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ec.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function hl(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Ka={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},FT=["Webkit","ms","Moz","O"];Object.keys(Ka).forEach(function(n){FT.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Ka[e]=Ka[n]})});function Gx(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Ka.hasOwnProperty(n)&&Ka[n]?(""+e).trim():e+"px"}function Wx(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,r=Gx(t,e[t],i);t==="float"&&(t="cssFloat"),i?n.setProperty(t,r):n[t]=r}}var UT=At({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Tf(n,e){if(e){if(UT[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(se(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(se(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(se(61))}if(e.style!=null&&typeof e.style!="object")throw Error(se(62))}}function Ef(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bf=null;function Xp(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Cf=null,Ro=null,Po=null;function Wg(n){if(n=Bl(n)){if(typeof Cf!="function")throw Error(se(280));var e=n.stateNode;e&&(e=ah(e),Cf(n.stateNode,n.type,e))}}function jx(n){Ro?Po?Po.push(n):Po=[n]:Ro=n}function Xx(){if(Ro){var n=Ro,e=Po;if(Po=Ro=null,Wg(n),e)for(n=0;n<e.length;n++)Wg(e[n])}}function qx(n,e){return n(e)}function Kx(){}var Hh=!1;function Yx(n,e,t){if(Hh)return n(e,t);Hh=!0;try{return qx(n,e,t)}finally{Hh=!1,(Ro!==null||Po!==null)&&(Kx(),Xx())}}function dl(n,e){var t=n.stateNode;if(t===null)return null;var i=ah(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(n=n.type,i=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!i;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(se(231,e,typeof t));return t}var Rf=!1;if(cr)try{var ya={};Object.defineProperty(ya,"passive",{get:function(){Rf=!0}}),window.addEventListener("test",ya,ya),window.removeEventListener("test",ya,ya)}catch{Rf=!1}function OT(n,e,t,i,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var Ya=!1,vu=null,yu=!1,Pf=null,BT={onError:function(n){Ya=!0,vu=n}};function zT(n,e,t,i,r,s,o,a,l){Ya=!1,vu=null,OT.apply(BT,arguments)}function VT(n,e,t,i,r,s,o,a,l){if(zT.apply(this,arguments),Ya){if(Ya){var c=vu;Ya=!1,vu=null}else throw Error(se(198));yu||(yu=!0,Pf=c)}}function zs(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function $x(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function jg(n){if(zs(n)!==n)throw Error(se(188))}function HT(n){var e=n.alternate;if(!e){if(e=zs(n),e===null)throw Error(se(188));return e!==n?null:n}for(var t=n,i=e;;){var r=t.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){t=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===t)return jg(r),n;if(s===i)return jg(r),e;s=s.sibling}throw Error(se(188))}if(t.return!==i.return)t=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===t){o=!0,t=r,i=s;break}if(a===i){o=!0,i=r,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,i=r;break}if(a===i){o=!0,i=s,t=r;break}a=a.sibling}if(!o)throw Error(se(189))}}if(t.alternate!==i)throw Error(se(190))}if(t.tag!==3)throw Error(se(188));return t.stateNode.current===t?n:e}function Zx(n){return n=HT(n),n!==null?Qx(n):null}function Qx(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=Qx(n);if(e!==null)return e;n=n.sibling}return null}var Jx=Un.unstable_scheduleCallback,Xg=Un.unstable_cancelCallback,GT=Un.unstable_shouldYield,WT=Un.unstable_requestPaint,It=Un.unstable_now,jT=Un.unstable_getCurrentPriorityLevel,qp=Un.unstable_ImmediatePriority,ew=Un.unstable_UserBlockingPriority,_u=Un.unstable_NormalPriority,XT=Un.unstable_LowPriority,tw=Un.unstable_IdlePriority,ih=null,Ri=null;function qT(n){if(Ri&&typeof Ri.onCommitFiberRoot=="function")try{Ri.onCommitFiberRoot(ih,n,void 0,(n.current.flags&128)===128)}catch{}}var hi=Math.clz32?Math.clz32:$T,KT=Math.log,YT=Math.LN2;function $T(n){return n>>>=0,n===0?32:31-(KT(n)/YT|0)|0}var tc=64,nc=4194304;function Va(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function xu(n,e){var t=n.pendingLanes;if(t===0)return 0;var i=0,r=n.suspendedLanes,s=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~r;a!==0?i=Va(a):(s&=o,s!==0&&(i=Va(s)))}else o=t&~r,o!==0?i=Va(o):s!==0&&(i=Va(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=i;0<e;)t=31-hi(e),r=1<<t,i|=n[t],e&=~r;return i}function ZT(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function QT(n,e){for(var t=n.suspendedLanes,i=n.pingedLanes,r=n.expirationTimes,s=n.pendingLanes;0<s;){var o=31-hi(s),a=1<<o,l=r[o];l===-1?(!(a&t)||a&i)&&(r[o]=ZT(a,e)):l<=e&&(n.expiredLanes|=a),s&=~a}}function Lf(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function nw(){var n=tc;return tc<<=1,!(tc&4194240)&&(tc=64),n}function Gh(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Ul(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-hi(e),n[e]=t}function JT(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var i=n.eventTimes;for(n=n.expirationTimes;0<t;){var r=31-hi(t),s=1<<r;e[r]=0,i[r]=-1,n[r]=-1,t&=~s}}function Kp(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var i=31-hi(t),r=1<<i;r&e|n[i]&e&&(n[i]|=e),t&=~r}}var lt=0;function iw(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var rw,Yp,sw,ow,aw,If=!1,ic=[],Ur=null,Or=null,Br=null,fl=new Map,pl=new Map,Pr=[],eE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function qg(n,e){switch(n){case"focusin":case"focusout":Ur=null;break;case"dragenter":case"dragleave":Or=null;break;case"mouseover":case"mouseout":Br=null;break;case"pointerover":case"pointerout":fl.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":pl.delete(e.pointerId)}}function _a(n,e,t,i,r,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=Bl(e),e!==null&&Yp(e)),n):(n.eventSystemFlags|=i,e=n.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),n)}function tE(n,e,t,i,r){switch(e){case"focusin":return Ur=_a(Ur,n,e,t,i,r),!0;case"dragenter":return Or=_a(Or,n,e,t,i,r),!0;case"mouseover":return Br=_a(Br,n,e,t,i,r),!0;case"pointerover":var s=r.pointerId;return fl.set(s,_a(fl.get(s)||null,n,e,t,i,r)),!0;case"gotpointercapture":return s=r.pointerId,pl.set(s,_a(pl.get(s)||null,n,e,t,i,r)),!0}return!1}function lw(n){var e=As(n.target);if(e!==null){var t=zs(e);if(t!==null){if(e=t.tag,e===13){if(e=$x(t),e!==null){n.blockedOn=e,aw(n.priority,function(){sw(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function tu(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Df(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var i=new t.constructor(t.type,t);bf=i,t.target.dispatchEvent(i),bf=null}else return e=Bl(t),e!==null&&Yp(e),n.blockedOn=t,!1;e.shift()}return!0}function Kg(n,e,t){tu(n)&&t.delete(e)}function nE(){If=!1,Ur!==null&&tu(Ur)&&(Ur=null),Or!==null&&tu(Or)&&(Or=null),Br!==null&&tu(Br)&&(Br=null),fl.forEach(Kg),pl.forEach(Kg)}function xa(n,e){n.blockedOn===e&&(n.blockedOn=null,If||(If=!0,Un.unstable_scheduleCallback(Un.unstable_NormalPriority,nE)))}function ml(n){function e(r){return xa(r,n)}if(0<ic.length){xa(ic[0],n);for(var t=1;t<ic.length;t++){var i=ic[t];i.blockedOn===n&&(i.blockedOn=null)}}for(Ur!==null&&xa(Ur,n),Or!==null&&xa(Or,n),Br!==null&&xa(Br,n),fl.forEach(e),pl.forEach(e),t=0;t<Pr.length;t++)i=Pr[t],i.blockedOn===n&&(i.blockedOn=null);for(;0<Pr.length&&(t=Pr[0],t.blockedOn===null);)lw(t),t.blockedOn===null&&Pr.shift()}var Lo=mr.ReactCurrentBatchConfig,wu=!0;function iE(n,e,t,i){var r=lt,s=Lo.transition;Lo.transition=null;try{lt=1,$p(n,e,t,i)}finally{lt=r,Lo.transition=s}}function rE(n,e,t,i){var r=lt,s=Lo.transition;Lo.transition=null;try{lt=4,$p(n,e,t,i)}finally{lt=r,Lo.transition=s}}function $p(n,e,t,i){if(wu){var r=Df(n,e,t,i);if(r===null)Jh(n,e,i,Su,t),qg(n,i);else if(tE(r,n,e,t,i))i.stopPropagation();else if(qg(n,i),e&4&&-1<eE.indexOf(n)){for(;r!==null;){var s=Bl(r);if(s!==null&&rw(s),s=Df(n,e,t,i),s===null&&Jh(n,e,i,Su,t),s===r)break;r=s}r!==null&&i.stopPropagation()}else Jh(n,e,i,null,t)}}var Su=null;function Df(n,e,t,i){if(Su=null,n=Xp(i),n=As(n),n!==null)if(e=zs(n),e===null)n=null;else if(t=e.tag,t===13){if(n=$x(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Su=n,null}function cw(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(jT()){case qp:return 1;case ew:return 4;case _u:case XT:return 16;case tw:return 536870912;default:return 16}default:return 16}}var Dr=null,Zp=null,nu=null;function uw(){if(nu)return nu;var n,e=Zp,t=e.length,i,r="value"in Dr?Dr.value:Dr.textContent,s=r.length;for(n=0;n<t&&e[n]===r[n];n++);var o=t-n;for(i=1;i<=o&&e[t-i]===r[s-i];i++);return nu=r.slice(n,1<i?1-i:void 0)}function iu(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function rc(){return!0}function Yg(){return!1}function zn(n){function e(t,i,r,s,o){this._reactName=t,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?rc:Yg,this.isPropagationStopped=Yg,this}return At(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=rc)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=rc)},persist:function(){},isPersistent:rc}),e}var la={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qp=zn(la),Ol=At({},la,{view:0,detail:0}),sE=zn(Ol),Wh,jh,wa,rh=At({},Ol,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Jp,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==wa&&(wa&&n.type==="mousemove"?(Wh=n.screenX-wa.screenX,jh=n.screenY-wa.screenY):jh=Wh=0,wa=n),Wh)},movementY:function(n){return"movementY"in n?n.movementY:jh}}),$g=zn(rh),oE=At({},rh,{dataTransfer:0}),aE=zn(oE),lE=At({},Ol,{relatedTarget:0}),Xh=zn(lE),cE=At({},la,{animationName:0,elapsedTime:0,pseudoElement:0}),uE=zn(cE),hE=At({},la,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),dE=zn(hE),fE=At({},la,{data:0}),Zg=zn(fE),pE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},mE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},gE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vE(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=gE[n])?!!e[n]:!1}function Jp(){return vE}var yE=At({},Ol,{key:function(n){if(n.key){var e=pE[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=iu(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?mE[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Jp,charCode:function(n){return n.type==="keypress"?iu(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?iu(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),_E=zn(yE),xE=At({},rh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Qg=zn(xE),wE=At({},Ol,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Jp}),SE=zn(wE),ME=At({},la,{propertyName:0,elapsedTime:0,pseudoElement:0}),AE=zn(ME),TE=At({},rh,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),EE=zn(TE),bE=[9,13,27,32],em=cr&&"CompositionEvent"in window,$a=null;cr&&"documentMode"in document&&($a=document.documentMode);var CE=cr&&"TextEvent"in window&&!$a,hw=cr&&(!em||$a&&8<$a&&11>=$a),Jg=" ",ev=!1;function dw(n,e){switch(n){case"keyup":return bE.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fw(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var ho=!1;function RE(n,e){switch(n){case"compositionend":return fw(e);case"keypress":return e.which!==32?null:(ev=!0,Jg);case"textInput":return n=e.data,n===Jg&&ev?null:n;default:return null}}function PE(n,e){if(ho)return n==="compositionend"||!em&&dw(n,e)?(n=uw(),nu=Zp=Dr=null,ho=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return hw&&e.locale!=="ko"?null:e.data;default:return null}}var LE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function tv(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!LE[n.type]:e==="textarea"}function pw(n,e,t,i){jx(i),e=Mu(e,"onChange"),0<e.length&&(t=new Qp("onChange","change",null,t,i),n.push({event:t,listeners:e}))}var Za=null,gl=null;function IE(n){Tw(n,0)}function sh(n){var e=mo(n);if(Ox(e))return n}function DE(n,e){if(n==="change")return e}var mw=!1;if(cr){var qh;if(cr){var Kh="oninput"in document;if(!Kh){var nv=document.createElement("div");nv.setAttribute("oninput","return;"),Kh=typeof nv.oninput=="function"}qh=Kh}else qh=!1;mw=qh&&(!document.documentMode||9<document.documentMode)}function iv(){Za&&(Za.detachEvent("onpropertychange",gw),gl=Za=null)}function gw(n){if(n.propertyName==="value"&&sh(gl)){var e=[];pw(e,gl,n,Xp(n)),Yx(IE,e)}}function NE(n,e,t){n==="focusin"?(iv(),Za=e,gl=t,Za.attachEvent("onpropertychange",gw)):n==="focusout"&&iv()}function kE(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return sh(gl)}function FE(n,e){if(n==="click")return sh(e)}function UE(n,e){if(n==="input"||n==="change")return sh(e)}function OE(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var mi=typeof Object.is=="function"?Object.is:OE;function vl(n,e){if(mi(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var r=t[i];if(!mf.call(e,r)||!mi(n[r],e[r]))return!1}return!0}function rv(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function sv(n,e){var t=rv(n);n=0;for(var i;t;){if(t.nodeType===3){if(i=n+t.textContent.length,n<=e&&i>=e)return{node:t,offset:e-n};n=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=rv(t)}}function vw(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?vw(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function yw(){for(var n=window,e=gu();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=gu(n.document)}return e}function tm(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function BE(n){var e=yw(),t=n.focusedElem,i=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&vw(t.ownerDocument.documentElement,t)){if(i!==null&&tm(t)){if(e=i.start,n=i.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var r=t.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!n.extend&&s>i&&(r=i,i=s,s=r),r=sv(t,s);var o=sv(t,i);r&&o&&(n.rangeCount!==1||n.anchorNode!==r.node||n.anchorOffset!==r.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),n.removeAllRanges(),s>i?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var zE=cr&&"documentMode"in document&&11>=document.documentMode,fo=null,Nf=null,Qa=null,kf=!1;function ov(n,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;kf||fo==null||fo!==gu(i)||(i=fo,"selectionStart"in i&&tm(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Qa&&vl(Qa,i)||(Qa=i,i=Mu(Nf,"onSelect"),0<i.length&&(e=new Qp("onSelect","select",null,e,t),n.push({event:e,listeners:i}),e.target=fo)))}function sc(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var po={animationend:sc("Animation","AnimationEnd"),animationiteration:sc("Animation","AnimationIteration"),animationstart:sc("Animation","AnimationStart"),transitionend:sc("Transition","TransitionEnd")},Yh={},_w={};cr&&(_w=document.createElement("div").style,"AnimationEvent"in window||(delete po.animationend.animation,delete po.animationiteration.animation,delete po.animationstart.animation),"TransitionEvent"in window||delete po.transitionend.transition);function oh(n){if(Yh[n])return Yh[n];if(!po[n])return n;var e=po[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in _w)return Yh[n]=e[t];return n}var xw=oh("animationend"),ww=oh("animationiteration"),Sw=oh("animationstart"),Mw=oh("transitionend"),Aw=new Map,av="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Jr(n,e){Aw.set(n,e),Bs(e,[n])}for(var $h=0;$h<av.length;$h++){var Zh=av[$h],VE=Zh.toLowerCase(),HE=Zh[0].toUpperCase()+Zh.slice(1);Jr(VE,"on"+HE)}Jr(xw,"onAnimationEnd");Jr(ww,"onAnimationIteration");Jr(Sw,"onAnimationStart");Jr("dblclick","onDoubleClick");Jr("focusin","onFocus");Jr("focusout","onBlur");Jr(Mw,"onTransitionEnd");Bo("onMouseEnter",["mouseout","mouseover"]);Bo("onMouseLeave",["mouseout","mouseover"]);Bo("onPointerEnter",["pointerout","pointerover"]);Bo("onPointerLeave",["pointerout","pointerover"]);Bs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Bs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Bs("onBeforeInput",["compositionend","keypress","textInput","paste"]);Bs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Bs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Bs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ha="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),GE=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ha));function lv(n,e,t){var i=n.type||"unknown-event";n.currentTarget=t,VT(i,e,void 0,n),n.currentTarget=null}function Tw(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var i=n[t],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;lv(r,a,c),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;lv(r,a,c),s=l}}}if(yu)throw n=Pf,yu=!1,Pf=null,n}function pt(n,e){var t=e[zf];t===void 0&&(t=e[zf]=new Set);var i=n+"__bubble";t.has(i)||(Ew(e,n,2,!1),t.add(i))}function Qh(n,e,t){var i=0;e&&(i|=4),Ew(t,n,i,e)}var oc="_reactListening"+Math.random().toString(36).slice(2);function yl(n){if(!n[oc]){n[oc]=!0,Dx.forEach(function(t){t!=="selectionchange"&&(GE.has(t)||Qh(t,!1,n),Qh(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[oc]||(e[oc]=!0,Qh("selectionchange",!1,e))}}function Ew(n,e,t,i){switch(cw(e)){case 1:var r=iE;break;case 4:r=rE;break;default:r=$p}t=r.bind(null,e,t,n),r=void 0,!Rf||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?n.addEventListener(e,t,{capture:!0,passive:r}):n.addEventListener(e,t,!0):r!==void 0?n.addEventListener(e,t,{passive:r}):n.addEventListener(e,t,!1)}function Jh(n,e,t,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=As(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}Yx(function(){var c=s,u=Xp(t),d=[];e:{var h=Aw.get(n);if(h!==void 0){var f=Qp,m=n;switch(n){case"keypress":if(iu(t)===0)break e;case"keydown":case"keyup":f=_E;break;case"focusin":m="focus",f=Xh;break;case"focusout":m="blur",f=Xh;break;case"beforeblur":case"afterblur":f=Xh;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=$g;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=aE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=SE;break;case xw:case ww:case Sw:f=uE;break;case Mw:f=AE;break;case"scroll":f=sE;break;case"wheel":f=EE;break;case"copy":case"cut":case"paste":f=dE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=Qg}var y=(e&4)!==0,g=!y&&n==="scroll",p=y?h!==null?h+"Capture":null:h;y=[];for(var v=c,_;v!==null;){_=v;var x=_.stateNode;if(_.tag===5&&x!==null&&(_=x,p!==null&&(x=dl(v,p),x!=null&&y.push(_l(v,x,_)))),g)break;v=v.return}0<y.length&&(h=new f(h,m,null,t,u),d.push({event:h,listeners:y}))}}if(!(e&7)){e:{if(h=n==="mouseover"||n==="pointerover",f=n==="mouseout"||n==="pointerout",h&&t!==bf&&(m=t.relatedTarget||t.fromElement)&&(As(m)||m[ur]))break e;if((f||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,f?(m=t.relatedTarget||t.toElement,f=c,m=m?As(m):null,m!==null&&(g=zs(m),m!==g||m.tag!==5&&m.tag!==6)&&(m=null)):(f=null,m=c),f!==m)){if(y=$g,x="onMouseLeave",p="onMouseEnter",v="mouse",(n==="pointerout"||n==="pointerover")&&(y=Qg,x="onPointerLeave",p="onPointerEnter",v="pointer"),g=f==null?h:mo(f),_=m==null?h:mo(m),h=new y(x,v+"leave",f,t,u),h.target=g,h.relatedTarget=_,x=null,As(u)===c&&(y=new y(p,v+"enter",m,t,u),y.target=_,y.relatedTarget=g,x=y),g=x,f&&m)t:{for(y=f,p=m,v=0,_=y;_;_=Hs(_))v++;for(_=0,x=p;x;x=Hs(x))_++;for(;0<v-_;)y=Hs(y),v--;for(;0<_-v;)p=Hs(p),_--;for(;v--;){if(y===p||p!==null&&y===p.alternate)break t;y=Hs(y),p=Hs(p)}y=null}else y=null;f!==null&&cv(d,h,f,y,!1),m!==null&&g!==null&&cv(d,g,m,y,!0)}}e:{if(h=c?mo(c):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var A=DE;else if(tv(h))if(mw)A=UE;else{A=kE;var M=NE}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(A=FE);if(A&&(A=A(n,c))){pw(d,A,t,u);break e}M&&M(n,h,c),n==="focusout"&&(M=h._wrapperState)&&M.controlled&&h.type==="number"&&Sf(h,"number",h.value)}switch(M=c?mo(c):window,n){case"focusin":(tv(M)||M.contentEditable==="true")&&(fo=M,Nf=c,Qa=null);break;case"focusout":Qa=Nf=fo=null;break;case"mousedown":kf=!0;break;case"contextmenu":case"mouseup":case"dragend":kf=!1,ov(d,t,u);break;case"selectionchange":if(zE)break;case"keydown":case"keyup":ov(d,t,u)}var S;if(em)e:{switch(n){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else ho?dw(n,t)&&(b="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(b="onCompositionStart");b&&(hw&&t.locale!=="ko"&&(ho||b!=="onCompositionStart"?b==="onCompositionEnd"&&ho&&(S=uw()):(Dr=u,Zp="value"in Dr?Dr.value:Dr.textContent,ho=!0)),M=Mu(c,b),0<M.length&&(b=new Zg(b,n,null,t,u),d.push({event:b,listeners:M}),S?b.data=S:(S=fw(t),S!==null&&(b.data=S)))),(S=CE?RE(n,t):PE(n,t))&&(c=Mu(c,"onBeforeInput"),0<c.length&&(u=new Zg("onBeforeInput","beforeinput",null,t,u),d.push({event:u,listeners:c}),u.data=S))}Tw(d,e)})}function _l(n,e,t){return{instance:n,listener:e,currentTarget:t}}function Mu(n,e){for(var t=e+"Capture",i=[];n!==null;){var r=n,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=dl(n,t),s!=null&&i.unshift(_l(n,s,r)),s=dl(n,e),s!=null&&i.push(_l(n,s,r))),n=n.return}return i}function Hs(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function cv(n,e,t,i,r){for(var s=e._reactName,o=[];t!==null&&t!==i;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,r?(l=dl(t,s),l!=null&&o.unshift(_l(t,l,a))):r||(l=dl(t,s),l!=null&&o.push(_l(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var WE=/\r\n?/g,jE=/\u0000|\uFFFD/g;function uv(n){return(typeof n=="string"?n:""+n).replace(WE,`
`).replace(jE,"")}function ac(n,e,t){if(e=uv(e),uv(n)!==e&&t)throw Error(se(425))}function Au(){}var Ff=null,Uf=null;function Of(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Bf=typeof setTimeout=="function"?setTimeout:void 0,XE=typeof clearTimeout=="function"?clearTimeout:void 0,hv=typeof Promise=="function"?Promise:void 0,qE=typeof queueMicrotask=="function"?queueMicrotask:typeof hv<"u"?function(n){return hv.resolve(null).then(n).catch(KE)}:Bf;function KE(n){setTimeout(function(){throw n})}function ed(n,e){var t=e,i=0;do{var r=t.nextSibling;if(n.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(i===0){n.removeChild(r),ml(e);return}i--}else t!=="$"&&t!=="$?"&&t!=="$!"||i++;t=r}while(t);ml(e)}function zr(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function dv(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var ca=Math.random().toString(36).slice(2),Ai="__reactFiber$"+ca,xl="__reactProps$"+ca,ur="__reactContainer$"+ca,zf="__reactEvents$"+ca,YE="__reactListeners$"+ca,$E="__reactHandles$"+ca;function As(n){var e=n[Ai];if(e)return e;for(var t=n.parentNode;t;){if(e=t[ur]||t[Ai]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=dv(n);n!==null;){if(t=n[Ai])return t;n=dv(n)}return e}n=t,t=n.parentNode}return null}function Bl(n){return n=n[Ai]||n[ur],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function mo(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(se(33))}function ah(n){return n[xl]||null}var Vf=[],go=-1;function es(n){return{current:n}}function gt(n){0>go||(n.current=Vf[go],Vf[go]=null,go--)}function dt(n,e){go++,Vf[go]=n.current,n.current=e}var Kr={},cn=es(Kr),Tn=es(!1),Ds=Kr;function zo(n,e){var t=n.type.contextTypes;if(!t)return Kr;var i=n.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in t)r[s]=e[s];return i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=r),r}function En(n){return n=n.childContextTypes,n!=null}function Tu(){gt(Tn),gt(cn)}function fv(n,e,t){if(cn.current!==Kr)throw Error(se(168));dt(cn,e),dt(Tn,t)}function bw(n,e,t){var i=n.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(se(108,NT(n)||"Unknown",r));return At({},t,i)}function Eu(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Kr,Ds=cn.current,dt(cn,n),dt(Tn,Tn.current),!0}function pv(n,e,t){var i=n.stateNode;if(!i)throw Error(se(169));t?(n=bw(n,e,Ds),i.__reactInternalMemoizedMergedChildContext=n,gt(Tn),gt(cn),dt(cn,n)):gt(Tn),dt(Tn,t)}var Ji=null,lh=!1,td=!1;function Cw(n){Ji===null?Ji=[n]:Ji.push(n)}function ZE(n){lh=!0,Cw(n)}function ts(){if(!td&&Ji!==null){td=!0;var n=0,e=lt;try{var t=Ji;for(lt=1;n<t.length;n++){var i=t[n];do i=i(!0);while(i!==null)}Ji=null,lh=!1}catch(r){throw Ji!==null&&(Ji=Ji.slice(n+1)),Jx(qp,ts),r}finally{lt=e,td=!1}}return null}var vo=[],yo=0,bu=null,Cu=0,qn=[],Kn=0,Ns=null,er=1,tr="";function ms(n,e){vo[yo++]=Cu,vo[yo++]=bu,bu=n,Cu=e}function Rw(n,e,t){qn[Kn++]=er,qn[Kn++]=tr,qn[Kn++]=Ns,Ns=n;var i=er;n=tr;var r=32-hi(i)-1;i&=~(1<<r),t+=1;var s=32-hi(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,er=1<<32-hi(e)+r|t<<r|i,tr=s+n}else er=1<<s|t<<r|i,tr=n}function nm(n){n.return!==null&&(ms(n,1),Rw(n,1,0))}function im(n){for(;n===bu;)bu=vo[--yo],vo[yo]=null,Cu=vo[--yo],vo[yo]=null;for(;n===Ns;)Ns=qn[--Kn],qn[Kn]=null,tr=qn[--Kn],qn[Kn]=null,er=qn[--Kn],qn[Kn]=null}var kn=null,Nn=null,yt=!1,ai=null;function Pw(n,e){var t=Yn(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function mv(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,kn=n,Nn=zr(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,kn=n,Nn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Ns!==null?{id:er,overflow:tr}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Yn(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,kn=n,Nn=null,!0):!1;default:return!1}}function Hf(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Gf(n){if(yt){var e=Nn;if(e){var t=e;if(!mv(n,e)){if(Hf(n))throw Error(se(418));e=zr(t.nextSibling);var i=kn;e&&mv(n,e)?Pw(i,t):(n.flags=n.flags&-4097|2,yt=!1,kn=n)}}else{if(Hf(n))throw Error(se(418));n.flags=n.flags&-4097|2,yt=!1,kn=n}}}function gv(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;kn=n}function lc(n){if(n!==kn)return!1;if(!yt)return gv(n),yt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!Of(n.type,n.memoizedProps)),e&&(e=Nn)){if(Hf(n))throw Lw(),Error(se(418));for(;e;)Pw(n,e),e=zr(e.nextSibling)}if(gv(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(se(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Nn=zr(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Nn=null}}else Nn=kn?zr(n.stateNode.nextSibling):null;return!0}function Lw(){for(var n=Nn;n;)n=zr(n.nextSibling)}function Vo(){Nn=kn=null,yt=!1}function rm(n){ai===null?ai=[n]:ai.push(n)}var QE=mr.ReactCurrentBatchConfig;function Sa(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(se(309));var i=t.stateNode}if(!i)throw Error(se(147,n));var r=i,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof n!="string")throw Error(se(284));if(!t._owner)throw Error(se(290,n))}return n}function cc(n,e){throw n=Object.prototype.toString.call(e),Error(se(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function vv(n){var e=n._init;return e(n._payload)}function Iw(n){function e(p,v){if(n){var _=p.deletions;_===null?(p.deletions=[v],p.flags|=16):_.push(v)}}function t(p,v){if(!n)return null;for(;v!==null;)e(p,v),v=v.sibling;return null}function i(p,v){for(p=new Map;v!==null;)v.key!==null?p.set(v.key,v):p.set(v.index,v),v=v.sibling;return p}function r(p,v){return p=Wr(p,v),p.index=0,p.sibling=null,p}function s(p,v,_){return p.index=_,n?(_=p.alternate,_!==null?(_=_.index,_<v?(p.flags|=2,v):_):(p.flags|=2,v)):(p.flags|=1048576,v)}function o(p){return n&&p.alternate===null&&(p.flags|=2),p}function a(p,v,_,x){return v===null||v.tag!==6?(v=ld(_,p.mode,x),v.return=p,v):(v=r(v,_),v.return=p,v)}function l(p,v,_,x){var A=_.type;return A===uo?u(p,v,_.props.children,x,_.key):v!==null&&(v.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===Cr&&vv(A)===v.type)?(x=r(v,_.props),x.ref=Sa(p,v,_),x.return=p,x):(x=uu(_.type,_.key,_.props,null,p.mode,x),x.ref=Sa(p,v,_),x.return=p,x)}function c(p,v,_,x){return v===null||v.tag!==4||v.stateNode.containerInfo!==_.containerInfo||v.stateNode.implementation!==_.implementation?(v=cd(_,p.mode,x),v.return=p,v):(v=r(v,_.children||[]),v.return=p,v)}function u(p,v,_,x,A){return v===null||v.tag!==7?(v=Ls(_,p.mode,x,A),v.return=p,v):(v=r(v,_),v.return=p,v)}function d(p,v,_){if(typeof v=="string"&&v!==""||typeof v=="number")return v=ld(""+v,p.mode,_),v.return=p,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Ql:return _=uu(v.type,v.key,v.props,null,p.mode,_),_.ref=Sa(p,null,v),_.return=p,_;case co:return v=cd(v,p.mode,_),v.return=p,v;case Cr:var x=v._init;return d(p,x(v._payload),_)}if(za(v)||va(v))return v=Ls(v,p.mode,_,null),v.return=p,v;cc(p,v)}return null}function h(p,v,_,x){var A=v!==null?v.key:null;if(typeof _=="string"&&_!==""||typeof _=="number")return A!==null?null:a(p,v,""+_,x);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case Ql:return _.key===A?l(p,v,_,x):null;case co:return _.key===A?c(p,v,_,x):null;case Cr:return A=_._init,h(p,v,A(_._payload),x)}if(za(_)||va(_))return A!==null?null:u(p,v,_,x,null);cc(p,_)}return null}function f(p,v,_,x,A){if(typeof x=="string"&&x!==""||typeof x=="number")return p=p.get(_)||null,a(v,p,""+x,A);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Ql:return p=p.get(x.key===null?_:x.key)||null,l(v,p,x,A);case co:return p=p.get(x.key===null?_:x.key)||null,c(v,p,x,A);case Cr:var M=x._init;return f(p,v,_,M(x._payload),A)}if(za(x)||va(x))return p=p.get(_)||null,u(v,p,x,A,null);cc(v,x)}return null}function m(p,v,_,x){for(var A=null,M=null,S=v,b=v=0,T=null;S!==null&&b<_.length;b++){S.index>b?(T=S,S=null):T=S.sibling;var w=h(p,S,_[b],x);if(w===null){S===null&&(S=T);break}n&&S&&w.alternate===null&&e(p,S),v=s(w,v,b),M===null?A=w:M.sibling=w,M=w,S=T}if(b===_.length)return t(p,S),yt&&ms(p,b),A;if(S===null){for(;b<_.length;b++)S=d(p,_[b],x),S!==null&&(v=s(S,v,b),M===null?A=S:M.sibling=S,M=S);return yt&&ms(p,b),A}for(S=i(p,S);b<_.length;b++)T=f(S,p,b,_[b],x),T!==null&&(n&&T.alternate!==null&&S.delete(T.key===null?b:T.key),v=s(T,v,b),M===null?A=T:M.sibling=T,M=T);return n&&S.forEach(function(P){return e(p,P)}),yt&&ms(p,b),A}function y(p,v,_,x){var A=va(_);if(typeof A!="function")throw Error(se(150));if(_=A.call(_),_==null)throw Error(se(151));for(var M=A=null,S=v,b=v=0,T=null,w=_.next();S!==null&&!w.done;b++,w=_.next()){S.index>b?(T=S,S=null):T=S.sibling;var P=h(p,S,w.value,x);if(P===null){S===null&&(S=T);break}n&&S&&P.alternate===null&&e(p,S),v=s(P,v,b),M===null?A=P:M.sibling=P,M=P,S=T}if(w.done)return t(p,S),yt&&ms(p,b),A;if(S===null){for(;!w.done;b++,w=_.next())w=d(p,w.value,x),w!==null&&(v=s(w,v,b),M===null?A=w:M.sibling=w,M=w);return yt&&ms(p,b),A}for(S=i(p,S);!w.done;b++,w=_.next())w=f(S,p,b,w.value,x),w!==null&&(n&&w.alternate!==null&&S.delete(w.key===null?b:w.key),v=s(w,v,b),M===null?A=w:M.sibling=w,M=w);return n&&S.forEach(function(V){return e(p,V)}),yt&&ms(p,b),A}function g(p,v,_,x){if(typeof _=="object"&&_!==null&&_.type===uo&&_.key===null&&(_=_.props.children),typeof _=="object"&&_!==null){switch(_.$$typeof){case Ql:e:{for(var A=_.key,M=v;M!==null;){if(M.key===A){if(A=_.type,A===uo){if(M.tag===7){t(p,M.sibling),v=r(M,_.props.children),v.return=p,p=v;break e}}else if(M.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===Cr&&vv(A)===M.type){t(p,M.sibling),v=r(M,_.props),v.ref=Sa(p,M,_),v.return=p,p=v;break e}t(p,M);break}else e(p,M);M=M.sibling}_.type===uo?(v=Ls(_.props.children,p.mode,x,_.key),v.return=p,p=v):(x=uu(_.type,_.key,_.props,null,p.mode,x),x.ref=Sa(p,v,_),x.return=p,p=x)}return o(p);case co:e:{for(M=_.key;v!==null;){if(v.key===M)if(v.tag===4&&v.stateNode.containerInfo===_.containerInfo&&v.stateNode.implementation===_.implementation){t(p,v.sibling),v=r(v,_.children||[]),v.return=p,p=v;break e}else{t(p,v);break}else e(p,v);v=v.sibling}v=cd(_,p.mode,x),v.return=p,p=v}return o(p);case Cr:return M=_._init,g(p,v,M(_._payload),x)}if(za(_))return m(p,v,_,x);if(va(_))return y(p,v,_,x);cc(p,_)}return typeof _=="string"&&_!==""||typeof _=="number"?(_=""+_,v!==null&&v.tag===6?(t(p,v.sibling),v=r(v,_),v.return=p,p=v):(t(p,v),v=ld(_,p.mode,x),v.return=p,p=v),o(p)):t(p,v)}return g}var Ho=Iw(!0),Dw=Iw(!1),Ru=es(null),Pu=null,_o=null,sm=null;function om(){sm=_o=Pu=null}function am(n){var e=Ru.current;gt(Ru),n._currentValue=e}function Wf(n,e,t){for(;n!==null;){var i=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),n===t)break;n=n.return}}function Io(n,e){Pu=n,sm=_o=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(An=!0),n.firstContext=null)}function Zn(n){var e=n._currentValue;if(sm!==n)if(n={context:n,memoizedValue:e,next:null},_o===null){if(Pu===null)throw Error(se(308));_o=n,Pu.dependencies={lanes:0,firstContext:n}}else _o=_o.next=n;return e}var Ts=null;function lm(n){Ts===null?Ts=[n]:Ts.push(n)}function Nw(n,e,t,i){var r=e.interleaved;return r===null?(t.next=t,lm(e)):(t.next=r.next,r.next=t),e.interleaved=t,hr(n,i)}function hr(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Rr=!1;function cm(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function kw(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function rr(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Vr(n,e,t){var i=n.updateQueue;if(i===null)return null;if(i=i.shared,Qe&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,hr(n,t)}return r=i.interleaved,r===null?(e.next=e,lm(i)):(e.next=r.next,r.next=e),i.interleaved=e,hr(n,t)}function ru(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,Kp(n,t)}}function yv(n,e){var t=n.updateQueue,i=n.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var r=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?r=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?r=s=e:s=s.next=e}else r=s=e;t={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Lu(n,e,t,i){var r=n.updateQueue;Rr=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=n.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var d=r.baseState;o=0,u=c=l=null,a=s;do{var h=a.lane,f=a.eventTime;if((i&h)===h){u!==null&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=n,y=a;switch(h=e,f=t,y.tag){case 1:if(m=y.payload,typeof m=="function"){d=m.call(f,d,h);break e}d=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=y.payload,h=typeof m=="function"?m.call(f,d,h):m,h==null)break e;d=At({},d,h);break e;case 2:Rr=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else f={eventTime:f,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=f,l=d):u=u.next=f,o|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(!0);if(u===null&&(l=d),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);Fs|=o,n.lanes=o,n.memoizedState=d}}function _v(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var i=n[e],r=i.callback;if(r!==null){if(i.callback=null,i=t,typeof r!="function")throw Error(se(191,r));r.call(i)}}}var zl={},Pi=es(zl),wl=es(zl),Sl=es(zl);function Es(n){if(n===zl)throw Error(se(174));return n}function um(n,e){switch(dt(Sl,e),dt(wl,n),dt(Pi,zl),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Af(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Af(e,n)}gt(Pi),dt(Pi,e)}function Go(){gt(Pi),gt(wl),gt(Sl)}function Fw(n){Es(Sl.current);var e=Es(Pi.current),t=Af(e,n.type);e!==t&&(dt(wl,n),dt(Pi,t))}function hm(n){wl.current===n&&(gt(Pi),gt(wl))}var xt=es(0);function Iu(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var nd=[];function dm(){for(var n=0;n<nd.length;n++)nd[n]._workInProgressVersionPrimary=null;nd.length=0}var su=mr.ReactCurrentDispatcher,id=mr.ReactCurrentBatchConfig,ks=0,St=null,Bt=null,Xt=null,Du=!1,Ja=!1,Ml=0,JE=0;function en(){throw Error(se(321))}function fm(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!mi(n[t],e[t]))return!1;return!0}function pm(n,e,t,i,r,s){if(ks=s,St=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,su.current=n===null||n.memoizedState===null?ib:rb,n=t(i,r),Ja){s=0;do{if(Ja=!1,Ml=0,25<=s)throw Error(se(301));s+=1,Xt=Bt=null,e.updateQueue=null,su.current=sb,n=t(i,r)}while(Ja)}if(su.current=Nu,e=Bt!==null&&Bt.next!==null,ks=0,Xt=Bt=St=null,Du=!1,e)throw Error(se(300));return n}function mm(){var n=Ml!==0;return Ml=0,n}function Si(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xt===null?St.memoizedState=Xt=n:Xt=Xt.next=n,Xt}function Qn(){if(Bt===null){var n=St.alternate;n=n!==null?n.memoizedState:null}else n=Bt.next;var e=Xt===null?St.memoizedState:Xt.next;if(e!==null)Xt=e,Bt=n;else{if(n===null)throw Error(se(310));Bt=n,n={memoizedState:Bt.memoizedState,baseState:Bt.baseState,baseQueue:Bt.baseQueue,queue:Bt.queue,next:null},Xt===null?St.memoizedState=Xt=n:Xt=Xt.next=n}return Xt}function Al(n,e){return typeof e=="function"?e(n):e}function rd(n){var e=Qn(),t=e.queue;if(t===null)throw Error(se(311));t.lastRenderedReducer=n;var i=Bt,r=i.baseQueue,s=t.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,t.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((ks&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:n(i,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,o=i):l=l.next=d,St.lanes|=u,Fs|=u}c=c.next}while(c!==null&&c!==s);l===null?o=i:l.next=a,mi(i,e.memoizedState)||(An=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,t.lastRenderedState=i}if(n=t.interleaved,n!==null){r=n;do s=r.lane,St.lanes|=s,Fs|=s,r=r.next;while(r!==n)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function sd(n){var e=Qn(),t=e.queue;if(t===null)throw Error(se(311));t.lastRenderedReducer=n;var i=t.dispatch,r=t.pending,s=e.memoizedState;if(r!==null){t.pending=null;var o=r=r.next;do s=n(s,o.action),o=o.next;while(o!==r);mi(s,e.memoizedState)||(An=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,i]}function Uw(){}function Ow(n,e){var t=St,i=Qn(),r=e(),s=!mi(i.memoizedState,r);if(s&&(i.memoizedState=r,An=!0),i=i.queue,gm(Vw.bind(null,t,i,n),[n]),i.getSnapshot!==e||s||Xt!==null&&Xt.memoizedState.tag&1){if(t.flags|=2048,Tl(9,zw.bind(null,t,i,r,e),void 0,null),qt===null)throw Error(se(349));ks&30||Bw(t,e,r)}return r}function Bw(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=St.updateQueue,e===null?(e={lastEffect:null,stores:null},St.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function zw(n,e,t,i){e.value=t,e.getSnapshot=i,Hw(e)&&Gw(n)}function Vw(n,e,t){return t(function(){Hw(e)&&Gw(n)})}function Hw(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!mi(n,t)}catch{return!0}}function Gw(n){var e=hr(n,1);e!==null&&di(e,n,1,-1)}function xv(n){var e=Si();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Al,lastRenderedState:n},e.queue=n,n=n.dispatch=nb.bind(null,St,n),[e.memoizedState,n]}function Tl(n,e,t,i){return n={tag:n,create:e,destroy:t,deps:i,next:null},e=St.updateQueue,e===null?(e={lastEffect:null,stores:null},St.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(i=t.next,t.next=n,n.next=i,e.lastEffect=n)),n}function Ww(){return Qn().memoizedState}function ou(n,e,t,i){var r=Si();St.flags|=n,r.memoizedState=Tl(1|e,t,void 0,i===void 0?null:i)}function ch(n,e,t,i){var r=Qn();i=i===void 0?null:i;var s=void 0;if(Bt!==null){var o=Bt.memoizedState;if(s=o.destroy,i!==null&&fm(i,o.deps)){r.memoizedState=Tl(e,t,s,i);return}}St.flags|=n,r.memoizedState=Tl(1|e,t,s,i)}function wv(n,e){return ou(8390656,8,n,e)}function gm(n,e){return ch(2048,8,n,e)}function jw(n,e){return ch(4,2,n,e)}function Xw(n,e){return ch(4,4,n,e)}function qw(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function Kw(n,e,t){return t=t!=null?t.concat([n]):null,ch(4,4,qw.bind(null,e,n),t)}function vm(){}function Yw(n,e){var t=Qn();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&fm(e,i[1])?i[0]:(t.memoizedState=[n,e],n)}function $w(n,e){var t=Qn();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&fm(e,i[1])?i[0]:(n=n(),t.memoizedState=[n,e],n)}function Zw(n,e,t){return ks&21?(mi(t,e)||(t=nw(),St.lanes|=t,Fs|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,An=!0),n.memoizedState=t)}function eb(n,e){var t=lt;lt=t!==0&&4>t?t:4,n(!0);var i=id.transition;id.transition={};try{n(!1),e()}finally{lt=t,id.transition=i}}function Qw(){return Qn().memoizedState}function tb(n,e,t){var i=Gr(n);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},Jw(n))eS(e,t);else if(t=Nw(n,e,t,i),t!==null){var r=yn();di(t,n,i,r),tS(t,e,i)}}function nb(n,e,t){var i=Gr(n),r={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(Jw(n))eS(e,r);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(r.hasEagerState=!0,r.eagerState=a,mi(a,o)){var l=e.interleaved;l===null?(r.next=r,lm(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}t=Nw(n,e,r,i),t!==null&&(r=yn(),di(t,n,i,r),tS(t,e,i))}}function Jw(n){var e=n.alternate;return n===St||e!==null&&e===St}function eS(n,e){Ja=Du=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function tS(n,e,t){if(t&4194240){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,Kp(n,t)}}var Nu={readContext:Zn,useCallback:en,useContext:en,useEffect:en,useImperativeHandle:en,useInsertionEffect:en,useLayoutEffect:en,useMemo:en,useReducer:en,useRef:en,useState:en,useDebugValue:en,useDeferredValue:en,useTransition:en,useMutableSource:en,useSyncExternalStore:en,useId:en,unstable_isNewReconciler:!1},ib={readContext:Zn,useCallback:function(n,e){return Si().memoizedState=[n,e===void 0?null:e],n},useContext:Zn,useEffect:wv,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,ou(4194308,4,qw.bind(null,e,n),t)},useLayoutEffect:function(n,e){return ou(4194308,4,n,e)},useInsertionEffect:function(n,e){return ou(4,2,n,e)},useMemo:function(n,e){var t=Si();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var i=Si();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},i.queue=n,n=n.dispatch=tb.bind(null,St,n),[i.memoizedState,n]},useRef:function(n){var e=Si();return n={current:n},e.memoizedState=n},useState:xv,useDebugValue:vm,useDeferredValue:function(n){return Si().memoizedState=n},useTransition:function(){var n=xv(!1),e=n[0];return n=eb.bind(null,n[1]),Si().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var i=St,r=Si();if(yt){if(t===void 0)throw Error(se(407));t=t()}else{if(t=e(),qt===null)throw Error(se(349));ks&30||Bw(i,e,t)}r.memoizedState=t;var s={value:t,getSnapshot:e};return r.queue=s,wv(Vw.bind(null,i,s,n),[n]),i.flags|=2048,Tl(9,zw.bind(null,i,s,t,e),void 0,null),t},useId:function(){var n=Si(),e=qt.identifierPrefix;if(yt){var t=tr,i=er;t=(i&~(1<<32-hi(i)-1)).toString(32)+t,e=":"+e+"R"+t,t=Ml++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=JE++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},rb={readContext:Zn,useCallback:Yw,useContext:Zn,useEffect:gm,useImperativeHandle:Kw,useInsertionEffect:jw,useLayoutEffect:Xw,useMemo:$w,useReducer:rd,useRef:Ww,useState:function(){return rd(Al)},useDebugValue:vm,useDeferredValue:function(n){var e=Qn();return Zw(e,Bt.memoizedState,n)},useTransition:function(){var n=rd(Al)[0],e=Qn().memoizedState;return[n,e]},useMutableSource:Uw,useSyncExternalStore:Ow,useId:Qw,unstable_isNewReconciler:!1},sb={readContext:Zn,useCallback:Yw,useContext:Zn,useEffect:gm,useImperativeHandle:Kw,useInsertionEffect:jw,useLayoutEffect:Xw,useMemo:$w,useReducer:sd,useRef:Ww,useState:function(){return sd(Al)},useDebugValue:vm,useDeferredValue:function(n){var e=Qn();return Bt===null?e.memoizedState=n:Zw(e,Bt.memoizedState,n)},useTransition:function(){var n=sd(Al)[0],e=Qn().memoizedState;return[n,e]},useMutableSource:Uw,useSyncExternalStore:Ow,useId:Qw,unstable_isNewReconciler:!1};function si(n,e){if(n&&n.defaultProps){e=At({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function jf(n,e,t,i){e=n.memoizedState,t=t(i,e),t=t==null?e:At({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var uh={isMounted:function(n){return(n=n._reactInternals)?zs(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var i=yn(),r=Gr(n),s=rr(i,r);s.payload=e,t!=null&&(s.callback=t),e=Vr(n,s,r),e!==null&&(di(e,n,r,i),ru(e,n,r))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var i=yn(),r=Gr(n),s=rr(i,r);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=Vr(n,s,r),e!==null&&(di(e,n,r,i),ru(e,n,r))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=yn(),i=Gr(n),r=rr(t,i);r.tag=2,e!=null&&(r.callback=e),e=Vr(n,r,i),e!==null&&(di(e,n,i,t),ru(e,n,i))}};function Sv(n,e,t,i,r,s,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!vl(t,i)||!vl(r,s):!0}function nS(n,e,t){var i=!1,r=Kr,s=e.contextType;return typeof s=="object"&&s!==null?s=Zn(s):(r=En(e)?Ds:cn.current,i=e.contextTypes,s=(i=i!=null)?zo(n,r):Kr),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=uh,n.stateNode=e,e._reactInternals=n,i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=s),e}function Mv(n,e,t,i){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==n&&uh.enqueueReplaceState(e,e.state,null)}function Xf(n,e,t,i){var r=n.stateNode;r.props=t,r.state=n.memoizedState,r.refs={},cm(n);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Zn(s):(s=En(e)?Ds:cn.current,r.context=zo(n,s)),r.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(jf(n,e,s,t),r.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&uh.enqueueReplaceState(r,r.state,null),Lu(n,t,r,i),r.state=n.memoizedState),typeof r.componentDidMount=="function"&&(n.flags|=4194308)}function Wo(n,e){try{var t="",i=e;do t+=DT(i),i=i.return;while(i);var r=t}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:r,digest:null}}function od(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function qf(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var ob=typeof WeakMap=="function"?WeakMap:Map;function iS(n,e,t){t=rr(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){Fu||(Fu=!0,ip=i),qf(n,e)},t}function rS(n,e,t){t=rr(-1,t),t.tag=3;var i=n.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;t.payload=function(){return i(r)},t.callback=function(){qf(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){qf(n,e),typeof i!="function"&&(Hr===null?Hr=new Set([this]):Hr.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function Av(n,e,t){var i=n.pingCache;if(i===null){i=n.pingCache=new ob;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(t)||(r.add(t),n=xb.bind(null,n,e,t),e.then(n,n))}function Tv(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function Ev(n,e,t,i,r){return n.mode&1?(n.flags|=65536,n.lanes=r,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=rr(-1,1),e.tag=2,Vr(t,e,1))),t.lanes|=1),n)}var ab=mr.ReactCurrentOwner,An=!1;function fn(n,e,t,i){e.child=n===null?Dw(e,null,t,i):Ho(e,n.child,t,i)}function bv(n,e,t,i,r){t=t.render;var s=e.ref;return Io(e,r),i=pm(n,e,t,i,s,r),t=mm(),n!==null&&!An?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,dr(n,e,r)):(yt&&t&&nm(e),e.flags|=1,fn(n,e,i,r),e.child)}function Cv(n,e,t,i,r){if(n===null){var s=t.type;return typeof s=="function"&&!Tm(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,sS(n,e,s,i,r)):(n=uu(t.type,null,i,e,e.mode,r),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&r)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:vl,t(o,i)&&n.ref===e.ref)return dr(n,e,r)}return e.flags|=1,n=Wr(s,i),n.ref=e.ref,n.return=e,e.child=n}function sS(n,e,t,i,r){if(n!==null){var s=n.memoizedProps;if(vl(s,i)&&n.ref===e.ref)if(An=!1,e.pendingProps=i=s,(n.lanes&r)!==0)n.flags&131072&&(An=!0);else return e.lanes=n.lanes,dr(n,e,r)}return Kf(n,e,t,i,r)}function oS(n,e,t){var i=e.pendingProps,r=i.children,s=n!==null?n.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},dt(wo,In),In|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,dt(wo,In),In|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:t,dt(wo,In),In|=i}else s!==null?(i=s.baseLanes|t,e.memoizedState=null):i=t,dt(wo,In),In|=i;return fn(n,e,r,t),e.child}function aS(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Kf(n,e,t,i,r){var s=En(t)?Ds:cn.current;return s=zo(e,s),Io(e,r),t=pm(n,e,t,i,s,r),i=mm(),n!==null&&!An?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,dr(n,e,r)):(yt&&i&&nm(e),e.flags|=1,fn(n,e,t,r),e.child)}function Rv(n,e,t,i,r){if(En(t)){var s=!0;Eu(e)}else s=!1;if(Io(e,r),e.stateNode===null)au(n,e),nS(e,t,i),Xf(e,t,i,r),i=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=t.contextType;typeof c=="object"&&c!==null?c=Zn(c):(c=En(t)?Ds:cn.current,c=zo(e,c));var u=t.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&Mv(e,o,i,c),Rr=!1;var h=e.memoizedState;o.state=h,Lu(e,i,o,r),l=e.memoizedState,a!==i||h!==l||Tn.current||Rr?(typeof u=="function"&&(jf(e,t,u,i),l=e.memoizedState),(a=Rr||Sv(e,t,a,i,h,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,kw(n,e),a=e.memoizedProps,c=e.type===e.elementType?a:si(e.type,a),o.props=c,d=e.pendingProps,h=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=Zn(l):(l=En(t)?Ds:cn.current,l=zo(e,l));var f=t.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==l)&&Mv(e,o,i,l),Rr=!1,h=e.memoizedState,o.state=h,Lu(e,i,o,r);var m=e.memoizedState;a!==d||h!==m||Tn.current||Rr?(typeof f=="function"&&(jf(e,t,f,i),m=e.memoizedState),(c=Rr||Sv(e,t,c,i,h,m,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,m,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,m,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=m),o.props=i,o.state=m,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),i=!1)}return Yf(n,e,t,i,s,r)}function Yf(n,e,t,i,r,s){aS(n,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&pv(e,t,!1),dr(n,e,s);i=e.stateNode,ab.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,n!==null&&o?(e.child=Ho(e,n.child,null,s),e.child=Ho(e,null,a,s)):fn(n,e,a,s),e.memoizedState=i.state,r&&pv(e,t,!0),e.child}function lS(n){var e=n.stateNode;e.pendingContext?fv(n,e.pendingContext,e.pendingContext!==e.context):e.context&&fv(n,e.context,!1),um(n,e.containerInfo)}function Pv(n,e,t,i,r){return Vo(),rm(r),e.flags|=256,fn(n,e,t,i),e.child}var $f={dehydrated:null,treeContext:null,retryLane:0};function Zf(n){return{baseLanes:n,cachePool:null,transitions:null}}function cS(n,e,t){var i=e.pendingProps,r=xt.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(r|=1),dt(xt,r&1),n===null)return Gf(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,n=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=fh(o,i,0,null),n=Ls(n,i,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=Zf(t),e.memoizedState=$f,n):ym(e,o));if(r=n.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return lb(n,e,o,i,a,r,t);if(s){s=i.fallback,o=e.mode,r=n.child,a=r.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=Wr(r,l),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=Wr(a,s):(s=Ls(s,o,t,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=n.child.memoizedState,o=o===null?Zf(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=n.childLanes&~t,e.memoizedState=$f,i}return s=n.child,n=s.sibling,i=Wr(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=t),i.return=e,i.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=i,e.memoizedState=null,i}function ym(n,e){return e=fh({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function uc(n,e,t,i){return i!==null&&rm(i),Ho(e,n.child,null,t),n=ym(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function lb(n,e,t,i,r,s,o){if(t)return e.flags&256?(e.flags&=-257,i=od(Error(se(422))),uc(n,e,o,i)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=fh({mode:"visible",children:i.children},r,0,null),s=Ls(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&Ho(e,n.child,null,o),e.child.memoizedState=Zf(o),e.memoizedState=$f,s);if(!(e.mode&1))return uc(n,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(se(419)),i=od(s,i,void 0),uc(n,e,o,i)}if(a=(o&n.childLanes)!==0,An||a){if(i=qt,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,hr(n,r),di(i,n,r,-1))}return Am(),i=od(Error(se(421))),uc(n,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=n.child,e=wb.bind(null,n),r._reactRetry=e,null):(n=s.treeContext,Nn=zr(r.nextSibling),kn=e,yt=!0,ai=null,n!==null&&(qn[Kn++]=er,qn[Kn++]=tr,qn[Kn++]=Ns,er=n.id,tr=n.overflow,Ns=e),e=ym(e,i.children),e.flags|=4096,e)}function Lv(n,e,t){n.lanes|=e;var i=n.alternate;i!==null&&(i.lanes|=e),Wf(n.return,e,t)}function ad(n,e,t,i,r){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=t,s.tailMode=r)}function uS(n,e,t){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(fn(n,e,i.children,t),i=xt.current,i&2)i=i&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Lv(n,t,e);else if(n.tag===19)Lv(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}i&=1}if(dt(xt,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)n=t.alternate,n!==null&&Iu(n)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),ad(e,!1,r,t,s);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(n=r.alternate,n!==null&&Iu(n)===null){e.child=r;break}n=r.sibling,r.sibling=t,t=r,r=n}ad(e,!0,t,null,s);break;case"together":ad(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function au(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function dr(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Fs|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(se(153));if(e.child!==null){for(n=e.child,t=Wr(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Wr(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function cb(n,e,t){switch(e.tag){case 3:lS(e),Vo();break;case 5:Fw(e);break;case 1:En(e.type)&&Eu(e);break;case 4:um(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;dt(Ru,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(dt(xt,xt.current&1),e.flags|=128,null):t&e.child.childLanes?cS(n,e,t):(dt(xt,xt.current&1),n=dr(n,e,t),n!==null?n.sibling:null);dt(xt,xt.current&1);break;case 19:if(i=(t&e.childLanes)!==0,n.flags&128){if(i)return uS(n,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),dt(xt,xt.current),i)break;return null;case 22:case 23:return e.lanes=0,oS(n,e,t)}return dr(n,e,t)}var hS,Qf,dS,fS;hS=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Qf=function(){};dS=function(n,e,t,i){var r=n.memoizedProps;if(r!==i){n=e.stateNode,Es(Pi.current);var s=null;switch(t){case"input":r=xf(n,r),i=xf(n,i),s=[];break;case"select":r=At({},r,{value:void 0}),i=At({},i,{value:void 0}),s=[];break;case"textarea":r=Mf(n,r),i=Mf(n,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(n.onclick=Au)}Tf(t,i);var o;t=null;for(c in r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(ul.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(a=r!=null?r[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(s||(s=[]),s.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(ul.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&pt("scroll",n),s||a===l||(s=[])):(s=s||[]).push(c,l))}t&&(s=s||[]).push("style",t);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};fS=function(n,e,t,i){t!==i&&(e.flags|=4)};function Ma(n,e){if(!yt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:i.sibling=null}}function tn(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,i=0;if(e)for(var r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=n,r=r.sibling;else for(r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=n,r=r.sibling;return n.subtreeFlags|=i,n.childLanes=t,e}function ub(n,e,t){var i=e.pendingProps;switch(im(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return tn(e),null;case 1:return En(e.type)&&Tu(),tn(e),null;case 3:return i=e.stateNode,Go(),gt(Tn),gt(cn),dm(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(n===null||n.child===null)&&(lc(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,ai!==null&&(op(ai),ai=null))),Qf(n,e),tn(e),null;case 5:hm(e);var r=Es(Sl.current);if(t=e.type,n!==null&&e.stateNode!=null)dS(n,e,t,i,r),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(se(166));return tn(e),null}if(n=Es(Pi.current),lc(e)){i=e.stateNode,t=e.type;var s=e.memoizedProps;switch(i[Ai]=e,i[xl]=s,n=(e.mode&1)!==0,t){case"dialog":pt("cancel",i),pt("close",i);break;case"iframe":case"object":case"embed":pt("load",i);break;case"video":case"audio":for(r=0;r<Ha.length;r++)pt(Ha[r],i);break;case"source":pt("error",i);break;case"img":case"image":case"link":pt("error",i),pt("load",i);break;case"details":pt("toggle",i);break;case"input":zg(i,s),pt("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},pt("invalid",i);break;case"textarea":Hg(i,s),pt("invalid",i)}Tf(t,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&ac(i.textContent,a,n),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&ac(i.textContent,a,n),r=["children",""+a]):ul.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&pt("scroll",i)}switch(t){case"input":Jl(i),Vg(i,s,!0);break;case"textarea":Jl(i),Gg(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=Au)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Vx(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof i.is=="string"?n=o.createElement(t,{is:i.is}):(n=o.createElement(t),t==="select"&&(o=n,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):n=o.createElementNS(n,t),n[Ai]=e,n[xl]=i,hS(n,e,!1,!1),e.stateNode=n;e:{switch(o=Ef(t,i),t){case"dialog":pt("cancel",n),pt("close",n),r=i;break;case"iframe":case"object":case"embed":pt("load",n),r=i;break;case"video":case"audio":for(r=0;r<Ha.length;r++)pt(Ha[r],n);r=i;break;case"source":pt("error",n),r=i;break;case"img":case"image":case"link":pt("error",n),pt("load",n),r=i;break;case"details":pt("toggle",n),r=i;break;case"input":zg(n,i),r=xf(n,i),pt("invalid",n);break;case"option":r=i;break;case"select":n._wrapperState={wasMultiple:!!i.multiple},r=At({},i,{value:void 0}),pt("invalid",n);break;case"textarea":Hg(n,i),r=Mf(n,i),pt("invalid",n);break;default:r=i}Tf(t,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?Wx(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Hx(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&hl(n,l):typeof l=="number"&&hl(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(ul.hasOwnProperty(s)?l!=null&&s==="onScroll"&&pt("scroll",n):l!=null&&Hp(n,s,l,o))}switch(t){case"input":Jl(n),Vg(n,i,!1);break;case"textarea":Jl(n),Gg(n);break;case"option":i.value!=null&&n.setAttribute("value",""+qr(i.value));break;case"select":n.multiple=!!i.multiple,s=i.value,s!=null?Co(n,!!i.multiple,s,!1):i.defaultValue!=null&&Co(n,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(n.onclick=Au)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return tn(e),null;case 6:if(n&&e.stateNode!=null)fS(n,e,n.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(se(166));if(t=Es(Sl.current),Es(Pi.current),lc(e)){if(i=e.stateNode,t=e.memoizedProps,i[Ai]=e,(s=i.nodeValue!==t)&&(n=kn,n!==null))switch(n.tag){case 3:ac(i.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&ac(i.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[Ai]=e,e.stateNode=i}return tn(e),null;case 13:if(gt(xt),i=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(yt&&Nn!==null&&e.mode&1&&!(e.flags&128))Lw(),Vo(),e.flags|=98560,s=!1;else if(s=lc(e),i!==null&&i.dehydrated!==null){if(n===null){if(!s)throw Error(se(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(se(317));s[Ai]=e}else Vo(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;tn(e),s=!1}else ai!==null&&(op(ai),ai=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(i=i!==null,i!==(n!==null&&n.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(n===null||xt.current&1?zt===0&&(zt=3):Am())),e.updateQueue!==null&&(e.flags|=4),tn(e),null);case 4:return Go(),Qf(n,e),n===null&&yl(e.stateNode.containerInfo),tn(e),null;case 10:return am(e.type._context),tn(e),null;case 17:return En(e.type)&&Tu(),tn(e),null;case 19:if(gt(xt),s=e.memoizedState,s===null)return tn(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)Ma(s,!1);else{if(zt!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Iu(n),o!==null){for(e.flags|=128,Ma(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=t,t=e.child;t!==null;)s=t,n=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,n=o.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return dt(xt,xt.current&1|2),e.child}n=n.sibling}s.tail!==null&&It()>jo&&(e.flags|=128,i=!0,Ma(s,!1),e.lanes=4194304)}else{if(!i)if(n=Iu(o),n!==null){if(e.flags|=128,i=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Ma(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!yt)return tn(e),null}else 2*It()-s.renderingStartTime>jo&&t!==1073741824&&(e.flags|=128,i=!0,Ma(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=It(),e.sibling=null,t=xt.current,dt(xt,i?t&1|2:t&1),e):(tn(e),null);case 22:case 23:return Mm(),i=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?In&1073741824&&(tn(e),e.subtreeFlags&6&&(e.flags|=8192)):tn(e),null;case 24:return null;case 25:return null}throw Error(se(156,e.tag))}function hb(n,e){switch(im(e),e.tag){case 1:return En(e.type)&&Tu(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Go(),gt(Tn),gt(cn),dm(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return hm(e),null;case 13:if(gt(xt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(se(340));Vo()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return gt(xt),null;case 4:return Go(),null;case 10:return am(e.type._context),null;case 22:case 23:return Mm(),null;case 24:return null;default:return null}}var hc=!1,on=!1,db=typeof WeakSet=="function"?WeakSet:Set,ve=null;function xo(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(i){Ct(n,e,i)}else t.current=null}function Jf(n,e,t){try{t()}catch(i){Ct(n,e,i)}}var Iv=!1;function fb(n,e){if(Ff=wu,n=yw(),tm(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,c=0,u=0,d=n,h=null;t:for(;;){for(var f;d!==t||r!==0&&d.nodeType!==3||(a=o+r),d!==s||i!==0&&d.nodeType!==3||(l=o+i),d.nodeType===3&&(o+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===n)break t;if(h===t&&++c===r&&(a=o),h===s&&++u===i&&(l=o),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Uf={focusedElem:n,selectionRange:t},wu=!1,ve=e;ve!==null;)if(e=ve,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,ve=n;else for(;ve!==null;){e=ve;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var y=m.memoizedProps,g=m.memoizedState,p=e.stateNode,v=p.getSnapshotBeforeUpdate(e.elementType===e.type?y:si(e.type,y),g);p.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var _=e.stateNode.containerInfo;_.nodeType===1?_.textContent="":_.nodeType===9&&_.documentElement&&_.removeChild(_.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(se(163))}}catch(x){Ct(e,e.return,x)}if(n=e.sibling,n!==null){n.return=e.return,ve=n;break}ve=e.return}return m=Iv,Iv=!1,m}function el(n,e,t){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&n)===n){var s=r.destroy;r.destroy=void 0,s!==void 0&&Jf(e,t,s)}r=r.next}while(r!==i)}}function hh(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}}function ep(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function pS(n){var e=n.alternate;e!==null&&(n.alternate=null,pS(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Ai],delete e[xl],delete e[zf],delete e[YE],delete e[$E])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function mS(n){return n.tag===5||n.tag===3||n.tag===4}function Dv(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||mS(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function tp(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Au));else if(i!==4&&(n=n.child,n!==null))for(tp(n,e,t),n=n.sibling;n!==null;)tp(n,e,t),n=n.sibling}function np(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(i!==4&&(n=n.child,n!==null))for(np(n,e,t),n=n.sibling;n!==null;)np(n,e,t),n=n.sibling}var Yt=null,oi=!1;function yr(n,e,t){for(t=t.child;t!==null;)gS(n,e,t),t=t.sibling}function gS(n,e,t){if(Ri&&typeof Ri.onCommitFiberUnmount=="function")try{Ri.onCommitFiberUnmount(ih,t)}catch{}switch(t.tag){case 5:on||xo(t,e);case 6:var i=Yt,r=oi;Yt=null,yr(n,e,t),Yt=i,oi=r,Yt!==null&&(oi?(n=Yt,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Yt.removeChild(t.stateNode));break;case 18:Yt!==null&&(oi?(n=Yt,t=t.stateNode,n.nodeType===8?ed(n.parentNode,t):n.nodeType===1&&ed(n,t),ml(n)):ed(Yt,t.stateNode));break;case 4:i=Yt,r=oi,Yt=t.stateNode.containerInfo,oi=!0,yr(n,e,t),Yt=i,oi=r;break;case 0:case 11:case 14:case 15:if(!on&&(i=t.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Jf(t,e,o),r=r.next}while(r!==i)}yr(n,e,t);break;case 1:if(!on&&(xo(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(a){Ct(t,e,a)}yr(n,e,t);break;case 21:yr(n,e,t);break;case 22:t.mode&1?(on=(i=on)||t.memoizedState!==null,yr(n,e,t),on=i):yr(n,e,t);break;default:yr(n,e,t)}}function Nv(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new db),e.forEach(function(i){var r=Sb.bind(null,n,i);t.has(i)||(t.add(i),i.then(r,r))})}}function Jn(n,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var r=t[i];try{var s=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Yt=a.stateNode,oi=!1;break e;case 3:Yt=a.stateNode.containerInfo,oi=!0;break e;case 4:Yt=a.stateNode.containerInfo,oi=!0;break e}a=a.return}if(Yt===null)throw Error(se(160));gS(s,o,r),Yt=null,oi=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){Ct(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)vS(e,n),e=e.sibling}function vS(n,e){var t=n.alternate,i=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Jn(e,n),yi(n),i&4){try{el(3,n,n.return),hh(3,n)}catch(y){Ct(n,n.return,y)}try{el(5,n,n.return)}catch(y){Ct(n,n.return,y)}}break;case 1:Jn(e,n),yi(n),i&512&&t!==null&&xo(t,t.return);break;case 5:if(Jn(e,n),yi(n),i&512&&t!==null&&xo(t,t.return),n.flags&32){var r=n.stateNode;try{hl(r,"")}catch(y){Ct(n,n.return,y)}}if(i&4&&(r=n.stateNode,r!=null)){var s=n.memoizedProps,o=t!==null?t.memoizedProps:s,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&Bx(r,s),Ef(a,o);var c=Ef(a,s);for(o=0;o<l.length;o+=2){var u=l[o],d=l[o+1];u==="style"?Wx(r,d):u==="dangerouslySetInnerHTML"?Hx(r,d):u==="children"?hl(r,d):Hp(r,u,d,c)}switch(a){case"input":wf(r,s);break;case"textarea":zx(r,s);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?Co(r,!!s.multiple,f,!1):h!==!!s.multiple&&(s.defaultValue!=null?Co(r,!!s.multiple,s.defaultValue,!0):Co(r,!!s.multiple,s.multiple?[]:"",!1))}r[xl]=s}catch(y){Ct(n,n.return,y)}}break;case 6:if(Jn(e,n),yi(n),i&4){if(n.stateNode===null)throw Error(se(162));r=n.stateNode,s=n.memoizedProps;try{r.nodeValue=s}catch(y){Ct(n,n.return,y)}}break;case 3:if(Jn(e,n),yi(n),i&4&&t!==null&&t.memoizedState.isDehydrated)try{ml(e.containerInfo)}catch(y){Ct(n,n.return,y)}break;case 4:Jn(e,n),yi(n);break;case 13:Jn(e,n),yi(n),r=n.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(wm=It())),i&4&&Nv(n);break;case 22:if(u=t!==null&&t.memoizedState!==null,n.mode&1?(on=(c=on)||u,Jn(e,n),on=c):Jn(e,n),yi(n),i&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!u&&n.mode&1)for(ve=n,u=n.child;u!==null;){for(d=ve=u;ve!==null;){switch(h=ve,f=h.child,h.tag){case 0:case 11:case 14:case 15:el(4,h,h.return);break;case 1:xo(h,h.return);var m=h.stateNode;if(typeof m.componentWillUnmount=="function"){i=h,t=h.return;try{e=i,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(y){Ct(i,t,y)}}break;case 5:xo(h,h.return);break;case 22:if(h.memoizedState!==null){Fv(d);continue}}f!==null?(f.return=h,ve=f):Fv(d)}u=u.sibling}e:for(u=null,d=n;;){if(d.tag===5){if(u===null){u=d;try{r=d.stateNode,c?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Gx("display",o))}catch(y){Ct(n,n.return,y)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(y){Ct(n,n.return,y)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Jn(e,n),yi(n),i&4&&Nv(n);break;case 21:break;default:Jn(e,n),yi(n)}}function yi(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(mS(t)){var i=t;break e}t=t.return}throw Error(se(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(hl(r,""),i.flags&=-33);var s=Dv(n);np(n,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=Dv(n);tp(n,a,o);break;default:throw Error(se(161))}}catch(l){Ct(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function pb(n,e,t){ve=n,yS(n)}function yS(n,e,t){for(var i=(n.mode&1)!==0;ve!==null;){var r=ve,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||hc;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||on;a=hc;var c=on;if(hc=o,(on=l)&&!c)for(ve=r;ve!==null;)o=ve,l=o.child,o.tag===22&&o.memoizedState!==null?Uv(r):l!==null?(l.return=o,ve=l):Uv(r);for(;s!==null;)ve=s,yS(s),s=s.sibling;ve=r,hc=a,on=c}kv(n)}else r.subtreeFlags&8772&&s!==null?(s.return=r,ve=s):kv(n)}}function kv(n){for(;ve!==null;){var e=ve;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:on||hh(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!on)if(t===null)i.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:si(e.type,t.memoizedProps);i.componentDidUpdate(r,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&_v(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}_v(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&ml(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(se(163))}on||e.flags&512&&ep(e)}catch(h){Ct(e,e.return,h)}}if(e===n){ve=null;break}if(t=e.sibling,t!==null){t.return=e.return,ve=t;break}ve=e.return}}function Fv(n){for(;ve!==null;){var e=ve;if(e===n){ve=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ve=t;break}ve=e.return}}function Uv(n){for(;ve!==null;){var e=ve;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{hh(4,e)}catch(l){Ct(e,t,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){Ct(e,r,l)}}var s=e.return;try{ep(e)}catch(l){Ct(e,s,l)}break;case 5:var o=e.return;try{ep(e)}catch(l){Ct(e,o,l)}}}catch(l){Ct(e,e.return,l)}if(e===n){ve=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ve=a;break}ve=e.return}}var mb=Math.ceil,ku=mr.ReactCurrentDispatcher,_m=mr.ReactCurrentOwner,$n=mr.ReactCurrentBatchConfig,Qe=0,qt=null,Ut=null,Zt=0,In=0,wo=es(0),zt=0,El=null,Fs=0,dh=0,xm=0,tl=null,Mn=null,wm=0,jo=1/0,Zi=null,Fu=!1,ip=null,Hr=null,dc=!1,Nr=null,Uu=0,nl=0,rp=null,lu=-1,cu=0;function yn(){return Qe&6?It():lu!==-1?lu:lu=It()}function Gr(n){return n.mode&1?Qe&2&&Zt!==0?Zt&-Zt:QE.transition!==null?(cu===0&&(cu=nw()),cu):(n=lt,n!==0||(n=window.event,n=n===void 0?16:cw(n.type)),n):1}function di(n,e,t,i){if(50<nl)throw nl=0,rp=null,Error(se(185));Ul(n,t,i),(!(Qe&2)||n!==qt)&&(n===qt&&(!(Qe&2)&&(dh|=t),zt===4&&Lr(n,Zt)),bn(n,i),t===1&&Qe===0&&!(e.mode&1)&&(jo=It()+500,lh&&ts()))}function bn(n,e){var t=n.callbackNode;QT(n,e);var i=xu(n,n===qt?Zt:0);if(i===0)t!==null&&Xg(t),n.callbackNode=null,n.callbackPriority=0;else if(e=i&-i,n.callbackPriority!==e){if(t!=null&&Xg(t),e===1)n.tag===0?ZE(Ov.bind(null,n)):Cw(Ov.bind(null,n)),qE(function(){!(Qe&6)&&ts()}),t=null;else{switch(iw(i)){case 1:t=qp;break;case 4:t=ew;break;case 16:t=_u;break;case 536870912:t=tw;break;default:t=_u}t=ES(t,_S.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function _S(n,e){if(lu=-1,cu=0,Qe&6)throw Error(se(327));var t=n.callbackNode;if(Do()&&n.callbackNode!==t)return null;var i=xu(n,n===qt?Zt:0);if(i===0)return null;if(i&30||i&n.expiredLanes||e)e=Ou(n,i);else{e=i;var r=Qe;Qe|=2;var s=wS();(qt!==n||Zt!==e)&&(Zi=null,jo=It()+500,Ps(n,e));do try{yb();break}catch(a){xS(n,a)}while(!0);om(),ku.current=s,Qe=r,Ut!==null?e=0:(qt=null,Zt=0,e=zt)}if(e!==0){if(e===2&&(r=Lf(n),r!==0&&(i=r,e=sp(n,r))),e===1)throw t=El,Ps(n,0),Lr(n,i),bn(n,It()),t;if(e===6)Lr(n,i);else{if(r=n.current.alternate,!(i&30)&&!gb(r)&&(e=Ou(n,i),e===2&&(s=Lf(n),s!==0&&(i=s,e=sp(n,s))),e===1))throw t=El,Ps(n,0),Lr(n,i),bn(n,It()),t;switch(n.finishedWork=r,n.finishedLanes=i,e){case 0:case 1:throw Error(se(345));case 2:gs(n,Mn,Zi);break;case 3:if(Lr(n,i),(i&130023424)===i&&(e=wm+500-It(),10<e)){if(xu(n,0)!==0)break;if(r=n.suspendedLanes,(r&i)!==i){yn(),n.pingedLanes|=n.suspendedLanes&r;break}n.timeoutHandle=Bf(gs.bind(null,n,Mn,Zi),e);break}gs(n,Mn,Zi);break;case 4:if(Lr(n,i),(i&4194240)===i)break;for(e=n.eventTimes,r=-1;0<i;){var o=31-hi(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=It()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*mb(i/1960))-i,10<i){n.timeoutHandle=Bf(gs.bind(null,n,Mn,Zi),i);break}gs(n,Mn,Zi);break;case 5:gs(n,Mn,Zi);break;default:throw Error(se(329))}}}return bn(n,It()),n.callbackNode===t?_S.bind(null,n):null}function sp(n,e){var t=tl;return n.current.memoizedState.isDehydrated&&(Ps(n,e).flags|=256),n=Ou(n,e),n!==2&&(e=Mn,Mn=t,e!==null&&op(e)),n}function op(n){Mn===null?Mn=n:Mn.push.apply(Mn,n)}function gb(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var i=0;i<t.length;i++){var r=t[i],s=r.getSnapshot;r=r.value;try{if(!mi(s(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Lr(n,e){for(e&=~xm,e&=~dh,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-hi(e),i=1<<t;n[t]=-1,e&=~i}}function Ov(n){if(Qe&6)throw Error(se(327));Do();var e=xu(n,0);if(!(e&1))return bn(n,It()),null;var t=Ou(n,e);if(n.tag!==0&&t===2){var i=Lf(n);i!==0&&(e=i,t=sp(n,i))}if(t===1)throw t=El,Ps(n,0),Lr(n,e),bn(n,It()),t;if(t===6)throw Error(se(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,gs(n,Mn,Zi),bn(n,It()),null}function Sm(n,e){var t=Qe;Qe|=1;try{return n(e)}finally{Qe=t,Qe===0&&(jo=It()+500,lh&&ts())}}function Us(n){Nr!==null&&Nr.tag===0&&!(Qe&6)&&Do();var e=Qe;Qe|=1;var t=$n.transition,i=lt;try{if($n.transition=null,lt=1,n)return n()}finally{lt=i,$n.transition=t,Qe=e,!(Qe&6)&&ts()}}function Mm(){In=wo.current,gt(wo)}function Ps(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,XE(t)),Ut!==null)for(t=Ut.return;t!==null;){var i=t;switch(im(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Tu();break;case 3:Go(),gt(Tn),gt(cn),dm();break;case 5:hm(i);break;case 4:Go();break;case 13:gt(xt);break;case 19:gt(xt);break;case 10:am(i.type._context);break;case 22:case 23:Mm()}t=t.return}if(qt=n,Ut=n=Wr(n.current,null),Zt=In=e,zt=0,El=null,xm=dh=Fs=0,Mn=tl=null,Ts!==null){for(e=0;e<Ts.length;e++)if(t=Ts[e],i=t.interleaved,i!==null){t.interleaved=null;var r=i.next,s=t.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}t.pending=i}Ts=null}return n}function xS(n,e){do{var t=Ut;try{if(om(),su.current=Nu,Du){for(var i=St.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}Du=!1}if(ks=0,Xt=Bt=St=null,Ja=!1,Ml=0,_m.current=null,t===null||t.return===null){zt=1,El=e,Ut=null;break}e:{var s=n,o=t.return,a=t,l=e;if(e=Zt,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=Tv(o);if(f!==null){f.flags&=-257,Ev(f,o,a,s,e),f.mode&1&&Av(s,c,e),e=f,l=c;var m=e.updateQueue;if(m===null){var y=new Set;y.add(l),e.updateQueue=y}else m.add(l);break e}else{if(!(e&1)){Av(s,c,e),Am();break e}l=Error(se(426))}}else if(yt&&a.mode&1){var g=Tv(o);if(g!==null){!(g.flags&65536)&&(g.flags|=256),Ev(g,o,a,s,e),rm(Wo(l,a));break e}}s=l=Wo(l,a),zt!==4&&(zt=2),tl===null?tl=[s]:tl.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var p=iS(s,l,e);yv(s,p);break e;case 1:a=l;var v=s.type,_=s.stateNode;if(!(s.flags&128)&&(typeof v.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(Hr===null||!Hr.has(_)))){s.flags|=65536,e&=-e,s.lanes|=e;var x=rS(s,a,e);yv(s,x);break e}}s=s.return}while(s!==null)}MS(t)}catch(A){e=A,Ut===t&&t!==null&&(Ut=t=t.return);continue}break}while(!0)}function wS(){var n=ku.current;return ku.current=Nu,n===null?Nu:n}function Am(){(zt===0||zt===3||zt===2)&&(zt=4),qt===null||!(Fs&268435455)&&!(dh&268435455)||Lr(qt,Zt)}function Ou(n,e){var t=Qe;Qe|=2;var i=wS();(qt!==n||Zt!==e)&&(Zi=null,Ps(n,e));do try{vb();break}catch(r){xS(n,r)}while(!0);if(om(),Qe=t,ku.current=i,Ut!==null)throw Error(se(261));return qt=null,Zt=0,zt}function vb(){for(;Ut!==null;)SS(Ut)}function yb(){for(;Ut!==null&&!GT();)SS(Ut)}function SS(n){var e=TS(n.alternate,n,In);n.memoizedProps=n.pendingProps,e===null?MS(n):Ut=e,_m.current=null}function MS(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=hb(t,e),t!==null){t.flags&=32767,Ut=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{zt=6,Ut=null;return}}else if(t=ub(t,e,In),t!==null){Ut=t;return}if(e=e.sibling,e!==null){Ut=e;return}Ut=e=n}while(e!==null);zt===0&&(zt=5)}function gs(n,e,t){var i=lt,r=$n.transition;try{$n.transition=null,lt=1,_b(n,e,t,i)}finally{$n.transition=r,lt=i}return null}function _b(n,e,t,i){do Do();while(Nr!==null);if(Qe&6)throw Error(se(327));t=n.finishedWork;var r=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(se(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(JT(n,s),n===qt&&(Ut=qt=null,Zt=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||dc||(dc=!0,ES(_u,function(){return Do(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=$n.transition,$n.transition=null;var o=lt;lt=1;var a=Qe;Qe|=4,_m.current=null,fb(n,t),vS(t,n),BE(Uf),wu=!!Ff,Uf=Ff=null,n.current=t,pb(t),WT(),Qe=a,lt=o,$n.transition=s}else n.current=t;if(dc&&(dc=!1,Nr=n,Uu=r),s=n.pendingLanes,s===0&&(Hr=null),qT(t.stateNode),bn(n,It()),e!==null)for(i=n.onRecoverableError,t=0;t<e.length;t++)r=e[t],i(r.value,{componentStack:r.stack,digest:r.digest});if(Fu)throw Fu=!1,n=ip,ip=null,n;return Uu&1&&n.tag!==0&&Do(),s=n.pendingLanes,s&1?n===rp?nl++:(nl=0,rp=n):nl=0,ts(),null}function Do(){if(Nr!==null){var n=iw(Uu),e=$n.transition,t=lt;try{if($n.transition=null,lt=16>n?16:n,Nr===null)var i=!1;else{if(n=Nr,Nr=null,Uu=0,Qe&6)throw Error(se(331));var r=Qe;for(Qe|=4,ve=n.current;ve!==null;){var s=ve,o=s.child;if(ve.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(ve=c;ve!==null;){var u=ve;switch(u.tag){case 0:case 11:case 15:el(8,u,s)}var d=u.child;if(d!==null)d.return=u,ve=d;else for(;ve!==null;){u=ve;var h=u.sibling,f=u.return;if(pS(u),u===c){ve=null;break}if(h!==null){h.return=f,ve=h;break}ve=f}}}var m=s.alternate;if(m!==null){var y=m.child;if(y!==null){m.child=null;do{var g=y.sibling;y.sibling=null,y=g}while(y!==null)}}ve=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,ve=o;else e:for(;ve!==null;){if(s=ve,s.flags&2048)switch(s.tag){case 0:case 11:case 15:el(9,s,s.return)}var p=s.sibling;if(p!==null){p.return=s.return,ve=p;break e}ve=s.return}}var v=n.current;for(ve=v;ve!==null;){o=ve;var _=o.child;if(o.subtreeFlags&2064&&_!==null)_.return=o,ve=_;else e:for(o=v;ve!==null;){if(a=ve,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:hh(9,a)}}catch(A){Ct(a,a.return,A)}if(a===o){ve=null;break e}var x=a.sibling;if(x!==null){x.return=a.return,ve=x;break e}ve=a.return}}if(Qe=r,ts(),Ri&&typeof Ri.onPostCommitFiberRoot=="function")try{Ri.onPostCommitFiberRoot(ih,n)}catch{}i=!0}return i}finally{lt=t,$n.transition=e}}return!1}function Bv(n,e,t){e=Wo(t,e),e=iS(n,e,1),n=Vr(n,e,1),e=yn(),n!==null&&(Ul(n,1,e),bn(n,e))}function Ct(n,e,t){if(n.tag===3)Bv(n,n,t);else for(;e!==null;){if(e.tag===3){Bv(e,n,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Hr===null||!Hr.has(i))){n=Wo(t,n),n=rS(e,n,1),e=Vr(e,n,1),n=yn(),e!==null&&(Ul(e,1,n),bn(e,n));break}}e=e.return}}function xb(n,e,t){var i=n.pingCache;i!==null&&i.delete(e),e=yn(),n.pingedLanes|=n.suspendedLanes&t,qt===n&&(Zt&t)===t&&(zt===4||zt===3&&(Zt&130023424)===Zt&&500>It()-wm?Ps(n,0):xm|=t),bn(n,e)}function AS(n,e){e===0&&(n.mode&1?(e=nc,nc<<=1,!(nc&130023424)&&(nc=4194304)):e=1);var t=yn();n=hr(n,e),n!==null&&(Ul(n,e,t),bn(n,t))}function wb(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),AS(n,t)}function Sb(n,e){var t=0;switch(n.tag){case 13:var i=n.stateNode,r=n.memoizedState;r!==null&&(t=r.retryLane);break;case 19:i=n.stateNode;break;default:throw Error(se(314))}i!==null&&i.delete(e),AS(n,t)}var TS;TS=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Tn.current)An=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return An=!1,cb(n,e,t);An=!!(n.flags&131072)}else An=!1,yt&&e.flags&1048576&&Rw(e,Cu,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;au(n,e),n=e.pendingProps;var r=zo(e,cn.current);Io(e,t),r=pm(null,e,i,n,r,t);var s=mm();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,En(i)?(s=!0,Eu(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,cm(e),r.updater=uh,e.stateNode=r,r._reactInternals=e,Xf(e,i,n,t),e=Yf(null,e,i,!0,s,t)):(e.tag=0,yt&&s&&nm(e),fn(null,e,r,t),e=e.child),e;case 16:i=e.elementType;e:{switch(au(n,e),n=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=Ab(i),n=si(i,n),r){case 0:e=Kf(null,e,i,n,t);break e;case 1:e=Rv(null,e,i,n,t);break e;case 11:e=bv(null,e,i,n,t);break e;case 14:e=Cv(null,e,i,si(i.type,n),t);break e}throw Error(se(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:si(i,r),Kf(n,e,i,r,t);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:si(i,r),Rv(n,e,i,r,t);case 3:e:{if(lS(e),n===null)throw Error(se(387));i=e.pendingProps,s=e.memoizedState,r=s.element,kw(n,e),Lu(e,i,null,t);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Wo(Error(se(423)),e),e=Pv(n,e,i,t,r);break e}else if(i!==r){r=Wo(Error(se(424)),e),e=Pv(n,e,i,t,r);break e}else for(Nn=zr(e.stateNode.containerInfo.firstChild),kn=e,yt=!0,ai=null,t=Dw(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Vo(),i===r){e=dr(n,e,t);break e}fn(n,e,i,t)}e=e.child}return e;case 5:return Fw(e),n===null&&Gf(e),i=e.type,r=e.pendingProps,s=n!==null?n.memoizedProps:null,o=r.children,Of(i,r)?o=null:s!==null&&Of(i,s)&&(e.flags|=32),aS(n,e),fn(n,e,o,t),e.child;case 6:return n===null&&Gf(e),null;case 13:return cS(n,e,t);case 4:return um(e,e.stateNode.containerInfo),i=e.pendingProps,n===null?e.child=Ho(e,null,i,t):fn(n,e,i,t),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:si(i,r),bv(n,e,i,r,t);case 7:return fn(n,e,e.pendingProps,t),e.child;case 8:return fn(n,e,e.pendingProps.children,t),e.child;case 12:return fn(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,dt(Ru,i._currentValue),i._currentValue=o,s!==null)if(mi(s.value,o)){if(s.children===r.children&&!Tn.current){e=dr(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=rr(-1,t&-t),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),Wf(s.return,t,e),a.lanes|=t;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(se(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),Wf(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}fn(n,e,r.children,t),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Io(e,t),r=Zn(r),i=i(r),e.flags|=1,fn(n,e,i,t),e.child;case 14:return i=e.type,r=si(i,e.pendingProps),r=si(i.type,r),Cv(n,e,i,r,t);case 15:return sS(n,e,e.type,e.pendingProps,t);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:si(i,r),au(n,e),e.tag=1,En(i)?(n=!0,Eu(e)):n=!1,Io(e,t),nS(e,i,r),Xf(e,i,r,t),Yf(null,e,i,!0,n,t);case 19:return uS(n,e,t);case 22:return oS(n,e,t)}throw Error(se(156,e.tag))};function ES(n,e){return Jx(n,e)}function Mb(n,e,t,i){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Yn(n,e,t,i){return new Mb(n,e,t,i)}function Tm(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Ab(n){if(typeof n=="function")return Tm(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Wp)return 11;if(n===jp)return 14}return 2}function Wr(n,e){var t=n.alternate;return t===null?(t=Yn(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function uu(n,e,t,i,r,s){var o=2;if(i=n,typeof n=="function")Tm(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case uo:return Ls(t.children,r,s,e);case Gp:o=8,r|=8;break;case gf:return n=Yn(12,t,e,r|2),n.elementType=gf,n.lanes=s,n;case vf:return n=Yn(13,t,e,r),n.elementType=vf,n.lanes=s,n;case yf:return n=Yn(19,t,e,r),n.elementType=yf,n.lanes=s,n;case Fx:return fh(t,r,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Nx:o=10;break e;case kx:o=9;break e;case Wp:o=11;break e;case jp:o=14;break e;case Cr:o=16,i=null;break e}throw Error(se(130,n==null?n:typeof n,""))}return e=Yn(o,t,e,r),e.elementType=n,e.type=i,e.lanes=s,e}function Ls(n,e,t,i){return n=Yn(7,n,i,e),n.lanes=t,n}function fh(n,e,t,i){return n=Yn(22,n,i,e),n.elementType=Fx,n.lanes=t,n.stateNode={isHidden:!1},n}function ld(n,e,t){return n=Yn(6,n,null,e),n.lanes=t,n}function cd(n,e,t){return e=Yn(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function Tb(n,e,t,i,r){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Gh(0),this.expirationTimes=Gh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Gh(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Em(n,e,t,i,r,s,o,a,l){return n=new Tb(n,e,t,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Yn(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},cm(s),n}function Eb(n,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:co,key:i==null?null:""+i,children:n,containerInfo:e,implementation:t}}function bS(n){if(!n)return Kr;n=n._reactInternals;e:{if(zs(n)!==n||n.tag!==1)throw Error(se(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(En(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(se(171))}if(n.tag===1){var t=n.type;if(En(t))return bw(n,t,e)}return e}function CS(n,e,t,i,r,s,o,a,l){return n=Em(t,i,!0,n,r,s,o,a,l),n.context=bS(null),t=n.current,i=yn(),r=Gr(t),s=rr(i,r),s.callback=e??null,Vr(t,s,r),n.current.lanes=r,Ul(n,r,i),bn(n,i),n}function ph(n,e,t,i){var r=e.current,s=yn(),o=Gr(r);return t=bS(t),e.context===null?e.context=t:e.pendingContext=t,e=rr(s,o),e.payload={element:n},i=i===void 0?null:i,i!==null&&(e.callback=i),n=Vr(r,e,o),n!==null&&(di(n,r,o,s),ru(n,r,o)),o}function Bu(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function zv(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function bm(n,e){zv(n,e),(n=n.alternate)&&zv(n,e)}function bb(){return null}var RS=typeof reportError=="function"?reportError:function(n){console.error(n)};function Cm(n){this._internalRoot=n}mh.prototype.render=Cm.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(se(409));ph(n,e,null,null)};mh.prototype.unmount=Cm.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Us(function(){ph(null,n,null,null)}),e[ur]=null}};function mh(n){this._internalRoot=n}mh.prototype.unstable_scheduleHydration=function(n){if(n){var e=ow();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Pr.length&&e!==0&&e<Pr[t].priority;t++);Pr.splice(t,0,n),t===0&&lw(n)}};function Rm(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function gh(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Vv(){}function Cb(n,e,t,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var c=Bu(o);s.call(c)}}var o=CS(e,i,n,0,null,!1,!1,"",Vv);return n._reactRootContainer=o,n[ur]=o.current,yl(n.nodeType===8?n.parentNode:n),Us(),o}for(;r=n.lastChild;)n.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var c=Bu(l);a.call(c)}}var l=Em(n,0,!1,null,null,!1,!1,"",Vv);return n._reactRootContainer=l,n[ur]=l.current,yl(n.nodeType===8?n.parentNode:n),Us(function(){ph(e,l,t,i)}),l}function vh(n,e,t,i,r){var s=t._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var l=Bu(o);a.call(l)}}ph(e,o,n,r)}else o=Cb(t,e,n,r,i);return Bu(o)}rw=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Va(e.pendingLanes);t!==0&&(Kp(e,t|1),bn(e,It()),!(Qe&6)&&(jo=It()+500,ts()))}break;case 13:Us(function(){var i=hr(n,1);if(i!==null){var r=yn();di(i,n,1,r)}}),bm(n,1)}};Yp=function(n){if(n.tag===13){var e=hr(n,134217728);if(e!==null){var t=yn();di(e,n,134217728,t)}bm(n,134217728)}};sw=function(n){if(n.tag===13){var e=Gr(n),t=hr(n,e);if(t!==null){var i=yn();di(t,n,e,i)}bm(n,e)}};ow=function(){return lt};aw=function(n,e){var t=lt;try{return lt=n,e()}finally{lt=t}};Cf=function(n,e,t){switch(e){case"input":if(wf(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==n&&i.form===n.form){var r=ah(i);if(!r)throw Error(se(90));Ox(i),wf(i,r)}}}break;case"textarea":zx(n,t);break;case"select":e=t.value,e!=null&&Co(n,!!t.multiple,e,!1)}};qx=Sm;Kx=Us;var Rb={usingClientEntryPoint:!1,Events:[Bl,mo,ah,jx,Xx,Sm]},Aa={findFiberByHostInstance:As,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Pb={bundleType:Aa.bundleType,version:Aa.version,rendererPackageName:Aa.rendererPackageName,rendererConfig:Aa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:mr.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Zx(n),n===null?null:n.stateNode},findFiberByHostInstance:Aa.findFiberByHostInstance||bb,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fc.isDisabled&&fc.supportsFiber)try{ih=fc.inject(Pb),Ri=fc}catch{}}Bn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Rb;Bn.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Rm(e))throw Error(se(200));return Eb(n,e,null,t)};Bn.createRoot=function(n,e){if(!Rm(n))throw Error(se(299));var t=!1,i="",r=RS;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Em(n,1,!1,null,null,t,!1,i,r),n[ur]=e.current,yl(n.nodeType===8?n.parentNode:n),new Cm(e)};Bn.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(se(188)):(n=Object.keys(n).join(","),Error(se(268,n)));return n=Zx(e),n=n===null?null:n.stateNode,n};Bn.flushSync=function(n){return Us(n)};Bn.hydrate=function(n,e,t){if(!gh(e))throw Error(se(200));return vh(null,n,e,!0,t)};Bn.hydrateRoot=function(n,e,t){if(!Rm(n))throw Error(se(405));var i=t!=null&&t.hydratedSources||null,r=!1,s="",o=RS;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=CS(e,null,n,1,t??null,r,!1,s,o),n[ur]=e.current,yl(n),i)for(n=0;n<i.length;n++)t=i[n],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new mh(e)};Bn.render=function(n,e,t){if(!gh(e))throw Error(se(200));return vh(null,n,e,!1,t)};Bn.unmountComponentAtNode=function(n){if(!gh(n))throw Error(se(40));return n._reactRootContainer?(Us(function(){vh(null,null,n,!1,function(){n._reactRootContainer=null,n[ur]=null})}),!0):!1};Bn.unstable_batchedUpdates=Sm;Bn.unstable_renderSubtreeIntoContainer=function(n,e,t,i){if(!gh(t))throw Error(se(200));if(n==null||n._reactInternals===void 0)throw Error(se(38));return vh(n,e,t,!1,i)};Bn.version="18.3.1-next-f1338f8080-20240426";function PS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(PS)}catch(n){console.error(n)}}PS(),Px.exports=Bn;var Lb=Px.exports,LS,Hv=Lb;LS=Hv.createRoot,Hv.hydrateRoot;/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Pm="165",Ib=0,Gv=1,Db=2,IS=1,Nb=2,$i=3,fr=0,Cn=1,Ti=2,jr=0,No=1,Wv=2,jv=3,Xv=4,kb=5,ws=100,Fb=101,Ub=102,Ob=103,Bb=104,zb=200,Vb=201,Hb=202,Gb=203,ap=204,lp=205,Wb=206,jb=207,Xb=208,qb=209,Kb=210,Yb=211,$b=212,Zb=213,Qb=214,Jb=0,e1=1,t1=2,zu=3,n1=4,i1=5,r1=6,s1=7,DS=0,o1=1,a1=2,Xr=0,l1=1,c1=2,u1=3,h1=4,d1=5,f1=6,p1=7,qv="attached",m1="detached",NS=300,Xo=301,qo=302,cp=303,up=304,yh=306,Ko=1e3,kr=1001,Vu=1002,gn=1003,kS=1004,Ga=1005,Dn=1006,hu=1007,nr=1008,Yr=1009,g1=1010,v1=1011,Hu=1012,FS=1013,Yo=1014,bi=1015,_h=1016,US=1017,OS=1018,$o=1020,y1=35902,_1=1021,x1=1022,ci=1023,w1=1024,S1=1025,ko=1026,Zo=1027,BS=1028,zS=1029,M1=1030,VS=1031,HS=1033,ud=33776,hd=33777,dd=33778,fd=33779,Kv=35840,Yv=35841,$v=35842,Zv=35843,Qv=36196,Jv=37492,ey=37496,ty=37808,ny=37809,iy=37810,ry=37811,sy=37812,oy=37813,ay=37814,ly=37815,cy=37816,uy=37817,hy=37818,dy=37819,fy=37820,py=37821,pd=36492,my=36494,gy=36495,A1=36283,vy=36284,yy=36285,_y=36286,bl=2300,Cl=2301,md=2302,xy=2400,wy=2401,Sy=2402,T1=2500,E1=0,GS=1,hp=2,b1=3200,C1=3201,WS=0,R1=1,Ir="",pn="srgb",Jt="srgb-linear",Lm="display-p3",xh="display-p3-linear",Gu="linear",mt="srgb",Wu="rec709",ju="p3",Gs=7680,My=519,P1=512,L1=513,I1=514,jS=515,D1=516,N1=517,k1=518,F1=519,dp=35044,Ay="300 es",ir=2e3,Xu=2001;class ua{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const nn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Ty=1234567;const il=Math.PI/180,Qo=180/Math.PI;function fi(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(nn[n&255]+nn[n>>8&255]+nn[n>>16&255]+nn[n>>24&255]+"-"+nn[e&255]+nn[e>>8&255]+"-"+nn[e>>16&15|64]+nn[e>>24&255]+"-"+nn[t&63|128]+nn[t>>8&255]+"-"+nn[t>>16&255]+nn[t>>24&255]+nn[i&255]+nn[i>>8&255]+nn[i>>16&255]+nn[i>>24&255]).toLowerCase()}function an(n,e,t){return Math.max(e,Math.min(t,n))}function Im(n,e){return(n%e+e)%e}function U1(n,e,t,i,r){return i+(n-e)*(r-i)/(t-e)}function O1(n,e,t){return n!==e?(t-n)/(e-n):0}function rl(n,e,t){return(1-t)*n+t*e}function B1(n,e,t,i){return rl(n,e,1-Math.exp(-t*i))}function z1(n,e=1){return e-Math.abs(Im(n,e*2)-e)}function V1(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function H1(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function G1(n,e){return n+Math.floor(Math.random()*(e-n+1))}function W1(n,e){return n+Math.random()*(e-n)}function j1(n){return n*(.5-Math.random())}function X1(n){n!==void 0&&(Ty=n);let e=Ty+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function q1(n){return n*il}function K1(n){return n*Qo}function Y1(n){return(n&n-1)===0&&n!==0}function $1(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Z1(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function Q1(n,e,t,i,r){const s=Math.cos,o=Math.sin,a=s(t/2),l=o(t/2),c=s((e+i)/2),u=o((e+i)/2),d=s((e-i)/2),h=o((e-i)/2),f=s((i-e)/2),m=o((i-e)/2);switch(r){case"XYX":n.set(a*u,l*d,l*h,a*c);break;case"YZY":n.set(l*h,a*u,l*d,a*c);break;case"ZXZ":n.set(l*d,l*h,a*u,a*c);break;case"XZX":n.set(a*u,l*m,l*f,a*c);break;case"YXY":n.set(l*f,a*u,l*m,a*c);break;case"ZYZ":n.set(l*m,l*f,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function li(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function ot(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const J1={DEG2RAD:il,RAD2DEG:Qo,generateUUID:fi,clamp:an,euclideanModulo:Im,mapLinear:U1,inverseLerp:O1,lerp:rl,damp:B1,pingpong:z1,smoothstep:V1,smootherstep:H1,randInt:G1,randFloat:W1,randFloatSpread:j1,seededRandom:X1,degToRad:q1,radToDeg:K1,isPowerOfTwo:Y1,ceilPowerOfTwo:$1,floorPowerOfTwo:Z1,setQuaternionFromProperEuler:Q1,normalize:ot,denormalize:li};class je{constructor(e=0,t=0){je.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(an(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*r+e.x,this.y=s*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Fe{constructor(e,t,i,r,s,o,a,l,c){Fe.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,o,a,l,c)}set(e,t,i,r,s,o,a,l,c){const u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=s,u[5]=l,u[6]=i,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],u=i[4],d=i[7],h=i[2],f=i[5],m=i[8],y=r[0],g=r[3],p=r[6],v=r[1],_=r[4],x=r[7],A=r[2],M=r[5],S=r[8];return s[0]=o*y+a*v+l*A,s[3]=o*g+a*_+l*M,s[6]=o*p+a*x+l*S,s[1]=c*y+u*v+d*A,s[4]=c*g+u*_+d*M,s[7]=c*p+u*x+d*S,s[2]=h*y+f*v+m*A,s[5]=h*g+f*_+m*M,s[8]=h*p+f*x+m*S,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*o*u-t*a*c-i*s*u+i*a*l+r*s*c-r*o*l}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*o-a*c,h=a*l-u*s,f=c*s-o*l,m=t*d+i*h+r*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const y=1/m;return e[0]=d*y,e[1]=(r*c-u*i)*y,e[2]=(a*i-r*o)*y,e[3]=h*y,e[4]=(u*t-r*l)*y,e[5]=(r*s-a*t)*y,e[6]=f*y,e[7]=(i*l-c*t)*y,e[8]=(o*t-i*s)*y,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-r*c,r*l,-r*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(gd.makeScale(e,t)),this}rotate(e){return this.premultiply(gd.makeRotation(-e)),this}translate(e,t){return this.premultiply(gd.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const gd=new Fe;function XS(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function Rl(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function eC(){const n=Rl("canvas");return n.style.display="block",n}const Ey={};function Dm(n){n in Ey||(Ey[n]=!0,console.warn(n))}function tC(n,e,t){return new Promise(function(i,r){function s(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:r();break;case n.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:i()}}setTimeout(s,t)})}const by=new Fe().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Cy=new Fe().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),pc={[Jt]:{transfer:Gu,primaries:Wu,toReference:n=>n,fromReference:n=>n},[pn]:{transfer:mt,primaries:Wu,toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[xh]:{transfer:Gu,primaries:ju,toReference:n=>n.applyMatrix3(Cy),fromReference:n=>n.applyMatrix3(by)},[Lm]:{transfer:mt,primaries:ju,toReference:n=>n.convertSRGBToLinear().applyMatrix3(Cy),fromReference:n=>n.applyMatrix3(by).convertLinearToSRGB()}},nC=new Set([Jt,xh]),nt={enabled:!0,_workingColorSpace:Jt,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!nC.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,t){if(this.enabled===!1||e===t||!e||!t)return n;const i=pc[e].toReference,r=pc[t].fromReference;return r(i(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return pc[n].primaries},getTransfer:function(n){return n===Ir?Gu:pc[n].transfer}};function Fo(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function vd(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Ws;class iC{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Ws===void 0&&(Ws=Rl("canvas")),Ws.width=e.width,Ws.height=e.height;const i=Ws.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Ws}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Rl("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=Fo(s[o]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Fo(t[i]/255)*255):t[i]=Fo(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let rC=0;class qS{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:rC++}),this.uuid=fi(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(yd(r[o].image)):s.push(yd(r[o]))}else s=yd(r);i.url=s}return t||(e.images[this.uuid]=i),i}}function yd(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?iC.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let sC=0;class Kt extends ua{constructor(e=Kt.DEFAULT_IMAGE,t=Kt.DEFAULT_MAPPING,i=kr,r=kr,s=Dn,o=nr,a=ci,l=Yr,c=Kt.DEFAULT_ANISOTROPY,u=Ir){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:sC++}),this.uuid=fi(),this.name="",this.source=new qS(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new je(0,0),this.repeat=new je(1,1),this.center=new je(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Fe,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==NS)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ko:e.x=e.x-Math.floor(e.x);break;case kr:e.x=e.x<0?0:1;break;case Vu:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Ko:e.y=e.y-Math.floor(e.y);break;case kr:e.y=e.y<0?0:1;break;case Vu:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Kt.DEFAULT_IMAGE=null;Kt.DEFAULT_MAPPING=NS;Kt.DEFAULT_ANISOTROPY=1;class ht{constructor(e=0,t=0,i=0,r=1){ht.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s;const l=e.elements,c=l[0],u=l[4],d=l[8],h=l[1],f=l[5],m=l[9],y=l[2],g=l[6],p=l[10];if(Math.abs(u-h)<.01&&Math.abs(d-y)<.01&&Math.abs(m-g)<.01){if(Math.abs(u+h)<.1&&Math.abs(d+y)<.1&&Math.abs(m+g)<.1&&Math.abs(c+f+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const _=(c+1)/2,x=(f+1)/2,A=(p+1)/2,M=(u+h)/4,S=(d+y)/4,b=(m+g)/4;return _>x&&_>A?_<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(_),r=M/i,s=S/i):x>A?x<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(x),i=M/r,s=b/r):A<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(A),i=S/s,r=b/s),this.set(i,r,s,t),this}let v=Math.sqrt((g-m)*(g-m)+(d-y)*(d-y)+(h-u)*(h-u));return Math.abs(v)<.001&&(v=1),this.x=(g-m)/v,this.y=(d-y)/v,this.z=(h-u)/v,this.w=Math.acos((c+f+p-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class oC extends ua{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new ht(0,0,e,t),this.scissorTest=!1,this.viewport=new ht(0,0,e,t);const r={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Dn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const s=new Kt(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);s.flipY=!1,s.generateMipmaps=i.generateMipmaps,s.internalFormat=i.internalFormat,this.textures=[];const o=i.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,r=e.textures.length;i<r;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new qS(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Os extends oC{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class KS extends Kt{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=gn,this.minFilter=gn,this.wrapR=kr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class aC extends Kt{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=gn,this.minFilter=gn,this.wrapR=kr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let ns=class{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,o,a){let l=i[r+0],c=i[r+1],u=i[r+2],d=i[r+3];const h=s[o+0],f=s[o+1],m=s[o+2],y=s[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d;return}if(a===1){e[t+0]=h,e[t+1]=f,e[t+2]=m,e[t+3]=y;return}if(d!==y||l!==h||c!==f||u!==m){let g=1-a;const p=l*h+c*f+u*m+d*y,v=p>=0?1:-1,_=1-p*p;if(_>Number.EPSILON){const A=Math.sqrt(_),M=Math.atan2(A,p*v);g=Math.sin(g*M)/A,a=Math.sin(a*M)/A}const x=a*v;if(l=l*g+h*x,c=c*g+f*x,u=u*g+m*x,d=d*g+y*x,g===1-a){const A=1/Math.sqrt(l*l+c*c+u*u+d*d);l*=A,c*=A,u*=A,d*=A}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,r,s,o){const a=i[r],l=i[r+1],c=i[r+2],u=i[r+3],d=s[o],h=s[o+1],f=s[o+2],m=s[o+3];return e[t]=a*m+u*d+l*f-c*h,e[t+1]=l*m+u*h+c*d-a*f,e[t+2]=c*m+u*f+a*h-l*d,e[t+3]=u*m-a*d-l*h-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),u=a(r/2),d=a(s/2),h=l(i/2),f=l(r/2),m=l(s/2);switch(o){case"XYZ":this._x=h*u*d+c*f*m,this._y=c*f*d-h*u*m,this._z=c*u*m+h*f*d,this._w=c*u*d-h*f*m;break;case"YXZ":this._x=h*u*d+c*f*m,this._y=c*f*d-h*u*m,this._z=c*u*m-h*f*d,this._w=c*u*d+h*f*m;break;case"ZXY":this._x=h*u*d-c*f*m,this._y=c*f*d+h*u*m,this._z=c*u*m+h*f*d,this._w=c*u*d-h*f*m;break;case"ZYX":this._x=h*u*d-c*f*m,this._y=c*f*d+h*u*m,this._z=c*u*m-h*f*d,this._w=c*u*d+h*f*m;break;case"YZX":this._x=h*u*d+c*f*m,this._y=c*f*d+h*u*m,this._z=c*u*m-h*f*d,this._w=c*u*d-h*f*m;break;case"XZY":this._x=h*u*d-c*f*m,this._y=c*f*d-h*u*m,this._z=c*u*m+h*f*d,this._w=c*u*d+h*f*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],c=t[2],u=t[6],d=t[10],h=i+a+d;if(h>0){const f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(u-l)*f,this._y=(s-c)*f,this._z=(o-r)*f}else if(i>a&&i>d){const f=2*Math.sqrt(1+i-a-d);this._w=(u-l)/f,this._x=.25*f,this._y=(r+o)/f,this._z=(s+c)/f}else if(a>d){const f=2*Math.sqrt(1+a-i-d);this._w=(s-c)/f,this._x=(r+o)/f,this._y=.25*f,this._z=(l+u)/f}else{const f=2*Math.sqrt(1+d-i-a);this._w=(o-r)/f,this._x=(s+c)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(an(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=i*u+o*a+r*c-s*l,this._y=r*u+o*l+s*a-i*c,this._z=s*u+o*c+i*l-r*a,this._w=o*u-i*a-r*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*i+t*this._x,this._y=f*r+t*this._y,this._z=f*s+t*this._z,this.normalize(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),d=Math.sin((1-t)*u)/c,h=Math.sin(t*u)/c;return this._w=o*d+this._w*h,this._x=i*d+this._x*h,this._y=r*d+this._y*h,this._z=s*d+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};class B{constructor(e=0,t=0,i=0){B.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Ry.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Ry.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*r-a*i),u=2*(a*t-s*r),d=2*(s*i-o*t);return this.x=t+l*c+o*d-a*u,this.y=i+l*u+a*c-s*d,this.z=r+l*d+s*u-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-i*l,this.z=i*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return _d.copy(this).projectOnVector(e),this.sub(_d)}reflect(e){return this.sub(_d.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(an(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _d=new B,Ry=new ns;class gr{constructor(e=new B(1/0,1/0,1/0),t=new B(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(ei.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(ei.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=ei.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const s=i.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,ei):ei.fromBufferAttribute(s,o),ei.applyMatrix4(e.matrixWorld),this.expandByPoint(ei);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),mc.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),mc.copy(i.boundingBox)),mc.applyMatrix4(e.matrixWorld),this.union(mc)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,ei),ei.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Ta),gc.subVectors(this.max,Ta),js.subVectors(e.a,Ta),Xs.subVectors(e.b,Ta),qs.subVectors(e.c,Ta),_r.subVectors(Xs,js),xr.subVectors(qs,Xs),os.subVectors(js,qs);let t=[0,-_r.z,_r.y,0,-xr.z,xr.y,0,-os.z,os.y,_r.z,0,-_r.x,xr.z,0,-xr.x,os.z,0,-os.x,-_r.y,_r.x,0,-xr.y,xr.x,0,-os.y,os.x,0];return!xd(t,js,Xs,qs,gc)||(t=[1,0,0,0,1,0,0,0,1],!xd(t,js,Xs,qs,gc))?!1:(vc.crossVectors(_r,xr),t=[vc.x,vc.y,vc.z],xd(t,js,Xs,qs,gc))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,ei).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(ei).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Bi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Bi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Bi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Bi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Bi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Bi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Bi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Bi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Bi),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Bi=[new B,new B,new B,new B,new B,new B,new B,new B],ei=new B,mc=new gr,js=new B,Xs=new B,qs=new B,_r=new B,xr=new B,os=new B,Ta=new B,gc=new B,vc=new B,as=new B;function xd(n,e,t,i,r){for(let s=0,o=n.length-3;s<=o;s+=3){as.fromArray(n,s);const a=r.x*Math.abs(as.x)+r.y*Math.abs(as.y)+r.z*Math.abs(as.z),l=e.dot(as),c=t.dot(as),u=i.dot(as);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const lC=new gr,Ea=new B,wd=new B;class Ni{constructor(e=new B,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):lC.setFromPoints(e).getCenter(i);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Ea.subVectors(e,this.center);const t=Ea.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(Ea,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(wd.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Ea.copy(e.center).add(wd)),this.expandByPoint(Ea.copy(e.center).sub(wd))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const zi=new B,Sd=new B,yc=new B,wr=new B,Md=new B,_c=new B,Ad=new B;let wh=class{constructor(e=new B,t=new B(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,zi)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=zi.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(zi.copy(this.origin).addScaledVector(this.direction,t),zi.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){Sd.copy(e).add(t).multiplyScalar(.5),yc.copy(t).sub(e).normalize(),wr.copy(this.origin).sub(Sd);const s=e.distanceTo(t)*.5,o=-this.direction.dot(yc),a=wr.dot(this.direction),l=-wr.dot(yc),c=wr.lengthSq(),u=Math.abs(1-o*o);let d,h,f,m;if(u>0)if(d=o*l-a,h=o*a-l,m=s*u,d>=0)if(h>=-m)if(h<=m){const y=1/u;d*=y,h*=y,f=d*(d+o*h+2*a)+h*(o*d+h+2*l)+c}else h=s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*l)+c;else h=-s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*l)+c;else h<=-m?(d=Math.max(0,-(-o*s+a)),h=d>0?-s:Math.min(Math.max(-s,-l),s),f=-d*d+h*(h+2*l)+c):h<=m?(d=0,h=Math.min(Math.max(-s,-l),s),f=h*(h+2*l)+c):(d=Math.max(0,-(o*s+a)),h=d>0?s:Math.min(Math.max(-s,-l),s),f=-d*d+h*(h+2*l)+c);else h=o>0?-s:s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,d),r&&r.copy(Sd).addScaledVector(yc,h),f}intersectSphere(e,t){zi.subVectors(e.center,this.origin);const i=zi.dot(this.direction),r=zi.dot(zi)-i*i,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,o,a,l;const c=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,h=this.origin;return c>=0?(i=(e.min.x-h.x)*c,r=(e.max.x-h.x)*c):(i=(e.max.x-h.x)*c,r=(e.min.x-h.x)*c),u>=0?(s=(e.min.y-h.y)*u,o=(e.max.y-h.y)*u):(s=(e.max.y-h.y)*u,o=(e.min.y-h.y)*u),i>o||s>r||((s>i||isNaN(i))&&(i=s),(o<r||isNaN(r))&&(r=o),d>=0?(a=(e.min.z-h.z)*d,l=(e.max.z-h.z)*d):(a=(e.max.z-h.z)*d,l=(e.min.z-h.z)*d),i>l||a>r)||((a>i||i!==i)&&(i=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,zi)!==null}intersectTriangle(e,t,i,r,s){Md.subVectors(t,e),_c.subVectors(i,e),Ad.crossVectors(Md,_c);let o=this.direction.dot(Ad),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;wr.subVectors(this.origin,e);const l=a*this.direction.dot(_c.crossVectors(wr,_c));if(l<0)return null;const c=a*this.direction.dot(Md.cross(wr));if(c<0||l+c>o)return null;const u=-a*wr.dot(Ad);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};class Oe{constructor(e,t,i,r,s,o,a,l,c,u,d,h,f,m,y,g){Oe.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,o,a,l,c,u,d,h,f,m,y,g)}set(e,t,i,r,s,o,a,l,c,u,d,h,f,m,y,g){const p=this.elements;return p[0]=e,p[4]=t,p[8]=i,p[12]=r,p[1]=s,p[5]=o,p[9]=a,p[13]=l,p[2]=c,p[6]=u,p[10]=d,p[14]=h,p[3]=f,p[7]=m,p[11]=y,p[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Oe().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/Ks.setFromMatrixColumn(e,0).length(),s=1/Ks.setFromMatrixColumn(e,1).length(),o=1/Ks.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(r),c=Math.sin(r),u=Math.cos(s),d=Math.sin(s);if(e.order==="XYZ"){const h=o*u,f=o*d,m=a*u,y=a*d;t[0]=l*u,t[4]=-l*d,t[8]=c,t[1]=f+m*c,t[5]=h-y*c,t[9]=-a*l,t[2]=y-h*c,t[6]=m+f*c,t[10]=o*l}else if(e.order==="YXZ"){const h=l*u,f=l*d,m=c*u,y=c*d;t[0]=h+y*a,t[4]=m*a-f,t[8]=o*c,t[1]=o*d,t[5]=o*u,t[9]=-a,t[2]=f*a-m,t[6]=y+h*a,t[10]=o*l}else if(e.order==="ZXY"){const h=l*u,f=l*d,m=c*u,y=c*d;t[0]=h-y*a,t[4]=-o*d,t[8]=m+f*a,t[1]=f+m*a,t[5]=o*u,t[9]=y-h*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const h=o*u,f=o*d,m=a*u,y=a*d;t[0]=l*u,t[4]=m*c-f,t[8]=h*c+y,t[1]=l*d,t[5]=y*c+h,t[9]=f*c-m,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const h=o*l,f=o*c,m=a*l,y=a*c;t[0]=l*u,t[4]=y-h*d,t[8]=m*d+f,t[1]=d,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=f*d+m,t[10]=h-y*d}else if(e.order==="XZY"){const h=o*l,f=o*c,m=a*l,y=a*c;t[0]=l*u,t[4]=-d,t[8]=c*u,t[1]=h*d+y,t[5]=o*u,t[9]=f*d-m,t[2]=m*d-f,t[6]=a*u,t[10]=y*d+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(cC,e,uC)}lookAt(e,t,i){const r=this.elements;return Pn.subVectors(e,t),Pn.lengthSq()===0&&(Pn.z=1),Pn.normalize(),Sr.crossVectors(i,Pn),Sr.lengthSq()===0&&(Math.abs(i.z)===1?Pn.x+=1e-4:Pn.z+=1e-4,Pn.normalize(),Sr.crossVectors(i,Pn)),Sr.normalize(),xc.crossVectors(Pn,Sr),r[0]=Sr.x,r[4]=xc.x,r[8]=Pn.x,r[1]=Sr.y,r[5]=xc.y,r[9]=Pn.y,r[2]=Sr.z,r[6]=xc.z,r[10]=Pn.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],u=i[1],d=i[5],h=i[9],f=i[13],m=i[2],y=i[6],g=i[10],p=i[14],v=i[3],_=i[7],x=i[11],A=i[15],M=r[0],S=r[4],b=r[8],T=r[12],w=r[1],P=r[5],V=r[9],I=r[13],O=r[2],F=r[6],N=r[10],G=r[14],L=r[3],j=r[7],Y=r[11],ee=r[15];return s[0]=o*M+a*w+l*O+c*L,s[4]=o*S+a*P+l*F+c*j,s[8]=o*b+a*V+l*N+c*Y,s[12]=o*T+a*I+l*G+c*ee,s[1]=u*M+d*w+h*O+f*L,s[5]=u*S+d*P+h*F+f*j,s[9]=u*b+d*V+h*N+f*Y,s[13]=u*T+d*I+h*G+f*ee,s[2]=m*M+y*w+g*O+p*L,s[6]=m*S+y*P+g*F+p*j,s[10]=m*b+y*V+g*N+p*Y,s[14]=m*T+y*I+g*G+p*ee,s[3]=v*M+_*w+x*O+A*L,s[7]=v*S+_*P+x*F+A*j,s[11]=v*b+_*V+x*N+A*Y,s[15]=v*T+_*I+x*G+A*ee,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],u=e[2],d=e[6],h=e[10],f=e[14],m=e[3],y=e[7],g=e[11],p=e[15];return m*(+s*l*d-r*c*d-s*a*h+i*c*h+r*a*f-i*l*f)+y*(+t*l*f-t*c*h+s*o*h-r*o*f+r*c*u-s*l*u)+g*(+t*c*d-t*a*f-s*o*d+i*o*f+s*a*u-i*c*u)+p*(-r*a*u-t*l*d+t*a*h+r*o*d-i*o*h+i*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],h=e[10],f=e[11],m=e[12],y=e[13],g=e[14],p=e[15],v=d*g*c-y*h*c+y*l*f-a*g*f-d*l*p+a*h*p,_=m*h*c-u*g*c-m*l*f+o*g*f+u*l*p-o*h*p,x=u*y*c-m*d*c+m*a*f-o*y*f-u*a*p+o*d*p,A=m*d*l-u*y*l-m*a*h+o*y*h+u*a*g-o*d*g,M=t*v+i*_+r*x+s*A;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/M;return e[0]=v*S,e[1]=(y*h*s-d*g*s-y*r*f+i*g*f+d*r*p-i*h*p)*S,e[2]=(a*g*s-y*l*s+y*r*c-i*g*c-a*r*p+i*l*p)*S,e[3]=(d*l*s-a*h*s-d*r*c+i*h*c+a*r*f-i*l*f)*S,e[4]=_*S,e[5]=(u*g*s-m*h*s+m*r*f-t*g*f-u*r*p+t*h*p)*S,e[6]=(m*l*s-o*g*s-m*r*c+t*g*c+o*r*p-t*l*p)*S,e[7]=(o*h*s-u*l*s+u*r*c-t*h*c-o*r*f+t*l*f)*S,e[8]=x*S,e[9]=(m*d*s-u*y*s-m*i*f+t*y*f+u*i*p-t*d*p)*S,e[10]=(o*y*s-m*a*s+m*i*c-t*y*c-o*i*p+t*a*p)*S,e[11]=(u*a*s-o*d*s-u*i*c+t*d*c+o*i*f-t*a*f)*S,e[12]=A*S,e[13]=(u*y*r-m*d*r+m*i*h-t*y*h-u*i*g+t*d*g)*S,e[14]=(m*a*r-o*y*r-m*i*l+t*y*l+o*i*g-t*a*g)*S,e[15]=(o*d*r-u*a*r+u*i*l-t*d*l-o*i*h+t*a*h)*S,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,o=e.x,a=e.y,l=e.z,c=s*o,u=s*a;return this.set(c*o+i,c*a-r*l,c*l+r*a,0,c*a+r*l,u*a+i,u*l-r*o,0,c*l-r*a,u*l+r*o,s*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,o){return this.set(1,i,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,c=s+s,u=o+o,d=a+a,h=s*c,f=s*u,m=s*d,y=o*u,g=o*d,p=a*d,v=l*c,_=l*u,x=l*d,A=i.x,M=i.y,S=i.z;return r[0]=(1-(y+p))*A,r[1]=(f+x)*A,r[2]=(m-_)*A,r[3]=0,r[4]=(f-x)*M,r[5]=(1-(h+p))*M,r[6]=(g+v)*M,r[7]=0,r[8]=(m+_)*S,r[9]=(g-v)*S,r[10]=(1-(h+y))*S,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let s=Ks.set(r[0],r[1],r[2]).length();const o=Ks.set(r[4],r[5],r[6]).length(),a=Ks.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],ti.copy(this);const c=1/s,u=1/o,d=1/a;return ti.elements[0]*=c,ti.elements[1]*=c,ti.elements[2]*=c,ti.elements[4]*=u,ti.elements[5]*=u,ti.elements[6]*=u,ti.elements[8]*=d,ti.elements[9]*=d,ti.elements[10]*=d,t.setFromRotationMatrix(ti),i.x=s,i.y=o,i.z=a,this}makePerspective(e,t,i,r,s,o,a=ir){const l=this.elements,c=2*s/(t-e),u=2*s/(i-r),d=(t+e)/(t-e),h=(i+r)/(i-r);let f,m;if(a===ir)f=-(o+s)/(o-s),m=-2*o*s/(o-s);else if(a===Xu)f=-o/(o-s),m=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=u,l[9]=h,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,r,s,o,a=ir){const l=this.elements,c=1/(t-e),u=1/(i-r),d=1/(o-s),h=(t+e)*c,f=(i+r)*u;let m,y;if(a===ir)m=(o+s)*d,y=-2*d;else if(a===Xu)m=s*d,y=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-h,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=y,l[14]=-m,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const Ks=new B,ti=new Oe,cC=new B(0,0,0),uC=new B(1,1,1),Sr=new B,xc=new B,Pn=new B,Py=new Oe,Ly=new ns;class Di{constructor(e=0,t=0,i=0,r=Di.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],l=r[1],c=r[5],u=r[9],d=r[2],h=r[6],f=r[10];switch(t){case"XYZ":this._y=Math.asin(an(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(h,c),this._z=0);break;case"YXZ":this._x=Math.asin(-an(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,s),this._z=0);break;case"ZXY":this._x=Math.asin(an(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-an(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(h,f),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(an(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-d,s)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-an(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return Py.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Py,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Ly.setFromEuler(this),this.setFromQuaternion(Ly,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Di.DEFAULT_ORDER="XYZ";class YS{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let hC=0;const Iy=new B,Ys=new ns,Vi=new Oe,wc=new B,ba=new B,dC=new B,fC=new ns,Dy=new B(1,0,0),Ny=new B(0,1,0),ky=new B(0,0,1),Fy={type:"added"},pC={type:"removed"},$s={type:"childadded",child:null},Td={type:"childremoved",child:null};class Mt extends ua{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:hC++}),this.uuid=fi(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Mt.DEFAULT_UP.clone();const e=new B,t=new Di,i=new ns,r=new B(1,1,1);function s(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(s),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Oe},normalMatrix:{value:new Fe}}),this.matrix=new Oe,this.matrixWorld=new Oe,this.matrixAutoUpdate=Mt.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Mt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new YS,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Ys.setFromAxisAngle(e,t),this.quaternion.multiply(Ys),this}rotateOnWorldAxis(e,t){return Ys.setFromAxisAngle(e,t),this.quaternion.premultiply(Ys),this}rotateX(e){return this.rotateOnAxis(Dy,e)}rotateY(e){return this.rotateOnAxis(Ny,e)}rotateZ(e){return this.rotateOnAxis(ky,e)}translateOnAxis(e,t){return Iy.copy(e).applyQuaternion(this.quaternion),this.position.add(Iy.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Dy,e)}translateY(e){return this.translateOnAxis(Ny,e)}translateZ(e){return this.translateOnAxis(ky,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Vi.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?wc.copy(e):wc.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),ba.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Vi.lookAt(ba,wc,this.up):Vi.lookAt(wc,ba,this.up),this.quaternion.setFromRotationMatrix(Vi),r&&(Vi.extractRotation(r.matrixWorld),Ys.setFromRotationMatrix(Vi),this.quaternion.premultiply(Ys.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Fy),$s.child=e,this.dispatchEvent($s),$s.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(pC),Td.child=e,this.dispatchEvent(Td),Td.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Vi.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Vi.multiply(e.parent.matrixWorld)),e.applyMatrix4(Vi),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Fy),$s.child=e,this.dispatchEvent($s),$s.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ba,e,dC),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ba,fC,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++){const s=t[i];(s.matrixWorldAutoUpdate===!0||e===!0)&&s.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++){const a=r[s];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),r.maxGeometryCount=this._maxGeometryCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const d=l[c];s(e.shapes,d)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(s(e.materials,this.material[l]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),u=o(e.images),d=o(e.shapes),h=o(e.skeletons),f=o(e.animations),m=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),u.length>0&&(i.images=u),d.length>0&&(i.shapes=d),h.length>0&&(i.skeletons=h),f.length>0&&(i.animations=f),m.length>0&&(i.nodes=m)}return i.object=r,i;function o(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}}Mt.DEFAULT_UP=new B(0,1,0);Mt.DEFAULT_MATRIX_AUTO_UPDATE=!0;Mt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ni=new B,Hi=new B,Ed=new B,Gi=new B,Zs=new B,Qs=new B,Uy=new B,bd=new B,Cd=new B,Rd=new B;class Ei{constructor(e=new B,t=new B,i=new B){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),ni.subVectors(e,t),r.cross(ni);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){ni.subVectors(r,t),Hi.subVectors(i,t),Ed.subVectors(e,t);const o=ni.dot(ni),a=ni.dot(Hi),l=ni.dot(Ed),c=Hi.dot(Hi),u=Hi.dot(Ed),d=o*c-a*a;if(d===0)return s.set(0,0,0),null;const h=1/d,f=(c*l-a*u)*h,m=(o*u-a*l)*h;return s.set(1-f-m,m,f)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,Gi)===null?!1:Gi.x>=0&&Gi.y>=0&&Gi.x+Gi.y<=1}static getInterpolation(e,t,i,r,s,o,a,l){return this.getBarycoord(e,t,i,r,Gi)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,Gi.x),l.addScaledVector(o,Gi.y),l.addScaledVector(a,Gi.z),l)}static isFrontFacing(e,t,i,r){return ni.subVectors(i,t),Hi.subVectors(e,t),ni.cross(Hi).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ni.subVectors(this.c,this.b),Hi.subVectors(this.a,this.b),ni.cross(Hi).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ei.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ei.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,r,s){return Ei.getInterpolation(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return Ei.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ei.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,s=this.c;let o,a;Zs.subVectors(r,i),Qs.subVectors(s,i),bd.subVectors(e,i);const l=Zs.dot(bd),c=Qs.dot(bd);if(l<=0&&c<=0)return t.copy(i);Cd.subVectors(e,r);const u=Zs.dot(Cd),d=Qs.dot(Cd);if(u>=0&&d<=u)return t.copy(r);const h=l*d-u*c;if(h<=0&&l>=0&&u<=0)return o=l/(l-u),t.copy(i).addScaledVector(Zs,o);Rd.subVectors(e,s);const f=Zs.dot(Rd),m=Qs.dot(Rd);if(m>=0&&f<=m)return t.copy(s);const y=f*c-l*m;if(y<=0&&c>=0&&m<=0)return a=c/(c-m),t.copy(i).addScaledVector(Qs,a);const g=u*m-f*d;if(g<=0&&d-u>=0&&f-m>=0)return Uy.subVectors(s,r),a=(d-u)/(d-u+(f-m)),t.copy(r).addScaledVector(Uy,a);const p=1/(g+y+h);return o=y*p,a=h*p,t.copy(i).addScaledVector(Zs,o).addScaledVector(Qs,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const $S={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Mr={h:0,s:0,l:0},Sc={h:0,s:0,l:0};function Pd(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class Le{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=pn){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,nt.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=nt.workingColorSpace){return this.r=e,this.g=t,this.b=i,nt.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=nt.workingColorSpace){if(e=Im(e,1),t=an(t,0,1),i=an(i,0,1),t===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,o=2*i-s;this.r=Pd(o,s,e+1/3),this.g=Pd(o,s,e),this.b=Pd(o,s,e-1/3)}return nt.toWorkingColorSpace(this,r),this}setStyle(e,t=pn){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=pn){const i=$S[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Fo(e.r),this.g=Fo(e.g),this.b=Fo(e.b),this}copyLinearToSRGB(e){return this.r=vd(e.r),this.g=vd(e.g),this.b=vd(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=pn){return nt.fromWorkingColorSpace(rn.copy(this),e),Math.round(an(rn.r*255,0,255))*65536+Math.round(an(rn.g*255,0,255))*256+Math.round(an(rn.b*255,0,255))}getHexString(e=pn){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=nt.workingColorSpace){nt.fromWorkingColorSpace(rn.copy(this),t);const i=rn.r,r=rn.g,s=rn.b,o=Math.max(i,r,s),a=Math.min(i,r,s);let l,c;const u=(a+o)/2;if(a===o)l=0,c=0;else{const d=o-a;switch(c=u<=.5?d/(o+a):d/(2-o-a),o){case i:l=(r-s)/d+(r<s?6:0);break;case r:l=(s-i)/d+2;break;case s:l=(i-r)/d+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=nt.workingColorSpace){return nt.fromWorkingColorSpace(rn.copy(this),t),e.r=rn.r,e.g=rn.g,e.b=rn.b,e}getStyle(e=pn){nt.fromWorkingColorSpace(rn.copy(this),e);const t=rn.r,i=rn.g,r=rn.b;return e!==pn?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(r*255)})`}offsetHSL(e,t,i){return this.getHSL(Mr),this.setHSL(Mr.h+e,Mr.s+t,Mr.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Mr),e.getHSL(Sc);const i=rl(Mr.h,Sc.h,t),r=rl(Mr.s,Sc.s,t),s=rl(Mr.l,Sc.l,t);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*i+s[6]*r,this.g=s[1]*t+s[4]*i+s[7]*r,this.b=s[2]*t+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const rn=new Le;Le.NAMES=$S;let mC=0,pi=class extends ua{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:mC++}),this.uuid=fi(),this.name="",this.type="Material",this.blending=No,this.side=fr,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=ap,this.blendDst=lp,this.blendEquation=ws,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Le(0,0,0),this.blendAlpha=0,this.depthFunc=zu,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=My,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Gs,this.stencilZFail=Gs,this.stencilZPass=Gs,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==No&&(i.blending=this.blending),this.side!==fr&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==ap&&(i.blendSrc=this.blendSrc),this.blendDst!==lp&&(i.blendDst=this.blendDst),this.blendEquation!==ws&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==zu&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==My&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Gs&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Gs&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Gs&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}};class bs extends pi{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Le(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Di,this.combine=DS,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Nt=new B,Mc=new je;class _n{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=dp,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=bi,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return Dm("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Mc.fromBufferAttribute(this,t),Mc.applyMatrix3(e),this.setXY(t,Mc.x,Mc.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Nt.fromBufferAttribute(this,t),Nt.applyMatrix3(e),this.setXYZ(t,Nt.x,Nt.y,Nt.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Nt.fromBufferAttribute(this,t),Nt.applyMatrix4(e),this.setXYZ(t,Nt.x,Nt.y,Nt.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Nt.fromBufferAttribute(this,t),Nt.applyNormalMatrix(e),this.setXYZ(t,Nt.x,Nt.y,Nt.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Nt.fromBufferAttribute(this,t),Nt.transformDirection(e),this.setXYZ(t,Nt.x,Nt.y,Nt.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=li(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=ot(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=li(t,this.array)),t}setX(e,t){return this.normalized&&(t=ot(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=li(t,this.array)),t}setY(e,t){return this.normalized&&(t=ot(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=li(t,this.array)),t}setZ(e,t){return this.normalized&&(t=ot(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=li(t,this.array)),t}setW(e,t){return this.normalized&&(t=ot(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=ot(t,this.array),i=ot(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=ot(t,this.array),i=ot(i,this.array),r=ot(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=ot(t,this.array),i=ot(i,this.array),r=ot(r,this.array),s=ot(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==dp&&(e.usage=this.usage),e}}class ZS extends _n{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class QS extends _n{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class sr extends _n{constructor(e,t,i){super(new Float32Array(e),t,i)}}let gC=0;const Gn=new Oe,Ld=new Mt,Js=new B,Ln=new gr,Ca=new gr,jt=new B;class ki extends ua{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:gC++}),this.uuid=fi(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(XS(e)?QS:ZS)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new Fe().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Gn.makeRotationFromQuaternion(e),this.applyMatrix4(Gn),this}rotateX(e){return Gn.makeRotationX(e),this.applyMatrix4(Gn),this}rotateY(e){return Gn.makeRotationY(e),this.applyMatrix4(Gn),this}rotateZ(e){return Gn.makeRotationZ(e),this.applyMatrix4(Gn),this}translate(e,t,i){return Gn.makeTranslation(e,t,i),this.applyMatrix4(Gn),this}scale(e,t,i){return Gn.makeScale(e,t,i),this.applyMatrix4(Gn),this}lookAt(e){return Ld.lookAt(e),Ld.updateMatrix(),this.applyMatrix4(Ld.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Js).negate(),this.translate(Js.x,Js.y,Js.z),this}setFromPoints(e){const t=[];for(let i=0,r=e.length;i<r;i++){const s=e[i];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new sr(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new gr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new B(-1/0,-1/0,-1/0),new B(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){const s=t[i];Ln.setFromBufferAttribute(s),this.morphTargetsRelative?(jt.addVectors(this.boundingBox.min,Ln.min),this.boundingBox.expandByPoint(jt),jt.addVectors(this.boundingBox.max,Ln.max),this.boundingBox.expandByPoint(jt)):(this.boundingBox.expandByPoint(Ln.min),this.boundingBox.expandByPoint(Ln.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ni);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new B,1/0);return}if(e){const i=this.boundingSphere.center;if(Ln.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];Ca.setFromBufferAttribute(a),this.morphTargetsRelative?(jt.addVectors(Ln.min,Ca.min),Ln.expandByPoint(jt),jt.addVectors(Ln.max,Ca.max),Ln.expandByPoint(jt)):(Ln.expandByPoint(Ca.min),Ln.expandByPoint(Ca.max))}Ln.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)jt.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(jt));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)jt.fromBufferAttribute(a,c),l&&(Js.fromBufferAttribute(e,c),jt.add(Js)),r=Math.max(r,i.distanceToSquared(jt))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,r=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new _n(new Float32Array(4*i.count),4));const o=this.getAttribute("tangent"),a=[],l=[];for(let b=0;b<i.count;b++)a[b]=new B,l[b]=new B;const c=new B,u=new B,d=new B,h=new je,f=new je,m=new je,y=new B,g=new B;function p(b,T,w){c.fromBufferAttribute(i,b),u.fromBufferAttribute(i,T),d.fromBufferAttribute(i,w),h.fromBufferAttribute(s,b),f.fromBufferAttribute(s,T),m.fromBufferAttribute(s,w),u.sub(c),d.sub(c),f.sub(h),m.sub(h);const P=1/(f.x*m.y-m.x*f.y);isFinite(P)&&(y.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(P),g.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(P),a[b].add(y),a[T].add(y),a[w].add(y),l[b].add(g),l[T].add(g),l[w].add(g))}let v=this.groups;v.length===0&&(v=[{start:0,count:e.count}]);for(let b=0,T=v.length;b<T;++b){const w=v[b],P=w.start,V=w.count;for(let I=P,O=P+V;I<O;I+=3)p(e.getX(I+0),e.getX(I+1),e.getX(I+2))}const _=new B,x=new B,A=new B,M=new B;function S(b){A.fromBufferAttribute(r,b),M.copy(A);const T=a[b];_.copy(T),_.sub(A.multiplyScalar(A.dot(T))).normalize(),x.crossVectors(M,T);const P=x.dot(l[b])<0?-1:1;o.setXYZW(b,_.x,_.y,_.z,P)}for(let b=0,T=v.length;b<T;++b){const w=v[b],P=w.start,V=w.count;for(let I=P,O=P+V;I<O;I+=3)S(e.getX(I+0)),S(e.getX(I+1)),S(e.getX(I+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new _n(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let h=0,f=i.count;h<f;h++)i.setXYZ(h,0,0,0);const r=new B,s=new B,o=new B,a=new B,l=new B,c=new B,u=new B,d=new B;if(e)for(let h=0,f=e.count;h<f;h+=3){const m=e.getX(h+0),y=e.getX(h+1),g=e.getX(h+2);r.fromBufferAttribute(t,m),s.fromBufferAttribute(t,y),o.fromBufferAttribute(t,g),u.subVectors(o,s),d.subVectors(r,s),u.cross(d),a.fromBufferAttribute(i,m),l.fromBufferAttribute(i,y),c.fromBufferAttribute(i,g),a.add(u),l.add(u),c.add(u),i.setXYZ(m,a.x,a.y,a.z),i.setXYZ(y,l.x,l.y,l.z),i.setXYZ(g,c.x,c.y,c.z)}else for(let h=0,f=t.count;h<f;h+=3)r.fromBufferAttribute(t,h+0),s.fromBufferAttribute(t,h+1),o.fromBufferAttribute(t,h+2),u.subVectors(o,s),d.subVectors(r,s),u.cross(d),i.setXYZ(h+0,u.x,u.y,u.z),i.setXYZ(h+1,u.x,u.y,u.z),i.setXYZ(h+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)jt.fromBufferAttribute(e,t),jt.normalize(),e.setXYZ(t,jt.x,jt.y,jt.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,d=a.normalized,h=new c.constructor(l.length*u);let f=0,m=0;for(let y=0,g=l.length;y<g;y++){a.isInterleavedBufferAttribute?f=l[y]*a.data.stride+a.offset:f=l[y]*u;for(let p=0;p<u;p++)h[m++]=c[f++]}return new _n(h,u,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new ki,i=this.index.array,r=this.attributes;for(const a in r){const l=r[a],c=e(l,i);t.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let u=0,d=c.length;u<d;u++){const h=c[u],f=e(h,i);l.push(f)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let d=0,h=c.length;d<h;d++){const f=c[d];u.push(f.toJSON(e.data))}u.length>0&&(r[l]=u,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const r=e.attributes;for(const c in r){const u=r[c];this.setAttribute(c,u.clone(t))}const s=e.morphAttributes;for(const c in s){const u=[],d=s[c];for(let h=0,f=d.length;h<f;h++)u.push(d[h].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,u=o.length;c<u;c++){const d=o[c];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Oy=new Oe,ls=new wh,Ac=new Ni,By=new B,eo=new B,to=new B,no=new B,Id=new B,Tc=new B,Ec=new je,bc=new je,Cc=new je,zy=new B,Vy=new B,Hy=new B,Rc=new B,Pc=new B;class vn extends Mt{constructor(e=new ki,t=new bs){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const i=this.geometry,r=i.attributes.position,s=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(s&&a){Tc.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=a[l],d=s[l];u!==0&&(Id.fromBufferAttribute(d,e),o?Tc.addScaledVector(Id,u):Tc.addScaledVector(Id.sub(t),u))}t.add(Tc)}return t}raycast(e,t){const i=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Ac.copy(i.boundingSphere),Ac.applyMatrix4(s),ls.copy(e.ray).recast(e.near),!(Ac.containsPoint(ls.origin)===!1&&(ls.intersectSphere(Ac,By)===null||ls.origin.distanceToSquared(By)>(e.far-e.near)**2))&&(Oy.copy(s).invert(),ls.copy(e.ray).applyMatrix4(Oy),!(i.boundingBox!==null&&ls.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,ls)))}_computeIntersections(e,t,i){let r;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,d=s.attributes.normal,h=s.groups,f=s.drawRange;if(a!==null)if(Array.isArray(o))for(let m=0,y=h.length;m<y;m++){const g=h[m],p=o[g.materialIndex],v=Math.max(g.start,f.start),_=Math.min(a.count,Math.min(g.start+g.count,f.start+f.count));for(let x=v,A=_;x<A;x+=3){const M=a.getX(x),S=a.getX(x+1),b=a.getX(x+2);r=Lc(this,p,e,i,c,u,d,M,S,b),r&&(r.faceIndex=Math.floor(x/3),r.face.materialIndex=g.materialIndex,t.push(r))}}else{const m=Math.max(0,f.start),y=Math.min(a.count,f.start+f.count);for(let g=m,p=y;g<p;g+=3){const v=a.getX(g),_=a.getX(g+1),x=a.getX(g+2);r=Lc(this,o,e,i,c,u,d,v,_,x),r&&(r.faceIndex=Math.floor(g/3),t.push(r))}}else if(l!==void 0)if(Array.isArray(o))for(let m=0,y=h.length;m<y;m++){const g=h[m],p=o[g.materialIndex],v=Math.max(g.start,f.start),_=Math.min(l.count,Math.min(g.start+g.count,f.start+f.count));for(let x=v,A=_;x<A;x+=3){const M=x,S=x+1,b=x+2;r=Lc(this,p,e,i,c,u,d,M,S,b),r&&(r.faceIndex=Math.floor(x/3),r.face.materialIndex=g.materialIndex,t.push(r))}}else{const m=Math.max(0,f.start),y=Math.min(l.count,f.start+f.count);for(let g=m,p=y;g<p;g+=3){const v=g,_=g+1,x=g+2;r=Lc(this,o,e,i,c,u,d,v,_,x),r&&(r.faceIndex=Math.floor(g/3),t.push(r))}}}}function vC(n,e,t,i,r,s,o,a){let l;if(e.side===Cn?l=i.intersectTriangle(o,s,r,!0,a):l=i.intersectTriangle(r,s,o,e.side===fr,a),l===null)return null;Pc.copy(a),Pc.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(Pc);return c<t.near||c>t.far?null:{distance:c,point:Pc.clone(),object:n}}function Lc(n,e,t,i,r,s,o,a,l,c){n.getVertexPosition(a,eo),n.getVertexPosition(l,to),n.getVertexPosition(c,no);const u=vC(n,e,t,i,eo,to,no,Rc);if(u){r&&(Ec.fromBufferAttribute(r,a),bc.fromBufferAttribute(r,l),Cc.fromBufferAttribute(r,c),u.uv=Ei.getInterpolation(Rc,eo,to,no,Ec,bc,Cc,new je)),s&&(Ec.fromBufferAttribute(s,a),bc.fromBufferAttribute(s,l),Cc.fromBufferAttribute(s,c),u.uv1=Ei.getInterpolation(Rc,eo,to,no,Ec,bc,Cc,new je)),o&&(zy.fromBufferAttribute(o,a),Vy.fromBufferAttribute(o,l),Hy.fromBufferAttribute(o,c),u.normal=Ei.getInterpolation(Rc,eo,to,no,zy,Vy,Hy,new B),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const d={a,b:l,c,normal:new B,materialIndex:0};Ei.getNormal(eo,to,no,d.normal),u.face=d}return u}class Vl extends ki{constructor(e=1,t=1,i=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],u=[],d=[];let h=0,f=0;m("z","y","x",-1,-1,i,t,e,o,s,0),m("z","y","x",1,-1,i,t,-e,o,s,1),m("x","z","y",1,1,e,i,t,r,o,2),m("x","z","y",1,-1,e,i,-t,r,o,3),m("x","y","z",1,-1,e,t,i,r,s,4),m("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(l),this.setAttribute("position",new sr(c,3)),this.setAttribute("normal",new sr(u,3)),this.setAttribute("uv",new sr(d,2));function m(y,g,p,v,_,x,A,M,S,b,T){const w=x/S,P=A/b,V=x/2,I=A/2,O=M/2,F=S+1,N=b+1;let G=0,L=0;const j=new B;for(let Y=0;Y<N;Y++){const ee=Y*P-I;for(let Q=0;Q<F;Q++){const De=Q*w-V;j[y]=De*v,j[g]=ee*_,j[p]=O,c.push(j.x,j.y,j.z),j[y]=0,j[g]=0,j[p]=M>0?1:-1,u.push(j.x,j.y,j.z),d.push(Q/S),d.push(1-Y/b),G+=1}}for(let Y=0;Y<b;Y++)for(let ee=0;ee<S;ee++){const Q=h+ee+F*Y,De=h+ee+F*(Y+1),K=h+(ee+1)+F*(Y+1),ne=h+(ee+1)+F*Y;l.push(Q,De,ne),l.push(De,K,ne),L+=6}a.addGroup(f,L,T),f+=L,h+=G}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Vl(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Jo(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=r.clone():Array.isArray(r)?e[t][i]=r.slice():e[t][i]=r}}return e}function dn(n){const e={};for(let t=0;t<n.length;t++){const i=Jo(n[t]);for(const r in i)e[r]=i[r]}return e}function yC(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function JS(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:nt.workingColorSpace}const _C={clone:Jo,merge:dn};var xC=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,wC=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class $r extends pi{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=xC,this.fragmentShader=wC,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Jo(e.uniforms),this.uniformsGroups=yC(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class eM extends Mt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Oe,this.projectionMatrix=new Oe,this.projectionMatrixInverse=new Oe,this.coordinateSystem=ir}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Ar=new B,Gy=new je,Wy=new je;class mn extends eM{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Qo*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(il*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Qo*2*Math.atan(Math.tan(il*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){Ar.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Ar.x,Ar.y).multiplyScalar(-e/Ar.z),Ar.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Ar.x,Ar.y).multiplyScalar(-e/Ar.z)}getViewSize(e,t){return this.getViewBounds(e,Gy,Wy),t.subVectors(Wy,Gy)}setViewOffset(e,t,i,r,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(il*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*r/l,t-=o.offsetY*i/c,r*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const io=-90,ro=1;class SC extends Mt{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new mn(io,ro,e,t);r.layers=this.layers,this.add(r);const s=new mn(io,ro,e,t);s.layers=this.layers,this.add(s);const o=new mn(io,ro,e,t);o.layers=this.layers,this.add(o);const a=new mn(io,ro,e,t);a.layers=this.layers,this.add(a);const l=new mn(io,ro,e,t);l.layers=this.layers,this.add(l);const c=new mn(io,ro,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,r,s,o,a,l]=t;for(const c of t)this.remove(c);if(e===ir)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===Xu)i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,l,c,u]=this.children,d=e.getRenderTarget(),h=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),m=e.xr.enabled;e.xr.enabled=!1;const y=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,r),e.render(t,s),e.setRenderTarget(i,1,r),e.render(t,o),e.setRenderTarget(i,2,r),e.render(t,a),e.setRenderTarget(i,3,r),e.render(t,l),e.setRenderTarget(i,4,r),e.render(t,c),i.texture.generateMipmaps=y,e.setRenderTarget(i,5,r),e.render(t,u),e.setRenderTarget(d,h,f),e.xr.enabled=m,i.texture.needsPMREMUpdate=!0}}class tM extends Kt{constructor(e,t,i,r,s,o,a,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:Xo,super(e,t,i,r,s,o,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class MC extends Os{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new tM(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Dn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Vl(5,5,5),s=new $r({name:"CubemapFromEquirect",uniforms:Jo(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Cn,blending:jr});s.uniforms.tEquirect.value=t;const o=new vn(r,s),a=t.minFilter;return t.minFilter===nr&&(t.minFilter=Dn),new SC(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,r);e.setRenderTarget(s)}}const Dd=new B,AC=new B,TC=new Fe;let vs=class{constructor(e=new B(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=Dd.subVectors(i,t).cross(AC.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(Dd),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||TC.getNormalMatrix(e),r=this.coplanarPoint(Dd).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};const cs=new Ni,Ic=new B;class Nm{constructor(e=new vs,t=new vs,i=new vs,r=new vs,s=new vs,o=new vs){this.planes=[e,t,i,r,s,o]}set(e,t,i,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=ir){const i=this.planes,r=e.elements,s=r[0],o=r[1],a=r[2],l=r[3],c=r[4],u=r[5],d=r[6],h=r[7],f=r[8],m=r[9],y=r[10],g=r[11],p=r[12],v=r[13],_=r[14],x=r[15];if(i[0].setComponents(l-s,h-c,g-f,x-p).normalize(),i[1].setComponents(l+s,h+c,g+f,x+p).normalize(),i[2].setComponents(l+o,h+u,g+m,x+v).normalize(),i[3].setComponents(l-o,h-u,g-m,x-v).normalize(),i[4].setComponents(l-a,h-d,g-y,x-_).normalize(),t===ir)i[5].setComponents(l+a,h+d,g+y,x+_).normalize();else if(t===Xu)i[5].setComponents(a,d,y,_).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),cs.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),cs.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(cs)}intersectsSprite(e){return cs.center.set(0,0,0),cs.radius=.7071067811865476,cs.applyMatrix4(e.matrixWorld),this.intersectsSphere(cs)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(Ic.x=r.normal.x>0?e.max.x:e.min.x,Ic.y=r.normal.y>0?e.max.y:e.min.y,Ic.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Ic)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function nM(){let n=null,e=!1,t=null,i=null;function r(s,o){t(s,o),i=n.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function EC(n){const e=new WeakMap;function t(a,l){const c=a.array,u=a.usage,d=c.byteLength,h=n.createBuffer();n.bindBuffer(l,h),n.bufferData(l,c,u),a.onUploadCallback();let f;if(c instanceof Float32Array)f=n.FLOAT;else if(c instanceof Uint16Array)a.isFloat16BufferAttribute?f=n.HALF_FLOAT:f=n.UNSIGNED_SHORT;else if(c instanceof Int16Array)f=n.SHORT;else if(c instanceof Uint32Array)f=n.UNSIGNED_INT;else if(c instanceof Int32Array)f=n.INT;else if(c instanceof Int8Array)f=n.BYTE;else if(c instanceof Uint8Array)f=n.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)f=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:h,type:f,bytesPerElement:c.BYTES_PER_ELEMENT,version:a.version,size:d}}function i(a,l,c){const u=l.array,d=l._updateRange,h=l.updateRanges;if(n.bindBuffer(c,a),d.count===-1&&h.length===0&&n.bufferSubData(c,0,u),h.length!==0){for(let f=0,m=h.length;f<m;f++){const y=h[f];n.bufferSubData(c,y.start*u.BYTES_PER_ELEMENT,u,y.start,y.count)}l.clearUpdateRanges()}d.count!==-1&&(n.bufferSubData(c,d.offset*u.BYTES_PER_ELEMENT,u,d.offset,d.count),d.count=-1),l.onUploadCallback()}function r(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const l=e.get(a);l&&(n.deleteBuffer(l.buffer),e.delete(a))}function o(a,l){if(a.isGLBufferAttribute){const u=e.get(a);(!u||u.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}a.isInterleavedBufferAttribute&&(a=a.data);const c=e.get(a);if(c===void 0)e.set(a,t(a,l));else if(c.version<a.version){if(c.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(c.buffer,a,l),c.version=a.version}}return{get:r,remove:s,update:o}}class ea extends ki{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(i),l=Math.floor(r),c=a+1,u=l+1,d=e/a,h=t/l,f=[],m=[],y=[],g=[];for(let p=0;p<u;p++){const v=p*h-o;for(let _=0;_<c;_++){const x=_*d-s;m.push(x,-v,0),y.push(0,0,1),g.push(_/a),g.push(1-p/l)}}for(let p=0;p<l;p++)for(let v=0;v<a;v++){const _=v+c*p,x=v+c*(p+1),A=v+1+c*(p+1),M=v+1+c*p;f.push(_,x,M),f.push(x,A,M)}this.setIndex(f),this.setAttribute("position",new sr(m,3)),this.setAttribute("normal",new sr(y,3)),this.setAttribute("uv",new sr(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ea(e.width,e.height,e.widthSegments,e.heightSegments)}}var bC=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,CC=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,RC=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,PC=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,LC=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,IC=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,DC=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,NC=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,kC=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,FC=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,UC=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,OC=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,BC=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,zC=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,VC=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,HC=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,GC=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,WC=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,jC=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,XC=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,qC=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,KC=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,YC=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( batchId );
	vColor.xyz *= batchingColor.xyz;
#endif`,$C=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,ZC=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,QC=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,JC=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,eR=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,tR=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,nR=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,iR="gl_FragColor = linearToOutputTexel( gl_FragColor );",rR=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,sR=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,oR=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,aR=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,lR=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,cR=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,uR=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,hR=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,dR=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fR=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,pR=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,mR=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,gR=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,vR=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,yR=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,_R=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,xR=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,wR=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,SR=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,MR=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,AR=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,TR=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,ER=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,bR=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,CR=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,RR=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,PR=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,LR=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,IR=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,DR=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,NR=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,kR=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,FR=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,UR=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,OR=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,BR=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,zR=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,VR=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,HR=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,GR=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,WR=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,jR=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,XR=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,qR=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,KR=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,YR=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,$R=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,ZR=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,QR=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,JR=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,eP=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,tP=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,nP=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,iP=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,rP=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,sP=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,oP=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,aP=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,lP=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return shadow;
	}
#endif`,cP=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,uP=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,hP=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,dP=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,fP=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,pP=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,mP=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,gP=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,vP=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,yP=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,_P=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,xP=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,wP=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,SP=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,MP=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,AP=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,TP=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const EP=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,bP=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,CP=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,RP=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,PP=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,LP=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,IP=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,DP=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,NP=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,kP=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,FP=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,UP=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,OP=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,BP=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,zP=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,VP=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,HP=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,GP=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,WP=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,jP=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,XP=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,qP=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,KP=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,YP=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,$P=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,ZP=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,QP=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,JP=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,eL=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,tL=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,nL=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,iL=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,rL=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sL=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ke={alphahash_fragment:bC,alphahash_pars_fragment:CC,alphamap_fragment:RC,alphamap_pars_fragment:PC,alphatest_fragment:LC,alphatest_pars_fragment:IC,aomap_fragment:DC,aomap_pars_fragment:NC,batching_pars_vertex:kC,batching_vertex:FC,begin_vertex:UC,beginnormal_vertex:OC,bsdfs:BC,iridescence_fragment:zC,bumpmap_pars_fragment:VC,clipping_planes_fragment:HC,clipping_planes_pars_fragment:GC,clipping_planes_pars_vertex:WC,clipping_planes_vertex:jC,color_fragment:XC,color_pars_fragment:qC,color_pars_vertex:KC,color_vertex:YC,common:$C,cube_uv_reflection_fragment:ZC,defaultnormal_vertex:QC,displacementmap_pars_vertex:JC,displacementmap_vertex:eR,emissivemap_fragment:tR,emissivemap_pars_fragment:nR,colorspace_fragment:iR,colorspace_pars_fragment:rR,envmap_fragment:sR,envmap_common_pars_fragment:oR,envmap_pars_fragment:aR,envmap_pars_vertex:lR,envmap_physical_pars_fragment:_R,envmap_vertex:cR,fog_vertex:uR,fog_pars_vertex:hR,fog_fragment:dR,fog_pars_fragment:fR,gradientmap_pars_fragment:pR,lightmap_pars_fragment:mR,lights_lambert_fragment:gR,lights_lambert_pars_fragment:vR,lights_pars_begin:yR,lights_toon_fragment:xR,lights_toon_pars_fragment:wR,lights_phong_fragment:SR,lights_phong_pars_fragment:MR,lights_physical_fragment:AR,lights_physical_pars_fragment:TR,lights_fragment_begin:ER,lights_fragment_maps:bR,lights_fragment_end:CR,logdepthbuf_fragment:RR,logdepthbuf_pars_fragment:PR,logdepthbuf_pars_vertex:LR,logdepthbuf_vertex:IR,map_fragment:DR,map_pars_fragment:NR,map_particle_fragment:kR,map_particle_pars_fragment:FR,metalnessmap_fragment:UR,metalnessmap_pars_fragment:OR,morphinstance_vertex:BR,morphcolor_vertex:zR,morphnormal_vertex:VR,morphtarget_pars_vertex:HR,morphtarget_vertex:GR,normal_fragment_begin:WR,normal_fragment_maps:jR,normal_pars_fragment:XR,normal_pars_vertex:qR,normal_vertex:KR,normalmap_pars_fragment:YR,clearcoat_normal_fragment_begin:$R,clearcoat_normal_fragment_maps:ZR,clearcoat_pars_fragment:QR,iridescence_pars_fragment:JR,opaque_fragment:eP,packing:tP,premultiplied_alpha_fragment:nP,project_vertex:iP,dithering_fragment:rP,dithering_pars_fragment:sP,roughnessmap_fragment:oP,roughnessmap_pars_fragment:aP,shadowmap_pars_fragment:lP,shadowmap_pars_vertex:cP,shadowmap_vertex:uP,shadowmask_pars_fragment:hP,skinbase_vertex:dP,skinning_pars_vertex:fP,skinning_vertex:pP,skinnormal_vertex:mP,specularmap_fragment:gP,specularmap_pars_fragment:vP,tonemapping_fragment:yP,tonemapping_pars_fragment:_P,transmission_fragment:xP,transmission_pars_fragment:wP,uv_pars_fragment:SP,uv_pars_vertex:MP,uv_vertex:AP,worldpos_vertex:TP,background_vert:EP,background_frag:bP,backgroundCube_vert:CP,backgroundCube_frag:RP,cube_vert:PP,cube_frag:LP,depth_vert:IP,depth_frag:DP,distanceRGBA_vert:NP,distanceRGBA_frag:kP,equirect_vert:FP,equirect_frag:UP,linedashed_vert:OP,linedashed_frag:BP,meshbasic_vert:zP,meshbasic_frag:VP,meshlambert_vert:HP,meshlambert_frag:GP,meshmatcap_vert:WP,meshmatcap_frag:jP,meshnormal_vert:XP,meshnormal_frag:qP,meshphong_vert:KP,meshphong_frag:YP,meshphysical_vert:$P,meshphysical_frag:ZP,meshtoon_vert:QP,meshtoon_frag:JP,points_vert:eL,points_frag:tL,shadow_vert:nL,shadow_frag:iL,sprite_vert:rL,sprite_frag:sL},ue={common:{diffuse:{value:new Le(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Fe},alphaMap:{value:null},alphaMapTransform:{value:new Fe},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Fe}},envmap:{envMap:{value:null},envMapRotation:{value:new Fe},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Fe}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Fe}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Fe},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Fe},normalScale:{value:new je(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Fe},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Fe}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Fe}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Fe}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Le(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Le(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Fe},alphaTest:{value:0},uvTransform:{value:new Fe}},sprite:{diffuse:{value:new Le(16777215)},opacity:{value:1},center:{value:new je(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Fe},alphaMap:{value:null},alphaMapTransform:{value:new Fe},alphaTest:{value:0}}},Mi={basic:{uniforms:dn([ue.common,ue.specularmap,ue.envmap,ue.aomap,ue.lightmap,ue.fog]),vertexShader:ke.meshbasic_vert,fragmentShader:ke.meshbasic_frag},lambert:{uniforms:dn([ue.common,ue.specularmap,ue.envmap,ue.aomap,ue.lightmap,ue.emissivemap,ue.bumpmap,ue.normalmap,ue.displacementmap,ue.fog,ue.lights,{emissive:{value:new Le(0)}}]),vertexShader:ke.meshlambert_vert,fragmentShader:ke.meshlambert_frag},phong:{uniforms:dn([ue.common,ue.specularmap,ue.envmap,ue.aomap,ue.lightmap,ue.emissivemap,ue.bumpmap,ue.normalmap,ue.displacementmap,ue.fog,ue.lights,{emissive:{value:new Le(0)},specular:{value:new Le(1118481)},shininess:{value:30}}]),vertexShader:ke.meshphong_vert,fragmentShader:ke.meshphong_frag},standard:{uniforms:dn([ue.common,ue.envmap,ue.aomap,ue.lightmap,ue.emissivemap,ue.bumpmap,ue.normalmap,ue.displacementmap,ue.roughnessmap,ue.metalnessmap,ue.fog,ue.lights,{emissive:{value:new Le(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ke.meshphysical_vert,fragmentShader:ke.meshphysical_frag},toon:{uniforms:dn([ue.common,ue.aomap,ue.lightmap,ue.emissivemap,ue.bumpmap,ue.normalmap,ue.displacementmap,ue.gradientmap,ue.fog,ue.lights,{emissive:{value:new Le(0)}}]),vertexShader:ke.meshtoon_vert,fragmentShader:ke.meshtoon_frag},matcap:{uniforms:dn([ue.common,ue.bumpmap,ue.normalmap,ue.displacementmap,ue.fog,{matcap:{value:null}}]),vertexShader:ke.meshmatcap_vert,fragmentShader:ke.meshmatcap_frag},points:{uniforms:dn([ue.points,ue.fog]),vertexShader:ke.points_vert,fragmentShader:ke.points_frag},dashed:{uniforms:dn([ue.common,ue.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ke.linedashed_vert,fragmentShader:ke.linedashed_frag},depth:{uniforms:dn([ue.common,ue.displacementmap]),vertexShader:ke.depth_vert,fragmentShader:ke.depth_frag},normal:{uniforms:dn([ue.common,ue.bumpmap,ue.normalmap,ue.displacementmap,{opacity:{value:1}}]),vertexShader:ke.meshnormal_vert,fragmentShader:ke.meshnormal_frag},sprite:{uniforms:dn([ue.sprite,ue.fog]),vertexShader:ke.sprite_vert,fragmentShader:ke.sprite_frag},background:{uniforms:{uvTransform:{value:new Fe},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ke.background_vert,fragmentShader:ke.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Fe}},vertexShader:ke.backgroundCube_vert,fragmentShader:ke.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ke.cube_vert,fragmentShader:ke.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ke.equirect_vert,fragmentShader:ke.equirect_frag},distanceRGBA:{uniforms:dn([ue.common,ue.displacementmap,{referencePosition:{value:new B},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ke.distanceRGBA_vert,fragmentShader:ke.distanceRGBA_frag},shadow:{uniforms:dn([ue.lights,ue.fog,{color:{value:new Le(0)},opacity:{value:1}}]),vertexShader:ke.shadow_vert,fragmentShader:ke.shadow_frag}};Mi.physical={uniforms:dn([Mi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Fe},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Fe},clearcoatNormalScale:{value:new je(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Fe},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Fe},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Fe},sheen:{value:0},sheenColor:{value:new Le(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Fe},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Fe},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Fe},transmissionSamplerSize:{value:new je},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Fe},attenuationDistance:{value:0},attenuationColor:{value:new Le(0)},specularColor:{value:new Le(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Fe},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Fe},anisotropyVector:{value:new je},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Fe}}]),vertexShader:ke.meshphysical_vert,fragmentShader:ke.meshphysical_frag};const Dc={r:0,b:0,g:0},us=new Di,oL=new Oe;function aL(n,e,t,i,r,s,o){const a=new Le(0);let l=s===!0?0:1,c,u,d=null,h=0,f=null;function m(v){let _=v.isScene===!0?v.background:null;return _&&_.isTexture&&(_=(v.backgroundBlurriness>0?t:e).get(_)),_}function y(v){let _=!1;const x=m(v);x===null?p(a,l):x&&x.isColor&&(p(x,1),_=!0);const A=n.xr.getEnvironmentBlendMode();A==="additive"?i.buffers.color.setClear(0,0,0,1,o):A==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,o),(n.autoClear||_)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function g(v,_){const x=m(_);x&&(x.isCubeTexture||x.mapping===yh)?(u===void 0&&(u=new vn(new Vl(1,1,1),new $r({name:"BackgroundCubeMaterial",uniforms:Jo(Mi.backgroundCube.uniforms),vertexShader:Mi.backgroundCube.vertexShader,fragmentShader:Mi.backgroundCube.fragmentShader,side:Cn,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(A,M,S){this.matrixWorld.copyPosition(S.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),us.copy(_.backgroundRotation),us.x*=-1,us.y*=-1,us.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(us.y*=-1,us.z*=-1),u.material.uniforms.envMap.value=x,u.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=_.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(oL.makeRotationFromEuler(us)),u.material.toneMapped=nt.getTransfer(x.colorSpace)!==mt,(d!==x||h!==x.version||f!==n.toneMapping)&&(u.material.needsUpdate=!0,d=x,h=x.version,f=n.toneMapping),u.layers.enableAll(),v.unshift(u,u.geometry,u.material,0,0,null)):x&&x.isTexture&&(c===void 0&&(c=new vn(new ea(2,2),new $r({name:"BackgroundMaterial",uniforms:Jo(Mi.background.uniforms),vertexShader:Mi.background.vertexShader,fragmentShader:Mi.background.fragmentShader,side:fr,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=x,c.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,c.material.toneMapped=nt.getTransfer(x.colorSpace)!==mt,x.matrixAutoUpdate===!0&&x.updateMatrix(),c.material.uniforms.uvTransform.value.copy(x.matrix),(d!==x||h!==x.version||f!==n.toneMapping)&&(c.material.needsUpdate=!0,d=x,h=x.version,f=n.toneMapping),c.layers.enableAll(),v.unshift(c,c.geometry,c.material,0,0,null))}function p(v,_){v.getRGB(Dc,JS(n)),i.buffers.color.setClear(Dc.r,Dc.g,Dc.b,_,o)}return{getClearColor:function(){return a},setClearColor:function(v,_=1){a.set(v),l=_,p(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(v){l=v,p(a,l)},render:y,addToRenderList:g}}function lL(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},r=h(null);let s=r,o=!1;function a(w,P,V,I,O){let F=!1;const N=d(I,V,P);s!==N&&(s=N,c(s.object)),F=f(w,I,V,O),F&&m(w,I,V,O),O!==null&&e.update(O,n.ELEMENT_ARRAY_BUFFER),(F||o)&&(o=!1,x(w,P,V,I),O!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(O).buffer))}function l(){return n.createVertexArray()}function c(w){return n.bindVertexArray(w)}function u(w){return n.deleteVertexArray(w)}function d(w,P,V){const I=V.wireframe===!0;let O=i[w.id];O===void 0&&(O={},i[w.id]=O);let F=O[P.id];F===void 0&&(F={},O[P.id]=F);let N=F[I];return N===void 0&&(N=h(l()),F[I]=N),N}function h(w){const P=[],V=[],I=[];for(let O=0;O<t;O++)P[O]=0,V[O]=0,I[O]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:P,enabledAttributes:V,attributeDivisors:I,object:w,attributes:{},index:null}}function f(w,P,V,I){const O=s.attributes,F=P.attributes;let N=0;const G=V.getAttributes();for(const L in G)if(G[L].location>=0){const Y=O[L];let ee=F[L];if(ee===void 0&&(L==="instanceMatrix"&&w.instanceMatrix&&(ee=w.instanceMatrix),L==="instanceColor"&&w.instanceColor&&(ee=w.instanceColor)),Y===void 0||Y.attribute!==ee||ee&&Y.data!==ee.data)return!0;N++}return s.attributesNum!==N||s.index!==I}function m(w,P,V,I){const O={},F=P.attributes;let N=0;const G=V.getAttributes();for(const L in G)if(G[L].location>=0){let Y=F[L];Y===void 0&&(L==="instanceMatrix"&&w.instanceMatrix&&(Y=w.instanceMatrix),L==="instanceColor"&&w.instanceColor&&(Y=w.instanceColor));const ee={};ee.attribute=Y,Y&&Y.data&&(ee.data=Y.data),O[L]=ee,N++}s.attributes=O,s.attributesNum=N,s.index=I}function y(){const w=s.newAttributes;for(let P=0,V=w.length;P<V;P++)w[P]=0}function g(w){p(w,0)}function p(w,P){const V=s.newAttributes,I=s.enabledAttributes,O=s.attributeDivisors;V[w]=1,I[w]===0&&(n.enableVertexAttribArray(w),I[w]=1),O[w]!==P&&(n.vertexAttribDivisor(w,P),O[w]=P)}function v(){const w=s.newAttributes,P=s.enabledAttributes;for(let V=0,I=P.length;V<I;V++)P[V]!==w[V]&&(n.disableVertexAttribArray(V),P[V]=0)}function _(w,P,V,I,O,F,N){N===!0?n.vertexAttribIPointer(w,P,V,O,F):n.vertexAttribPointer(w,P,V,I,O,F)}function x(w,P,V,I){y();const O=I.attributes,F=V.getAttributes(),N=P.defaultAttributeValues;for(const G in F){const L=F[G];if(L.location>=0){let j=O[G];if(j===void 0&&(G==="instanceMatrix"&&w.instanceMatrix&&(j=w.instanceMatrix),G==="instanceColor"&&w.instanceColor&&(j=w.instanceColor)),j!==void 0){const Y=j.normalized,ee=j.itemSize,Q=e.get(j);if(Q===void 0)continue;const De=Q.buffer,K=Q.type,ne=Q.bytesPerElement,he=K===n.INT||K===n.UNSIGNED_INT||j.gpuType===FS;if(j.isInterleavedBufferAttribute){const ce=j.data,He=ce.stride,Be=j.offset;if(ce.isInstancedInterleavedBuffer){for(let Ze=0;Ze<L.locationSize;Ze++)p(L.location+Ze,ce.meshPerAttribute);w.isInstancedMesh!==!0&&I._maxInstanceCount===void 0&&(I._maxInstanceCount=ce.meshPerAttribute*ce.count)}else for(let Ze=0;Ze<L.locationSize;Ze++)g(L.location+Ze);n.bindBuffer(n.ARRAY_BUFFER,De);for(let Ze=0;Ze<L.locationSize;Ze++)_(L.location+Ze,ee/L.locationSize,K,Y,He*ne,(Be+ee/L.locationSize*Ze)*ne,he)}else{if(j.isInstancedBufferAttribute){for(let ce=0;ce<L.locationSize;ce++)p(L.location+ce,j.meshPerAttribute);w.isInstancedMesh!==!0&&I._maxInstanceCount===void 0&&(I._maxInstanceCount=j.meshPerAttribute*j.count)}else for(let ce=0;ce<L.locationSize;ce++)g(L.location+ce);n.bindBuffer(n.ARRAY_BUFFER,De);for(let ce=0;ce<L.locationSize;ce++)_(L.location+ce,ee/L.locationSize,K,Y,ee*ne,ee/L.locationSize*ce*ne,he)}}else if(N!==void 0){const Y=N[G];if(Y!==void 0)switch(Y.length){case 2:n.vertexAttrib2fv(L.location,Y);break;case 3:n.vertexAttrib3fv(L.location,Y);break;case 4:n.vertexAttrib4fv(L.location,Y);break;default:n.vertexAttrib1fv(L.location,Y)}}}}v()}function A(){b();for(const w in i){const P=i[w];for(const V in P){const I=P[V];for(const O in I)u(I[O].object),delete I[O];delete P[V]}delete i[w]}}function M(w){if(i[w.id]===void 0)return;const P=i[w.id];for(const V in P){const I=P[V];for(const O in I)u(I[O].object),delete I[O];delete P[V]}delete i[w.id]}function S(w){for(const P in i){const V=i[P];if(V[w.id]===void 0)continue;const I=V[w.id];for(const O in I)u(I[O].object),delete I[O];delete V[w.id]}}function b(){T(),o=!0,s!==r&&(s=r,c(s.object))}function T(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:a,reset:b,resetDefaultState:T,dispose:A,releaseStatesOfGeometry:M,releaseStatesOfProgram:S,initAttributes:y,enableAttribute:g,disableUnusedAttributes:v}}function cL(n,e,t){let i;function r(c){i=c}function s(c,u){n.drawArrays(i,c,u),t.update(u,i,1)}function o(c,u,d){d!==0&&(n.drawArraysInstanced(i,c,u,d),t.update(u,i,d))}function a(c,u,d){if(d===0)return;const h=e.get("WEBGL_multi_draw");if(h===null)for(let f=0;f<d;f++)this.render(c[f],u[f]);else{h.multiDrawArraysWEBGL(i,c,0,u,0,d);let f=0;for(let m=0;m<d;m++)f+=u[m];t.update(f,i,1)}}function l(c,u,d,h){if(d===0)return;const f=e.get("WEBGL_multi_draw");if(f===null)for(let m=0;m<c.length;m++)o(c[m],u[m],h[m]);else{f.multiDrawArraysInstancedWEBGL(i,c,0,u,0,h,0,d);let m=0;for(let y=0;y<d;y++)m+=u[y];for(let y=0;y<h.length;y++)t.update(m,i,h[y])}}this.setMode=r,this.render=s,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=l}function uL(n,e,t,i){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const M=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(M){return!(M!==ci&&i.convert(M)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(M){const S=M===_h&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(M!==Yr&&i.convert(M)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&M!==bi&&!S)}function l(M){if(M==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";M="mediump"}return M==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=t.precision!==void 0?t.precision:"highp";const u=l(c);u!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",u,"instead."),c=u);const d=t.logarithmicDepthBuffer===!0,h=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),f=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),m=n.getParameter(n.MAX_TEXTURE_SIZE),y=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),g=n.getParameter(n.MAX_VERTEX_ATTRIBS),p=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),v=n.getParameter(n.MAX_VARYING_VECTORS),_=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),x=f>0,A=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:l,textureFormatReadable:o,textureTypeReadable:a,precision:c,logarithmicDepthBuffer:d,maxTextures:h,maxVertexTextures:f,maxTextureSize:m,maxCubemapSize:y,maxAttributes:g,maxVertexUniforms:p,maxVaryings:v,maxFragmentUniforms:_,vertexTextures:x,maxSamples:A}}function hL(n){const e=this;let t=null,i=0,r=!1,s=!1;const o=new vs,a=new Fe,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,h){const f=d.length!==0||h||i!==0||r;return r=h,i=d.length,f},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(d,h){t=u(d,h,0)},this.setState=function(d,h,f){const m=d.clippingPlanes,y=d.clipIntersection,g=d.clipShadows,p=n.get(d);if(!r||m===null||m.length===0||s&&!g)s?u(null):c();else{const v=s?0:i,_=v*4;let x=p.clippingState||null;l.value=x,x=u(m,h,_,f);for(let A=0;A!==_;++A)x[A]=t[A];p.clippingState=x,this.numIntersection=y?this.numPlanes:0,this.numPlanes+=v}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function u(d,h,f,m){const y=d!==null?d.length:0;let g=null;if(y!==0){if(g=l.value,m!==!0||g===null){const p=f+y*4,v=h.matrixWorldInverse;a.getNormalMatrix(v),(g===null||g.length<p)&&(g=new Float32Array(p));for(let _=0,x=f;_!==y;++_,x+=4)o.copy(d[_]).applyMatrix4(v,a),o.normal.toArray(g,x),g[x+3]=o.constant}l.value=g,l.needsUpdate=!0}return e.numPlanes=y,e.numIntersection=0,g}}function dL(n){let e=new WeakMap;function t(o,a){return a===cp?o.mapping=Xo:a===up&&(o.mapping=qo),o}function i(o){if(o&&o.isTexture){const a=o.mapping;if(a===cp||a===up)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new MC(l.height);return c.fromEquirectangularTexture(n,o),e.set(o,c),o.addEventListener("dispose",r),t(c.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:i,dispose:s}}class km extends eM{constructor(e=-1,t=1,i=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,o=i+e,a=r+t,l=r-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const So=4,jy=[.125,.215,.35,.446,.526,.582],Ss=20,Nd=new km,Xy=new Le;let kd=null,Fd=0,Ud=0,Od=!1;const ys=(1+Math.sqrt(5))/2,so=1/ys,qy=[new B(-ys,so,0),new B(ys,so,0),new B(-so,0,ys),new B(so,0,ys),new B(0,ys,-so),new B(0,ys,so),new B(-1,1,-1),new B(1,1,-1),new B(-1,1,1),new B(1,1,1)];class Ky{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){kd=this._renderer.getRenderTarget(),Fd=this._renderer.getActiveCubeFace(),Ud=this._renderer.getActiveMipmapLevel(),Od=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,i,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Zy(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=$y(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(kd,Fd,Ud),this._renderer.xr.enabled=Od,e.scissorTest=!1,Nc(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Xo||e.mapping===qo?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),kd=this._renderer.getRenderTarget(),Fd=this._renderer.getActiveCubeFace(),Ud=this._renderer.getActiveMipmapLevel(),Od=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Dn,minFilter:Dn,generateMipmaps:!1,type:_h,format:ci,colorSpace:Jt,depthBuffer:!1},r=Yy(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Yy(e,t,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=fL(s)),this._blurMaterial=pL(s,e,t)}return r}_compileMaterial(e){const t=new vn(this._lodPlanes[0],e);this._renderer.compile(t,Nd)}_sceneToCubeUV(e,t,i,r){const a=new mn(90,1,t,i),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,d=u.autoClear,h=u.toneMapping;u.getClearColor(Xy),u.toneMapping=Xr,u.autoClear=!1;const f=new bs({name:"PMREM.Background",side:Cn,depthWrite:!1,depthTest:!1}),m=new vn(new Vl,f);let y=!1;const g=e.background;g?g.isColor&&(f.color.copy(g),e.background=null,y=!0):(f.color.copy(Xy),y=!0);for(let p=0;p<6;p++){const v=p%3;v===0?(a.up.set(0,l[p],0),a.lookAt(c[p],0,0)):v===1?(a.up.set(0,0,l[p]),a.lookAt(0,c[p],0)):(a.up.set(0,l[p],0),a.lookAt(0,0,c[p]));const _=this._cubeSize;Nc(r,v*_,p>2?_:0,_,_),u.setRenderTarget(r),y&&u.render(m,a),u.render(e,a)}m.geometry.dispose(),m.material.dispose(),u.toneMapping=h,u.autoClear=d,e.background=g}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===Xo||e.mapping===qo;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=Zy()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=$y());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new vn(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const l=this._cubeSize;Nc(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(o,Nd)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=qy[(r-s-1)%qy.length];this._blur(e,s-1,s,o,a)}t.autoClear=i}_blur(e,t,i,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,r,"latitudinal",s),this._halfBlur(o,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,d=new vn(this._lodPlanes[r],c),h=c.uniforms,f=this._sizeLods[i]-1,m=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*Ss-1),y=s/m,g=isFinite(s)?1+Math.floor(u*y):Ss;g>Ss&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${Ss}`);const p=[];let v=0;for(let S=0;S<Ss;++S){const b=S/y,T=Math.exp(-b*b/2);p.push(T),S===0?v+=T:S<g&&(v+=2*T)}for(let S=0;S<p.length;S++)p[S]=p[S]/v;h.envMap.value=e.texture,h.samples.value=g,h.weights.value=p,h.latitudinal.value=o==="latitudinal",a&&(h.poleAxis.value=a);const{_lodMax:_}=this;h.dTheta.value=m,h.mipInt.value=_-i;const x=this._sizeLods[r],A=3*x*(r>_-So?r-_+So:0),M=4*(this._cubeSize-x);Nc(t,A,M,3*x,2*x),l.setRenderTarget(t),l.render(d,Nd)}}function fL(n){const e=[],t=[],i=[];let r=n;const s=n-So+1+jy.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);t.push(a);let l=1/a;o>n-So?l=jy[o-n+So-1]:o===0&&(l=0),i.push(l);const c=1/(a-2),u=-c,d=1+c,h=[u,u,d,u,d,d,u,u,d,d,u,d],f=6,m=6,y=3,g=2,p=1,v=new Float32Array(y*m*f),_=new Float32Array(g*m*f),x=new Float32Array(p*m*f);for(let M=0;M<f;M++){const S=M%3*2/3-1,b=M>2?0:-1,T=[S,b,0,S+2/3,b,0,S+2/3,b+1,0,S,b,0,S+2/3,b+1,0,S,b+1,0];v.set(T,y*m*M),_.set(h,g*m*M);const w=[M,M,M,M,M,M];x.set(w,p*m*M)}const A=new ki;A.setAttribute("position",new _n(v,y)),A.setAttribute("uv",new _n(_,g)),A.setAttribute("faceIndex",new _n(x,p)),e.push(A),r>So&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function Yy(n,e,t){const i=new Os(n,e,t);return i.texture.mapping=yh,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Nc(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function pL(n,e,t){const i=new Float32Array(Ss),r=new B(0,1,0);return new $r({name:"SphericalGaussianBlur",defines:{n:Ss,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:Fm(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:jr,depthTest:!1,depthWrite:!1})}function $y(){return new $r({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Fm(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:jr,depthTest:!1,depthWrite:!1})}function Zy(){return new $r({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Fm(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:jr,depthTest:!1,depthWrite:!1})}function Fm(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function mL(n){let e=new WeakMap,t=null;function i(a){if(a&&a.isTexture){const l=a.mapping,c=l===cp||l===up,u=l===Xo||l===qo;if(c||u){let d=e.get(a);const h=d!==void 0?d.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==h)return t===null&&(t=new Ky(n)),d=c?t.fromEquirectangular(a,d):t.fromCubemap(a,d),d.texture.pmremVersion=a.pmremVersion,e.set(a,d),d.texture;if(d!==void 0)return d.texture;{const f=a.image;return c&&f&&f.height>0||u&&f&&r(f)?(t===null&&(t=new Ky(n)),d=c?t.fromEquirectangular(a):t.fromCubemap(a),d.texture.pmremVersion=a.pmremVersion,e.set(a,d),a.addEventListener("dispose",s),d.texture):null}}}return a}function r(a){let l=0;const c=6;for(let u=0;u<c;u++)a[u]!==void 0&&l++;return l===c}function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:o}}function gL(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const r=t(i);return r===null&&Dm("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function vL(n,e,t,i){const r={},s=new WeakMap;function o(d){const h=d.target;h.index!==null&&e.remove(h.index);for(const m in h.attributes)e.remove(h.attributes[m]);for(const m in h.morphAttributes){const y=h.morphAttributes[m];for(let g=0,p=y.length;g<p;g++)e.remove(y[g])}h.removeEventListener("dispose",o),delete r[h.id];const f=s.get(h);f&&(e.remove(f),s.delete(h)),i.releaseStatesOfGeometry(h),h.isInstancedBufferGeometry===!0&&delete h._maxInstanceCount,t.memory.geometries--}function a(d,h){return r[h.id]===!0||(h.addEventListener("dispose",o),r[h.id]=!0,t.memory.geometries++),h}function l(d){const h=d.attributes;for(const m in h)e.update(h[m],n.ARRAY_BUFFER);const f=d.morphAttributes;for(const m in f){const y=f[m];for(let g=0,p=y.length;g<p;g++)e.update(y[g],n.ARRAY_BUFFER)}}function c(d){const h=[],f=d.index,m=d.attributes.position;let y=0;if(f!==null){const v=f.array;y=f.version;for(let _=0,x=v.length;_<x;_+=3){const A=v[_+0],M=v[_+1],S=v[_+2];h.push(A,M,M,S,S,A)}}else if(m!==void 0){const v=m.array;y=m.version;for(let _=0,x=v.length/3-1;_<x;_+=3){const A=_+0,M=_+1,S=_+2;h.push(A,M,M,S,S,A)}}else return;const g=new(XS(h)?QS:ZS)(h,1);g.version=y;const p=s.get(d);p&&e.remove(p),s.set(d,g)}function u(d){const h=s.get(d);if(h){const f=d.index;f!==null&&h.version<f.version&&c(d)}else c(d);return s.get(d)}return{get:a,update:l,getWireframeAttribute:u}}function yL(n,e,t){let i;function r(h){i=h}let s,o;function a(h){s=h.type,o=h.bytesPerElement}function l(h,f){n.drawElements(i,f,s,h*o),t.update(f,i,1)}function c(h,f,m){m!==0&&(n.drawElementsInstanced(i,f,s,h*o,m),t.update(f,i,m))}function u(h,f,m){if(m===0)return;const y=e.get("WEBGL_multi_draw");if(y===null)for(let g=0;g<m;g++)this.render(h[g]/o,f[g]);else{y.multiDrawElementsWEBGL(i,f,0,s,h,0,m);let g=0;for(let p=0;p<m;p++)g+=f[p];t.update(g,i,1)}}function d(h,f,m,y){if(m===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let p=0;p<h.length;p++)c(h[p]/o,f[p],y[p]);else{g.multiDrawElementsInstancedWEBGL(i,f,0,s,h,0,y,0,m);let p=0;for(let v=0;v<m;v++)p+=f[v];for(let v=0;v<y.length;v++)t.update(p,i,y[v])}}this.setMode=r,this.setIndex=a,this.render=l,this.renderInstances=c,this.renderMultiDraw=u,this.renderMultiDrawInstances=d}function _L(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,o,a){switch(t.calls++,o){case n.TRIANGLES:t.triangles+=a*(s/3);break;case n.LINES:t.lines+=a*(s/2);break;case n.LINE_STRIP:t.lines+=a*(s-1);break;case n.LINE_LOOP:t.lines+=a*s;break;case n.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:i}}function xL(n,e,t){const i=new WeakMap,r=new ht;function s(o,a,l){const c=o.morphTargetInfluences,u=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,d=u!==void 0?u.length:0;let h=i.get(a);if(h===void 0||h.count!==d){let w=function(){b.dispose(),i.delete(a),a.removeEventListener("dispose",w)};var f=w;h!==void 0&&h.texture.dispose();const m=a.morphAttributes.position!==void 0,y=a.morphAttributes.normal!==void 0,g=a.morphAttributes.color!==void 0,p=a.morphAttributes.position||[],v=a.morphAttributes.normal||[],_=a.morphAttributes.color||[];let x=0;m===!0&&(x=1),y===!0&&(x=2),g===!0&&(x=3);let A=a.attributes.position.count*x,M=1;A>e.maxTextureSize&&(M=Math.ceil(A/e.maxTextureSize),A=e.maxTextureSize);const S=new Float32Array(A*M*4*d),b=new KS(S,A,M,d);b.type=bi,b.needsUpdate=!0;const T=x*4;for(let P=0;P<d;P++){const V=p[P],I=v[P],O=_[P],F=A*M*4*P;for(let N=0;N<V.count;N++){const G=N*T;m===!0&&(r.fromBufferAttribute(V,N),S[F+G+0]=r.x,S[F+G+1]=r.y,S[F+G+2]=r.z,S[F+G+3]=0),y===!0&&(r.fromBufferAttribute(I,N),S[F+G+4]=r.x,S[F+G+5]=r.y,S[F+G+6]=r.z,S[F+G+7]=0),g===!0&&(r.fromBufferAttribute(O,N),S[F+G+8]=r.x,S[F+G+9]=r.y,S[F+G+10]=r.z,S[F+G+11]=O.itemSize===4?r.w:1)}}h={count:d,texture:b,size:new je(A,M)},i.set(a,h),a.addEventListener("dispose",w)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)l.getUniforms().setValue(n,"morphTexture",o.morphTexture,t);else{let m=0;for(let g=0;g<c.length;g++)m+=c[g];const y=a.morphTargetsRelative?1:1-m;l.getUniforms().setValue(n,"morphTargetBaseInfluence",y),l.getUniforms().setValue(n,"morphTargetInfluences",c)}l.getUniforms().setValue(n,"morphTargetsTexture",h.texture,t),l.getUniforms().setValue(n,"morphTargetsTextureSize",h.size)}return{update:s}}function wL(n,e,t,i){let r=new WeakMap;function s(l){const c=i.render.frame,u=l.geometry,d=e.get(l,u);if(r.get(d)!==c&&(e.update(d),r.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),r.get(l)!==c&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,n.ARRAY_BUFFER),r.set(l,c))),l.isSkinnedMesh){const h=l.skeleton;r.get(h)!==c&&(h.update(),r.set(h,c))}return d}function o(){r=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:s,dispose:o}}class iM extends Kt{constructor(e,t,i,r,s,o,a,l,c,u=ko){if(u!==ko&&u!==Zo)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&u===ko&&(i=Yo),i===void 0&&u===Zo&&(i=$o),super(null,r,s,o,a,l,u,i,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:gn,this.minFilter=l!==void 0?l:gn,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const rM=new Kt,sM=new iM(1,1);sM.compareFunction=jS;const oM=new KS,aM=new aC,lM=new tM,Qy=[],Jy=[],e0=new Float32Array(16),t0=new Float32Array(9),n0=new Float32Array(4);function ha(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let s=Qy[r];if(s===void 0&&(s=new Float32Array(r),Qy[r]=s),e!==0){i.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function Vt(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Ht(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function Sh(n,e){let t=Jy[e];t===void 0&&(t=new Int32Array(e),Jy[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function SL(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function ML(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Vt(t,e))return;n.uniform2fv(this.addr,e),Ht(t,e)}}function AL(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Vt(t,e))return;n.uniform3fv(this.addr,e),Ht(t,e)}}function TL(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Vt(t,e))return;n.uniform4fv(this.addr,e),Ht(t,e)}}function EL(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Vt(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Ht(t,e)}else{if(Vt(t,i))return;n0.set(i),n.uniformMatrix2fv(this.addr,!1,n0),Ht(t,i)}}function bL(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Vt(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Ht(t,e)}else{if(Vt(t,i))return;t0.set(i),n.uniformMatrix3fv(this.addr,!1,t0),Ht(t,i)}}function CL(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Vt(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Ht(t,e)}else{if(Vt(t,i))return;e0.set(i),n.uniformMatrix4fv(this.addr,!1,e0),Ht(t,i)}}function RL(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function PL(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Vt(t,e))return;n.uniform2iv(this.addr,e),Ht(t,e)}}function LL(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Vt(t,e))return;n.uniform3iv(this.addr,e),Ht(t,e)}}function IL(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Vt(t,e))return;n.uniform4iv(this.addr,e),Ht(t,e)}}function DL(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function NL(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Vt(t,e))return;n.uniform2uiv(this.addr,e),Ht(t,e)}}function kL(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Vt(t,e))return;n.uniform3uiv(this.addr,e),Ht(t,e)}}function FL(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Vt(t,e))return;n.uniform4uiv(this.addr,e),Ht(t,e)}}function UL(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r);const s=this.type===n.SAMPLER_2D_SHADOW?sM:rM;t.setTexture2D(e||s,r)}function OL(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||aM,r)}function BL(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||lM,r)}function zL(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||oM,r)}function VL(n){switch(n){case 5126:return SL;case 35664:return ML;case 35665:return AL;case 35666:return TL;case 35674:return EL;case 35675:return bL;case 35676:return CL;case 5124:case 35670:return RL;case 35667:case 35671:return PL;case 35668:case 35672:return LL;case 35669:case 35673:return IL;case 5125:return DL;case 36294:return NL;case 36295:return kL;case 36296:return FL;case 35678:case 36198:case 36298:case 36306:case 35682:return UL;case 35679:case 36299:case 36307:return OL;case 35680:case 36300:case 36308:case 36293:return BL;case 36289:case 36303:case 36311:case 36292:return zL}}function HL(n,e){n.uniform1fv(this.addr,e)}function GL(n,e){const t=ha(e,this.size,2);n.uniform2fv(this.addr,t)}function WL(n,e){const t=ha(e,this.size,3);n.uniform3fv(this.addr,t)}function jL(n,e){const t=ha(e,this.size,4);n.uniform4fv(this.addr,t)}function XL(n,e){const t=ha(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function qL(n,e){const t=ha(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function KL(n,e){const t=ha(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function YL(n,e){n.uniform1iv(this.addr,e)}function $L(n,e){n.uniform2iv(this.addr,e)}function ZL(n,e){n.uniform3iv(this.addr,e)}function QL(n,e){n.uniform4iv(this.addr,e)}function JL(n,e){n.uniform1uiv(this.addr,e)}function eI(n,e){n.uniform2uiv(this.addr,e)}function tI(n,e){n.uniform3uiv(this.addr,e)}function nI(n,e){n.uniform4uiv(this.addr,e)}function iI(n,e,t){const i=this.cache,r=e.length,s=Sh(t,r);Vt(i,s)||(n.uniform1iv(this.addr,s),Ht(i,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||rM,s[o])}function rI(n,e,t){const i=this.cache,r=e.length,s=Sh(t,r);Vt(i,s)||(n.uniform1iv(this.addr,s),Ht(i,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||aM,s[o])}function sI(n,e,t){const i=this.cache,r=e.length,s=Sh(t,r);Vt(i,s)||(n.uniform1iv(this.addr,s),Ht(i,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||lM,s[o])}function oI(n,e,t){const i=this.cache,r=e.length,s=Sh(t,r);Vt(i,s)||(n.uniform1iv(this.addr,s),Ht(i,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||oM,s[o])}function aI(n){switch(n){case 5126:return HL;case 35664:return GL;case 35665:return WL;case 35666:return jL;case 35674:return XL;case 35675:return qL;case 35676:return KL;case 5124:case 35670:return YL;case 35667:case 35671:return $L;case 35668:case 35672:return ZL;case 35669:case 35673:return QL;case 5125:return JL;case 36294:return eI;case 36295:return tI;case 36296:return nI;case 35678:case 36198:case 36298:case 36306:case 35682:return iI;case 35679:case 36299:case 36307:return rI;case 35680:case 36300:case 36308:case 36293:return sI;case 36289:case 36303:case 36311:case 36292:return oI}}class lI{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=VL(t.type)}}class cI{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=aI(t.type)}}class uI{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],i)}}}const Bd=/(\w+)(\])?(\[|\.)?/g;function i0(n,e){n.seq.push(e),n.map[e.id]=e}function hI(n,e,t){const i=n.name,r=i.length;for(Bd.lastIndex=0;;){const s=Bd.exec(i),o=Bd.lastIndex;let a=s[1];const l=s[2]==="]",c=s[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===r){i0(t,c===void 0?new lI(a,n,e):new cI(a,n,e));break}else{let d=t.map[a];d===void 0&&(d=new uI(a),i0(t,d)),t=d}}}class du{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const s=e.getActiveUniform(t,r),o=e.getUniformLocation(t,s.name);hI(s,o,this)}}setValue(e,t,i,r){const s=this.map[t];s!==void 0&&s.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],l=i[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&i.push(o)}return i}}function r0(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}const dI=37297;let fI=0;function pI(n,e){const t=n.split(`
`),i=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join(`
`)}function mI(n){const e=nt.getPrimaries(nt.workingColorSpace),t=nt.getPrimaries(n);let i;switch(e===t?i="":e===ju&&t===Wu?i="LinearDisplayP3ToLinearSRGB":e===Wu&&t===ju&&(i="LinearSRGBToLinearDisplayP3"),n){case Jt:case xh:return[i,"LinearTransferOETF"];case pn:case Lm:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),[i,"LinearTransferOETF"]}}function s0(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),r=n.getShaderInfoLog(e).trim();if(i&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return t.toUpperCase()+`

`+r+`

`+pI(n.getShaderSource(e),o)}else return r}function gI(n,e){const t=mI(e);return`vec4 ${n}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function vI(n,e){let t;switch(e){case l1:t="Linear";break;case c1:t="Reinhard";break;case u1:t="OptimizedCineon";break;case h1:t="ACESFilmic";break;case f1:t="AgX";break;case p1:t="Neutral";break;case d1:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function yI(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Wa).join(`
`)}function _I(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function xI(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const s=n.getActiveAttrib(e,r),o=s.name;let a=1;s.type===n.FLOAT_MAT2&&(a=2),s.type===n.FLOAT_MAT3&&(a=3),s.type===n.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}function Wa(n){return n!==""}function o0(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function a0(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const wI=/^[ \t]*#include +<([\w\d./]+)>/gm;function fp(n){return n.replace(wI,MI)}const SI=new Map;function MI(n,e){let t=ke[e];if(t===void 0){const i=SI.get(e);if(i!==void 0)t=ke[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return fp(t)}const AI=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function l0(n){return n.replace(AI,TI)}function TI(n,e,t,i){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function c0(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function EI(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===IS?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===Nb?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===$i&&(e="SHADOWMAP_TYPE_VSM"),e}function bI(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Xo:case qo:e="ENVMAP_TYPE_CUBE";break;case yh:e="ENVMAP_TYPE_CUBE_UV";break}return e}function CI(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case qo:e="ENVMAP_MODE_REFRACTION";break}return e}function RI(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case DS:e="ENVMAP_BLENDING_MULTIPLY";break;case o1:e="ENVMAP_BLENDING_MIX";break;case a1:e="ENVMAP_BLENDING_ADD";break}return e}function PI(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function LI(n,e,t,i){const r=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=EI(t),c=bI(t),u=CI(t),d=RI(t),h=PI(t),f=yI(t),m=_I(s),y=r.createProgram();let g,p,v=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(g=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m].filter(Wa).join(`
`),g.length>0&&(g+=`
`),p=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m].filter(Wa).join(`
`),p.length>0&&(p+=`
`)):(g=[c0(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Wa).join(`
`),p=[c0(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Xr?"#define TONE_MAPPING":"",t.toneMapping!==Xr?ke.tonemapping_pars_fragment:"",t.toneMapping!==Xr?vI("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",ke.colorspace_pars_fragment,gI("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Wa).join(`
`)),o=fp(o),o=o0(o,t),o=a0(o,t),a=fp(a),a=o0(a,t),a=a0(a,t),o=l0(o),a=l0(a),t.isRawShaderMaterial!==!0&&(v=`#version 300 es
`,g=[f,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,p=["#define varying in",t.glslVersion===Ay?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Ay?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+p);const _=v+g+o,x=v+p+a,A=r0(r,r.VERTEX_SHADER,_),M=r0(r,r.FRAGMENT_SHADER,x);r.attachShader(y,A),r.attachShader(y,M),t.index0AttributeName!==void 0?r.bindAttribLocation(y,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(y,0,"position"),r.linkProgram(y);function S(P){if(n.debug.checkShaderErrors){const V=r.getProgramInfoLog(y).trim(),I=r.getShaderInfoLog(A).trim(),O=r.getShaderInfoLog(M).trim();let F=!0,N=!0;if(r.getProgramParameter(y,r.LINK_STATUS)===!1)if(F=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(r,y,A,M);else{const G=s0(r,A,"vertex"),L=s0(r,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(y,r.VALIDATE_STATUS)+`

Material Name: `+P.name+`
Material Type: `+P.type+`

Program Info Log: `+V+`
`+G+`
`+L)}else V!==""?console.warn("THREE.WebGLProgram: Program Info Log:",V):(I===""||O==="")&&(N=!1);N&&(P.diagnostics={runnable:F,programLog:V,vertexShader:{log:I,prefix:g},fragmentShader:{log:O,prefix:p}})}r.deleteShader(A),r.deleteShader(M),b=new du(r,y),T=xI(r,y)}let b;this.getUniforms=function(){return b===void 0&&S(this),b};let T;this.getAttributes=function(){return T===void 0&&S(this),T};let w=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return w===!1&&(w=r.getProgramParameter(y,dI)),w},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(y),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=fI++,this.cacheKey=e,this.usedTimes=1,this.program=y,this.vertexShader=A,this.fragmentShader=M,this}let II=0;class DI{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new NI(e),t.set(e,i)),i}}class NI{constructor(e){this.id=II++,this.code=e,this.usedTimes=0}}function kI(n,e,t,i,r,s,o){const a=new YS,l=new DI,c=new Set,u=[],d=r.logarithmicDepthBuffer,h=r.vertexTextures;let f=r.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function y(T){return c.add(T),T===0?"uv":`uv${T}`}function g(T,w,P,V,I){const O=V.fog,F=I.geometry,N=T.isMeshStandardMaterial?V.environment:null,G=(T.isMeshStandardMaterial?t:e).get(T.envMap||N),L=G&&G.mapping===yh?G.image.height:null,j=m[T.type];T.precision!==null&&(f=r.getMaxPrecision(T.precision),f!==T.precision&&console.warn("THREE.WebGLProgram.getParameters:",T.precision,"not supported, using",f,"instead."));const Y=F.morphAttributes.position||F.morphAttributes.normal||F.morphAttributes.color,ee=Y!==void 0?Y.length:0;let Q=0;F.morphAttributes.position!==void 0&&(Q=1),F.morphAttributes.normal!==void 0&&(Q=2),F.morphAttributes.color!==void 0&&(Q=3);let De,K,ne,he;if(j){const ct=Mi[j];De=ct.vertexShader,K=ct.fragmentShader}else De=T.vertexShader,K=T.fragmentShader,l.update(T),ne=l.getVertexShaderID(T),he=l.getFragmentShaderID(T);const ce=n.getRenderTarget(),He=I.isInstancedMesh===!0,Be=I.isBatchedMesh===!0,Ze=!!T.map,U=!!T.matcap,$e=!!G,Ke=!!T.aoMap,_t=!!T.lightMap,Ee=!!T.bumpMap,Je=!!T.normalMap,Ge=!!T.displacementMap,Ne=!!T.emissiveMap,Dt=!!T.metalnessMap,D=!!T.roughnessMap,C=T.anisotropy>0,q=T.clearcoat>0,J=T.dispersion>0,ie=T.iridescence>0,re=T.sheen>0,Me=T.transmission>0,de=C&&!!T.anisotropyMap,fe=q&&!!T.clearcoatMap,ze=q&&!!T.clearcoatNormalMap,oe=q&&!!T.clearcoatRoughnessMap,we=ie&&!!T.iridescenceMap,qe=ie&&!!T.iridescenceThicknessMap,Re=re&&!!T.sheenColorMap,pe=re&&!!T.sheenRoughnessMap,Ve=!!T.specularMap,Ye=!!T.specularColorMap,Rt=!!T.specularIntensityMap,k=Me&&!!T.transmissionMap,me=Me&&!!T.thicknessMap,$=!!T.gradientMap,Z=!!T.alphaMap,le=T.alphaTest>0,Pe=!!T.alphaHash,et=!!T.extensions;let Pt=Xr;T.toneMapped&&(ce===null||ce.isXRRenderTarget===!0)&&(Pt=n.toneMapping);const Gt={shaderID:j,shaderType:T.type,shaderName:T.name,vertexShader:De,fragmentShader:K,defines:T.defines,customVertexShaderID:ne,customFragmentShaderID:he,isRawShaderMaterial:T.isRawShaderMaterial===!0,glslVersion:T.glslVersion,precision:f,batching:Be,batchingColor:Be&&I._colorsTexture!==null,instancing:He,instancingColor:He&&I.instanceColor!==null,instancingMorph:He&&I.morphTexture!==null,supportsVertexTextures:h,outputColorSpace:ce===null?n.outputColorSpace:ce.isXRRenderTarget===!0?ce.texture.colorSpace:Jt,alphaToCoverage:!!T.alphaToCoverage,map:Ze,matcap:U,envMap:$e,envMapMode:$e&&G.mapping,envMapCubeUVHeight:L,aoMap:Ke,lightMap:_t,bumpMap:Ee,normalMap:Je,displacementMap:h&&Ge,emissiveMap:Ne,normalMapObjectSpace:Je&&T.normalMapType===R1,normalMapTangentSpace:Je&&T.normalMapType===WS,metalnessMap:Dt,roughnessMap:D,anisotropy:C,anisotropyMap:de,clearcoat:q,clearcoatMap:fe,clearcoatNormalMap:ze,clearcoatRoughnessMap:oe,dispersion:J,iridescence:ie,iridescenceMap:we,iridescenceThicknessMap:qe,sheen:re,sheenColorMap:Re,sheenRoughnessMap:pe,specularMap:Ve,specularColorMap:Ye,specularIntensityMap:Rt,transmission:Me,transmissionMap:k,thicknessMap:me,gradientMap:$,opaque:T.transparent===!1&&T.blending===No&&T.alphaToCoverage===!1,alphaMap:Z,alphaTest:le,alphaHash:Pe,combine:T.combine,mapUv:Ze&&y(T.map.channel),aoMapUv:Ke&&y(T.aoMap.channel),lightMapUv:_t&&y(T.lightMap.channel),bumpMapUv:Ee&&y(T.bumpMap.channel),normalMapUv:Je&&y(T.normalMap.channel),displacementMapUv:Ge&&y(T.displacementMap.channel),emissiveMapUv:Ne&&y(T.emissiveMap.channel),metalnessMapUv:Dt&&y(T.metalnessMap.channel),roughnessMapUv:D&&y(T.roughnessMap.channel),anisotropyMapUv:de&&y(T.anisotropyMap.channel),clearcoatMapUv:fe&&y(T.clearcoatMap.channel),clearcoatNormalMapUv:ze&&y(T.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:oe&&y(T.clearcoatRoughnessMap.channel),iridescenceMapUv:we&&y(T.iridescenceMap.channel),iridescenceThicknessMapUv:qe&&y(T.iridescenceThicknessMap.channel),sheenColorMapUv:Re&&y(T.sheenColorMap.channel),sheenRoughnessMapUv:pe&&y(T.sheenRoughnessMap.channel),specularMapUv:Ve&&y(T.specularMap.channel),specularColorMapUv:Ye&&y(T.specularColorMap.channel),specularIntensityMapUv:Rt&&y(T.specularIntensityMap.channel),transmissionMapUv:k&&y(T.transmissionMap.channel),thicknessMapUv:me&&y(T.thicknessMap.channel),alphaMapUv:Z&&y(T.alphaMap.channel),vertexTangents:!!F.attributes.tangent&&(Je||C),vertexColors:T.vertexColors,vertexAlphas:T.vertexColors===!0&&!!F.attributes.color&&F.attributes.color.itemSize===4,pointsUvs:I.isPoints===!0&&!!F.attributes.uv&&(Ze||Z),fog:!!O,useFog:T.fog===!0,fogExp2:!!O&&O.isFogExp2,flatShading:T.flatShading===!0,sizeAttenuation:T.sizeAttenuation===!0,logarithmicDepthBuffer:d,skinning:I.isSkinnedMesh===!0,morphTargets:F.morphAttributes.position!==void 0,morphNormals:F.morphAttributes.normal!==void 0,morphColors:F.morphAttributes.color!==void 0,morphTargetsCount:ee,morphTextureStride:Q,numDirLights:w.directional.length,numPointLights:w.point.length,numSpotLights:w.spot.length,numSpotLightMaps:w.spotLightMap.length,numRectAreaLights:w.rectArea.length,numHemiLights:w.hemi.length,numDirLightShadows:w.directionalShadowMap.length,numPointLightShadows:w.pointShadowMap.length,numSpotLightShadows:w.spotShadowMap.length,numSpotLightShadowsWithMaps:w.numSpotLightShadowsWithMaps,numLightProbes:w.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:T.dithering,shadowMapEnabled:n.shadowMap.enabled&&P.length>0,shadowMapType:n.shadowMap.type,toneMapping:Pt,decodeVideoTexture:Ze&&T.map.isVideoTexture===!0&&nt.getTransfer(T.map.colorSpace)===mt,premultipliedAlpha:T.premultipliedAlpha,doubleSided:T.side===Ti,flipSided:T.side===Cn,useDepthPacking:T.depthPacking>=0,depthPacking:T.depthPacking||0,index0AttributeName:T.index0AttributeName,extensionClipCullDistance:et&&T.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:et&&T.extensions.multiDraw===!0&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:T.customProgramCacheKey()};return Gt.vertexUv1s=c.has(1),Gt.vertexUv2s=c.has(2),Gt.vertexUv3s=c.has(3),c.clear(),Gt}function p(T){const w=[];if(T.shaderID?w.push(T.shaderID):(w.push(T.customVertexShaderID),w.push(T.customFragmentShaderID)),T.defines!==void 0)for(const P in T.defines)w.push(P),w.push(T.defines[P]);return T.isRawShaderMaterial===!1&&(v(w,T),_(w,T),w.push(n.outputColorSpace)),w.push(T.customProgramCacheKey),w.join()}function v(T,w){T.push(w.precision),T.push(w.outputColorSpace),T.push(w.envMapMode),T.push(w.envMapCubeUVHeight),T.push(w.mapUv),T.push(w.alphaMapUv),T.push(w.lightMapUv),T.push(w.aoMapUv),T.push(w.bumpMapUv),T.push(w.normalMapUv),T.push(w.displacementMapUv),T.push(w.emissiveMapUv),T.push(w.metalnessMapUv),T.push(w.roughnessMapUv),T.push(w.anisotropyMapUv),T.push(w.clearcoatMapUv),T.push(w.clearcoatNormalMapUv),T.push(w.clearcoatRoughnessMapUv),T.push(w.iridescenceMapUv),T.push(w.iridescenceThicknessMapUv),T.push(w.sheenColorMapUv),T.push(w.sheenRoughnessMapUv),T.push(w.specularMapUv),T.push(w.specularColorMapUv),T.push(w.specularIntensityMapUv),T.push(w.transmissionMapUv),T.push(w.thicknessMapUv),T.push(w.combine),T.push(w.fogExp2),T.push(w.sizeAttenuation),T.push(w.morphTargetsCount),T.push(w.morphAttributeCount),T.push(w.numDirLights),T.push(w.numPointLights),T.push(w.numSpotLights),T.push(w.numSpotLightMaps),T.push(w.numHemiLights),T.push(w.numRectAreaLights),T.push(w.numDirLightShadows),T.push(w.numPointLightShadows),T.push(w.numSpotLightShadows),T.push(w.numSpotLightShadowsWithMaps),T.push(w.numLightProbes),T.push(w.shadowMapType),T.push(w.toneMapping),T.push(w.numClippingPlanes),T.push(w.numClipIntersection),T.push(w.depthPacking)}function _(T,w){a.disableAll(),w.supportsVertexTextures&&a.enable(0),w.instancing&&a.enable(1),w.instancingColor&&a.enable(2),w.instancingMorph&&a.enable(3),w.matcap&&a.enable(4),w.envMap&&a.enable(5),w.normalMapObjectSpace&&a.enable(6),w.normalMapTangentSpace&&a.enable(7),w.clearcoat&&a.enable(8),w.iridescence&&a.enable(9),w.alphaTest&&a.enable(10),w.vertexColors&&a.enable(11),w.vertexAlphas&&a.enable(12),w.vertexUv1s&&a.enable(13),w.vertexUv2s&&a.enable(14),w.vertexUv3s&&a.enable(15),w.vertexTangents&&a.enable(16),w.anisotropy&&a.enable(17),w.alphaHash&&a.enable(18),w.batching&&a.enable(19),w.dispersion&&a.enable(20),w.batchingColor&&a.enable(21),T.push(a.mask),a.disableAll(),w.fog&&a.enable(0),w.useFog&&a.enable(1),w.flatShading&&a.enable(2),w.logarithmicDepthBuffer&&a.enable(3),w.skinning&&a.enable(4),w.morphTargets&&a.enable(5),w.morphNormals&&a.enable(6),w.morphColors&&a.enable(7),w.premultipliedAlpha&&a.enable(8),w.shadowMapEnabled&&a.enable(9),w.doubleSided&&a.enable(10),w.flipSided&&a.enable(11),w.useDepthPacking&&a.enable(12),w.dithering&&a.enable(13),w.transmission&&a.enable(14),w.sheen&&a.enable(15),w.opaque&&a.enable(16),w.pointsUvs&&a.enable(17),w.decodeVideoTexture&&a.enable(18),w.alphaToCoverage&&a.enable(19),T.push(a.mask)}function x(T){const w=m[T.type];let P;if(w){const V=Mi[w];P=_C.clone(V.uniforms)}else P=T.uniforms;return P}function A(T,w){let P;for(let V=0,I=u.length;V<I;V++){const O=u[V];if(O.cacheKey===w){P=O,++P.usedTimes;break}}return P===void 0&&(P=new LI(n,w,T,s),u.push(P)),P}function M(T){if(--T.usedTimes===0){const w=u.indexOf(T);u[w]=u[u.length-1],u.pop(),T.destroy()}}function S(T){l.remove(T)}function b(){l.dispose()}return{getParameters:g,getProgramCacheKey:p,getUniforms:x,acquireProgram:A,releaseProgram:M,releaseShaderCache:S,programs:u,dispose:b}}function FI(){let n=new WeakMap;function e(s){let o=n.get(s);return o===void 0&&(o={},n.set(s,o)),o}function t(s){n.delete(s)}function i(s,o,a){n.get(s)[o]=a}function r(){n=new WeakMap}return{get:e,remove:t,update:i,dispose:r}}function UI(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function u0(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function h0(){const n=[];let e=0;const t=[],i=[],r=[];function s(){e=0,t.length=0,i.length=0,r.length=0}function o(d,h,f,m,y,g){let p=n[e];return p===void 0?(p={id:d.id,object:d,geometry:h,material:f,groupOrder:m,renderOrder:d.renderOrder,z:y,group:g},n[e]=p):(p.id=d.id,p.object=d,p.geometry=h,p.material=f,p.groupOrder=m,p.renderOrder=d.renderOrder,p.z=y,p.group=g),e++,p}function a(d,h,f,m,y,g){const p=o(d,h,f,m,y,g);f.transmission>0?i.push(p):f.transparent===!0?r.push(p):t.push(p)}function l(d,h,f,m,y,g){const p=o(d,h,f,m,y,g);f.transmission>0?i.unshift(p):f.transparent===!0?r.unshift(p):t.unshift(p)}function c(d,h){t.length>1&&t.sort(d||UI),i.length>1&&i.sort(h||u0),r.length>1&&r.sort(h||u0)}function u(){for(let d=e,h=n.length;d<h;d++){const f=n[d];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:t,transmissive:i,transparent:r,init:s,push:a,unshift:l,finish:u,sort:c}}function OI(){let n=new WeakMap;function e(i,r){const s=n.get(i);let o;return s===void 0?(o=new h0,n.set(i,[o])):r>=s.length?(o=new h0,s.push(o)):o=s[r],o}function t(){n=new WeakMap}return{get:e,dispose:t}}function BI(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new B,color:new Le};break;case"SpotLight":t={position:new B,direction:new B,color:new Le,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new B,color:new Le,distance:0,decay:0};break;case"HemisphereLight":t={direction:new B,skyColor:new Le,groundColor:new Le};break;case"RectAreaLight":t={color:new Le,position:new B,halfWidth:new B,halfHeight:new B};break}return n[e.id]=t,t}}}function zI(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new je};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new je};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new je,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let VI=0;function HI(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function GI(n){const e=new BI,t=zI(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)i.probe.push(new B);const r=new B,s=new Oe,o=new Oe;function a(c){let u=0,d=0,h=0;for(let T=0;T<9;T++)i.probe[T].set(0,0,0);let f=0,m=0,y=0,g=0,p=0,v=0,_=0,x=0,A=0,M=0,S=0;c.sort(HI);for(let T=0,w=c.length;T<w;T++){const P=c[T],V=P.color,I=P.intensity,O=P.distance,F=P.shadow&&P.shadow.map?P.shadow.map.texture:null;if(P.isAmbientLight)u+=V.r*I,d+=V.g*I,h+=V.b*I;else if(P.isLightProbe){for(let N=0;N<9;N++)i.probe[N].addScaledVector(P.sh.coefficients[N],I);S++}else if(P.isDirectionalLight){const N=e.get(P);if(N.color.copy(P.color).multiplyScalar(P.intensity),P.castShadow){const G=P.shadow,L=t.get(P);L.shadowBias=G.bias,L.shadowNormalBias=G.normalBias,L.shadowRadius=G.radius,L.shadowMapSize=G.mapSize,i.directionalShadow[f]=L,i.directionalShadowMap[f]=F,i.directionalShadowMatrix[f]=P.shadow.matrix,v++}i.directional[f]=N,f++}else if(P.isSpotLight){const N=e.get(P);N.position.setFromMatrixPosition(P.matrixWorld),N.color.copy(V).multiplyScalar(I),N.distance=O,N.coneCos=Math.cos(P.angle),N.penumbraCos=Math.cos(P.angle*(1-P.penumbra)),N.decay=P.decay,i.spot[y]=N;const G=P.shadow;if(P.map&&(i.spotLightMap[A]=P.map,A++,G.updateMatrices(P),P.castShadow&&M++),i.spotLightMatrix[y]=G.matrix,P.castShadow){const L=t.get(P);L.shadowBias=G.bias,L.shadowNormalBias=G.normalBias,L.shadowRadius=G.radius,L.shadowMapSize=G.mapSize,i.spotShadow[y]=L,i.spotShadowMap[y]=F,x++}y++}else if(P.isRectAreaLight){const N=e.get(P);N.color.copy(V).multiplyScalar(I),N.halfWidth.set(P.width*.5,0,0),N.halfHeight.set(0,P.height*.5,0),i.rectArea[g]=N,g++}else if(P.isPointLight){const N=e.get(P);if(N.color.copy(P.color).multiplyScalar(P.intensity),N.distance=P.distance,N.decay=P.decay,P.castShadow){const G=P.shadow,L=t.get(P);L.shadowBias=G.bias,L.shadowNormalBias=G.normalBias,L.shadowRadius=G.radius,L.shadowMapSize=G.mapSize,L.shadowCameraNear=G.camera.near,L.shadowCameraFar=G.camera.far,i.pointShadow[m]=L,i.pointShadowMap[m]=F,i.pointShadowMatrix[m]=P.shadow.matrix,_++}i.point[m]=N,m++}else if(P.isHemisphereLight){const N=e.get(P);N.skyColor.copy(P.color).multiplyScalar(I),N.groundColor.copy(P.groundColor).multiplyScalar(I),i.hemi[p]=N,p++}}g>0&&(n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=ue.LTC_FLOAT_1,i.rectAreaLTC2=ue.LTC_FLOAT_2):(i.rectAreaLTC1=ue.LTC_HALF_1,i.rectAreaLTC2=ue.LTC_HALF_2)),i.ambient[0]=u,i.ambient[1]=d,i.ambient[2]=h;const b=i.hash;(b.directionalLength!==f||b.pointLength!==m||b.spotLength!==y||b.rectAreaLength!==g||b.hemiLength!==p||b.numDirectionalShadows!==v||b.numPointShadows!==_||b.numSpotShadows!==x||b.numSpotMaps!==A||b.numLightProbes!==S)&&(i.directional.length=f,i.spot.length=y,i.rectArea.length=g,i.point.length=m,i.hemi.length=p,i.directionalShadow.length=v,i.directionalShadowMap.length=v,i.pointShadow.length=_,i.pointShadowMap.length=_,i.spotShadow.length=x,i.spotShadowMap.length=x,i.directionalShadowMatrix.length=v,i.pointShadowMatrix.length=_,i.spotLightMatrix.length=x+A-M,i.spotLightMap.length=A,i.numSpotLightShadowsWithMaps=M,i.numLightProbes=S,b.directionalLength=f,b.pointLength=m,b.spotLength=y,b.rectAreaLength=g,b.hemiLength=p,b.numDirectionalShadows=v,b.numPointShadows=_,b.numSpotShadows=x,b.numSpotMaps=A,b.numLightProbes=S,i.version=VI++)}function l(c,u){let d=0,h=0,f=0,m=0,y=0;const g=u.matrixWorldInverse;for(let p=0,v=c.length;p<v;p++){const _=c[p];if(_.isDirectionalLight){const x=i.directional[d];x.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),x.direction.sub(r),x.direction.transformDirection(g),d++}else if(_.isSpotLight){const x=i.spot[f];x.position.setFromMatrixPosition(_.matrixWorld),x.position.applyMatrix4(g),x.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),x.direction.sub(r),x.direction.transformDirection(g),f++}else if(_.isRectAreaLight){const x=i.rectArea[m];x.position.setFromMatrixPosition(_.matrixWorld),x.position.applyMatrix4(g),o.identity(),s.copy(_.matrixWorld),s.premultiply(g),o.extractRotation(s),x.halfWidth.set(_.width*.5,0,0),x.halfHeight.set(0,_.height*.5,0),x.halfWidth.applyMatrix4(o),x.halfHeight.applyMatrix4(o),m++}else if(_.isPointLight){const x=i.point[h];x.position.setFromMatrixPosition(_.matrixWorld),x.position.applyMatrix4(g),h++}else if(_.isHemisphereLight){const x=i.hemi[y];x.direction.setFromMatrixPosition(_.matrixWorld),x.direction.transformDirection(g),y++}}}return{setup:a,setupView:l,state:i}}function d0(n){const e=new GI(n),t=[],i=[];function r(u){c.camera=u,t.length=0,i.length=0}function s(u){t.push(u)}function o(u){i.push(u)}function a(){e.setup(t)}function l(u){e.setupView(t,u)}const c={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:c,setupLights:a,setupLightsView:l,pushLight:s,pushShadow:o}}function WI(n){let e=new WeakMap;function t(r,s=0){const o=e.get(r);let a;return o===void 0?(a=new d0(n),e.set(r,[a])):s>=o.length?(a=new d0(n),o.push(a)):a=o[s],a}function i(){e=new WeakMap}return{get:t,dispose:i}}class jI extends pi{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=b1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class XI extends pi{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const qI=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,KI=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function YI(n,e,t){let i=new Nm;const r=new je,s=new je,o=new ht,a=new jI({depthPacking:C1}),l=new XI,c={},u=t.maxTextureSize,d={[fr]:Cn,[Cn]:fr,[Ti]:Ti},h=new $r({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new je},radius:{value:4}},vertexShader:qI,fragmentShader:KI}),f=h.clone();f.defines.HORIZONTAL_PASS=1;const m=new ki;m.setAttribute("position",new _n(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const y=new vn(m,h),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=IS;let p=this.type;this.render=function(M,S,b){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||M.length===0)return;const T=n.getRenderTarget(),w=n.getActiveCubeFace(),P=n.getActiveMipmapLevel(),V=n.state;V.setBlending(jr),V.buffers.color.setClear(1,1,1,1),V.buffers.depth.setTest(!0),V.setScissorTest(!1);const I=p!==$i&&this.type===$i,O=p===$i&&this.type!==$i;for(let F=0,N=M.length;F<N;F++){const G=M[F],L=G.shadow;if(L===void 0){console.warn("THREE.WebGLShadowMap:",G,"has no shadow.");continue}if(L.autoUpdate===!1&&L.needsUpdate===!1)continue;r.copy(L.mapSize);const j=L.getFrameExtents();if(r.multiply(j),s.copy(L.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/j.x),r.x=s.x*j.x,L.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/j.y),r.y=s.y*j.y,L.mapSize.y=s.y)),L.map===null||I===!0||O===!0){const ee=this.type!==$i?{minFilter:gn,magFilter:gn}:{};L.map!==null&&L.map.dispose(),L.map=new Os(r.x,r.y,ee),L.map.texture.name=G.name+".shadowMap",L.camera.updateProjectionMatrix()}n.setRenderTarget(L.map),n.clear();const Y=L.getViewportCount();for(let ee=0;ee<Y;ee++){const Q=L.getViewport(ee);o.set(s.x*Q.x,s.y*Q.y,s.x*Q.z,s.y*Q.w),V.viewport(o),L.updateMatrices(G,ee),i=L.getFrustum(),x(S,b,L.camera,G,this.type)}L.isPointLightShadow!==!0&&this.type===$i&&v(L,b),L.needsUpdate=!1}p=this.type,g.needsUpdate=!1,n.setRenderTarget(T,w,P)};function v(M,S){const b=e.update(y);h.defines.VSM_SAMPLES!==M.blurSamples&&(h.defines.VSM_SAMPLES=M.blurSamples,f.defines.VSM_SAMPLES=M.blurSamples,h.needsUpdate=!0,f.needsUpdate=!0),M.mapPass===null&&(M.mapPass=new Os(r.x,r.y)),h.uniforms.shadow_pass.value=M.map.texture,h.uniforms.resolution.value=M.mapSize,h.uniforms.radius.value=M.radius,n.setRenderTarget(M.mapPass),n.clear(),n.renderBufferDirect(S,null,b,h,y,null),f.uniforms.shadow_pass.value=M.mapPass.texture,f.uniforms.resolution.value=M.mapSize,f.uniforms.radius.value=M.radius,n.setRenderTarget(M.map),n.clear(),n.renderBufferDirect(S,null,b,f,y,null)}function _(M,S,b,T){let w=null;const P=b.isPointLight===!0?M.customDistanceMaterial:M.customDepthMaterial;if(P!==void 0)w=P;else if(w=b.isPointLight===!0?l:a,n.localClippingEnabled&&S.clipShadows===!0&&Array.isArray(S.clippingPlanes)&&S.clippingPlanes.length!==0||S.displacementMap&&S.displacementScale!==0||S.alphaMap&&S.alphaTest>0||S.map&&S.alphaTest>0){const V=w.uuid,I=S.uuid;let O=c[V];O===void 0&&(O={},c[V]=O);let F=O[I];F===void 0&&(F=w.clone(),O[I]=F,S.addEventListener("dispose",A)),w=F}if(w.visible=S.visible,w.wireframe=S.wireframe,T===$i?w.side=S.shadowSide!==null?S.shadowSide:S.side:w.side=S.shadowSide!==null?S.shadowSide:d[S.side],w.alphaMap=S.alphaMap,w.alphaTest=S.alphaTest,w.map=S.map,w.clipShadows=S.clipShadows,w.clippingPlanes=S.clippingPlanes,w.clipIntersection=S.clipIntersection,w.displacementMap=S.displacementMap,w.displacementScale=S.displacementScale,w.displacementBias=S.displacementBias,w.wireframeLinewidth=S.wireframeLinewidth,w.linewidth=S.linewidth,b.isPointLight===!0&&w.isMeshDistanceMaterial===!0){const V=n.properties.get(w);V.light=b}return w}function x(M,S,b,T,w){if(M.visible===!1)return;if(M.layers.test(S.layers)&&(M.isMesh||M.isLine||M.isPoints)&&(M.castShadow||M.receiveShadow&&w===$i)&&(!M.frustumCulled||i.intersectsObject(M))){M.modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,M.matrixWorld);const I=e.update(M),O=M.material;if(Array.isArray(O)){const F=I.groups;for(let N=0,G=F.length;N<G;N++){const L=F[N],j=O[L.materialIndex];if(j&&j.visible){const Y=_(M,j,T,w);M.onBeforeShadow(n,M,S,b,I,Y,L),n.renderBufferDirect(b,null,I,Y,M,L),M.onAfterShadow(n,M,S,b,I,Y,L)}}}else if(O.visible){const F=_(M,O,T,w);M.onBeforeShadow(n,M,S,b,I,F,null),n.renderBufferDirect(b,null,I,F,M,null),M.onAfterShadow(n,M,S,b,I,F,null)}}const V=M.children;for(let I=0,O=V.length;I<O;I++)x(V[I],S,b,T,w)}function A(M){M.target.removeEventListener("dispose",A);for(const b in c){const T=c[b],w=M.target.uuid;w in T&&(T[w].dispose(),delete T[w])}}}function $I(n){function e(){let k=!1;const me=new ht;let $=null;const Z=new ht(0,0,0,0);return{setMask:function(le){$!==le&&!k&&(n.colorMask(le,le,le,le),$=le)},setLocked:function(le){k=le},setClear:function(le,Pe,et,Pt,Gt){Gt===!0&&(le*=Pt,Pe*=Pt,et*=Pt),me.set(le,Pe,et,Pt),Z.equals(me)===!1&&(n.clearColor(le,Pe,et,Pt),Z.copy(me))},reset:function(){k=!1,$=null,Z.set(-1,0,0,0)}}}function t(){let k=!1,me=null,$=null,Z=null;return{setTest:function(le){le?he(n.DEPTH_TEST):ce(n.DEPTH_TEST)},setMask:function(le){me!==le&&!k&&(n.depthMask(le),me=le)},setFunc:function(le){if($!==le){switch(le){case Jb:n.depthFunc(n.NEVER);break;case e1:n.depthFunc(n.ALWAYS);break;case t1:n.depthFunc(n.LESS);break;case zu:n.depthFunc(n.LEQUAL);break;case n1:n.depthFunc(n.EQUAL);break;case i1:n.depthFunc(n.GEQUAL);break;case r1:n.depthFunc(n.GREATER);break;case s1:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}$=le}},setLocked:function(le){k=le},setClear:function(le){Z!==le&&(n.clearDepth(le),Z=le)},reset:function(){k=!1,me=null,$=null,Z=null}}}function i(){let k=!1,me=null,$=null,Z=null,le=null,Pe=null,et=null,Pt=null,Gt=null;return{setTest:function(ct){k||(ct?he(n.STENCIL_TEST):ce(n.STENCIL_TEST))},setMask:function(ct){me!==ct&&!k&&(n.stencilMask(ct),me=ct)},setFunc:function(ct,gi,vi){($!==ct||Z!==gi||le!==vi)&&(n.stencilFunc(ct,gi,vi),$=ct,Z=gi,le=vi)},setOp:function(ct,gi,vi){(Pe!==ct||et!==gi||Pt!==vi)&&(n.stencilOp(ct,gi,vi),Pe=ct,et=gi,Pt=vi)},setLocked:function(ct){k=ct},setClear:function(ct){Gt!==ct&&(n.clearStencil(ct),Gt=ct)},reset:function(){k=!1,me=null,$=null,Z=null,le=null,Pe=null,et=null,Pt=null,Gt=null}}}const r=new e,s=new t,o=new i,a=new WeakMap,l=new WeakMap;let c={},u={},d=new WeakMap,h=[],f=null,m=!1,y=null,g=null,p=null,v=null,_=null,x=null,A=null,M=new Le(0,0,0),S=0,b=!1,T=null,w=null,P=null,V=null,I=null;const O=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let F=!1,N=0;const G=n.getParameter(n.VERSION);G.indexOf("WebGL")!==-1?(N=parseFloat(/^WebGL (\d)/.exec(G)[1]),F=N>=1):G.indexOf("OpenGL ES")!==-1&&(N=parseFloat(/^OpenGL ES (\d)/.exec(G)[1]),F=N>=2);let L=null,j={};const Y=n.getParameter(n.SCISSOR_BOX),ee=n.getParameter(n.VIEWPORT),Q=new ht().fromArray(Y),De=new ht().fromArray(ee);function K(k,me,$,Z){const le=new Uint8Array(4),Pe=n.createTexture();n.bindTexture(k,Pe),n.texParameteri(k,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(k,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let et=0;et<$;et++)k===n.TEXTURE_3D||k===n.TEXTURE_2D_ARRAY?n.texImage3D(me,0,n.RGBA,1,1,Z,0,n.RGBA,n.UNSIGNED_BYTE,le):n.texImage2D(me+et,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,le);return Pe}const ne={};ne[n.TEXTURE_2D]=K(n.TEXTURE_2D,n.TEXTURE_2D,1),ne[n.TEXTURE_CUBE_MAP]=K(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),ne[n.TEXTURE_2D_ARRAY]=K(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),ne[n.TEXTURE_3D]=K(n.TEXTURE_3D,n.TEXTURE_3D,1,1),r.setClear(0,0,0,1),s.setClear(1),o.setClear(0),he(n.DEPTH_TEST),s.setFunc(zu),Ee(!1),Je(Gv),he(n.CULL_FACE),Ke(jr);function he(k){c[k]!==!0&&(n.enable(k),c[k]=!0)}function ce(k){c[k]!==!1&&(n.disable(k),c[k]=!1)}function He(k,me){return u[k]!==me?(n.bindFramebuffer(k,me),u[k]=me,k===n.DRAW_FRAMEBUFFER&&(u[n.FRAMEBUFFER]=me),k===n.FRAMEBUFFER&&(u[n.DRAW_FRAMEBUFFER]=me),!0):!1}function Be(k,me){let $=h,Z=!1;if(k){$=d.get(me),$===void 0&&($=[],d.set(me,$));const le=k.textures;if($.length!==le.length||$[0]!==n.COLOR_ATTACHMENT0){for(let Pe=0,et=le.length;Pe<et;Pe++)$[Pe]=n.COLOR_ATTACHMENT0+Pe;$.length=le.length,Z=!0}}else $[0]!==n.BACK&&($[0]=n.BACK,Z=!0);Z&&n.drawBuffers($)}function Ze(k){return f!==k?(n.useProgram(k),f=k,!0):!1}const U={[ws]:n.FUNC_ADD,[Fb]:n.FUNC_SUBTRACT,[Ub]:n.FUNC_REVERSE_SUBTRACT};U[Ob]=n.MIN,U[Bb]=n.MAX;const $e={[zb]:n.ZERO,[Vb]:n.ONE,[Hb]:n.SRC_COLOR,[ap]:n.SRC_ALPHA,[Kb]:n.SRC_ALPHA_SATURATE,[Xb]:n.DST_COLOR,[Wb]:n.DST_ALPHA,[Gb]:n.ONE_MINUS_SRC_COLOR,[lp]:n.ONE_MINUS_SRC_ALPHA,[qb]:n.ONE_MINUS_DST_COLOR,[jb]:n.ONE_MINUS_DST_ALPHA,[Yb]:n.CONSTANT_COLOR,[$b]:n.ONE_MINUS_CONSTANT_COLOR,[Zb]:n.CONSTANT_ALPHA,[Qb]:n.ONE_MINUS_CONSTANT_ALPHA};function Ke(k,me,$,Z,le,Pe,et,Pt,Gt,ct){if(k===jr){m===!0&&(ce(n.BLEND),m=!1);return}if(m===!1&&(he(n.BLEND),m=!0),k!==kb){if(k!==y||ct!==b){if((g!==ws||_!==ws)&&(n.blendEquation(n.FUNC_ADD),g=ws,_=ws),ct)switch(k){case No:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Wv:n.blendFunc(n.ONE,n.ONE);break;case jv:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case Xv:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",k);break}else switch(k){case No:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Wv:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case jv:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case Xv:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",k);break}p=null,v=null,x=null,A=null,M.set(0,0,0),S=0,y=k,b=ct}return}le=le||me,Pe=Pe||$,et=et||Z,(me!==g||le!==_)&&(n.blendEquationSeparate(U[me],U[le]),g=me,_=le),($!==p||Z!==v||Pe!==x||et!==A)&&(n.blendFuncSeparate($e[$],$e[Z],$e[Pe],$e[et]),p=$,v=Z,x=Pe,A=et),(Pt.equals(M)===!1||Gt!==S)&&(n.blendColor(Pt.r,Pt.g,Pt.b,Gt),M.copy(Pt),S=Gt),y=k,b=!1}function _t(k,me){k.side===Ti?ce(n.CULL_FACE):he(n.CULL_FACE);let $=k.side===Cn;me&&($=!$),Ee($),k.blending===No&&k.transparent===!1?Ke(jr):Ke(k.blending,k.blendEquation,k.blendSrc,k.blendDst,k.blendEquationAlpha,k.blendSrcAlpha,k.blendDstAlpha,k.blendColor,k.blendAlpha,k.premultipliedAlpha),s.setFunc(k.depthFunc),s.setTest(k.depthTest),s.setMask(k.depthWrite),r.setMask(k.colorWrite);const Z=k.stencilWrite;o.setTest(Z),Z&&(o.setMask(k.stencilWriteMask),o.setFunc(k.stencilFunc,k.stencilRef,k.stencilFuncMask),o.setOp(k.stencilFail,k.stencilZFail,k.stencilZPass)),Ne(k.polygonOffset,k.polygonOffsetFactor,k.polygonOffsetUnits),k.alphaToCoverage===!0?he(n.SAMPLE_ALPHA_TO_COVERAGE):ce(n.SAMPLE_ALPHA_TO_COVERAGE)}function Ee(k){T!==k&&(k?n.frontFace(n.CW):n.frontFace(n.CCW),T=k)}function Je(k){k!==Ib?(he(n.CULL_FACE),k!==w&&(k===Gv?n.cullFace(n.BACK):k===Db?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):ce(n.CULL_FACE),w=k}function Ge(k){k!==P&&(F&&n.lineWidth(k),P=k)}function Ne(k,me,$){k?(he(n.POLYGON_OFFSET_FILL),(V!==me||I!==$)&&(n.polygonOffset(me,$),V=me,I=$)):ce(n.POLYGON_OFFSET_FILL)}function Dt(k){k?he(n.SCISSOR_TEST):ce(n.SCISSOR_TEST)}function D(k){k===void 0&&(k=n.TEXTURE0+O-1),L!==k&&(n.activeTexture(k),L=k)}function C(k,me,$){$===void 0&&(L===null?$=n.TEXTURE0+O-1:$=L);let Z=j[$];Z===void 0&&(Z={type:void 0,texture:void 0},j[$]=Z),(Z.type!==k||Z.texture!==me)&&(L!==$&&(n.activeTexture($),L=$),n.bindTexture(k,me||ne[k]),Z.type=k,Z.texture=me)}function q(){const k=j[L];k!==void 0&&k.type!==void 0&&(n.bindTexture(k.type,null),k.type=void 0,k.texture=void 0)}function J(){try{n.compressedTexImage2D.apply(n,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function ie(){try{n.compressedTexImage3D.apply(n,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function re(){try{n.texSubImage2D.apply(n,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function Me(){try{n.texSubImage3D.apply(n,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function de(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function fe(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function ze(){try{n.texStorage2D.apply(n,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function oe(){try{n.texStorage3D.apply(n,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function we(){try{n.texImage2D.apply(n,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function qe(){try{n.texImage3D.apply(n,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function Re(k){Q.equals(k)===!1&&(n.scissor(k.x,k.y,k.z,k.w),Q.copy(k))}function pe(k){De.equals(k)===!1&&(n.viewport(k.x,k.y,k.z,k.w),De.copy(k))}function Ve(k,me){let $=l.get(me);$===void 0&&($=new WeakMap,l.set(me,$));let Z=$.get(k);Z===void 0&&(Z=n.getUniformBlockIndex(me,k.name),$.set(k,Z))}function Ye(k,me){const Z=l.get(me).get(k);a.get(me)!==Z&&(n.uniformBlockBinding(me,Z,k.__bindingPointIndex),a.set(me,Z))}function Rt(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),c={},L=null,j={},u={},d=new WeakMap,h=[],f=null,m=!1,y=null,g=null,p=null,v=null,_=null,x=null,A=null,M=new Le(0,0,0),S=0,b=!1,T=null,w=null,P=null,V=null,I=null,Q.set(0,0,n.canvas.width,n.canvas.height),De.set(0,0,n.canvas.width,n.canvas.height),r.reset(),s.reset(),o.reset()}return{buffers:{color:r,depth:s,stencil:o},enable:he,disable:ce,bindFramebuffer:He,drawBuffers:Be,useProgram:Ze,setBlending:Ke,setMaterial:_t,setFlipSided:Ee,setCullFace:Je,setLineWidth:Ge,setPolygonOffset:Ne,setScissorTest:Dt,activeTexture:D,bindTexture:C,unbindTexture:q,compressedTexImage2D:J,compressedTexImage3D:ie,texImage2D:we,texImage3D:qe,updateUBOMapping:Ve,uniformBlockBinding:Ye,texStorage2D:ze,texStorage3D:oe,texSubImage2D:re,texSubImage3D:Me,compressedTexSubImage2D:de,compressedTexSubImage3D:fe,scissor:Re,viewport:pe,reset:Rt}}function ZI(n,e,t,i,r,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new je,u=new WeakMap;let d;const h=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function m(D,C){return f?new OffscreenCanvas(D,C):Rl("canvas")}function y(D,C,q){let J=1;const ie=Dt(D);if((ie.width>q||ie.height>q)&&(J=q/Math.max(ie.width,ie.height)),J<1)if(typeof HTMLImageElement<"u"&&D instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&D instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&D instanceof ImageBitmap||typeof VideoFrame<"u"&&D instanceof VideoFrame){const re=Math.floor(J*ie.width),Me=Math.floor(J*ie.height);d===void 0&&(d=m(re,Me));const de=C?m(re,Me):d;return de.width=re,de.height=Me,de.getContext("2d").drawImage(D,0,0,re,Me),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ie.width+"x"+ie.height+") to ("+re+"x"+Me+")."),de}else return"data"in D&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ie.width+"x"+ie.height+")."),D;return D}function g(D){return D.generateMipmaps&&D.minFilter!==gn&&D.minFilter!==Dn}function p(D){n.generateMipmap(D)}function v(D,C,q,J,ie=!1){if(D!==null){if(n[D]!==void 0)return n[D];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+D+"'")}let re=C;if(C===n.RED&&(q===n.FLOAT&&(re=n.R32F),q===n.HALF_FLOAT&&(re=n.R16F),q===n.UNSIGNED_BYTE&&(re=n.R8)),C===n.RED_INTEGER&&(q===n.UNSIGNED_BYTE&&(re=n.R8UI),q===n.UNSIGNED_SHORT&&(re=n.R16UI),q===n.UNSIGNED_INT&&(re=n.R32UI),q===n.BYTE&&(re=n.R8I),q===n.SHORT&&(re=n.R16I),q===n.INT&&(re=n.R32I)),C===n.RG&&(q===n.FLOAT&&(re=n.RG32F),q===n.HALF_FLOAT&&(re=n.RG16F),q===n.UNSIGNED_BYTE&&(re=n.RG8)),C===n.RG_INTEGER&&(q===n.UNSIGNED_BYTE&&(re=n.RG8UI),q===n.UNSIGNED_SHORT&&(re=n.RG16UI),q===n.UNSIGNED_INT&&(re=n.RG32UI),q===n.BYTE&&(re=n.RG8I),q===n.SHORT&&(re=n.RG16I),q===n.INT&&(re=n.RG32I)),C===n.RGB&&q===n.UNSIGNED_INT_5_9_9_9_REV&&(re=n.RGB9_E5),C===n.RGBA){const Me=ie?Gu:nt.getTransfer(J);q===n.FLOAT&&(re=n.RGBA32F),q===n.HALF_FLOAT&&(re=n.RGBA16F),q===n.UNSIGNED_BYTE&&(re=Me===mt?n.SRGB8_ALPHA8:n.RGBA8),q===n.UNSIGNED_SHORT_4_4_4_4&&(re=n.RGBA4),q===n.UNSIGNED_SHORT_5_5_5_1&&(re=n.RGB5_A1)}return(re===n.R16F||re===n.R32F||re===n.RG16F||re===n.RG32F||re===n.RGBA16F||re===n.RGBA32F)&&e.get("EXT_color_buffer_float"),re}function _(D,C){let q;return D?C===null||C===Yo||C===$o?q=n.DEPTH24_STENCIL8:C===bi?q=n.DEPTH32F_STENCIL8:C===Hu&&(q=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):C===null||C===Yo||C===$o?q=n.DEPTH_COMPONENT24:C===bi?q=n.DEPTH_COMPONENT32F:C===Hu&&(q=n.DEPTH_COMPONENT16),q}function x(D,C){return g(D)===!0||D.isFramebufferTexture&&D.minFilter!==gn&&D.minFilter!==Dn?Math.log2(Math.max(C.width,C.height))+1:D.mipmaps!==void 0&&D.mipmaps.length>0?D.mipmaps.length:D.isCompressedTexture&&Array.isArray(D.image)?C.mipmaps.length:1}function A(D){const C=D.target;C.removeEventListener("dispose",A),S(C),C.isVideoTexture&&u.delete(C)}function M(D){const C=D.target;C.removeEventListener("dispose",M),T(C)}function S(D){const C=i.get(D);if(C.__webglInit===void 0)return;const q=D.source,J=h.get(q);if(J){const ie=J[C.__cacheKey];ie.usedTimes--,ie.usedTimes===0&&b(D),Object.keys(J).length===0&&h.delete(q)}i.remove(D)}function b(D){const C=i.get(D);n.deleteTexture(C.__webglTexture);const q=D.source,J=h.get(q);delete J[C.__cacheKey],o.memory.textures--}function T(D){const C=i.get(D);if(D.depthTexture&&D.depthTexture.dispose(),D.isWebGLCubeRenderTarget)for(let J=0;J<6;J++){if(Array.isArray(C.__webglFramebuffer[J]))for(let ie=0;ie<C.__webglFramebuffer[J].length;ie++)n.deleteFramebuffer(C.__webglFramebuffer[J][ie]);else n.deleteFramebuffer(C.__webglFramebuffer[J]);C.__webglDepthbuffer&&n.deleteRenderbuffer(C.__webglDepthbuffer[J])}else{if(Array.isArray(C.__webglFramebuffer))for(let J=0;J<C.__webglFramebuffer.length;J++)n.deleteFramebuffer(C.__webglFramebuffer[J]);else n.deleteFramebuffer(C.__webglFramebuffer);if(C.__webglDepthbuffer&&n.deleteRenderbuffer(C.__webglDepthbuffer),C.__webglMultisampledFramebuffer&&n.deleteFramebuffer(C.__webglMultisampledFramebuffer),C.__webglColorRenderbuffer)for(let J=0;J<C.__webglColorRenderbuffer.length;J++)C.__webglColorRenderbuffer[J]&&n.deleteRenderbuffer(C.__webglColorRenderbuffer[J]);C.__webglDepthRenderbuffer&&n.deleteRenderbuffer(C.__webglDepthRenderbuffer)}const q=D.textures;for(let J=0,ie=q.length;J<ie;J++){const re=i.get(q[J]);re.__webglTexture&&(n.deleteTexture(re.__webglTexture),o.memory.textures--),i.remove(q[J])}i.remove(D)}let w=0;function P(){w=0}function V(){const D=w;return D>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+D+" texture units while this GPU supports only "+r.maxTextures),w+=1,D}function I(D){const C=[];return C.push(D.wrapS),C.push(D.wrapT),C.push(D.wrapR||0),C.push(D.magFilter),C.push(D.minFilter),C.push(D.anisotropy),C.push(D.internalFormat),C.push(D.format),C.push(D.type),C.push(D.generateMipmaps),C.push(D.premultiplyAlpha),C.push(D.flipY),C.push(D.unpackAlignment),C.push(D.colorSpace),C.join()}function O(D,C){const q=i.get(D);if(D.isVideoTexture&&Ge(D),D.isRenderTargetTexture===!1&&D.version>0&&q.__version!==D.version){const J=D.image;if(J===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(J.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{De(q,D,C);return}}t.bindTexture(n.TEXTURE_2D,q.__webglTexture,n.TEXTURE0+C)}function F(D,C){const q=i.get(D);if(D.version>0&&q.__version!==D.version){De(q,D,C);return}t.bindTexture(n.TEXTURE_2D_ARRAY,q.__webglTexture,n.TEXTURE0+C)}function N(D,C){const q=i.get(D);if(D.version>0&&q.__version!==D.version){De(q,D,C);return}t.bindTexture(n.TEXTURE_3D,q.__webglTexture,n.TEXTURE0+C)}function G(D,C){const q=i.get(D);if(D.version>0&&q.__version!==D.version){K(q,D,C);return}t.bindTexture(n.TEXTURE_CUBE_MAP,q.__webglTexture,n.TEXTURE0+C)}const L={[Ko]:n.REPEAT,[kr]:n.CLAMP_TO_EDGE,[Vu]:n.MIRRORED_REPEAT},j={[gn]:n.NEAREST,[kS]:n.NEAREST_MIPMAP_NEAREST,[Ga]:n.NEAREST_MIPMAP_LINEAR,[Dn]:n.LINEAR,[hu]:n.LINEAR_MIPMAP_NEAREST,[nr]:n.LINEAR_MIPMAP_LINEAR},Y={[P1]:n.NEVER,[F1]:n.ALWAYS,[L1]:n.LESS,[jS]:n.LEQUAL,[I1]:n.EQUAL,[k1]:n.GEQUAL,[D1]:n.GREATER,[N1]:n.NOTEQUAL};function ee(D,C){if(C.type===bi&&e.has("OES_texture_float_linear")===!1&&(C.magFilter===Dn||C.magFilter===hu||C.magFilter===Ga||C.magFilter===nr||C.minFilter===Dn||C.minFilter===hu||C.minFilter===Ga||C.minFilter===nr)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(D,n.TEXTURE_WRAP_S,L[C.wrapS]),n.texParameteri(D,n.TEXTURE_WRAP_T,L[C.wrapT]),(D===n.TEXTURE_3D||D===n.TEXTURE_2D_ARRAY)&&n.texParameteri(D,n.TEXTURE_WRAP_R,L[C.wrapR]),n.texParameteri(D,n.TEXTURE_MAG_FILTER,j[C.magFilter]),n.texParameteri(D,n.TEXTURE_MIN_FILTER,j[C.minFilter]),C.compareFunction&&(n.texParameteri(D,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(D,n.TEXTURE_COMPARE_FUNC,Y[C.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(C.magFilter===gn||C.minFilter!==Ga&&C.minFilter!==nr||C.type===bi&&e.has("OES_texture_float_linear")===!1)return;if(C.anisotropy>1||i.get(C).__currentAnisotropy){const q=e.get("EXT_texture_filter_anisotropic");n.texParameterf(D,q.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(C.anisotropy,r.getMaxAnisotropy())),i.get(C).__currentAnisotropy=C.anisotropy}}}function Q(D,C){let q=!1;D.__webglInit===void 0&&(D.__webglInit=!0,C.addEventListener("dispose",A));const J=C.source;let ie=h.get(J);ie===void 0&&(ie={},h.set(J,ie));const re=I(C);if(re!==D.__cacheKey){ie[re]===void 0&&(ie[re]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,q=!0),ie[re].usedTimes++;const Me=ie[D.__cacheKey];Me!==void 0&&(ie[D.__cacheKey].usedTimes--,Me.usedTimes===0&&b(C)),D.__cacheKey=re,D.__webglTexture=ie[re].texture}return q}function De(D,C,q){let J=n.TEXTURE_2D;(C.isDataArrayTexture||C.isCompressedArrayTexture)&&(J=n.TEXTURE_2D_ARRAY),C.isData3DTexture&&(J=n.TEXTURE_3D);const ie=Q(D,C),re=C.source;t.bindTexture(J,D.__webglTexture,n.TEXTURE0+q);const Me=i.get(re);if(re.version!==Me.__version||ie===!0){t.activeTexture(n.TEXTURE0+q);const de=nt.getPrimaries(nt.workingColorSpace),fe=C.colorSpace===Ir?null:nt.getPrimaries(C.colorSpace),ze=C.colorSpace===Ir||de===fe?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,C.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,C.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,C.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,ze);let oe=y(C.image,!1,r.maxTextureSize);oe=Ne(C,oe);const we=s.convert(C.format,C.colorSpace),qe=s.convert(C.type);let Re=v(C.internalFormat,we,qe,C.colorSpace,C.isVideoTexture);ee(J,C);let pe;const Ve=C.mipmaps,Ye=C.isVideoTexture!==!0,Rt=Me.__version===void 0||ie===!0,k=re.dataReady,me=x(C,oe);if(C.isDepthTexture)Re=_(C.format===Zo,C.type),Rt&&(Ye?t.texStorage2D(n.TEXTURE_2D,1,Re,oe.width,oe.height):t.texImage2D(n.TEXTURE_2D,0,Re,oe.width,oe.height,0,we,qe,null));else if(C.isDataTexture)if(Ve.length>0){Ye&&Rt&&t.texStorage2D(n.TEXTURE_2D,me,Re,Ve[0].width,Ve[0].height);for(let $=0,Z=Ve.length;$<Z;$++)pe=Ve[$],Ye?k&&t.texSubImage2D(n.TEXTURE_2D,$,0,0,pe.width,pe.height,we,qe,pe.data):t.texImage2D(n.TEXTURE_2D,$,Re,pe.width,pe.height,0,we,qe,pe.data);C.generateMipmaps=!1}else Ye?(Rt&&t.texStorage2D(n.TEXTURE_2D,me,Re,oe.width,oe.height),k&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,oe.width,oe.height,we,qe,oe.data)):t.texImage2D(n.TEXTURE_2D,0,Re,oe.width,oe.height,0,we,qe,oe.data);else if(C.isCompressedTexture)if(C.isCompressedArrayTexture){Ye&&Rt&&t.texStorage3D(n.TEXTURE_2D_ARRAY,me,Re,Ve[0].width,Ve[0].height,oe.depth);for(let $=0,Z=Ve.length;$<Z;$++)if(pe=Ve[$],C.format!==ci)if(we!==null)if(Ye){if(k)if(C.layerUpdates.size>0){for(const le of C.layerUpdates){const Pe=pe.width*pe.height;t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,$,0,0,le,pe.width,pe.height,1,we,pe.data.slice(Pe*le,Pe*(le+1)),0,0)}C.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,$,0,0,0,pe.width,pe.height,oe.depth,we,pe.data,0,0)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,$,Re,pe.width,pe.height,oe.depth,0,pe.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Ye?k&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,$,0,0,0,pe.width,pe.height,oe.depth,we,qe,pe.data):t.texImage3D(n.TEXTURE_2D_ARRAY,$,Re,pe.width,pe.height,oe.depth,0,we,qe,pe.data)}else{Ye&&Rt&&t.texStorage2D(n.TEXTURE_2D,me,Re,Ve[0].width,Ve[0].height);for(let $=0,Z=Ve.length;$<Z;$++)pe=Ve[$],C.format!==ci?we!==null?Ye?k&&t.compressedTexSubImage2D(n.TEXTURE_2D,$,0,0,pe.width,pe.height,we,pe.data):t.compressedTexImage2D(n.TEXTURE_2D,$,Re,pe.width,pe.height,0,pe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ye?k&&t.texSubImage2D(n.TEXTURE_2D,$,0,0,pe.width,pe.height,we,qe,pe.data):t.texImage2D(n.TEXTURE_2D,$,Re,pe.width,pe.height,0,we,qe,pe.data)}else if(C.isDataArrayTexture)if(Ye){if(Rt&&t.texStorage3D(n.TEXTURE_2D_ARRAY,me,Re,oe.width,oe.height,oe.depth),k)if(C.layerUpdates.size>0){let $;switch(qe){case n.UNSIGNED_BYTE:switch(we){case n.ALPHA:$=1;break;case n.LUMINANCE:$=1;break;case n.LUMINANCE_ALPHA:$=2;break;case n.RGB:$=3;break;case n.RGBA:$=4;break;default:throw new Error(`Unknown texel size for format ${we}.`)}break;case n.UNSIGNED_SHORT_4_4_4_4:case n.UNSIGNED_SHORT_5_5_5_1:case n.UNSIGNED_SHORT_5_6_5:$=1;break;default:throw new Error(`Unknown texel size for type ${qe}.`)}const Z=oe.width*oe.height*$;for(const le of C.layerUpdates)t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,le,oe.width,oe.height,1,we,qe,oe.data.slice(Z*le,Z*(le+1)));C.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,oe.width,oe.height,oe.depth,we,qe,oe.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,Re,oe.width,oe.height,oe.depth,0,we,qe,oe.data);else if(C.isData3DTexture)Ye?(Rt&&t.texStorage3D(n.TEXTURE_3D,me,Re,oe.width,oe.height,oe.depth),k&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,oe.width,oe.height,oe.depth,we,qe,oe.data)):t.texImage3D(n.TEXTURE_3D,0,Re,oe.width,oe.height,oe.depth,0,we,qe,oe.data);else if(C.isFramebufferTexture){if(Rt)if(Ye)t.texStorage2D(n.TEXTURE_2D,me,Re,oe.width,oe.height);else{let $=oe.width,Z=oe.height;for(let le=0;le<me;le++)t.texImage2D(n.TEXTURE_2D,le,Re,$,Z,0,we,qe,null),$>>=1,Z>>=1}}else if(Ve.length>0){if(Ye&&Rt){const $=Dt(Ve[0]);t.texStorage2D(n.TEXTURE_2D,me,Re,$.width,$.height)}for(let $=0,Z=Ve.length;$<Z;$++)pe=Ve[$],Ye?k&&t.texSubImage2D(n.TEXTURE_2D,$,0,0,we,qe,pe):t.texImage2D(n.TEXTURE_2D,$,Re,we,qe,pe);C.generateMipmaps=!1}else if(Ye){if(Rt){const $=Dt(oe);t.texStorage2D(n.TEXTURE_2D,me,Re,$.width,$.height)}k&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,we,qe,oe)}else t.texImage2D(n.TEXTURE_2D,0,Re,we,qe,oe);g(C)&&p(J),Me.__version=re.version,C.onUpdate&&C.onUpdate(C)}D.__version=C.version}function K(D,C,q){if(C.image.length!==6)return;const J=Q(D,C),ie=C.source;t.bindTexture(n.TEXTURE_CUBE_MAP,D.__webglTexture,n.TEXTURE0+q);const re=i.get(ie);if(ie.version!==re.__version||J===!0){t.activeTexture(n.TEXTURE0+q);const Me=nt.getPrimaries(nt.workingColorSpace),de=C.colorSpace===Ir?null:nt.getPrimaries(C.colorSpace),fe=C.colorSpace===Ir||Me===de?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,C.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,C.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,C.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,fe);const ze=C.isCompressedTexture||C.image[0].isCompressedTexture,oe=C.image[0]&&C.image[0].isDataTexture,we=[];for(let Z=0;Z<6;Z++)!ze&&!oe?we[Z]=y(C.image[Z],!0,r.maxCubemapSize):we[Z]=oe?C.image[Z].image:C.image[Z],we[Z]=Ne(C,we[Z]);const qe=we[0],Re=s.convert(C.format,C.colorSpace),pe=s.convert(C.type),Ve=v(C.internalFormat,Re,pe,C.colorSpace),Ye=C.isVideoTexture!==!0,Rt=re.__version===void 0||J===!0,k=ie.dataReady;let me=x(C,qe);ee(n.TEXTURE_CUBE_MAP,C);let $;if(ze){Ye&&Rt&&t.texStorage2D(n.TEXTURE_CUBE_MAP,me,Ve,qe.width,qe.height);for(let Z=0;Z<6;Z++){$=we[Z].mipmaps;for(let le=0;le<$.length;le++){const Pe=$[le];C.format!==ci?Re!==null?Ye?k&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Z,le,0,0,Pe.width,Pe.height,Re,Pe.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Z,le,Ve,Pe.width,Pe.height,0,Pe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ye?k&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Z,le,0,0,Pe.width,Pe.height,Re,pe,Pe.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Z,le,Ve,Pe.width,Pe.height,0,Re,pe,Pe.data)}}}else{if($=C.mipmaps,Ye&&Rt){$.length>0&&me++;const Z=Dt(we[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,me,Ve,Z.width,Z.height)}for(let Z=0;Z<6;Z++)if(oe){Ye?k&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Z,0,0,0,we[Z].width,we[Z].height,Re,pe,we[Z].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Z,0,Ve,we[Z].width,we[Z].height,0,Re,pe,we[Z].data);for(let le=0;le<$.length;le++){const et=$[le].image[Z].image;Ye?k&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Z,le+1,0,0,et.width,et.height,Re,pe,et.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Z,le+1,Ve,et.width,et.height,0,Re,pe,et.data)}}else{Ye?k&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Z,0,0,0,Re,pe,we[Z]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Z,0,Ve,Re,pe,we[Z]);for(let le=0;le<$.length;le++){const Pe=$[le];Ye?k&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Z,le+1,0,0,Re,pe,Pe.image[Z]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Z,le+1,Ve,Re,pe,Pe.image[Z])}}}g(C)&&p(n.TEXTURE_CUBE_MAP),re.__version=ie.version,C.onUpdate&&C.onUpdate(C)}D.__version=C.version}function ne(D,C,q,J,ie,re){const Me=s.convert(q.format,q.colorSpace),de=s.convert(q.type),fe=v(q.internalFormat,Me,de,q.colorSpace);if(!i.get(C).__hasExternalTextures){const oe=Math.max(1,C.width>>re),we=Math.max(1,C.height>>re);ie===n.TEXTURE_3D||ie===n.TEXTURE_2D_ARRAY?t.texImage3D(ie,re,fe,oe,we,C.depth,0,Me,de,null):t.texImage2D(ie,re,fe,oe,we,0,Me,de,null)}t.bindFramebuffer(n.FRAMEBUFFER,D),Je(C)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,J,ie,i.get(q).__webglTexture,0,Ee(C)):(ie===n.TEXTURE_2D||ie>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&ie<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,J,ie,i.get(q).__webglTexture,re),t.bindFramebuffer(n.FRAMEBUFFER,null)}function he(D,C,q){if(n.bindRenderbuffer(n.RENDERBUFFER,D),C.depthBuffer){const J=C.depthTexture,ie=J&&J.isDepthTexture?J.type:null,re=_(C.stencilBuffer,ie),Me=C.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,de=Ee(C);Je(C)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,de,re,C.width,C.height):q?n.renderbufferStorageMultisample(n.RENDERBUFFER,de,re,C.width,C.height):n.renderbufferStorage(n.RENDERBUFFER,re,C.width,C.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,Me,n.RENDERBUFFER,D)}else{const J=C.textures;for(let ie=0;ie<J.length;ie++){const re=J[ie],Me=s.convert(re.format,re.colorSpace),de=s.convert(re.type),fe=v(re.internalFormat,Me,de,re.colorSpace),ze=Ee(C);q&&Je(C)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,ze,fe,C.width,C.height):Je(C)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,ze,fe,C.width,C.height):n.renderbufferStorage(n.RENDERBUFFER,fe,C.width,C.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function ce(D,C){if(C&&C.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,D),!(C.depthTexture&&C.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(C.depthTexture).__webglTexture||C.depthTexture.image.width!==C.width||C.depthTexture.image.height!==C.height)&&(C.depthTexture.image.width=C.width,C.depthTexture.image.height=C.height,C.depthTexture.needsUpdate=!0),O(C.depthTexture,0);const J=i.get(C.depthTexture).__webglTexture,ie=Ee(C);if(C.depthTexture.format===ko)Je(C)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,J,0,ie):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,J,0);else if(C.depthTexture.format===Zo)Je(C)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,J,0,ie):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,J,0);else throw new Error("Unknown depthTexture format")}function He(D){const C=i.get(D),q=D.isWebGLCubeRenderTarget===!0;if(D.depthTexture&&!C.__autoAllocateDepthBuffer){if(q)throw new Error("target.depthTexture not supported in Cube render targets");ce(C.__webglFramebuffer,D)}else if(q){C.__webglDepthbuffer=[];for(let J=0;J<6;J++)t.bindFramebuffer(n.FRAMEBUFFER,C.__webglFramebuffer[J]),C.__webglDepthbuffer[J]=n.createRenderbuffer(),he(C.__webglDepthbuffer[J],D,!1)}else t.bindFramebuffer(n.FRAMEBUFFER,C.__webglFramebuffer),C.__webglDepthbuffer=n.createRenderbuffer(),he(C.__webglDepthbuffer,D,!1);t.bindFramebuffer(n.FRAMEBUFFER,null)}function Be(D,C,q){const J=i.get(D);C!==void 0&&ne(J.__webglFramebuffer,D,D.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),q!==void 0&&He(D)}function Ze(D){const C=D.texture,q=i.get(D),J=i.get(C);D.addEventListener("dispose",M);const ie=D.textures,re=D.isWebGLCubeRenderTarget===!0,Me=ie.length>1;if(Me||(J.__webglTexture===void 0&&(J.__webglTexture=n.createTexture()),J.__version=C.version,o.memory.textures++),re){q.__webglFramebuffer=[];for(let de=0;de<6;de++)if(C.mipmaps&&C.mipmaps.length>0){q.__webglFramebuffer[de]=[];for(let fe=0;fe<C.mipmaps.length;fe++)q.__webglFramebuffer[de][fe]=n.createFramebuffer()}else q.__webglFramebuffer[de]=n.createFramebuffer()}else{if(C.mipmaps&&C.mipmaps.length>0){q.__webglFramebuffer=[];for(let de=0;de<C.mipmaps.length;de++)q.__webglFramebuffer[de]=n.createFramebuffer()}else q.__webglFramebuffer=n.createFramebuffer();if(Me)for(let de=0,fe=ie.length;de<fe;de++){const ze=i.get(ie[de]);ze.__webglTexture===void 0&&(ze.__webglTexture=n.createTexture(),o.memory.textures++)}if(D.samples>0&&Je(D)===!1){q.__webglMultisampledFramebuffer=n.createFramebuffer(),q.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,q.__webglMultisampledFramebuffer);for(let de=0;de<ie.length;de++){const fe=ie[de];q.__webglColorRenderbuffer[de]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,q.__webglColorRenderbuffer[de]);const ze=s.convert(fe.format,fe.colorSpace),oe=s.convert(fe.type),we=v(fe.internalFormat,ze,oe,fe.colorSpace,D.isXRRenderTarget===!0),qe=Ee(D);n.renderbufferStorageMultisample(n.RENDERBUFFER,qe,we,D.width,D.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+de,n.RENDERBUFFER,q.__webglColorRenderbuffer[de])}n.bindRenderbuffer(n.RENDERBUFFER,null),D.depthBuffer&&(q.__webglDepthRenderbuffer=n.createRenderbuffer(),he(q.__webglDepthRenderbuffer,D,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(re){t.bindTexture(n.TEXTURE_CUBE_MAP,J.__webglTexture),ee(n.TEXTURE_CUBE_MAP,C);for(let de=0;de<6;de++)if(C.mipmaps&&C.mipmaps.length>0)for(let fe=0;fe<C.mipmaps.length;fe++)ne(q.__webglFramebuffer[de][fe],D,C,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+de,fe);else ne(q.__webglFramebuffer[de],D,C,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+de,0);g(C)&&p(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Me){for(let de=0,fe=ie.length;de<fe;de++){const ze=ie[de],oe=i.get(ze);t.bindTexture(n.TEXTURE_2D,oe.__webglTexture),ee(n.TEXTURE_2D,ze),ne(q.__webglFramebuffer,D,ze,n.COLOR_ATTACHMENT0+de,n.TEXTURE_2D,0),g(ze)&&p(n.TEXTURE_2D)}t.unbindTexture()}else{let de=n.TEXTURE_2D;if((D.isWebGL3DRenderTarget||D.isWebGLArrayRenderTarget)&&(de=D.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(de,J.__webglTexture),ee(de,C),C.mipmaps&&C.mipmaps.length>0)for(let fe=0;fe<C.mipmaps.length;fe++)ne(q.__webglFramebuffer[fe],D,C,n.COLOR_ATTACHMENT0,de,fe);else ne(q.__webglFramebuffer,D,C,n.COLOR_ATTACHMENT0,de,0);g(C)&&p(de),t.unbindTexture()}D.depthBuffer&&He(D)}function U(D){const C=D.textures;for(let q=0,J=C.length;q<J;q++){const ie=C[q];if(g(ie)){const re=D.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,Me=i.get(ie).__webglTexture;t.bindTexture(re,Me),p(re),t.unbindTexture()}}}const $e=[],Ke=[];function _t(D){if(D.samples>0){if(Je(D)===!1){const C=D.textures,q=D.width,J=D.height;let ie=n.COLOR_BUFFER_BIT;const re=D.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Me=i.get(D),de=C.length>1;if(de)for(let fe=0;fe<C.length;fe++)t.bindFramebuffer(n.FRAMEBUFFER,Me.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+fe,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,Me.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+fe,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,Me.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Me.__webglFramebuffer);for(let fe=0;fe<C.length;fe++){if(D.resolveDepthBuffer&&(D.depthBuffer&&(ie|=n.DEPTH_BUFFER_BIT),D.stencilBuffer&&D.resolveStencilBuffer&&(ie|=n.STENCIL_BUFFER_BIT)),de){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,Me.__webglColorRenderbuffer[fe]);const ze=i.get(C[fe]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,ze,0)}n.blitFramebuffer(0,0,q,J,0,0,q,J,ie,n.NEAREST),l===!0&&($e.length=0,Ke.length=0,$e.push(n.COLOR_ATTACHMENT0+fe),D.depthBuffer&&D.resolveDepthBuffer===!1&&($e.push(re),Ke.push(re),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,Ke)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,$e))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),de)for(let fe=0;fe<C.length;fe++){t.bindFramebuffer(n.FRAMEBUFFER,Me.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+fe,n.RENDERBUFFER,Me.__webglColorRenderbuffer[fe]);const ze=i.get(C[fe]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,Me.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+fe,n.TEXTURE_2D,ze,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Me.__webglMultisampledFramebuffer)}else if(D.depthBuffer&&D.resolveDepthBuffer===!1&&l){const C=D.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[C])}}}function Ee(D){return Math.min(r.maxSamples,D.samples)}function Je(D){const C=i.get(D);return D.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&C.__useRenderToTexture!==!1}function Ge(D){const C=o.render.frame;u.get(D)!==C&&(u.set(D,C),D.update())}function Ne(D,C){const q=D.colorSpace,J=D.format,ie=D.type;return D.isCompressedTexture===!0||D.isVideoTexture===!0||q!==Jt&&q!==Ir&&(nt.getTransfer(q)===mt?(J!==ci||ie!==Yr)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",q)),C}function Dt(D){return typeof HTMLImageElement<"u"&&D instanceof HTMLImageElement?(c.width=D.naturalWidth||D.width,c.height=D.naturalHeight||D.height):typeof VideoFrame<"u"&&D instanceof VideoFrame?(c.width=D.displayWidth,c.height=D.displayHeight):(c.width=D.width,c.height=D.height),c}this.allocateTextureUnit=V,this.resetTextureUnits=P,this.setTexture2D=O,this.setTexture2DArray=F,this.setTexture3D=N,this.setTextureCube=G,this.rebindTextures=Be,this.setupRenderTarget=Ze,this.updateRenderTargetMipmap=U,this.updateMultisampleRenderTarget=_t,this.setupDepthRenderbuffer=He,this.setupFrameBufferTexture=ne,this.useMultisampledRTT=Je}function QI(n,e){function t(i,r=Ir){let s;const o=nt.getTransfer(r);if(i===Yr)return n.UNSIGNED_BYTE;if(i===US)return n.UNSIGNED_SHORT_4_4_4_4;if(i===OS)return n.UNSIGNED_SHORT_5_5_5_1;if(i===y1)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===g1)return n.BYTE;if(i===v1)return n.SHORT;if(i===Hu)return n.UNSIGNED_SHORT;if(i===FS)return n.INT;if(i===Yo)return n.UNSIGNED_INT;if(i===bi)return n.FLOAT;if(i===_h)return n.HALF_FLOAT;if(i===_1)return n.ALPHA;if(i===x1)return n.RGB;if(i===ci)return n.RGBA;if(i===w1)return n.LUMINANCE;if(i===S1)return n.LUMINANCE_ALPHA;if(i===ko)return n.DEPTH_COMPONENT;if(i===Zo)return n.DEPTH_STENCIL;if(i===BS)return n.RED;if(i===zS)return n.RED_INTEGER;if(i===M1)return n.RG;if(i===VS)return n.RG_INTEGER;if(i===HS)return n.RGBA_INTEGER;if(i===ud||i===hd||i===dd||i===fd)if(o===mt)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(i===ud)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===hd)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===dd)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===fd)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(i===ud)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===hd)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===dd)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===fd)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===Kv||i===Yv||i===$v||i===Zv)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(i===Kv)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===Yv)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===$v)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===Zv)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===Qv||i===Jv||i===ey)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(i===Qv||i===Jv)return o===mt?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===ey)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===ty||i===ny||i===iy||i===ry||i===sy||i===oy||i===ay||i===ly||i===cy||i===uy||i===hy||i===dy||i===fy||i===py)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(i===ty)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===ny)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===iy)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===ry)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===sy)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===oy)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===ay)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===ly)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===cy)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===uy)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===hy)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===dy)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===fy)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===py)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===pd||i===my||i===gy)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(i===pd)return o===mt?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===my)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===gy)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===A1||i===vy||i===yy||i===_y)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(i===pd)return s.COMPRESSED_RED_RGTC1_EXT;if(i===vy)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===yy)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===_y)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===$o?n.UNSIGNED_INT_24_8:n[i]!==void 0?n[i]:null}return{convert:t}}class JI extends mn{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Cs extends Mt{constructor(){super(),this.isGroup=!0,this.type="Group"}}const eD={type:"move"};class zd{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Cs,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Cs,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new B,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new B),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Cs,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new B,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new B),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const y of e.hand.values()){const g=t.getJointPose(y,i),p=this._getHandJoint(c,y);g!==null&&(p.matrix.fromArray(g.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.matrixWorldNeedsUpdate=!0,p.jointRadius=g.radius),p.visible=g!==null}const u=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],h=u.position.distanceTo(d.position),f=.02,m=.005;c.inputState.pinching&&h>f+m?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&h<=f-m&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&s!==null&&(r=s),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(eD)))}return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new Cs;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}const tD=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,nD=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class iD{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(this.texture===null){const r=new Kt,s=e.properties.get(r);s.__webglTexture=t.texture,(t.depthNear!=i.depthNear||t.depthFar!=i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=r}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,i=new $r({vertexShader:tD,fragmentShader:nD,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new vn(new ea(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}}class rD extends ua{constructor(e,t){super();const i=this;let r=null,s=1,o=null,a="local-floor",l=1,c=null,u=null,d=null,h=null,f=null,m=null;const y=new iD,g=t.getContextAttributes();let p=null,v=null;const _=[],x=[],A=new je;let M=null;const S=new mn;S.layers.enable(1),S.viewport=new ht;const b=new mn;b.layers.enable(2),b.viewport=new ht;const T=[S,b],w=new JI;w.layers.enable(1),w.layers.enable(2);let P=null,V=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(K){let ne=_[K];return ne===void 0&&(ne=new zd,_[K]=ne),ne.getTargetRaySpace()},this.getControllerGrip=function(K){let ne=_[K];return ne===void 0&&(ne=new zd,_[K]=ne),ne.getGripSpace()},this.getHand=function(K){let ne=_[K];return ne===void 0&&(ne=new zd,_[K]=ne),ne.getHandSpace()};function I(K){const ne=x.indexOf(K.inputSource);if(ne===-1)return;const he=_[ne];he!==void 0&&(he.update(K.inputSource,K.frame,c||o),he.dispatchEvent({type:K.type,data:K.inputSource}))}function O(){r.removeEventListener("select",I),r.removeEventListener("selectstart",I),r.removeEventListener("selectend",I),r.removeEventListener("squeeze",I),r.removeEventListener("squeezestart",I),r.removeEventListener("squeezeend",I),r.removeEventListener("end",O),r.removeEventListener("inputsourceschange",F);for(let K=0;K<_.length;K++){const ne=x[K];ne!==null&&(x[K]=null,_[K].disconnect(ne))}P=null,V=null,y.reset(),e.setRenderTarget(p),f=null,h=null,d=null,r=null,v=null,De.stop(),i.isPresenting=!1,e.setPixelRatio(M),e.setSize(A.width,A.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(K){s=K,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(K){a=K,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(K){c=K},this.getBaseLayer=function(){return h!==null?h:f},this.getBinding=function(){return d},this.getFrame=function(){return m},this.getSession=function(){return r},this.setSession=async function(K){if(r=K,r!==null){if(p=e.getRenderTarget(),r.addEventListener("select",I),r.addEventListener("selectstart",I),r.addEventListener("selectend",I),r.addEventListener("squeeze",I),r.addEventListener("squeezestart",I),r.addEventListener("squeezeend",I),r.addEventListener("end",O),r.addEventListener("inputsourceschange",F),g.xrCompatible!==!0&&await t.makeXRCompatible(),M=e.getPixelRatio(),e.getSize(A),r.renderState.layers===void 0){const ne={antialias:g.antialias,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:s};f=new XRWebGLLayer(r,t,ne),r.updateRenderState({baseLayer:f}),e.setPixelRatio(1),e.setSize(f.framebufferWidth,f.framebufferHeight,!1),v=new Os(f.framebufferWidth,f.framebufferHeight,{format:ci,type:Yr,colorSpace:e.outputColorSpace,stencilBuffer:g.stencil})}else{let ne=null,he=null,ce=null;g.depth&&(ce=g.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ne=g.stencil?Zo:ko,he=g.stencil?$o:Yo);const He={colorFormat:t.RGBA8,depthFormat:ce,scaleFactor:s};d=new XRWebGLBinding(r,t),h=d.createProjectionLayer(He),r.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),v=new Os(h.textureWidth,h.textureHeight,{format:ci,type:Yr,depthTexture:new iM(h.textureWidth,h.textureHeight,he,void 0,void 0,void 0,void 0,void 0,void 0,ne),stencilBuffer:g.stencil,colorSpace:e.outputColorSpace,samples:g.antialias?4:0,resolveDepthBuffer:h.ignoreDepthValues===!1})}v.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await r.requestReferenceSpace(a),De.setContext(r),De.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode};function F(K){for(let ne=0;ne<K.removed.length;ne++){const he=K.removed[ne],ce=x.indexOf(he);ce>=0&&(x[ce]=null,_[ce].disconnect(he))}for(let ne=0;ne<K.added.length;ne++){const he=K.added[ne];let ce=x.indexOf(he);if(ce===-1){for(let Be=0;Be<_.length;Be++)if(Be>=x.length){x.push(he),ce=Be;break}else if(x[Be]===null){x[Be]=he,ce=Be;break}if(ce===-1)break}const He=_[ce];He&&He.connect(he)}}const N=new B,G=new B;function L(K,ne,he){N.setFromMatrixPosition(ne.matrixWorld),G.setFromMatrixPosition(he.matrixWorld);const ce=N.distanceTo(G),He=ne.projectionMatrix.elements,Be=he.projectionMatrix.elements,Ze=He[14]/(He[10]-1),U=He[14]/(He[10]+1),$e=(He[9]+1)/He[5],Ke=(He[9]-1)/He[5],_t=(He[8]-1)/He[0],Ee=(Be[8]+1)/Be[0],Je=Ze*_t,Ge=Ze*Ee,Ne=ce/(-_t+Ee),Dt=Ne*-_t;ne.matrixWorld.decompose(K.position,K.quaternion,K.scale),K.translateX(Dt),K.translateZ(Ne),K.matrixWorld.compose(K.position,K.quaternion,K.scale),K.matrixWorldInverse.copy(K.matrixWorld).invert();const D=Ze+Ne,C=U+Ne,q=Je-Dt,J=Ge+(ce-Dt),ie=$e*U/C*D,re=Ke*U/C*D;K.projectionMatrix.makePerspective(q,J,ie,re,D,C),K.projectionMatrixInverse.copy(K.projectionMatrix).invert()}function j(K,ne){ne===null?K.matrixWorld.copy(K.matrix):K.matrixWorld.multiplyMatrices(ne.matrixWorld,K.matrix),K.matrixWorldInverse.copy(K.matrixWorld).invert()}this.updateCamera=function(K){if(r===null)return;y.texture!==null&&(K.near=y.depthNear,K.far=y.depthFar),w.near=b.near=S.near=K.near,w.far=b.far=S.far=K.far,(P!==w.near||V!==w.far)&&(r.updateRenderState({depthNear:w.near,depthFar:w.far}),P=w.near,V=w.far,S.near=P,S.far=V,b.near=P,b.far=V,S.updateProjectionMatrix(),b.updateProjectionMatrix(),K.updateProjectionMatrix());const ne=K.parent,he=w.cameras;j(w,ne);for(let ce=0;ce<he.length;ce++)j(he[ce],ne);he.length===2?L(w,S,b):w.projectionMatrix.copy(S.projectionMatrix),Y(K,w,ne)};function Y(K,ne,he){he===null?K.matrix.copy(ne.matrixWorld):(K.matrix.copy(he.matrixWorld),K.matrix.invert(),K.matrix.multiply(ne.matrixWorld)),K.matrix.decompose(K.position,K.quaternion,K.scale),K.updateMatrixWorld(!0),K.projectionMatrix.copy(ne.projectionMatrix),K.projectionMatrixInverse.copy(ne.projectionMatrixInverse),K.isPerspectiveCamera&&(K.fov=Qo*2*Math.atan(1/K.projectionMatrix.elements[5]),K.zoom=1)}this.getCamera=function(){return w},this.getFoveation=function(){if(!(h===null&&f===null))return l},this.setFoveation=function(K){l=K,h!==null&&(h.fixedFoveation=K),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=K)},this.hasDepthSensing=function(){return y.texture!==null},this.getDepthSensingMesh=function(){return y.getMesh(w)};let ee=null;function Q(K,ne){if(u=ne.getViewerPose(c||o),m=ne,u!==null){const he=u.views;f!==null&&(e.setRenderTargetFramebuffer(v,f.framebuffer),e.setRenderTarget(v));let ce=!1;he.length!==w.cameras.length&&(w.cameras.length=0,ce=!0);for(let Be=0;Be<he.length;Be++){const Ze=he[Be];let U=null;if(f!==null)U=f.getViewport(Ze);else{const Ke=d.getViewSubImage(h,Ze);U=Ke.viewport,Be===0&&(e.setRenderTargetTextures(v,Ke.colorTexture,h.ignoreDepthValues?void 0:Ke.depthStencilTexture),e.setRenderTarget(v))}let $e=T[Be];$e===void 0&&($e=new mn,$e.layers.enable(Be),$e.viewport=new ht,T[Be]=$e),$e.matrix.fromArray(Ze.transform.matrix),$e.matrix.decompose($e.position,$e.quaternion,$e.scale),$e.projectionMatrix.fromArray(Ze.projectionMatrix),$e.projectionMatrixInverse.copy($e.projectionMatrix).invert(),$e.viewport.set(U.x,U.y,U.width,U.height),Be===0&&(w.matrix.copy($e.matrix),w.matrix.decompose(w.position,w.quaternion,w.scale)),ce===!0&&w.cameras.push($e)}const He=r.enabledFeatures;if(He&&He.includes("depth-sensing")){const Be=d.getDepthInformation(he[0]);Be&&Be.isValid&&Be.texture&&y.init(e,Be,r.renderState)}}for(let he=0;he<_.length;he++){const ce=x[he],He=_[he];ce!==null&&He!==void 0&&He.update(ce,ne,c||o)}ee&&ee(K,ne),ne.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:ne}),m=null}const De=new nM;De.setAnimationLoop(Q),this.setAnimationLoop=function(K){ee=K},this.dispose=function(){}}}const hs=new Di,sD=new Oe;function oD(n,e){function t(g,p){g.matrixAutoUpdate===!0&&g.updateMatrix(),p.value.copy(g.matrix)}function i(g,p){p.color.getRGB(g.fogColor.value,JS(n)),p.isFog?(g.fogNear.value=p.near,g.fogFar.value=p.far):p.isFogExp2&&(g.fogDensity.value=p.density)}function r(g,p,v,_,x){p.isMeshBasicMaterial||p.isMeshLambertMaterial?s(g,p):p.isMeshToonMaterial?(s(g,p),d(g,p)):p.isMeshPhongMaterial?(s(g,p),u(g,p)):p.isMeshStandardMaterial?(s(g,p),h(g,p),p.isMeshPhysicalMaterial&&f(g,p,x)):p.isMeshMatcapMaterial?(s(g,p),m(g,p)):p.isMeshDepthMaterial?s(g,p):p.isMeshDistanceMaterial?(s(g,p),y(g,p)):p.isMeshNormalMaterial?s(g,p):p.isLineBasicMaterial?(o(g,p),p.isLineDashedMaterial&&a(g,p)):p.isPointsMaterial?l(g,p,v,_):p.isSpriteMaterial?c(g,p):p.isShadowMaterial?(g.color.value.copy(p.color),g.opacity.value=p.opacity):p.isShaderMaterial&&(p.uniformsNeedUpdate=!1)}function s(g,p){g.opacity.value=p.opacity,p.color&&g.diffuse.value.copy(p.color),p.emissive&&g.emissive.value.copy(p.emissive).multiplyScalar(p.emissiveIntensity),p.map&&(g.map.value=p.map,t(p.map,g.mapTransform)),p.alphaMap&&(g.alphaMap.value=p.alphaMap,t(p.alphaMap,g.alphaMapTransform)),p.bumpMap&&(g.bumpMap.value=p.bumpMap,t(p.bumpMap,g.bumpMapTransform),g.bumpScale.value=p.bumpScale,p.side===Cn&&(g.bumpScale.value*=-1)),p.normalMap&&(g.normalMap.value=p.normalMap,t(p.normalMap,g.normalMapTransform),g.normalScale.value.copy(p.normalScale),p.side===Cn&&g.normalScale.value.negate()),p.displacementMap&&(g.displacementMap.value=p.displacementMap,t(p.displacementMap,g.displacementMapTransform),g.displacementScale.value=p.displacementScale,g.displacementBias.value=p.displacementBias),p.emissiveMap&&(g.emissiveMap.value=p.emissiveMap,t(p.emissiveMap,g.emissiveMapTransform)),p.specularMap&&(g.specularMap.value=p.specularMap,t(p.specularMap,g.specularMapTransform)),p.alphaTest>0&&(g.alphaTest.value=p.alphaTest);const v=e.get(p),_=v.envMap,x=v.envMapRotation;_&&(g.envMap.value=_,hs.copy(x),hs.x*=-1,hs.y*=-1,hs.z*=-1,_.isCubeTexture&&_.isRenderTargetTexture===!1&&(hs.y*=-1,hs.z*=-1),g.envMapRotation.value.setFromMatrix4(sD.makeRotationFromEuler(hs)),g.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=p.reflectivity,g.ior.value=p.ior,g.refractionRatio.value=p.refractionRatio),p.lightMap&&(g.lightMap.value=p.lightMap,g.lightMapIntensity.value=p.lightMapIntensity,t(p.lightMap,g.lightMapTransform)),p.aoMap&&(g.aoMap.value=p.aoMap,g.aoMapIntensity.value=p.aoMapIntensity,t(p.aoMap,g.aoMapTransform))}function o(g,p){g.diffuse.value.copy(p.color),g.opacity.value=p.opacity,p.map&&(g.map.value=p.map,t(p.map,g.mapTransform))}function a(g,p){g.dashSize.value=p.dashSize,g.totalSize.value=p.dashSize+p.gapSize,g.scale.value=p.scale}function l(g,p,v,_){g.diffuse.value.copy(p.color),g.opacity.value=p.opacity,g.size.value=p.size*v,g.scale.value=_*.5,p.map&&(g.map.value=p.map,t(p.map,g.uvTransform)),p.alphaMap&&(g.alphaMap.value=p.alphaMap,t(p.alphaMap,g.alphaMapTransform)),p.alphaTest>0&&(g.alphaTest.value=p.alphaTest)}function c(g,p){g.diffuse.value.copy(p.color),g.opacity.value=p.opacity,g.rotation.value=p.rotation,p.map&&(g.map.value=p.map,t(p.map,g.mapTransform)),p.alphaMap&&(g.alphaMap.value=p.alphaMap,t(p.alphaMap,g.alphaMapTransform)),p.alphaTest>0&&(g.alphaTest.value=p.alphaTest)}function u(g,p){g.specular.value.copy(p.specular),g.shininess.value=Math.max(p.shininess,1e-4)}function d(g,p){p.gradientMap&&(g.gradientMap.value=p.gradientMap)}function h(g,p){g.metalness.value=p.metalness,p.metalnessMap&&(g.metalnessMap.value=p.metalnessMap,t(p.metalnessMap,g.metalnessMapTransform)),g.roughness.value=p.roughness,p.roughnessMap&&(g.roughnessMap.value=p.roughnessMap,t(p.roughnessMap,g.roughnessMapTransform)),p.envMap&&(g.envMapIntensity.value=p.envMapIntensity)}function f(g,p,v){g.ior.value=p.ior,p.sheen>0&&(g.sheenColor.value.copy(p.sheenColor).multiplyScalar(p.sheen),g.sheenRoughness.value=p.sheenRoughness,p.sheenColorMap&&(g.sheenColorMap.value=p.sheenColorMap,t(p.sheenColorMap,g.sheenColorMapTransform)),p.sheenRoughnessMap&&(g.sheenRoughnessMap.value=p.sheenRoughnessMap,t(p.sheenRoughnessMap,g.sheenRoughnessMapTransform))),p.clearcoat>0&&(g.clearcoat.value=p.clearcoat,g.clearcoatRoughness.value=p.clearcoatRoughness,p.clearcoatMap&&(g.clearcoatMap.value=p.clearcoatMap,t(p.clearcoatMap,g.clearcoatMapTransform)),p.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=p.clearcoatRoughnessMap,t(p.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),p.clearcoatNormalMap&&(g.clearcoatNormalMap.value=p.clearcoatNormalMap,t(p.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(p.clearcoatNormalScale),p.side===Cn&&g.clearcoatNormalScale.value.negate())),p.dispersion>0&&(g.dispersion.value=p.dispersion),p.iridescence>0&&(g.iridescence.value=p.iridescence,g.iridescenceIOR.value=p.iridescenceIOR,g.iridescenceThicknessMinimum.value=p.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=p.iridescenceThicknessRange[1],p.iridescenceMap&&(g.iridescenceMap.value=p.iridescenceMap,t(p.iridescenceMap,g.iridescenceMapTransform)),p.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=p.iridescenceThicknessMap,t(p.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),p.transmission>0&&(g.transmission.value=p.transmission,g.transmissionSamplerMap.value=v.texture,g.transmissionSamplerSize.value.set(v.width,v.height),p.transmissionMap&&(g.transmissionMap.value=p.transmissionMap,t(p.transmissionMap,g.transmissionMapTransform)),g.thickness.value=p.thickness,p.thicknessMap&&(g.thicknessMap.value=p.thicknessMap,t(p.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=p.attenuationDistance,g.attenuationColor.value.copy(p.attenuationColor)),p.anisotropy>0&&(g.anisotropyVector.value.set(p.anisotropy*Math.cos(p.anisotropyRotation),p.anisotropy*Math.sin(p.anisotropyRotation)),p.anisotropyMap&&(g.anisotropyMap.value=p.anisotropyMap,t(p.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=p.specularIntensity,g.specularColor.value.copy(p.specularColor),p.specularColorMap&&(g.specularColorMap.value=p.specularColorMap,t(p.specularColorMap,g.specularColorMapTransform)),p.specularIntensityMap&&(g.specularIntensityMap.value=p.specularIntensityMap,t(p.specularIntensityMap,g.specularIntensityMapTransform))}function m(g,p){p.matcap&&(g.matcap.value=p.matcap)}function y(g,p){const v=e.get(p).light;g.referencePosition.value.setFromMatrixPosition(v.matrixWorld),g.nearDistance.value=v.shadow.camera.near,g.farDistance.value=v.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function aD(n,e,t,i){let r={},s={},o=[];const a=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function l(v,_){const x=_.program;i.uniformBlockBinding(v,x)}function c(v,_){let x=r[v.id];x===void 0&&(m(v),x=u(v),r[v.id]=x,v.addEventListener("dispose",g));const A=_.program;i.updateUBOMapping(v,A);const M=e.render.frame;s[v.id]!==M&&(h(v),s[v.id]=M)}function u(v){const _=d();v.__bindingPointIndex=_;const x=n.createBuffer(),A=v.__size,M=v.usage;return n.bindBuffer(n.UNIFORM_BUFFER,x),n.bufferData(n.UNIFORM_BUFFER,A,M),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,_,x),x}function d(){for(let v=0;v<a;v++)if(o.indexOf(v)===-1)return o.push(v),v;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function h(v){const _=r[v.id],x=v.uniforms,A=v.__cache;n.bindBuffer(n.UNIFORM_BUFFER,_);for(let M=0,S=x.length;M<S;M++){const b=Array.isArray(x[M])?x[M]:[x[M]];for(let T=0,w=b.length;T<w;T++){const P=b[T];if(f(P,M,T,A)===!0){const V=P.__offset,I=Array.isArray(P.value)?P.value:[P.value];let O=0;for(let F=0;F<I.length;F++){const N=I[F],G=y(N);typeof N=="number"||typeof N=="boolean"?(P.__data[0]=N,n.bufferSubData(n.UNIFORM_BUFFER,V+O,P.__data)):N.isMatrix3?(P.__data[0]=N.elements[0],P.__data[1]=N.elements[1],P.__data[2]=N.elements[2],P.__data[3]=0,P.__data[4]=N.elements[3],P.__data[5]=N.elements[4],P.__data[6]=N.elements[5],P.__data[7]=0,P.__data[8]=N.elements[6],P.__data[9]=N.elements[7],P.__data[10]=N.elements[8],P.__data[11]=0):(N.toArray(P.__data,O),O+=G.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,V,P.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function f(v,_,x,A){const M=v.value,S=_+"_"+x;if(A[S]===void 0)return typeof M=="number"||typeof M=="boolean"?A[S]=M:A[S]=M.clone(),!0;{const b=A[S];if(typeof M=="number"||typeof M=="boolean"){if(b!==M)return A[S]=M,!0}else if(b.equals(M)===!1)return b.copy(M),!0}return!1}function m(v){const _=v.uniforms;let x=0;const A=16;for(let S=0,b=_.length;S<b;S++){const T=Array.isArray(_[S])?_[S]:[_[S]];for(let w=0,P=T.length;w<P;w++){const V=T[w],I=Array.isArray(V.value)?V.value:[V.value];for(let O=0,F=I.length;O<F;O++){const N=I[O],G=y(N),L=x%A;L!==0&&A-L<G.boundary&&(x+=A-L),V.__data=new Float32Array(G.storage/Float32Array.BYTES_PER_ELEMENT),V.__offset=x,x+=G.storage}}}const M=x%A;return M>0&&(x+=A-M),v.__size=x,v.__cache={},this}function y(v){const _={boundary:0,storage:0};return typeof v=="number"||typeof v=="boolean"?(_.boundary=4,_.storage=4):v.isVector2?(_.boundary=8,_.storage=8):v.isVector3||v.isColor?(_.boundary=16,_.storage=12):v.isVector4?(_.boundary=16,_.storage=16):v.isMatrix3?(_.boundary=48,_.storage=48):v.isMatrix4?(_.boundary=64,_.storage=64):v.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",v),_}function g(v){const _=v.target;_.removeEventListener("dispose",g);const x=o.indexOf(_.__bindingPointIndex);o.splice(x,1),n.deleteBuffer(r[_.id]),delete r[_.id],delete s[_.id]}function p(){for(const v in r)n.deleteBuffer(r[v]);o=[],r={},s={}}return{bind:l,update:c,dispose:p}}class lD{constructor(e={}){const{canvas:t=eC(),context:i=null,depth:r=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:d=!1}=e;this.isWebGLRenderer=!0;let h;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");h=i.getContextAttributes().alpha}else h=o;const f=new Uint32Array(4),m=new Int32Array(4);let y=null,g=null;const p=[],v=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=pn,this.toneMapping=Xr,this.toneMappingExposure=1;const _=this;let x=!1,A=0,M=0,S=null,b=-1,T=null;const w=new ht,P=new ht;let V=null;const I=new Le(0);let O=0,F=t.width,N=t.height,G=1,L=null,j=null;const Y=new ht(0,0,F,N),ee=new ht(0,0,F,N);let Q=!1;const De=new Nm;let K=!1,ne=!1;const he=new Oe,ce=new B,He={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Be=!1;function Ze(){return S===null?G:1}let U=i;function $e(R,z){return t.getContext(R,z)}try{const R={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Pm}`),t.addEventListener("webglcontextlost",me,!1),t.addEventListener("webglcontextrestored",$,!1),t.addEventListener("webglcontextcreationerror",Z,!1),U===null){const z="webgl2";if(U=$e(z,R),U===null)throw $e(z)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(R){throw console.error("THREE.WebGLRenderer: "+R.message),R}let Ke,_t,Ee,Je,Ge,Ne,Dt,D,C,q,J,ie,re,Me,de,fe,ze,oe,we,qe,Re,pe,Ve,Ye;function Rt(){Ke=new gL(U),Ke.init(),pe=new QI(U,Ke),_t=new uL(U,Ke,e,pe),Ee=new $I(U),Je=new _L(U),Ge=new FI,Ne=new ZI(U,Ke,Ee,Ge,_t,pe,Je),Dt=new dL(_),D=new mL(_),C=new EC(U),Ve=new lL(U,C),q=new vL(U,C,Je,Ve),J=new wL(U,q,C,Je),we=new xL(U,_t,Ne),fe=new hL(Ge),ie=new kI(_,Dt,D,Ke,_t,Ve,fe),re=new oD(_,Ge),Me=new OI,de=new WI(Ke),oe=new aL(_,Dt,D,Ee,J,h,l),ze=new YI(_,J,_t),Ye=new aD(U,Je,_t,Ee),qe=new cL(U,Ke,Je),Re=new yL(U,Ke,Je),Je.programs=ie.programs,_.capabilities=_t,_.extensions=Ke,_.properties=Ge,_.renderLists=Me,_.shadowMap=ze,_.state=Ee,_.info=Je}Rt();const k=new rD(_,U);this.xr=k,this.getContext=function(){return U},this.getContextAttributes=function(){return U.getContextAttributes()},this.forceContextLoss=function(){const R=Ke.get("WEBGL_lose_context");R&&R.loseContext()},this.forceContextRestore=function(){const R=Ke.get("WEBGL_lose_context");R&&R.restoreContext()},this.getPixelRatio=function(){return G},this.setPixelRatio=function(R){R!==void 0&&(G=R,this.setSize(F,N,!1))},this.getSize=function(R){return R.set(F,N)},this.setSize=function(R,z,W=!0){if(k.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}F=R,N=z,t.width=Math.floor(R*G),t.height=Math.floor(z*G),W===!0&&(t.style.width=R+"px",t.style.height=z+"px"),this.setViewport(0,0,R,z)},this.getDrawingBufferSize=function(R){return R.set(F*G,N*G).floor()},this.setDrawingBufferSize=function(R,z,W){F=R,N=z,G=W,t.width=Math.floor(R*W),t.height=Math.floor(z*W),this.setViewport(0,0,R,z)},this.getCurrentViewport=function(R){return R.copy(w)},this.getViewport=function(R){return R.copy(Y)},this.setViewport=function(R,z,W,X){R.isVector4?Y.set(R.x,R.y,R.z,R.w):Y.set(R,z,W,X),Ee.viewport(w.copy(Y).multiplyScalar(G).round())},this.getScissor=function(R){return R.copy(ee)},this.setScissor=function(R,z,W,X){R.isVector4?ee.set(R.x,R.y,R.z,R.w):ee.set(R,z,W,X),Ee.scissor(P.copy(ee).multiplyScalar(G).round())},this.getScissorTest=function(){return Q},this.setScissorTest=function(R){Ee.setScissorTest(Q=R)},this.setOpaqueSort=function(R){L=R},this.setTransparentSort=function(R){j=R},this.getClearColor=function(R){return R.copy(oe.getClearColor())},this.setClearColor=function(){oe.setClearColor.apply(oe,arguments)},this.getClearAlpha=function(){return oe.getClearAlpha()},this.setClearAlpha=function(){oe.setClearAlpha.apply(oe,arguments)},this.clear=function(R=!0,z=!0,W=!0){let X=0;if(R){let H=!1;if(S!==null){const ae=S.texture.format;H=ae===HS||ae===VS||ae===zS}if(H){const ae=S.texture.type,ge=ae===Yr||ae===Yo||ae===Hu||ae===$o||ae===US||ae===OS,_e=oe.getClearColor(),xe=oe.getClearAlpha(),be=_e.r,Ce=_e.g,Ae=_e.b;ge?(f[0]=be,f[1]=Ce,f[2]=Ae,f[3]=xe,U.clearBufferuiv(U.COLOR,0,f)):(m[0]=be,m[1]=Ce,m[2]=Ae,m[3]=xe,U.clearBufferiv(U.COLOR,0,m))}else X|=U.COLOR_BUFFER_BIT}z&&(X|=U.DEPTH_BUFFER_BIT),W&&(X|=U.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),U.clear(X)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",me,!1),t.removeEventListener("webglcontextrestored",$,!1),t.removeEventListener("webglcontextcreationerror",Z,!1),Me.dispose(),de.dispose(),Ge.dispose(),Dt.dispose(),D.dispose(),J.dispose(),Ve.dispose(),Ye.dispose(),ie.dispose(),k.dispose(),k.removeEventListener("sessionstart",gi),k.removeEventListener("sessionend",vi),rs.stop()};function me(R){R.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0}function $(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;const R=Je.autoReset,z=ze.enabled,W=ze.autoUpdate,X=ze.needsUpdate,H=ze.type;Rt(),Je.autoReset=R,ze.enabled=z,ze.autoUpdate=W,ze.needsUpdate=X,ze.type=H}function Z(R){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",R.statusMessage)}function le(R){const z=R.target;z.removeEventListener("dispose",le),Pe(z)}function Pe(R){et(R),Ge.remove(R)}function et(R){const z=Ge.get(R).programs;z!==void 0&&(z.forEach(function(W){ie.releaseProgram(W)}),R.isShaderMaterial&&ie.releaseShaderCache(R))}this.renderBufferDirect=function(R,z,W,X,H,ae){z===null&&(z=He);const ge=H.isMesh&&H.matrixWorld.determinant()<0,_e=aT(R,z,W,X,H);Ee.setMaterial(X,ge);let xe=W.index,be=1;if(X.wireframe===!0){if(xe=q.getWireframeAttribute(W),xe===void 0)return;be=2}const Ce=W.drawRange,Ae=W.attributes.position;let it=Ce.start*be,Tt=(Ce.start+Ce.count)*be;ae!==null&&(it=Math.max(it,ae.start*be),Tt=Math.min(Tt,(ae.start+ae.count)*be)),xe!==null?(it=Math.max(it,0),Tt=Math.min(Tt,xe.count)):Ae!=null&&(it=Math.max(it,0),Tt=Math.min(Tt,Ae.count));const Et=Tt-it;if(Et<0||Et===1/0)return;Ve.setup(H,X,_e,W,xe);let Rn,rt=qe;if(xe!==null&&(Rn=C.get(xe),rt=Re,rt.setIndex(Rn)),H.isMesh)X.wireframe===!0?(Ee.setLineWidth(X.wireframeLinewidth*Ze()),rt.setMode(U.LINES)):rt.setMode(U.TRIANGLES);else if(H.isLine){let Se=X.linewidth;Se===void 0&&(Se=1),Ee.setLineWidth(Se*Ze()),H.isLineSegments?rt.setMode(U.LINES):H.isLineLoop?rt.setMode(U.LINE_LOOP):rt.setMode(U.LINE_STRIP)}else H.isPoints?rt.setMode(U.POINTS):H.isSprite&&rt.setMode(U.TRIANGLES);if(H.isBatchedMesh)H._multiDrawInstances!==null?rt.renderMultiDrawInstances(H._multiDrawStarts,H._multiDrawCounts,H._multiDrawCount,H._multiDrawInstances):rt.renderMultiDraw(H._multiDrawStarts,H._multiDrawCounts,H._multiDrawCount);else if(H.isInstancedMesh)rt.renderInstances(it,Et,H.count);else if(W.isInstancedBufferGeometry){const Se=W._maxInstanceCount!==void 0?W._maxInstanceCount:1/0,un=Math.min(W.instanceCount,Se);rt.renderInstances(it,Et,un)}else rt.render(it,Et)};function Pt(R,z,W){R.transparent===!0&&R.side===Ti&&R.forceSinglePass===!1?(R.side=Cn,R.needsUpdate=!0,Yl(R,z,W),R.side=fr,R.needsUpdate=!0,Yl(R,z,W),R.side=Ti):Yl(R,z,W)}this.compile=function(R,z,W=null){W===null&&(W=R),g=de.get(W),g.init(z),v.push(g),W.traverseVisible(function(H){H.isLight&&H.layers.test(z.layers)&&(g.pushLight(H),H.castShadow&&g.pushShadow(H))}),R!==W&&R.traverseVisible(function(H){H.isLight&&H.layers.test(z.layers)&&(g.pushLight(H),H.castShadow&&g.pushShadow(H))}),g.setupLights();const X=new Set;return R.traverse(function(H){const ae=H.material;if(ae)if(Array.isArray(ae))for(let ge=0;ge<ae.length;ge++){const _e=ae[ge];Pt(_e,W,H),X.add(_e)}else Pt(ae,W,H),X.add(ae)}),v.pop(),g=null,X},this.compileAsync=function(R,z,W=null){const X=this.compile(R,z,W);return new Promise(H=>{function ae(){if(X.forEach(function(ge){Ge.get(ge).currentProgram.isReady()&&X.delete(ge)}),X.size===0){H(R);return}setTimeout(ae,10)}Ke.get("KHR_parallel_shader_compile")!==null?ae():setTimeout(ae,10)})};let Gt=null;function ct(R){Gt&&Gt(R)}function gi(){rs.stop()}function vi(){rs.start()}const rs=new nM;rs.setAnimationLoop(ct),typeof self<"u"&&rs.setContext(self),this.setAnimationLoop=function(R){Gt=R,k.setAnimationLoop(R),R===null?rs.stop():rs.start()},k.addEventListener("sessionstart",gi),k.addEventListener("sessionend",vi),this.render=function(R,z){if(z!==void 0&&z.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(x===!0)return;if(R.matrixWorldAutoUpdate===!0&&R.updateMatrixWorld(),z.parent===null&&z.matrixWorldAutoUpdate===!0&&z.updateMatrixWorld(),k.enabled===!0&&k.isPresenting===!0&&(k.cameraAutoUpdate===!0&&k.updateCamera(z),z=k.getCamera()),R.isScene===!0&&R.onBeforeRender(_,R,z,S),g=de.get(R,v.length),g.init(z),v.push(g),he.multiplyMatrices(z.projectionMatrix,z.matrixWorldInverse),De.setFromProjectionMatrix(he),ne=this.localClippingEnabled,K=fe.init(this.clippingPlanes,ne),y=Me.get(R,p.length),y.init(),p.push(y),k.enabled===!0&&k.isPresenting===!0){const ae=_.xr.getDepthSensingMesh();ae!==null&&Nh(ae,z,-1/0,_.sortObjects)}Nh(R,z,0,_.sortObjects),y.finish(),_.sortObjects===!0&&y.sort(L,j),Be=k.enabled===!1||k.isPresenting===!1||k.hasDepthSensing()===!1,Be&&oe.addToRenderList(y,R),this.info.render.frame++,K===!0&&fe.beginShadows();const W=g.state.shadowsArray;ze.render(W,R,z),K===!0&&fe.endShadows(),this.info.autoReset===!0&&this.info.reset();const X=y.opaque,H=y.transmissive;if(g.setupLights(),z.isArrayCamera){const ae=z.cameras;if(H.length>0)for(let ge=0,_e=ae.length;ge<_e;ge++){const xe=ae[ge];Rg(X,H,R,xe)}Be&&oe.render(R);for(let ge=0,_e=ae.length;ge<_e;ge++){const xe=ae[ge];Cg(y,R,xe,xe.viewport)}}else H.length>0&&Rg(X,H,R,z),Be&&oe.render(R),Cg(y,R,z);S!==null&&(Ne.updateMultisampleRenderTarget(S),Ne.updateRenderTargetMipmap(S)),R.isScene===!0&&R.onAfterRender(_,R,z),Ve.resetDefaultState(),b=-1,T=null,v.pop(),v.length>0?(g=v[v.length-1],K===!0&&fe.setGlobalState(_.clippingPlanes,g.state.camera)):g=null,p.pop(),p.length>0?y=p[p.length-1]:y=null};function Nh(R,z,W,X){if(R.visible===!1)return;if(R.layers.test(z.layers)){if(R.isGroup)W=R.renderOrder;else if(R.isLOD)R.autoUpdate===!0&&R.update(z);else if(R.isLight)g.pushLight(R),R.castShadow&&g.pushShadow(R);else if(R.isSprite){if(!R.frustumCulled||De.intersectsSprite(R)){X&&ce.setFromMatrixPosition(R.matrixWorld).applyMatrix4(he);const ge=J.update(R),_e=R.material;_e.visible&&y.push(R,ge,_e,W,ce.z,null)}}else if((R.isMesh||R.isLine||R.isPoints)&&(!R.frustumCulled||De.intersectsObject(R))){const ge=J.update(R),_e=R.material;if(X&&(R.boundingSphere!==void 0?(R.boundingSphere===null&&R.computeBoundingSphere(),ce.copy(R.boundingSphere.center)):(ge.boundingSphere===null&&ge.computeBoundingSphere(),ce.copy(ge.boundingSphere.center)),ce.applyMatrix4(R.matrixWorld).applyMatrix4(he)),Array.isArray(_e)){const xe=ge.groups;for(let be=0,Ce=xe.length;be<Ce;be++){const Ae=xe[be],it=_e[Ae.materialIndex];it&&it.visible&&y.push(R,ge,it,W,ce.z,Ae)}}else _e.visible&&y.push(R,ge,_e,W,ce.z,null)}}const ae=R.children;for(let ge=0,_e=ae.length;ge<_e;ge++)Nh(ae[ge],z,W,X)}function Cg(R,z,W,X){const H=R.opaque,ae=R.transmissive,ge=R.transparent;g.setupLightsView(W),K===!0&&fe.setGlobalState(_.clippingPlanes,W),X&&Ee.viewport(w.copy(X)),H.length>0&&Kl(H,z,W),ae.length>0&&Kl(ae,z,W),ge.length>0&&Kl(ge,z,W),Ee.buffers.depth.setTest(!0),Ee.buffers.depth.setMask(!0),Ee.buffers.color.setMask(!0),Ee.setPolygonOffset(!1)}function Rg(R,z,W,X){if((W.isScene===!0?W.overrideMaterial:null)!==null)return;g.state.transmissionRenderTarget[X.id]===void 0&&(g.state.transmissionRenderTarget[X.id]=new Os(1,1,{generateMipmaps:!0,type:Ke.has("EXT_color_buffer_half_float")||Ke.has("EXT_color_buffer_float")?_h:Yr,minFilter:nr,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:nt.workingColorSpace}));const ae=g.state.transmissionRenderTarget[X.id],ge=X.viewport||w;ae.setSize(ge.z,ge.w);const _e=_.getRenderTarget();_.setRenderTarget(ae),_.getClearColor(I),O=_.getClearAlpha(),O<1&&_.setClearColor(16777215,.5),Be?oe.render(W):_.clear();const xe=_.toneMapping;_.toneMapping=Xr;const be=X.viewport;if(X.viewport!==void 0&&(X.viewport=void 0),g.setupLightsView(X),K===!0&&fe.setGlobalState(_.clippingPlanes,X),Kl(R,W,X),Ne.updateMultisampleRenderTarget(ae),Ne.updateRenderTargetMipmap(ae),Ke.has("WEBGL_multisampled_render_to_texture")===!1){let Ce=!1;for(let Ae=0,it=z.length;Ae<it;Ae++){const Tt=z[Ae],Et=Tt.object,Rn=Tt.geometry,rt=Tt.material,Se=Tt.group;if(rt.side===Ti&&Et.layers.test(X.layers)){const un=rt.side;rt.side=Cn,rt.needsUpdate=!0,Pg(Et,W,X,Rn,rt,Se),rt.side=un,rt.needsUpdate=!0,Ce=!0}}Ce===!0&&(Ne.updateMultisampleRenderTarget(ae),Ne.updateRenderTargetMipmap(ae))}_.setRenderTarget(_e),_.setClearColor(I,O),be!==void 0&&(X.viewport=be),_.toneMapping=xe}function Kl(R,z,W){const X=z.isScene===!0?z.overrideMaterial:null;for(let H=0,ae=R.length;H<ae;H++){const ge=R[H],_e=ge.object,xe=ge.geometry,be=X===null?ge.material:X,Ce=ge.group;_e.layers.test(W.layers)&&Pg(_e,z,W,xe,be,Ce)}}function Pg(R,z,W,X,H,ae){R.onBeforeRender(_,z,W,X,H,ae),R.modelViewMatrix.multiplyMatrices(W.matrixWorldInverse,R.matrixWorld),R.normalMatrix.getNormalMatrix(R.modelViewMatrix),H.onBeforeRender(_,z,W,X,R,ae),H.transparent===!0&&H.side===Ti&&H.forceSinglePass===!1?(H.side=Cn,H.needsUpdate=!0,_.renderBufferDirect(W,z,X,H,R,ae),H.side=fr,H.needsUpdate=!0,_.renderBufferDirect(W,z,X,H,R,ae),H.side=Ti):_.renderBufferDirect(W,z,X,H,R,ae),R.onAfterRender(_,z,W,X,H,ae)}function Yl(R,z,W){z.isScene!==!0&&(z=He);const X=Ge.get(R),H=g.state.lights,ae=g.state.shadowsArray,ge=H.state.version,_e=ie.getParameters(R,H.state,ae,z,W),xe=ie.getProgramCacheKey(_e);let be=X.programs;X.environment=R.isMeshStandardMaterial?z.environment:null,X.fog=z.fog,X.envMap=(R.isMeshStandardMaterial?D:Dt).get(R.envMap||X.environment),X.envMapRotation=X.environment!==null&&R.envMap===null?z.environmentRotation:R.envMapRotation,be===void 0&&(R.addEventListener("dispose",le),be=new Map,X.programs=be);let Ce=be.get(xe);if(Ce!==void 0){if(X.currentProgram===Ce&&X.lightsStateVersion===ge)return Ig(R,_e),Ce}else _e.uniforms=ie.getUniforms(R),R.onBuild(W,_e,_),R.onBeforeCompile(_e,_),Ce=ie.acquireProgram(_e,xe),be.set(xe,Ce),X.uniforms=_e.uniforms;const Ae=X.uniforms;return(!R.isShaderMaterial&&!R.isRawShaderMaterial||R.clipping===!0)&&(Ae.clippingPlanes=fe.uniform),Ig(R,_e),X.needsLights=cT(R),X.lightsStateVersion=ge,X.needsLights&&(Ae.ambientLightColor.value=H.state.ambient,Ae.lightProbe.value=H.state.probe,Ae.directionalLights.value=H.state.directional,Ae.directionalLightShadows.value=H.state.directionalShadow,Ae.spotLights.value=H.state.spot,Ae.spotLightShadows.value=H.state.spotShadow,Ae.rectAreaLights.value=H.state.rectArea,Ae.ltc_1.value=H.state.rectAreaLTC1,Ae.ltc_2.value=H.state.rectAreaLTC2,Ae.pointLights.value=H.state.point,Ae.pointLightShadows.value=H.state.pointShadow,Ae.hemisphereLights.value=H.state.hemi,Ae.directionalShadowMap.value=H.state.directionalShadowMap,Ae.directionalShadowMatrix.value=H.state.directionalShadowMatrix,Ae.spotShadowMap.value=H.state.spotShadowMap,Ae.spotLightMatrix.value=H.state.spotLightMatrix,Ae.spotLightMap.value=H.state.spotLightMap,Ae.pointShadowMap.value=H.state.pointShadowMap,Ae.pointShadowMatrix.value=H.state.pointShadowMatrix),X.currentProgram=Ce,X.uniformsList=null,Ce}function Lg(R){if(R.uniformsList===null){const z=R.currentProgram.getUniforms();R.uniformsList=du.seqWithValue(z.seq,R.uniforms)}return R.uniformsList}function Ig(R,z){const W=Ge.get(R);W.outputColorSpace=z.outputColorSpace,W.batching=z.batching,W.batchingColor=z.batchingColor,W.instancing=z.instancing,W.instancingColor=z.instancingColor,W.instancingMorph=z.instancingMorph,W.skinning=z.skinning,W.morphTargets=z.morphTargets,W.morphNormals=z.morphNormals,W.morphColors=z.morphColors,W.morphTargetsCount=z.morphTargetsCount,W.numClippingPlanes=z.numClippingPlanes,W.numIntersection=z.numClipIntersection,W.vertexAlphas=z.vertexAlphas,W.vertexTangents=z.vertexTangents,W.toneMapping=z.toneMapping}function aT(R,z,W,X,H){z.isScene!==!0&&(z=He),Ne.resetTextureUnits();const ae=z.fog,ge=X.isMeshStandardMaterial?z.environment:null,_e=S===null?_.outputColorSpace:S.isXRRenderTarget===!0?S.texture.colorSpace:Jt,xe=(X.isMeshStandardMaterial?D:Dt).get(X.envMap||ge),be=X.vertexColors===!0&&!!W.attributes.color&&W.attributes.color.itemSize===4,Ce=!!W.attributes.tangent&&(!!X.normalMap||X.anisotropy>0),Ae=!!W.morphAttributes.position,it=!!W.morphAttributes.normal,Tt=!!W.morphAttributes.color;let Et=Xr;X.toneMapped&&(S===null||S.isXRRenderTarget===!0)&&(Et=_.toneMapping);const Rn=W.morphAttributes.position||W.morphAttributes.normal||W.morphAttributes.color,rt=Rn!==void 0?Rn.length:0,Se=Ge.get(X),un=g.state.lights;if(K===!0&&(ne===!0||R!==T)){const Hn=R===T&&X.id===b;fe.setState(X,R,Hn)}let ut=!1;X.version===Se.__version?(Se.needsLights&&Se.lightsStateVersion!==un.state.version||Se.outputColorSpace!==_e||H.isBatchedMesh&&Se.batching===!1||!H.isBatchedMesh&&Se.batching===!0||H.isBatchedMesh&&Se.batchingColor===!0&&H.colorTexture===null||H.isBatchedMesh&&Se.batchingColor===!1&&H.colorTexture!==null||H.isInstancedMesh&&Se.instancing===!1||!H.isInstancedMesh&&Se.instancing===!0||H.isSkinnedMesh&&Se.skinning===!1||!H.isSkinnedMesh&&Se.skinning===!0||H.isInstancedMesh&&Se.instancingColor===!0&&H.instanceColor===null||H.isInstancedMesh&&Se.instancingColor===!1&&H.instanceColor!==null||H.isInstancedMesh&&Se.instancingMorph===!0&&H.morphTexture===null||H.isInstancedMesh&&Se.instancingMorph===!1&&H.morphTexture!==null||Se.envMap!==xe||X.fog===!0&&Se.fog!==ae||Se.numClippingPlanes!==void 0&&(Se.numClippingPlanes!==fe.numPlanes||Se.numIntersection!==fe.numIntersection)||Se.vertexAlphas!==be||Se.vertexTangents!==Ce||Se.morphTargets!==Ae||Se.morphNormals!==it||Se.morphColors!==Tt||Se.toneMapping!==Et||Se.morphTargetsCount!==rt)&&(ut=!0):(ut=!0,Se.__version=X.version);let Oi=Se.currentProgram;ut===!0&&(Oi=Yl(X,z,H));let $l=!1,ss=!1,kh=!1;const Wt=Oi.getUniforms(),vr=Se.uniforms;if(Ee.useProgram(Oi.program)&&($l=!0,ss=!0,kh=!0),X.id!==b&&(b=X.id,ss=!0),$l||T!==R){Wt.setValue(U,"projectionMatrix",R.projectionMatrix),Wt.setValue(U,"viewMatrix",R.matrixWorldInverse);const Hn=Wt.map.cameraPosition;Hn!==void 0&&Hn.setValue(U,ce.setFromMatrixPosition(R.matrixWorld)),_t.logarithmicDepthBuffer&&Wt.setValue(U,"logDepthBufFC",2/(Math.log(R.far+1)/Math.LN2)),(X.isMeshPhongMaterial||X.isMeshToonMaterial||X.isMeshLambertMaterial||X.isMeshBasicMaterial||X.isMeshStandardMaterial||X.isShaderMaterial)&&Wt.setValue(U,"isOrthographic",R.isOrthographicCamera===!0),T!==R&&(T=R,ss=!0,kh=!0)}if(H.isSkinnedMesh){Wt.setOptional(U,H,"bindMatrix"),Wt.setOptional(U,H,"bindMatrixInverse");const Hn=H.skeleton;Hn&&(Hn.boneTexture===null&&Hn.computeBoneTexture(),Wt.setValue(U,"boneTexture",Hn.boneTexture,Ne))}H.isBatchedMesh&&(Wt.setOptional(U,H,"batchingTexture"),Wt.setValue(U,"batchingTexture",H._matricesTexture,Ne),Wt.setOptional(U,H,"batchingColorTexture"),H._colorsTexture!==null&&Wt.setValue(U,"batchingColorTexture",H._colorsTexture,Ne));const Fh=W.morphAttributes;if((Fh.position!==void 0||Fh.normal!==void 0||Fh.color!==void 0)&&we.update(H,W,Oi),(ss||Se.receiveShadow!==H.receiveShadow)&&(Se.receiveShadow=H.receiveShadow,Wt.setValue(U,"receiveShadow",H.receiveShadow)),X.isMeshGouraudMaterial&&X.envMap!==null&&(vr.envMap.value=xe,vr.flipEnvMap.value=xe.isCubeTexture&&xe.isRenderTargetTexture===!1?-1:1),X.isMeshStandardMaterial&&X.envMap===null&&z.environment!==null&&(vr.envMapIntensity.value=z.environmentIntensity),ss&&(Wt.setValue(U,"toneMappingExposure",_.toneMappingExposure),Se.needsLights&&lT(vr,kh),ae&&X.fog===!0&&re.refreshFogUniforms(vr,ae),re.refreshMaterialUniforms(vr,X,G,N,g.state.transmissionRenderTarget[R.id]),du.upload(U,Lg(Se),vr,Ne)),X.isShaderMaterial&&X.uniformsNeedUpdate===!0&&(du.upload(U,Lg(Se),vr,Ne),X.uniformsNeedUpdate=!1),X.isSpriteMaterial&&Wt.setValue(U,"center",H.center),Wt.setValue(U,"modelViewMatrix",H.modelViewMatrix),Wt.setValue(U,"normalMatrix",H.normalMatrix),Wt.setValue(U,"modelMatrix",H.matrixWorld),X.isShaderMaterial||X.isRawShaderMaterial){const Hn=X.uniformsGroups;for(let Uh=0,uT=Hn.length;Uh<uT;Uh++){const Dg=Hn[Uh];Ye.update(Dg,Oi),Ye.bind(Dg,Oi)}}return Oi}function lT(R,z){R.ambientLightColor.needsUpdate=z,R.lightProbe.needsUpdate=z,R.directionalLights.needsUpdate=z,R.directionalLightShadows.needsUpdate=z,R.pointLights.needsUpdate=z,R.pointLightShadows.needsUpdate=z,R.spotLights.needsUpdate=z,R.spotLightShadows.needsUpdate=z,R.rectAreaLights.needsUpdate=z,R.hemisphereLights.needsUpdate=z}function cT(R){return R.isMeshLambertMaterial||R.isMeshToonMaterial||R.isMeshPhongMaterial||R.isMeshStandardMaterial||R.isShadowMaterial||R.isShaderMaterial&&R.lights===!0}this.getActiveCubeFace=function(){return A},this.getActiveMipmapLevel=function(){return M},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(R,z,W){Ge.get(R.texture).__webglTexture=z,Ge.get(R.depthTexture).__webglTexture=W;const X=Ge.get(R);X.__hasExternalTextures=!0,X.__autoAllocateDepthBuffer=W===void 0,X.__autoAllocateDepthBuffer||Ke.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),X.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(R,z){const W=Ge.get(R);W.__webglFramebuffer=z,W.__useDefaultFramebuffer=z===void 0},this.setRenderTarget=function(R,z=0,W=0){S=R,A=z,M=W;let X=!0,H=null,ae=!1,ge=!1;if(R){const xe=Ge.get(R);xe.__useDefaultFramebuffer!==void 0?(Ee.bindFramebuffer(U.FRAMEBUFFER,null),X=!1):xe.__webglFramebuffer===void 0?Ne.setupRenderTarget(R):xe.__hasExternalTextures&&Ne.rebindTextures(R,Ge.get(R.texture).__webglTexture,Ge.get(R.depthTexture).__webglTexture);const be=R.texture;(be.isData3DTexture||be.isDataArrayTexture||be.isCompressedArrayTexture)&&(ge=!0);const Ce=Ge.get(R).__webglFramebuffer;R.isWebGLCubeRenderTarget?(Array.isArray(Ce[z])?H=Ce[z][W]:H=Ce[z],ae=!0):R.samples>0&&Ne.useMultisampledRTT(R)===!1?H=Ge.get(R).__webglMultisampledFramebuffer:Array.isArray(Ce)?H=Ce[W]:H=Ce,w.copy(R.viewport),P.copy(R.scissor),V=R.scissorTest}else w.copy(Y).multiplyScalar(G).floor(),P.copy(ee).multiplyScalar(G).floor(),V=Q;if(Ee.bindFramebuffer(U.FRAMEBUFFER,H)&&X&&Ee.drawBuffers(R,H),Ee.viewport(w),Ee.scissor(P),Ee.setScissorTest(V),ae){const xe=Ge.get(R.texture);U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_CUBE_MAP_POSITIVE_X+z,xe.__webglTexture,W)}else if(ge){const xe=Ge.get(R.texture),be=z||0;U.framebufferTextureLayer(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,xe.__webglTexture,W||0,be)}b=-1},this.readRenderTargetPixels=function(R,z,W,X,H,ae,ge){if(!(R&&R.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let _e=Ge.get(R).__webglFramebuffer;if(R.isWebGLCubeRenderTarget&&ge!==void 0&&(_e=_e[ge]),_e){Ee.bindFramebuffer(U.FRAMEBUFFER,_e);try{const xe=R.texture,be=xe.format,Ce=xe.type;if(!_t.textureFormatReadable(be)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!_t.textureTypeReadable(Ce)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}z>=0&&z<=R.width-X&&W>=0&&W<=R.height-H&&U.readPixels(z,W,X,H,pe.convert(be),pe.convert(Ce),ae)}finally{const xe=S!==null?Ge.get(S).__webglFramebuffer:null;Ee.bindFramebuffer(U.FRAMEBUFFER,xe)}}},this.readRenderTargetPixelsAsync=async function(R,z,W,X,H,ae,ge){if(!(R&&R.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let _e=Ge.get(R).__webglFramebuffer;if(R.isWebGLCubeRenderTarget&&ge!==void 0&&(_e=_e[ge]),_e){Ee.bindFramebuffer(U.FRAMEBUFFER,_e);try{const xe=R.texture,be=xe.format,Ce=xe.type;if(!_t.textureFormatReadable(be))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!_t.textureTypeReadable(Ce))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(z>=0&&z<=R.width-X&&W>=0&&W<=R.height-H){const Ae=U.createBuffer();U.bindBuffer(U.PIXEL_PACK_BUFFER,Ae),U.bufferData(U.PIXEL_PACK_BUFFER,ae.byteLength,U.STREAM_READ),U.readPixels(z,W,X,H,pe.convert(be),pe.convert(Ce),0),U.flush();const it=U.fenceSync(U.SYNC_GPU_COMMANDS_COMPLETE,0);await tC(U,it,4);try{U.bindBuffer(U.PIXEL_PACK_BUFFER,Ae),U.getBufferSubData(U.PIXEL_PACK_BUFFER,0,ae)}finally{U.deleteBuffer(Ae),U.deleteSync(it)}return ae}}finally{const xe=S!==null?Ge.get(S).__webglFramebuffer:null;Ee.bindFramebuffer(U.FRAMEBUFFER,xe)}}},this.copyFramebufferToTexture=function(R,z=null,W=0){R.isTexture!==!0&&(console.warn("WebGLRenderer: copyFramebufferToTexture function signature has changed."),z=arguments[0]||null,R=arguments[1]);const X=Math.pow(2,-W),H=Math.floor(R.image.width*X),ae=Math.floor(R.image.height*X),ge=z!==null?z.x:0,_e=z!==null?z.y:0;Ne.setTexture2D(R,0),U.copyTexSubImage2D(U.TEXTURE_2D,W,0,0,ge,_e,H,ae),Ee.unbindTexture()},this.copyTextureToTexture=function(R,z,W=null,X=null,H=0){R.isTexture!==!0&&(console.warn("WebGLRenderer: copyTextureToTexture function signature has changed."),X=arguments[0]||null,R=arguments[1],z=arguments[2],H=arguments[3]||0,W=null);let ae,ge,_e,xe,be,Ce;W!==null?(ae=W.max.x-W.min.x,ge=W.max.y-W.min.y,_e=W.min.x,xe=W.min.y):(ae=R.image.width,ge=R.image.height,_e=0,xe=0),X!==null?(be=X.x,Ce=X.y):(be=0,Ce=0);const Ae=pe.convert(z.format),it=pe.convert(z.type);Ne.setTexture2D(z,0),U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,z.flipY),U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,z.premultiplyAlpha),U.pixelStorei(U.UNPACK_ALIGNMENT,z.unpackAlignment);const Tt=U.getParameter(U.UNPACK_ROW_LENGTH),Et=U.getParameter(U.UNPACK_IMAGE_HEIGHT),Rn=U.getParameter(U.UNPACK_SKIP_PIXELS),rt=U.getParameter(U.UNPACK_SKIP_ROWS),Se=U.getParameter(U.UNPACK_SKIP_IMAGES),un=R.isCompressedTexture?R.mipmaps[H]:R.image;U.pixelStorei(U.UNPACK_ROW_LENGTH,un.width),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,un.height),U.pixelStorei(U.UNPACK_SKIP_PIXELS,_e),U.pixelStorei(U.UNPACK_SKIP_ROWS,xe),R.isDataTexture?U.texSubImage2D(U.TEXTURE_2D,H,be,Ce,ae,ge,Ae,it,un.data):R.isCompressedTexture?U.compressedTexSubImage2D(U.TEXTURE_2D,H,be,Ce,un.width,un.height,Ae,un.data):U.texSubImage2D(U.TEXTURE_2D,H,be,Ce,Ae,it,un),U.pixelStorei(U.UNPACK_ROW_LENGTH,Tt),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,Et),U.pixelStorei(U.UNPACK_SKIP_PIXELS,Rn),U.pixelStorei(U.UNPACK_SKIP_ROWS,rt),U.pixelStorei(U.UNPACK_SKIP_IMAGES,Se),H===0&&z.generateMipmaps&&U.generateMipmap(U.TEXTURE_2D),Ee.unbindTexture()},this.copyTextureToTexture3D=function(R,z,W=null,X=null,H=0){R.isTexture!==!0&&(console.warn("WebGLRenderer: copyTextureToTexture3D function signature has changed."),W=arguments[0]||null,X=arguments[1]||null,R=arguments[2],z=arguments[3],H=arguments[4]||0);let ae,ge,_e,xe,be,Ce,Ae,it,Tt;const Et=R.isCompressedTexture?R.mipmaps[H]:R.image;W!==null?(ae=W.max.x-W.min.x,ge=W.max.y-W.min.y,_e=W.max.z-W.min.z,xe=W.min.x,be=W.min.y,Ce=W.min.z):(ae=Et.width,ge=Et.height,_e=Et.depth,xe=0,be=0,Ce=0),X!==null?(Ae=X.x,it=X.y,Tt=X.z):(Ae=0,it=0,Tt=0);const Rn=pe.convert(z.format),rt=pe.convert(z.type);let Se;if(z.isData3DTexture)Ne.setTexture3D(z,0),Se=U.TEXTURE_3D;else if(z.isDataArrayTexture||z.isCompressedArrayTexture)Ne.setTexture2DArray(z,0),Se=U.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,z.flipY),U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,z.premultiplyAlpha),U.pixelStorei(U.UNPACK_ALIGNMENT,z.unpackAlignment);const un=U.getParameter(U.UNPACK_ROW_LENGTH),ut=U.getParameter(U.UNPACK_IMAGE_HEIGHT),Oi=U.getParameter(U.UNPACK_SKIP_PIXELS),$l=U.getParameter(U.UNPACK_SKIP_ROWS),ss=U.getParameter(U.UNPACK_SKIP_IMAGES);U.pixelStorei(U.UNPACK_ROW_LENGTH,Et.width),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,Et.height),U.pixelStorei(U.UNPACK_SKIP_PIXELS,xe),U.pixelStorei(U.UNPACK_SKIP_ROWS,be),U.pixelStorei(U.UNPACK_SKIP_IMAGES,Ce),R.isDataTexture||R.isData3DTexture?U.texSubImage3D(Se,H,Ae,it,Tt,ae,ge,_e,Rn,rt,Et.data):z.isCompressedArrayTexture?U.compressedTexSubImage3D(Se,H,Ae,it,Tt,ae,ge,_e,Rn,Et.data):U.texSubImage3D(Se,H,Ae,it,Tt,ae,ge,_e,Rn,rt,Et),U.pixelStorei(U.UNPACK_ROW_LENGTH,un),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,ut),U.pixelStorei(U.UNPACK_SKIP_PIXELS,Oi),U.pixelStorei(U.UNPACK_SKIP_ROWS,$l),U.pixelStorei(U.UNPACK_SKIP_IMAGES,ss),H===0&&z.generateMipmaps&&U.generateMipmap(Se),Ee.unbindTexture()},this.initRenderTarget=function(R){Ge.get(R).__webglFramebuffer===void 0&&Ne.setupRenderTarget(R)},this.initTexture=function(R){R.isCubeTexture?Ne.setTextureCube(R,0):R.isData3DTexture?Ne.setTexture3D(R,0):R.isDataArrayTexture||R.isCompressedArrayTexture?Ne.setTexture2DArray(R,0):Ne.setTexture2D(R,0),Ee.unbindTexture()},this.resetState=function(){A=0,M=0,S=null,Ee.reset(),Ve.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return ir}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===Lm?"display-p3":"srgb",t.unpackColorSpace=nt.workingColorSpace===xh?"display-p3":"srgb"}}class cD extends Mt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Di,this.environmentIntensity=1,this.environmentRotation=new Di,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class uD{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=dp,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=fi()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return Dm("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=fi()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=fi()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const hn=new B;class Um{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)hn.fromBufferAttribute(this,t),hn.applyMatrix4(e),this.setXYZ(t,hn.x,hn.y,hn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)hn.fromBufferAttribute(this,t),hn.applyNormalMatrix(e),this.setXYZ(t,hn.x,hn.y,hn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)hn.fromBufferAttribute(this,t),hn.transformDirection(e),this.setXYZ(t,hn.x,hn.y,hn.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=li(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=ot(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=ot(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=ot(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=ot(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=ot(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=li(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=li(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=li(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=li(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=ot(t,this.array),i=ot(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=ot(t,this.array),i=ot(i,this.array),r=ot(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=ot(t,this.array),i=ot(i,this.array),r=ot(r,this.array),s=ot(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new _n(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Um(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const f0=new B,p0=new ht,m0=new ht,hD=new B,g0=new Oe,kc=new B,Vd=new Ni,v0=new Oe,Hd=new wh;class dD extends vn{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=qv,this.bindMatrix=new Oe,this.bindMatrixInverse=new Oe,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new gr),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,kc),this.boundingBox.expandByPoint(kc)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Ni),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,kc),this.boundingSphere.expandByPoint(kc)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,r=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Vd.copy(this.boundingSphere),Vd.applyMatrix4(r),e.ray.intersectsSphere(Vd)!==!1&&(v0.copy(r).invert(),Hd.copy(e.ray).applyMatrix4(v0),!(this.boundingBox!==null&&Hd.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,Hd)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new ht,t=this.geometry.attributes.skinWeight;for(let i=0,r=t.count;i<r;i++){e.fromBufferAttribute(t,i);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===qv?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===m1?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,r=this.geometry;p0.fromBufferAttribute(r.attributes.skinIndex,e),m0.fromBufferAttribute(r.attributes.skinWeight,e),f0.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const o=m0.getComponent(s);if(o!==0){const a=p0.getComponent(s);g0.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(hD.copy(f0).applyMatrix4(g0),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}class cM extends Mt{constructor(){super(),this.isBone=!0,this.type="Bone"}}class uM extends Kt{constructor(e=null,t=1,i=1,r,s,o,a,l,c=gn,u=gn,d,h){super(null,o,a,l,c,u,r,s,d,h),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const y0=new Oe,fD=new Oe;class Om{constructor(e=[],t=[]){this.uuid=fi(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new Oe)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new Oe;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let s=0,o=e.length;s<o;s++){const a=e[s]?e[s].matrixWorld:fD;y0.multiplyMatrices(a,t[s]),y0.toArray(i,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new Om(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new uM(t,e,e,ci,bi);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){const s=e.bones[i];let o=t[s];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),o=new cM),this.bones.push(o),this.boneInverses.push(new Oe().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let r=0,s=t.length;r<s;r++){const o=t[r];e.bones.push(o.uuid);const a=i[r];e.boneInverses.push(a.toArray())}return e}}class pp extends _n{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const oo=new Oe,_0=new Oe,Fc=[],x0=new gr,pD=new Oe,Ra=new vn,Pa=new Ni;class mD extends vn{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new pp(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<i;r++)this.setMatrixAt(r,pD)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new gr),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,oo),x0.copy(e.boundingBox).applyMatrix4(oo),this.boundingBox.union(x0)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Ni),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,oo),Pa.copy(e.boundingSphere).applyMatrix4(oo),this.boundingSphere.union(Pa)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const i=t.morphTargetInfluences,r=this.morphTexture.source.data.data,s=i.length+1,o=e*s+1;for(let a=0;a<i.length;a++)i[a]=r[o+a]}raycast(e,t){const i=this.matrixWorld,r=this.count;if(Ra.geometry=this.geometry,Ra.material=this.material,Ra.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Pa.copy(this.boundingSphere),Pa.applyMatrix4(i),e.ray.intersectsSphere(Pa)!==!1))for(let s=0;s<r;s++){this.getMatrixAt(s,oo),_0.multiplyMatrices(i,oo),Ra.matrixWorld=_0,Ra.raycast(e,Fc);for(let o=0,a=Fc.length;o<a;o++){const l=Fc[o];l.instanceId=s,l.object=this,t.push(l)}Fc.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new pp(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const i=t.morphTargetInfluences,r=i.length+1;this.morphTexture===null&&(this.morphTexture=new uM(new Float32Array(r*this.count),r,this.count,BS,bi));const s=this.morphTexture.source.data.data;let o=0;for(let c=0;c<i.length;c++)o+=i[c];const a=this.geometry.morphTargetsRelative?1:1-o,l=r*e;s[l]=a,s.set(i,l+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class hM extends pi{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Le(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const qu=new B,Ku=new B,w0=new Oe,La=new wh,Uc=new Ni,Gd=new B,S0=new B;class Bm extends Mt{constructor(e=new ki,t=new hM){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let r=1,s=t.count;r<s;r++)qu.fromBufferAttribute(t,r-1),Ku.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=qu.distanceTo(Ku);e.setAttribute("lineDistance",new sr(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Uc.copy(i.boundingSphere),Uc.applyMatrix4(r),Uc.radius+=s,e.ray.intersectsSphere(Uc)===!1)return;w0.copy(r).invert(),La.copy(e.ray).applyMatrix4(w0);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=this.isLineSegments?2:1,u=i.index,h=i.attributes.position;if(u!==null){const f=Math.max(0,o.start),m=Math.min(u.count,o.start+o.count);for(let y=f,g=m-1;y<g;y+=c){const p=u.getX(y),v=u.getX(y+1),_=Oc(this,e,La,l,p,v);_&&t.push(_)}if(this.isLineLoop){const y=u.getX(m-1),g=u.getX(f),p=Oc(this,e,La,l,y,g);p&&t.push(p)}}else{const f=Math.max(0,o.start),m=Math.min(h.count,o.start+o.count);for(let y=f,g=m-1;y<g;y+=c){const p=Oc(this,e,La,l,y,y+1);p&&t.push(p)}if(this.isLineLoop){const y=Oc(this,e,La,l,m-1,f);y&&t.push(y)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function Oc(n,e,t,i,r,s){const o=n.geometry.attributes.position;if(qu.fromBufferAttribute(o,r),Ku.fromBufferAttribute(o,s),t.distanceSqToSegment(qu,Ku,Gd,S0)>i)return;Gd.applyMatrix4(n.matrixWorld);const l=e.ray.origin.distanceTo(Gd);if(!(l<e.near||l>e.far))return{distance:l,point:S0.clone().applyMatrix4(n.matrixWorld),index:r,face:null,faceIndex:null,object:n}}const M0=new B,A0=new B;class gD extends Bm{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let r=0,s=t.count;r<s;r+=2)M0.fromBufferAttribute(t,r),A0.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+M0.distanceTo(A0);e.setAttribute("lineDistance",new sr(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class vD extends Bm{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class dM extends pi{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Le(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const T0=new Oe,mp=new wh,Bc=new Ni,zc=new B;class yD extends Mt{constructor(e=new ki,t=new dM){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Bc.copy(i.boundingSphere),Bc.applyMatrix4(r),Bc.radius+=s,e.ray.intersectsSphere(Bc)===!1)return;T0.copy(r).invert(),mp.copy(e.ray).applyMatrix4(T0);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,d=i.attributes.position;if(c!==null){const h=Math.max(0,o.start),f=Math.min(c.count,o.start+o.count);for(let m=h,y=f;m<y;m++){const g=c.getX(m);zc.fromBufferAttribute(d,g),E0(zc,g,l,r,e,t,this)}}else{const h=Math.max(0,o.start),f=Math.min(d.count,o.start+o.count);for(let m=h,y=f;m<y;m++)zc.fromBufferAttribute(d,m),E0(zc,m,l,r,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function E0(n,e,t,i,r,s,o){const a=mp.distanceSqToPoint(n);if(a<t){const l=new B;mp.closestPointToPoint(n,l),l.applyMatrix4(i);const c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}class b0 extends pi{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Le(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class zm extends pi{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Le(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Le(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=WS,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Di,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Fi extends zm{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new je(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return an(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Le(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Le(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Le(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}function Vc(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function _D(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function xD(n){function e(r,s){return n[r]-n[s]}const t=n.length,i=new Array(t);for(let r=0;r!==t;++r)i[r]=r;return i.sort(e),i}function C0(n,e,t){const i=n.length,r=new n.constructor(i);for(let s=0,o=0;o!==i;++s){const a=t[s]*e;for(let l=0;l!==e;++l)r[o++]=n[a+l]}return r}function fM(n,e,t,i){let r=1,s=n[0];for(;s!==void 0&&s[i]===void 0;)s=n[r++];if(s===void 0)return;let o=s[i];if(o!==void 0)if(Array.isArray(o))do o=s[i],o!==void 0&&(e.push(s.time),t.push.apply(t,o)),s=n[r++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[i],o!==void 0&&(e.push(s.time),o.toArray(t,t.length)),s=n[r++];while(s!==void 0);else do o=s[i],o!==void 0&&(e.push(s.time),t.push(o)),s=n[r++];while(s!==void 0)}class Hl{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],s=t[i-1];e:{t:{let o;n:{i:if(!(e<r)){for(let a=i+2;;){if(r===void 0){if(e<s)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(s=r,r=t[++i],e<r)break t}o=t.length;break n}if(!(e>=s)){const a=t[1];e<a&&(i=2,s=a);for(let l=i-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(r=s,s=t[--i-1],e>=s)break t}o=i,i=0;break n}break e}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(r=t[i],s=t[i-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)t[o]=i[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class wD extends Hl{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:xy,endingEnd:xy}}intervalChanged_(e,t,i){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],l=r[o];if(a===void 0)switch(this.getSettings_().endingStart){case wy:s=e,a=2*t-i;break;case Sy:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case wy:o=e,l=2*i-t;break;case Sy:o=1,l=i+r[1]-r[0];break;default:o=e-1,l=t}const c=(i-t)*.5,u=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-i),this._offsetPrev=s*u,this._offsetNext=o*u}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=this._offsetPrev,d=this._offsetNext,h=this._weightPrev,f=this._weightNext,m=(i-t)/(r-t),y=m*m,g=y*m,p=-h*g+2*h*y-h*m,v=(1+h)*g+(-1.5-2*h)*y+(-.5+h)*m+1,_=(-1-f)*g+(1.5+f)*y+.5*m,x=f*g-f*y;for(let A=0;A!==a;++A)s[A]=p*o[u+A]+v*o[c+A]+_*o[l+A]+x*o[d+A];return s}}class SD extends Hl{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=(i-t)/(r-t),d=1-u;for(let h=0;h!==a;++h)s[h]=o[c+h]*d+o[l+h]*u;return s}}class MD extends Hl{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Ui{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Vc(t,this.TimeBufferType),this.values=Vc(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Vc(e.times,Array),values:Vc(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new MD(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new SD(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new wD(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case bl:t=this.InterpolantFactoryMethodDiscrete;break;case Cl:t=this.InterpolantFactoryMethodLinear;break;case md:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return bl;case this.InterpolantFactoryMethodLinear:return Cl;case this.InterpolantFactoryMethodSmooth:return md}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let s=0,o=r-1;for(;s!==r&&i[s]<e;)++s;for(;o!==-1&&i[o]>t;)--o;if(++o,s!==0||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=i.slice(s,o),this.values=this.values.slice(s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,s=i.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(r!==void 0&&_D(r))for(let a=0,l=r.length;a!==l;++a){const c=r[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),r=this.getInterpolation()===md,s=e.length-1;let o=1;for(let a=1;a<s;++a){let l=!1;const c=e[a],u=e[a+1];if(c!==u&&(a!==1||c!==e[0]))if(r)l=!0;else{const d=a*i,h=d-i,f=d+i;for(let m=0;m!==i;++m){const y=t[d+m];if(y!==t[h+m]||y!==t[f+m]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const d=a*i,h=o*i;for(let f=0;f!==i;++f)t[h+f]=t[d+f]}++o}}if(s>0){e[o]=e[s];for(let a=s*i,l=o*i,c=0;c!==i;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}Ui.prototype.TimeBufferType=Float32Array;Ui.prototype.ValueBufferType=Float32Array;Ui.prototype.DefaultInterpolation=Cl;class da extends Ui{constructor(e,t,i){super(e,t,i)}}da.prototype.ValueTypeName="bool";da.prototype.ValueBufferType=Array;da.prototype.DefaultInterpolation=bl;da.prototype.InterpolantFactoryMethodLinear=void 0;da.prototype.InterpolantFactoryMethodSmooth=void 0;class pM extends Ui{}pM.prototype.ValueTypeName="color";class ta extends Ui{}ta.prototype.ValueTypeName="number";class AD extends Hl{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-t)/(r-t);let c=e*a;for(let u=c+a;c!==u;c+=4)ns.slerpFlat(s,0,o,c-a,o,c,l);return s}}class na extends Ui{InterpolantFactoryMethodLinear(e){return new AD(this.times,this.values,this.getValueSize(),e)}}na.prototype.ValueTypeName="quaternion";na.prototype.InterpolantFactoryMethodSmooth=void 0;class fa extends Ui{constructor(e,t,i){super(e,t,i)}}fa.prototype.ValueTypeName="string";fa.prototype.ValueBufferType=Array;fa.prototype.DefaultInterpolation=bl;fa.prototype.InterpolantFactoryMethodLinear=void 0;fa.prototype.InterpolantFactoryMethodSmooth=void 0;class ia extends Ui{}ia.prototype.ValueTypeName="vector";class TD{constructor(e="",t=-1,i=[],r=T1){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=fi(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,r=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)t.push(bD(i[o]).scale(r));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=i.length;s!==o;++s)t.push(Ui.toJSON(i[s]));return r}static CreateFromMorphTargetSequence(e,t,i,r){const s=t.length,o=[];for(let a=0;a<s;a++){let l=[],c=[];l.push((a+s-1)%s,a,(a+1)%s),c.push(0,1,0);const u=xD(l);l=C0(l,1,u),c=C0(c,1,u),!r&&l[0]===0&&(l.push(s),c.push(c[0])),o.push(new ta(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],u=c.name.match(s);if(u&&u.length>1){const d=u[1];let h=r[d];h||(r[d]=h=[]),h.push(c)}}const o=[];for(const a in r)o.push(this.CreateFromMorphTargetSequence(a,r[a],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(d,h,f,m,y){if(f.length!==0){const g=[],p=[];fM(f,g,p,m),g.length!==0&&y.push(new d(h,g,p))}},r=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let d=0;d<c.length;d++){const h=c[d].keys;if(!(!h||h.length===0))if(h[0].morphTargets){const f={};let m;for(m=0;m<h.length;m++)if(h[m].morphTargets)for(let y=0;y<h[m].morphTargets.length;y++)f[h[m].morphTargets[y]]=-1;for(const y in f){const g=[],p=[];for(let v=0;v!==h[m].morphTargets.length;++v){const _=h[m];g.push(_.time),p.push(_.morphTarget===y?1:0)}r.push(new ta(".morphTargetInfluence["+y+"]",g,p))}l=f.length*o}else{const f=".bones["+t[d].name+"]";i(ia,f+".position",h,"pos",r),i(na,f+".quaternion",h,"rot",r),i(ia,f+".scale",h,"scl",r)}}return r.length===0?null:new this(s,l,r,a)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,r=e.length;i!==r;++i){const s=this.tracks[i];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function ED(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ta;case"vector":case"vector2":case"vector3":case"vector4":return ia;case"color":return pM;case"quaternion":return na;case"bool":case"boolean":return da;case"string":return fa}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function bD(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=ED(n.type);if(n.times===void 0){const t=[],i=[];fM(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Fr={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class CD{constructor(e,t,i){const r=this;let s=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(u){a++,s===!1&&r.onStart!==void 0&&r.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,r.onProgress!==void 0&&r.onProgress(u,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(u){r.onError!==void 0&&r.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,d){return c.push(u,d),this},this.removeHandler=function(u){const d=c.indexOf(u);return d!==-1&&c.splice(d,2),this},this.getHandler=function(u){for(let d=0,h=c.length;d<h;d+=2){const f=c[d],m=c[d+1];if(f.global&&(f.lastIndex=0),f.test(u))return m}return null}}}const RD=new CD;class pa{constructor(e){this.manager=e!==void 0?e:RD,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,s){i.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}pa.DEFAULT_MATERIAL_NAME="__DEFAULT";const Wi={};class PD extends Error{constructor(e,t){super(e),this.response=t}}class mM extends pa{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Fr.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(Wi[e]!==void 0){Wi[e].push({onLoad:t,onProgress:i,onError:r});return}Wi[e]=[],Wi[e].push({onLoad:t,onProgress:i,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=Wi[e],d=c.body.getReader(),h=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),f=h?parseInt(h):0,m=f!==0;let y=0;const g=new ReadableStream({start(p){v();function v(){d.read().then(({done:_,value:x})=>{if(_)p.close();else{y+=x.byteLength;const A=new ProgressEvent("progress",{lengthComputable:m,loaded:y,total:f});for(let M=0,S=u.length;M<S;M++){const b=u[M];b.onProgress&&b.onProgress(A)}p.enqueue(x),v()}},_=>{p.error(_)})}}});return new Response(g)}else throw new PD(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,a));case"json":return c.json();default:if(a===void 0)return c.text();{const d=/charset="?([^;"\s]*)"?/i.exec(a),h=d&&d[1]?d[1].toLowerCase():void 0,f=new TextDecoder(h);return c.arrayBuffer().then(m=>f.decode(m))}}}).then(c=>{Fr.add(e,c);const u=Wi[e];delete Wi[e];for(let d=0,h=u.length;d<h;d++){const f=u[d];f.onLoad&&f.onLoad(c)}}).catch(c=>{const u=Wi[e];if(u===void 0)throw this.manager.itemError(e),c;delete Wi[e];for(let d=0,h=u.length;d<h;d++){const f=u[d];f.onError&&f.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class LD extends pa{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Fr.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=Rl("img");function l(){u(),Fr.add(e,this),t&&t(this),s.manager.itemEnd(e)}function c(d){u(),r&&r(d),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class ID extends pa{constructor(e){super(e)}load(e,t,i,r){const s=new Kt,o=new LD(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},i,r),s}}class Vm extends Mt{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Le(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}const Wd=new Oe,R0=new B,P0=new B;class Hm{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new je(512,512),this.map=null,this.mapPass=null,this.matrix=new Oe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Nm,this._frameExtents=new je(1,1),this._viewportCount=1,this._viewports=[new ht(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;R0.setFromMatrixPosition(e.matrixWorld),t.position.copy(R0),P0.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(P0),t.updateMatrixWorld(),Wd.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Wd),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Wd)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class DD extends Hm{constructor(){super(new mn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=Qo*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(i!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=i,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class ND extends Vm{constructor(e,t,i=0,r=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Mt.DEFAULT_UP),this.updateMatrix(),this.target=new Mt,this.distance=i,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new DD}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const L0=new Oe,Ia=new B,jd=new B;class kD extends Hm{constructor(){super(new mn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new je(4,2),this._viewportCount=6,this._viewports=[new ht(2,1,1,1),new ht(0,1,1,1),new ht(3,1,1,1),new ht(1,1,1,1),new ht(3,0,1,1),new ht(1,0,1,1)],this._cubeDirections=[new B(1,0,0),new B(-1,0,0),new B(0,0,1),new B(0,0,-1),new B(0,1,0),new B(0,-1,0)],this._cubeUps=[new B(0,1,0),new B(0,1,0),new B(0,1,0),new B(0,1,0),new B(0,0,1),new B(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,r=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),Ia.setFromMatrixPosition(e.matrixWorld),i.position.copy(Ia),jd.copy(i.position),jd.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(jd),i.updateMatrixWorld(),r.makeTranslation(-Ia.x,-Ia.y,-Ia.z),L0.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(L0)}}class gM extends Vm{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new kD}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class FD extends Hm{constructor(){super(new km(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class vM extends Vm{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Mt.DEFAULT_UP),this.updateMatrix(),this.target=new Mt,this.shadow=new FD}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class sl{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class UD extends pa{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Fr.get(e);if(o!==void 0){if(s.manager.itemStart(e),o.then){o.then(c=>{t&&t(c),s.manager.itemEnd(e)}).catch(c=>{r&&r(c)});return}return setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const l=fetch(e,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){return Fr.add(e,c),t&&t(c),s.manager.itemEnd(e),c}).catch(function(c){r&&r(c),Fr.remove(e),s.manager.itemError(e),s.manager.itemEnd(e)});Fr.add(e,l),s.manager.itemStart(e)}}const Gm="\\[\\]\\.:\\/",OD=new RegExp("["+Gm+"]","g"),Wm="[^"+Gm+"]",BD="[^"+Gm.replace("\\.","")+"]",zD=/((?:WC+[\/:])*)/.source.replace("WC",Wm),VD=/(WCOD+)?/.source.replace("WCOD",BD),HD=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Wm),GD=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Wm),WD=new RegExp("^"+zD+VD+HD+GD+"$"),jD=["material","materials","bones","map"];class XD{constructor(e,t,i){const r=i||at.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class at{constructor(e,t,i){this.path=t,this.parsedPath=i||at.parseTrackName(t),this.node=at.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new at.Composite(e,t,i):new at(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(OD,"")}static parseTrackName(e){const t=WD.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const s=i.nodeName.substring(r+1);jD.indexOf(s)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=s)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(s){for(let o=0;o<s.length;o++){const a=s[o];if(a.name===t||a.uuid===t)return a;const l=i(a.children);if(l)return l}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,r=t.propertyName;let s=t.propertyIndex;if(e||(e=at.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let c=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[r];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}at.Composite=XD;at.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};at.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};at.prototype.GetterByBindingType=[at.prototype._getValue_direct,at.prototype._getValue_array,at.prototype._getValue_arrayElement,at.prototype._getValue_toArray];at.prototype.SetterByBindingTypeAndVersioning=[[at.prototype._setValue_direct,at.prototype._setValue_direct_setNeedsUpdate,at.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[at.prototype._setValue_array,at.prototype._setValue_array_setNeedsUpdate,at.prototype._setValue_array_setMatrixWorldNeedsUpdate],[at.prototype._setValue_arrayElement,at.prototype._setValue_arrayElement_setNeedsUpdate,at.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[at.prototype._setValue_fromArray,at.prototype._setValue_fromArray_setNeedsUpdate,at.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Pm}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Pm);class ui{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new E);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new E);const i=this.elements,r=e.x,s=e.y,o=e.z;return t.x=i[0]*r+i[1]*s+i[2]*o,t.y=i[3]*r+i[4]*s+i[5]*o,t.z=i[6]*r+i[7]*s+i[8]*o,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new ui);const i=this.elements,r=e.elements,s=t.elements,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],d=i[5],h=i[6],f=i[7],m=i[8],y=r[0],g=r[1],p=r[2],v=r[3],_=r[4],x=r[5],A=r[6],M=r[7],S=r[8];return s[0]=o*y+a*v+l*A,s[1]=o*g+a*_+l*M,s[2]=o*p+a*x+l*S,s[3]=c*y+u*v+d*A,s[4]=c*g+u*_+d*M,s[5]=c*p+u*x+d*S,s[6]=h*y+f*v+m*A,s[7]=h*g+f*_+m*M,s[8]=h*p+f*x+m*S,t}scale(e,t){t===void 0&&(t=new ui);const i=this.elements,r=t.elements;for(let s=0;s!==3;s++)r[3*s+0]=e.x*i[3*s+0],r[3*s+1]=e.y*i[3*s+1],r[3*s+2]=e.z*i[3*s+2];return t}solve(e,t){t===void 0&&(t=new E);const i=3,r=4,s=[];let o,a;for(o=0;o<i*r;o++)s.push(0);for(o=0;o<3;o++)for(a=0;a<3;a++)s[o+r*a]=this.elements[o+3*a];s[3+4*0]=e.x,s[3+4*1]=e.y,s[3+4*2]=e.z;let l=3;const c=l;let u;const d=4;let h;do{if(o=c-l,s[o+r*o]===0){for(a=o+1;a<c;a++)if(s[o+r*a]!==0){u=d;do h=d-u,s[h+r*o]+=s[h+r*a];while(--u);break}}if(s[o+r*o]!==0)for(a=o+1;a<c;a++){const f=s[o+r*a]/s[o+r*o];u=d;do h=d-u,s[h+r*a]=h<=o?0:s[h+r*a]-s[h+r*o]*f;while(--u)}}while(--l);if(t.z=s[2*r+3]/s[2*r+2],t.y=(s[1*r+3]-s[1*r+2]*t.z)/s[1*r+1],t.x=(s[0*r+3]-s[0*r+2]*t.z-s[0*r+1]*t.y)/s[0*r+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,i){if(i===void 0)return this.elements[t+3*e];this.elements[t+3*e]=i}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let i=0;i<9;i++)e+=this.elements[i]+t;return e}reverse(e){e===void 0&&(e=new ui);const t=3,i=6,r=qD;let s,o;for(s=0;s<3;s++)for(o=0;o<3;o++)r[s+i*o]=this.elements[s+3*o];r[3+6*0]=1,r[3+6*1]=0,r[3+6*2]=0,r[4+6*0]=0,r[4+6*1]=1,r[4+6*2]=0,r[5+6*0]=0,r[5+6*1]=0,r[5+6*2]=1;let a=3;const l=a;let c;const u=i;let d;do{if(s=l-a,r[s+i*s]===0){for(o=s+1;o<l;o++)if(r[s+i*o]!==0){c=u;do d=u-c,r[d+i*s]+=r[d+i*o];while(--c);break}}if(r[s+i*s]!==0)for(o=s+1;o<l;o++){const h=r[s+i*o]/r[s+i*s];c=u;do d=u-c,r[d+i*o]=d<=s?0:r[d+i*o]-r[d+i*s]*h;while(--c)}}while(--a);s=2;do{o=s-1;do{const h=r[s+i*o]/r[s+i*s];c=i;do d=i-c,r[d+i*o]=r[d+i*o]-r[d+i*s]*h;while(--c)}while(o--)}while(--s);s=2;do{const h=1/r[s+i*s];c=i;do d=i-c,r[d+i*s]=r[d+i*s]*h;while(--c)}while(s--);s=2;do{o=2;do{if(d=r[t+o+i*s],isNaN(d)||d===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(s,o,d)}while(o--)}while(s--);return e}setRotationFromQuaternion(e){const t=e.x,i=e.y,r=e.z,s=e.w,o=t+t,a=i+i,l=r+r,c=t*o,u=t*a,d=t*l,h=i*a,f=i*l,m=r*l,y=s*o,g=s*a,p=s*l,v=this.elements;return v[3*0+0]=1-(h+m),v[3*0+1]=u-p,v[3*0+2]=d+g,v[3*1+0]=u+p,v[3*1+1]=1-(c+m),v[3*1+2]=f-y,v[3*2+0]=d-g,v[3*2+1]=f+y,v[3*2+2]=1-(c+h),this}transpose(e){e===void 0&&(e=new ui);const t=this.elements,i=e.elements;let r;return i[0]=t[0],i[4]=t[4],i[8]=t[8],r=t[1],i[1]=t[3],i[3]=r,r=t[2],i[2]=t[6],i[6]=r,r=t[5],i[5]=t[7],i[7]=r,e}}const qD=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class E{constructor(e,t,i){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),this.x=e,this.y=t,this.z=i}cross(e,t){t===void 0&&(t=new E);const i=e.x,r=e.y,s=e.z,o=this.x,a=this.y,l=this.z;return t.x=a*s-l*r,t.y=l*i-o*s,t.z=o*r-a*i,t}set(e,t,i){return this.x=e,this.y=t,this.z=i,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new E(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new E(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new ui([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,i=this.z,r=Math.sqrt(e*e+t*t+i*i);if(r>0){const s=1/r;this.x*=s,this.y*=s,this.z*=s}else this.x=0,this.y=0,this.z=0;return r}unit(e){e===void 0&&(e=new E);const t=this.x,i=this.y,r=this.z;let s=Math.sqrt(t*t+i*i+r*r);return s>0?(s=1/s,e.x=t*s,e.y=i*s,e.z=r*s):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,i=this.z;return Math.sqrt(e*e+t*t+i*i)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z;return Math.sqrt((s-t)*(s-t)+(o-i)*(o-i)+(a-r)*(a-r))}distanceSquared(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z;return(s-t)*(s-t)+(o-i)*(o-i)+(a-r)*(a-r)}scale(e,t){t===void 0&&(t=new E);const i=this.x,r=this.y,s=this.z;return t.x=e*i,t.y=e*r,t.z=e*s,t}vmul(e,t){return t===void 0&&(t=new E),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,i){return i===void 0&&(i=new E),i.x=this.x+e*t.x,i.y=this.y+e*t.y,i.z=this.z+e*t.z,i}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new E),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const i=this.length();if(i>0){const r=KD,s=1/i;r.set(this.x*s,this.y*s,this.z*s);const o=YD;Math.abs(r.x)<.9?(o.set(1,0,0),r.cross(o,e)):(o.set(0,1,0),r.cross(o,e)),r.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,i){const r=this.x,s=this.y,o=this.z;i.x=r+(e.x-r)*t,i.y=s+(e.y-s)*t,i.z=o+(e.z-o)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(I0),I0.almostEquals(e,t)}clone(){return new E(this.x,this.y,this.z)}}E.ZERO=new E(0,0,0);E.UNIT_X=new E(1,0,0);E.UNIT_Y=new E(0,1,0);E.UNIT_Z=new E(0,0,1);const KD=new E,YD=new E,I0=new E;class Vn{constructor(e){e===void 0&&(e={}),this.lowerBound=new E,this.upperBound=new E,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,i,r){const s=this.lowerBound,o=this.upperBound,a=i;s.copy(e[0]),a&&a.vmult(s,s),o.copy(s);for(let l=1;l<e.length;l++){let c=e[l];a&&(a.vmult(c,D0),c=D0),c.x>o.x&&(o.x=c.x),c.x<s.x&&(s.x=c.x),c.y>o.y&&(o.y=c.y),c.y<s.y&&(s.y=c.y),c.z>o.z&&(o.z=c.z),c.z<s.z&&(s.z=c.z)}return t&&(t.vadd(s,s),t.vadd(o,o)),r&&(s.x-=r,s.y-=r,s.z-=r,o.x+=r,o.y+=r,o.z+=r),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new Vn().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,i=this.upperBound,r=e.lowerBound,s=e.upperBound,o=r.x<=i.x&&i.x<=s.x||t.x<=s.x&&s.x<=i.x,a=r.y<=i.y&&i.y<=s.y||t.y<=s.y&&s.y<=i.y,l=r.z<=i.z&&i.z<=s.z||t.z<=s.z&&s.z<=i.z;return o&&a&&l}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,i=this.upperBound,r=e.lowerBound,s=e.upperBound;return t.x<=r.x&&i.x>=s.x&&t.y<=r.y&&i.y>=s.y&&t.z<=r.z&&i.z>=s.z}getCorners(e,t,i,r,s,o,a,l){const c=this.lowerBound,u=this.upperBound;e.copy(c),t.set(u.x,c.y,c.z),i.set(u.x,u.y,c.z),r.set(c.x,u.y,u.z),s.set(u.x,c.y,u.z),o.set(c.x,u.y,c.z),a.set(c.x,c.y,u.z),l.copy(u)}toLocalFrame(e,t){const i=N0,r=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],u=i[6],d=i[7];this.getCorners(r,s,o,a,l,c,u,d);for(let h=0;h!==8;h++){const f=i[h];e.pointToLocal(f,f)}return t.setFromPoints(i)}toWorldFrame(e,t){const i=N0,r=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],u=i[6],d=i[7];this.getCorners(r,s,o,a,l,c,u,d);for(let h=0;h!==8;h++){const f=i[h];e.pointToWorld(f,f)}return t.setFromPoints(i)}overlapsRay(e){const{direction:t,from:i}=e,r=1/t.x,s=1/t.y,o=1/t.z,a=(this.lowerBound.x-i.x)*r,l=(this.upperBound.x-i.x)*r,c=(this.lowerBound.y-i.y)*s,u=(this.upperBound.y-i.y)*s,d=(this.lowerBound.z-i.z)*o,h=(this.upperBound.z-i.z)*o,f=Math.max(Math.max(Math.min(a,l),Math.min(c,u)),Math.min(d,h)),m=Math.min(Math.min(Math.max(a,l),Math.max(c,u)),Math.max(d,h));return!(m<0||f>m)}}const D0=new E,N0=[new E,new E,new E,new E,new E,new E,new E,new E];class k0{constructor(){this.matrix=[]}get(e,t){let{index:i}=e,{index:r}=t;if(r>i){const s=r;r=i,i=s}return this.matrix[(i*(i+1)>>1)+r-1]}set(e,t,i){let{index:r}=e,{index:s}=t;if(s>r){const o=s;s=r,r=o}this.matrix[(r*(r+1)>>1)+s-1]=i?1:0}reset(){for(let e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}}class yM{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;return i[e]===void 0&&(i[e]=[]),i[e].includes(t)||i[e].push(t),this}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return!!(i[e]!==void 0&&i[e].includes(t))}hasAnyEventListener(e){return this._listeners===void 0?!1:this._listeners[e]!==void 0}removeEventListener(e,t){if(this._listeners===void 0)return this;const i=this._listeners;if(i[e]===void 0)return this;const r=i[e].indexOf(t);return r!==-1&&i[e].splice(r,1),this}dispatchEvent(e){if(this._listeners===void 0)return this;const i=this._listeners[e.type];if(i!==void 0){e.target=this;for(let r=0,s=i.length;r<s;r++)i[r].call(this,e)}return this}}class Ft{constructor(e,t,i,r){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),r===void 0&&(r=1),this.x=e,this.y=t,this.z=i,this.w=r}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const i=Math.sin(t*.5);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new E),this.normalize();const t=2*Math.acos(this.w),i=Math.sqrt(1-this.w*this.w);return i<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/i,e.y=this.y/i,e.z=this.z/i),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const i=$D,r=ZD;e.tangents(i,r),this.setFromAxisAngle(i,Math.PI)}else{const i=e.cross(t);this.x=i.x,this.y=i.y,this.z=i.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new Ft);const i=this.x,r=this.y,s=this.z,o=this.w,a=e.x,l=e.y,c=e.z,u=e.w;return t.x=i*u+o*a+r*c-s*l,t.y=r*u+o*l+s*a-i*c,t.z=s*u+o*c+i*l-r*a,t.w=o*u-i*a-r*l-s*c,t}inverse(e){e===void 0&&(e=new Ft);const t=this.x,i=this.y,r=this.z,s=this.w;this.conjugate(e);const o=1/(t*t+i*i+r*r+s*s);return e.x*=o,e.y*=o,e.z*=o,e.w*=o,e}conjugate(e){return e===void 0&&(e=new Ft),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new E);const i=e.x,r=e.y,s=e.z,o=this.x,a=this.y,l=this.z,c=this.w,u=c*i+a*s-l*r,d=c*r+l*i-o*s,h=c*s+o*r-a*i,f=-o*i-a*r-l*s;return t.x=u*c+f*-o+d*-l-h*-a,t.y=d*c+f*-a+h*-o-u*-l,t.z=h*c+f*-l+u*-a-d*-o,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let i,r,s;const o=this.x,a=this.y,l=this.z,c=this.w;switch(t){case"YZX":const u=o*a+l*c;if(u>.499&&(i=2*Math.atan2(o,c),r=Math.PI/2,s=0),u<-.499&&(i=-2*Math.atan2(o,c),r=-Math.PI/2,s=0),i===void 0){const d=o*o,h=a*a,f=l*l;i=Math.atan2(2*a*c-2*o*l,1-2*h-2*f),r=Math.asin(2*u),s=Math.atan2(2*o*c-2*a*l,1-2*d-2*f)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=i,e.z=r,e.x=s}setFromEuler(e,t,i,r){r===void 0&&(r="XYZ");const s=Math.cos(e/2),o=Math.cos(t/2),a=Math.cos(i/2),l=Math.sin(e/2),c=Math.sin(t/2),u=Math.sin(i/2);return r==="XYZ"?(this.x=l*o*a+s*c*u,this.y=s*c*a-l*o*u,this.z=s*o*u+l*c*a,this.w=s*o*a-l*c*u):r==="YXZ"?(this.x=l*o*a+s*c*u,this.y=s*c*a-l*o*u,this.z=s*o*u-l*c*a,this.w=s*o*a+l*c*u):r==="ZXY"?(this.x=l*o*a-s*c*u,this.y=s*c*a+l*o*u,this.z=s*o*u+l*c*a,this.w=s*o*a-l*c*u):r==="ZYX"?(this.x=l*o*a-s*c*u,this.y=s*c*a+l*o*u,this.z=s*o*u-l*c*a,this.w=s*o*a+l*c*u):r==="YZX"?(this.x=l*o*a+s*c*u,this.y=s*c*a+l*o*u,this.z=s*o*u-l*c*a,this.w=s*o*a-l*c*u):r==="XZY"&&(this.x=l*o*a-s*c*u,this.y=s*c*a-l*o*u,this.z=s*o*u+l*c*a,this.w=s*o*a+l*c*u),this}clone(){return new Ft(this.x,this.y,this.z,this.w)}slerp(e,t,i){i===void 0&&(i=new Ft);const r=this.x,s=this.y,o=this.z,a=this.w;let l=e.x,c=e.y,u=e.z,d=e.w,h,f,m,y,g;return f=r*l+s*c+o*u+a*d,f<0&&(f=-f,l=-l,c=-c,u=-u,d=-d),1-f>1e-6?(h=Math.acos(f),m=Math.sin(h),y=Math.sin((1-t)*h)/m,g=Math.sin(t*h)/m):(y=1-t,g=t),i.x=y*r+g*l,i.y=y*s+g*c,i.z=y*o+g*u,i.w=y*a+g*d,i}integrate(e,t,i,r){r===void 0&&(r=new Ft);const s=e.x*i.x,o=e.y*i.y,a=e.z*i.z,l=this.x,c=this.y,u=this.z,d=this.w,h=t*.5;return r.x+=h*(s*d+o*u-a*c),r.y+=h*(o*d+a*l-s*u),r.z+=h*(a*d+s*c-o*l),r.w+=h*(-s*l-o*c-a*u),r}}const $D=new E,ZD=new E,QD={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class ye{constructor(e){e===void 0&&(e={}),this.id=ye.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,i,r){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}ye.idCounter=0;ye.types=QD;class tt{constructor(e){e===void 0&&(e={}),this.position=new E,this.quaternion=new Ft,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return tt.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return tt.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new E),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,i,r){return r===void 0&&(r=new E),i.vsub(e,r),t.conjugate(F0),F0.vmult(r,r),r}static pointToWorldFrame(e,t,i,r){return r===void 0&&(r=new E),t.vmult(i,r),r.vadd(e,r),r}static vectorToWorldFrame(e,t,i){return i===void 0&&(i=new E),e.vmult(t,i),i}static vectorToLocalFrame(e,t,i,r){return r===void 0&&(r=new E),t.w*=-1,t.vmult(i,r),t.w*=-1,r}}const F0=new Ft;class Uo extends ye{constructor(e){e===void 0&&(e={});const{vertices:t=[],faces:i=[],normals:r=[],axes:s,boundingSphereRadius:o}=e;super({type:ye.types.CONVEXPOLYHEDRON}),this.vertices=t,this.faces=i,this.faceNormals=r,this.faceNormals.length===0&&this.computeNormals(),o?this.boundingSphereRadius=o:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=s?s.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const e=this.faces,t=this.vertices,i=this.uniqueEdges;i.length=0;const r=new E;for(let s=0;s!==e.length;s++){const o=e[s],a=o.length;for(let l=0;l!==a;l++){const c=(l+1)%a;t[o[l]].vsub(t[o[c]],r),r.normalize();let u=!1;for(let d=0;d!==i.length;d++)if(i[d].almostEquals(r)||i[d].almostEquals(r)){u=!0;break}u||i.push(r.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let r=0;r<this.faces[e].length;r++)if(!this.vertices[this.faces[e][r]])throw new Error(`Vertex ${this.faces[e][r]} not found!`);const t=this.faceNormals[e]||new E;this.getFaceNormal(e,t),t.negate(t),this.faceNormals[e]=t;const i=this.vertices[this.faces[e][0]];if(t.dot(i)<0){console.error(`.faceNormals[${e}] = Vec3(${t.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let r=0;r<this.faces[e].length;r++)console.warn(`.vertices[${this.faces[e][r]}] = Vec3(${this.vertices[this.faces[e][r]].toString()})`)}}}getFaceNormal(e,t){const i=this.faces[e],r=this.vertices[i[0]],s=this.vertices[i[1]],o=this.vertices[i[2]];Uo.computeNormal(r,s,o,t)}static computeNormal(e,t,i,r){const s=new E,o=new E;t.vsub(e,o),i.vsub(t,s),s.cross(o,r),r.isZero()||r.normalize()}clipAgainstHull(e,t,i,r,s,o,a,l,c){const u=new E;let d=-1,h=-Number.MAX_VALUE;for(let m=0;m<i.faces.length;m++){u.copy(i.faceNormals[m]),s.vmult(u,u);const y=u.dot(o);y>h&&(h=y,d=m)}const f=[];for(let m=0;m<i.faces[d].length;m++){const y=i.vertices[i.faces[d][m]],g=new E;g.copy(y),s.vmult(g,g),r.vadd(g,g),f.push(g)}d>=0&&this.clipFaceAgainstHull(o,e,t,f,a,l,c)}findSeparatingAxis(e,t,i,r,s,o,a,l){const c=new E,u=new E,d=new E,h=new E,f=new E,m=new E;let y=Number.MAX_VALUE;const g=this;if(g.uniqueAxes)for(let p=0;p!==g.uniqueAxes.length;p++){i.vmult(g.uniqueAxes[p],c);const v=g.testSepAxis(c,e,t,i,r,s);if(v===!1)return!1;v<y&&(y=v,o.copy(c))}else{const p=a?a.length:g.faces.length;for(let v=0;v<p;v++){const _=a?a[v]:v;c.copy(g.faceNormals[_]),i.vmult(c,c);const x=g.testSepAxis(c,e,t,i,r,s);if(x===!1)return!1;x<y&&(y=x,o.copy(c))}}if(e.uniqueAxes)for(let p=0;p!==e.uniqueAxes.length;p++){s.vmult(e.uniqueAxes[p],u);const v=g.testSepAxis(u,e,t,i,r,s);if(v===!1)return!1;v<y&&(y=v,o.copy(u))}else{const p=l?l.length:e.faces.length;for(let v=0;v<p;v++){const _=l?l[v]:v;u.copy(e.faceNormals[_]),s.vmult(u,u);const x=g.testSepAxis(u,e,t,i,r,s);if(x===!1)return!1;x<y&&(y=x,o.copy(u))}}for(let p=0;p!==g.uniqueEdges.length;p++){i.vmult(g.uniqueEdges[p],h);for(let v=0;v!==e.uniqueEdges.length;v++)if(s.vmult(e.uniqueEdges[v],f),h.cross(f,m),!m.almostZero()){m.normalize();const _=g.testSepAxis(m,e,t,i,r,s);if(_===!1)return!1;_<y&&(y=_,o.copy(m))}}return r.vsub(t,d),d.dot(o)>0&&o.negate(o),!0}testSepAxis(e,t,i,r,s,o){const a=this;Uo.project(a,e,i,r,Xd),Uo.project(t,e,s,o,qd);const l=Xd[0],c=Xd[1],u=qd[0],d=qd[1];if(l<d||u<c)return!1;const h=l-d,f=u-c;return h<f?h:f}calculateLocalInertia(e,t){const i=new E,r=new E;this.computeLocalAABB(r,i);const s=i.x-r.x,o=i.y-r.y,a=i.z-r.z;t.x=1/12*e*(2*o*2*o+2*a*2*a),t.y=1/12*e*(2*s*2*s+2*a*2*a),t.z=1/12*e*(2*o*2*o+2*s*2*s)}getPlaneConstantOfFace(e){const t=this.faces[e],i=this.faceNormals[e],r=this.vertices[t[0]];return-i.dot(r)}clipFaceAgainstHull(e,t,i,r,s,o,a){const l=new E,c=new E,u=new E,d=new E,h=new E,f=new E,m=new E,y=new E,g=this,p=[],v=r,_=p;let x=-1,A=Number.MAX_VALUE;for(let w=0;w<g.faces.length;w++){l.copy(g.faceNormals[w]),i.vmult(l,l);const P=l.dot(e);P<A&&(A=P,x=w)}if(x<0)return;const M=g.faces[x];M.connectedFaces=[];for(let w=0;w<g.faces.length;w++)for(let P=0;P<g.faces[w].length;P++)M.indexOf(g.faces[w][P])!==-1&&w!==x&&M.connectedFaces.indexOf(w)===-1&&M.connectedFaces.push(w);const S=M.length;for(let w=0;w<S;w++){const P=g.vertices[M[w]],V=g.vertices[M[(w+1)%S]];P.vsub(V,c),u.copy(c),i.vmult(u,u),t.vadd(u,u),d.copy(this.faceNormals[x]),i.vmult(d,d),t.vadd(d,d),u.cross(d,h),h.negate(h),f.copy(P),i.vmult(f,f),t.vadd(f,f);const I=M.connectedFaces[w];m.copy(this.faceNormals[I]);const O=this.getPlaneConstantOfFace(I);y.copy(m),i.vmult(y,y);const F=O-y.dot(t);for(this.clipFaceAgainstPlane(v,_,y,F);v.length;)v.shift();for(;_.length;)v.push(_.shift())}m.copy(this.faceNormals[x]);const b=this.getPlaneConstantOfFace(x);y.copy(m),i.vmult(y,y);const T=b-y.dot(t);for(let w=0;w<v.length;w++){let P=y.dot(v[w])+T;if(P<=s&&(console.log(`clamped: depth=${P} to minDist=${s}`),P=s),P<=o){const V=v[w];if(P<=1e-6){const I={point:V,normal:y,depth:P};a.push(I)}}}}clipFaceAgainstPlane(e,t,i,r){let s,o;const a=e.length;if(a<2)return t;let l=e[e.length-1],c=e[0];s=i.dot(l)+r;for(let u=0;u<a;u++){if(c=e[u],o=i.dot(c)+r,s<0)if(o<0){const d=new E;d.copy(c),t.push(d)}else{const d=new E;l.lerp(c,s/(s-o),d),t.push(d)}else if(o<0){const d=new E;l.lerp(c,s/(s-o),d),t.push(d),t.push(c)}l=c,s=o}return t}computeWorldVertices(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new E);const i=this.vertices,r=this.worldVertices;for(let s=0;s!==this.vertices.length;s++)t.vmult(i[s],r[s]),e.vadd(r[s],r[s]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,t){const i=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let r=0;r<this.vertices.length;r++){const s=i[r];s.x<e.x?e.x=s.x:s.x>t.x&&(t.x=s.x),s.y<e.y?e.y=s.y:s.y>t.y&&(t.y=s.y),s.z<e.z?e.z=s.z:s.z>t.z&&(t.z=s.z)}}computeWorldFaceNormals(e){const t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new E);const i=this.faceNormals,r=this.worldFaceNormals;for(let s=0;s!==t;s++)e.vmult(i[s],r[s]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const t=this.vertices;for(let i=0;i!==t.length;i++){const r=t[i].lengthSquared();r>e&&(e=r)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,i,r){const s=this.vertices;let o,a,l,c,u,d,h=new E;for(let f=0;f<s.length;f++){h.copy(s[f]),t.vmult(h,h),e.vadd(h,h);const m=h;(o===void 0||m.x<o)&&(o=m.x),(c===void 0||m.x>c)&&(c=m.x),(a===void 0||m.y<a)&&(a=m.y),(u===void 0||m.y>u)&&(u=m.y),(l===void 0||m.z<l)&&(l=m.z),(d===void 0||m.z>d)&&(d=m.z)}i.set(o,a,l),r.set(c,u,d)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e){e===void 0&&(e=new E);const t=this.vertices;for(let i=0;i<t.length;i++)e.vadd(t[i],e);return e.scale(1/t.length,e),e}transformAllPoints(e,t){const i=this.vertices.length,r=this.vertices;if(t){for(let s=0;s<i;s++){const o=r[s];t.vmult(o,o)}for(let s=0;s<this.faceNormals.length;s++){const o=this.faceNormals[s];t.vmult(o,o)}}if(e)for(let s=0;s<i;s++){const o=r[s];o.vadd(e,o)}}pointIsInside(e){const t=this.vertices,i=this.faces,r=this.faceNormals,s=null,o=new E;this.getAveragePointLocal(o);for(let a=0;a<this.faces.length;a++){let l=r[a];const c=t[i[a][0]],u=new E;e.vsub(c,u);const d=l.dot(u),h=new E;o.vsub(c,h);const f=l.dot(h);if(d<0&&f>0||d>0&&f<0)return!1}return s?1:-1}static project(e,t,i,r,s){const o=e.vertices.length,a=JD;let l=0,c=0;const u=eN,d=e.vertices;u.setZero(),tt.vectorToLocalFrame(i,r,t,a),tt.pointToLocalFrame(i,r,u,u);const h=u.dot(a);c=l=d[0].dot(a);for(let f=1;f<o;f++){const m=d[f].dot(a);m>l&&(l=m),m<c&&(c=m)}if(c-=h,l-=h,c>l){const f=c;c=l,l=f}s[0]=l,s[1]=c}}const Xd=[],qd=[];new E;const JD=new E,eN=new E;class Mh extends ye{constructor(e){super({type:ye.types.BOX}),this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const e=this.halfExtents.x,t=this.halfExtents.y,i=this.halfExtents.z,r=E,s=[new r(-e,-t,-i),new r(e,-t,-i),new r(e,t,-i),new r(-e,t,-i),new r(-e,-t,i),new r(e,-t,i),new r(e,t,i),new r(-e,t,i)],o=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],a=[new r(0,0,1),new r(0,1,0),new r(1,0,0)],l=new Uo({vertices:s,faces:o,axes:a});this.convexPolyhedronRepresentation=l,l.material=this.material}calculateLocalInertia(e,t){return t===void 0&&(t=new E),Mh.calculateInertia(this.halfExtents,e,t),t}static calculateInertia(e,t,i){const r=e;i.x=1/12*t*(2*r.y*2*r.y+2*r.z*2*r.z),i.y=1/12*t*(2*r.x*2*r.x+2*r.z*2*r.z),i.z=1/12*t*(2*r.y*2*r.y+2*r.x*2*r.x)}getSideNormals(e,t){const i=e,r=this.halfExtents;if(i[0].set(r.x,0,0),i[1].set(0,r.y,0),i[2].set(0,0,r.z),i[3].set(-r.x,0,0),i[4].set(0,-r.y,0),i[5].set(0,0,-r.z),t!==void 0)for(let s=0;s!==i.length;s++)t.vmult(i[s],i[s]);return i}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,t,i){const r=this.halfExtents,s=[[r.x,r.y,r.z],[-r.x,r.y,r.z],[-r.x,-r.y,r.z],[-r.x,-r.y,-r.z],[r.x,-r.y,-r.z],[r.x,r.y,-r.z],[-r.x,r.y,-r.z],[r.x,-r.y,r.z]];for(let o=0;o<s.length;o++)Tr.set(s[o][0],s[o][1],s[o][2]),t.vmult(Tr,Tr),e.vadd(Tr,Tr),i(Tr.x,Tr.y,Tr.z)}calculateWorldAABB(e,t,i,r){const s=this.halfExtents;_i[0].set(s.x,s.y,s.z),_i[1].set(-s.x,s.y,s.z),_i[2].set(-s.x,-s.y,s.z),_i[3].set(-s.x,-s.y,-s.z),_i[4].set(s.x,-s.y,-s.z),_i[5].set(s.x,s.y,-s.z),_i[6].set(-s.x,s.y,-s.z),_i[7].set(s.x,-s.y,s.z);const o=_i[0];t.vmult(o,o),e.vadd(o,o),r.copy(o),i.copy(o);for(let a=1;a<8;a++){const l=_i[a];t.vmult(l,l),e.vadd(l,l);const c=l.x,u=l.y,d=l.z;c>r.x&&(r.x=c),u>r.y&&(r.y=u),d>r.z&&(r.z=d),c<i.x&&(i.x=c),u<i.y&&(i.y=u),d<i.z&&(i.z=d)}}}const Tr=new E,_i=[new E,new E,new E,new E,new E,new E,new E,new E],jm={DYNAMIC:1,STATIC:2,KINEMATIC:4},Xm={AWAKE:0,SLEEPY:1,SLEEPING:2};let Ue=class st extends yM{constructor(e){e===void 0&&(e={}),super(),this.id=st.idCounter++,this.index=-1,this.world=null,this.vlambda=new E,this.collisionFilterGroup=typeof e.collisionFilterGroup=="number"?e.collisionFilterGroup:1,this.collisionFilterMask=typeof e.collisionFilterMask=="number"?e.collisionFilterMask:-1,this.collisionResponse=typeof e.collisionResponse=="boolean"?e.collisionResponse:!0,this.position=new E,this.previousPosition=new E,this.interpolatedPosition=new E,this.initPosition=new E,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new E,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new E,this.force=new E;const t=typeof e.mass=="number"?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping=typeof e.linearDamping=="number"?e.linearDamping:.01,this.type=t<=0?st.STATIC:st.DYNAMIC,typeof e.type==typeof st.STATIC&&(this.type=e.type),this.allowSleep=typeof e.allowSleep<"u"?e.allowSleep:!0,this.sleepState=st.AWAKE,this.sleepSpeedLimit=typeof e.sleepSpeedLimit<"u"?e.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof e.sleepTimeLimit<"u"?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new E,this.quaternion=new Ft,this.initQuaternion=new Ft,this.previousQuaternion=new Ft,this.interpolatedQuaternion=new Ft,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new E,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new E,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new E,this.invInertia=new E,this.invInertiaWorld=new ui,this.invMassSolve=0,this.invInertiaSolve=new E,this.invInertiaWorldSolve=new ui,this.fixedRotation=typeof e.fixedRotation<"u"?e.fixedRotation:!1,this.angularDamping=typeof e.angularDamping<"u"?e.angularDamping:.01,this.linearFactor=new E(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new E(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new Vn,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new E,this.isTrigger=!!e.isTrigger,e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){const e=this.sleepState;this.sleepState=st.AWAKE,this.wakeUpAfterNarrowphase=!1,e===st.SLEEPING&&this.dispatchEvent(st.wakeupEvent)}sleep(){this.sleepState=st.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){const t=this.sleepState,i=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),r=this.sleepSpeedLimit**2;t===st.AWAKE&&i<r?(this.sleepState=st.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(st.sleepyEvent)):t===st.SLEEPY&&i>r?this.wakeUp():t===st.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(st.sleepEvent))}}updateSolveMassProperties(){this.sleepState===st.SLEEPING||this.type===st.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t){return t===void 0&&(t=new E),e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t){return t===void 0&&(t=new E),this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t){return t===void 0&&(t=new E),this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t){return t===void 0&&(t=new E),this.quaternion.vmult(e,t),t}addShape(e,t,i){const r=new E,s=new Ft;return t&&r.copy(t),i&&s.copy(i),this.shapes.push(e),this.shapeOffsets.push(r),this.shapeOrientations.push(s),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){const t=this.shapes.indexOf(e);return t===-1?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}updateBoundingRadius(){const e=this.shapes,t=this.shapeOffsets,i=e.length;let r=0;for(let s=0;s!==i;s++){const o=e[s];o.updateBoundingSphereRadius();const a=t[s].length(),l=o.boundingSphereRadius;a+l>r&&(r=a+l)}this.boundingRadius=r}updateAABB(){const e=this.shapes,t=this.shapeOffsets,i=this.shapeOrientations,r=e.length,s=tN,o=nN,a=this.quaternion,l=this.aabb,c=iN;for(let u=0;u!==r;u++){const d=e[u];a.vmult(t[u],s),s.vadd(this.position,s),a.mult(i[u],o),d.calculateWorldAABB(s,o,c.lowerBound,c.upperBound),u===0?l.copy(c):l.extend(c)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const t=this.invInertia;if(!(t.x===t.y&&t.y===t.z&&!e)){const i=rN,r=sN;i.setRotationFromQuaternion(this.quaternion),i.transpose(r),i.scale(t,i),i.mmult(r,this.invInertiaWorld)}}applyForce(e,t){if(t===void 0&&(t=new E),this.type!==st.DYNAMIC)return;this.sleepState===st.SLEEPING&&this.wakeUp();const i=oN;t.cross(e,i),this.force.vadd(e,this.force),this.torque.vadd(i,this.torque)}applyLocalForce(e,t){if(t===void 0&&(t=new E),this.type!==st.DYNAMIC)return;const i=aN,r=lN;this.vectorToWorldFrame(e,i),this.vectorToWorldFrame(t,r),this.applyForce(i,r)}applyTorque(e){this.type===st.DYNAMIC&&(this.sleepState===st.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,t){if(t===void 0&&(t=new E),this.type!==st.DYNAMIC)return;this.sleepState===st.SLEEPING&&this.wakeUp();const i=t,r=cN;r.copy(e),r.scale(this.invMass,r),this.velocity.vadd(r,this.velocity);const s=uN;i.cross(e,s),this.invInertiaWorld.vmult(s,s),this.angularVelocity.vadd(s,this.angularVelocity)}applyLocalImpulse(e,t){if(t===void 0&&(t=new E),this.type!==st.DYNAMIC)return;const i=hN,r=dN;this.vectorToWorldFrame(e,i),this.vectorToWorldFrame(t,r),this.applyImpulse(i,r)}updateMassProperties(){const e=fN;this.invMass=this.mass>0?1/this.mass:0;const t=this.inertia,i=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),Mh.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!i?1/t.x:0,t.y>0&&!i?1/t.y:0,t.z>0&&!i?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){const i=new E;return e.vsub(this.position,i),this.angularVelocity.cross(i,t),this.velocity.vadd(t,t),t}integrate(e,t,i){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),!(this.type===st.DYNAMIC||this.type===st.KINEMATIC)||this.sleepState===st.SLEEPING)return;const r=this.velocity,s=this.angularVelocity,o=this.position,a=this.force,l=this.torque,c=this.quaternion,u=this.invMass,d=this.invInertiaWorld,h=this.linearFactor,f=u*e;r.x+=a.x*f*h.x,r.y+=a.y*f*h.y,r.z+=a.z*f*h.z;const m=d.elements,y=this.angularFactor,g=l.x*y.x,p=l.y*y.y,v=l.z*y.z;s.x+=e*(m[0]*g+m[1]*p+m[2]*v),s.y+=e*(m[3]*g+m[4]*p+m[5]*v),s.z+=e*(m[6]*g+m[7]*p+m[8]*v),o.x+=r.x*e,o.y+=r.y*e,o.z+=r.z*e,c.integrate(this.angularVelocity,e,this.angularFactor,c),t&&(i?c.normalizeFast():c.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}};Ue.idCounter=0;Ue.COLLIDE_EVENT_NAME="collide";Ue.DYNAMIC=jm.DYNAMIC;Ue.STATIC=jm.STATIC;Ue.KINEMATIC=jm.KINEMATIC;Ue.AWAKE=Xm.AWAKE;Ue.SLEEPY=Xm.SLEEPY;Ue.SLEEPING=Xm.SLEEPING;Ue.wakeupEvent={type:"wakeup"};Ue.sleepyEvent={type:"sleepy"};Ue.sleepEvent={type:"sleep"};const tN=new E,nN=new Ft,iN=new Vn,rN=new ui,sN=new ui;new ui;const oN=new E,aN=new E,lN=new E,cN=new E,uN=new E,hN=new E,dN=new E,fN=new E;class pN{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,t,i){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,t){return!(!(e.collisionFilterGroup&t.collisionFilterMask)||!(t.collisionFilterGroup&e.collisionFilterMask)||(e.type&Ue.STATIC||e.sleepState===Ue.SLEEPING)&&(t.type&Ue.STATIC||t.sleepState===Ue.SLEEPING))}intersectionTest(e,t,i,r){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,i,r):this.doBoundingSphereBroadphase(e,t,i,r)}doBoundingSphereBroadphase(e,t,i,r){const s=mN;t.position.vsub(e.position,s);const o=(e.boundingRadius+t.boundingRadius)**2;s.lengthSquared()<o&&(i.push(e),r.push(t))}doBoundingBoxBroadphase(e,t,i,r){e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.aabb.overlaps(t.aabb)&&(i.push(e),r.push(t))}makePairsUnique(e,t){const i=gN,r=vN,s=yN,o=e.length;for(let a=0;a!==o;a++)r[a]=e[a],s[a]=t[a];e.length=0,t.length=0;for(let a=0;a!==o;a++){const l=r[a].id,c=s[a].id,u=l<c?`${l},${c}`:`${c},${l}`;i[u]=a,i.keys.push(u)}for(let a=0;a!==i.keys.length;a++){const l=i.keys.pop(),c=i[l];e.push(r[c]),t.push(s[c]),delete i[l]}}setWorld(e){}static boundingSphereCheck(e,t){const i=new E;e.position.vsub(t.position,i);const r=e.shapes[0],s=t.shapes[0];return Math.pow(r.boundingSphereRadius+s.boundingSphereRadius,2)>i.lengthSquared()}aabbQuery(e,t,i){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const mN=new E;new E;new Ft;new E;const gN={keys:[]},vN=[],yN=[];new E;new E;new E;class _N extends pN{constructor(){super()}collisionPairs(e,t,i){const r=e.bodies,s=r.length;let o,a;for(let l=0;l!==s;l++)for(let c=0;c!==l;c++)o=r[l],a=r[c],this.needBroadphaseCollision(o,a)&&this.intersectionTest(o,a,t,i)}aabbQuery(e,t,i){i===void 0&&(i=[]);for(let r=0;r<e.bodies.length;r++){const s=e.bodies[r];s.aabbNeedsUpdate&&s.updateAABB(),s.aabb.overlaps(t)&&i.push(s)}return i}}class Yu{constructor(){this.rayFromWorld=new E,this.rayToWorld=new E,this.hitNormalWorld=new E,this.hitPointWorld=new E,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,i,r,s,o,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(i),this.hitPointWorld.copy(r),this.shape=s,this.body=o,this.distance=a}}let _M,xM,wM,SM,MM,AM,TM;const qm={CLOSEST:1,ANY:2,ALL:4};_M=ye.types.SPHERE;xM=ye.types.PLANE;wM=ye.types.BOX;SM=ye.types.CYLINDER;MM=ye.types.CONVEXPOLYHEDRON;AM=ye.types.HEIGHTFIELD;TM=ye.types.TRIMESH;class kt{get[_M](){return this._intersectSphere}get[xM](){return this._intersectPlane}get[wM](){return this._intersectBox}get[SM](){return this._intersectConvex}get[MM](){return this._intersectConvex}get[AM](){return this._intersectHeightfield}get[TM](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new E),t===void 0&&(t=new E),this.from=e.clone(),this.to=t.clone(),this.direction=new E,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=kt.ANY,this.result=new Yu,this.hasHit=!1,this.callback=i=>{}}intersectWorld(e,t){return this.mode=t.mode||kt.ANY,this.result=t.result||new Yu,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(U0),Kd.length=0,e.broadphase.aabbQuery(e,U0,Kd),this.intersectBodies(Kd),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const i=this.checkCollisionResponse;if(i&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const r=xN,s=wN;for(let o=0,a=e.shapes.length;o<a;o++){const l=e.shapes[o];if(!(i&&!l.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],s),e.quaternion.vmult(e.shapeOffsets[o],r),r.vadd(e.position,r),this.intersectShape(l,s,r,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let i=0,r=e.length;!this.result.shouldStop&&i<r;i++)this.intersectBody(e[i])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,i,r){const s=this.from;if(kN(s,this.direction,i)>e.boundingSphereRadius)return;const a=this[e.type];a&&a.call(this,e,t,i,r,e)}_intersectBox(e,t,i,r,s){return this._intersectConvex(e.convexPolyhedronRepresentation,t,i,r,s)}_intersectPlane(e,t,i,r,s){const o=this.from,a=this.to,l=this.direction,c=new E(0,0,1);t.vmult(c,c);const u=new E;o.vsub(i,u);const d=u.dot(c);a.vsub(i,u);const h=u.dot(c);if(d*h>0||o.distanceTo(a)<d)return;const f=c.dot(l);if(Math.abs(f)<this.precision)return;const m=new E,y=new E,g=new E;o.vsub(i,m);const p=-c.dot(m)/f;l.scale(p,y),o.vadd(y,g),this.reportIntersection(c,g,s,r,-1)}getAABB(e){const{lowerBound:t,upperBound:i}=e,r=this.to,s=this.from;t.x=Math.min(r.x,s.x),t.y=Math.min(r.y,s.y),t.z=Math.min(r.z,s.z),i.x=Math.max(r.x,s.x),i.y=Math.max(r.y,s.y),i.z=Math.max(r.z,s.z)}_intersectHeightfield(e,t,i,r,s){e.data,e.elementSize;const o=SN;o.from.copy(this.from),o.to.copy(this.to),tt.pointToLocalFrame(i,t,o.from,o.from),tt.pointToLocalFrame(i,t,o.to,o.to),o.updateDirection();const a=MN;let l,c,u,d;l=c=0,u=d=e.data.length-1;const h=new Vn;o.getAABB(h),e.getIndexOfPosition(h.lowerBound.x,h.lowerBound.y,a,!0),l=Math.max(l,a[0]),c=Math.max(c,a[1]),e.getIndexOfPosition(h.upperBound.x,h.upperBound.y,a,!0),u=Math.min(u,a[0]+1),d=Math.min(d,a[1]+1);for(let f=l;f<u;f++)for(let m=c;m<d;m++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(f,m,h),!!h.overlapsRay(o)){if(e.getConvexTrianglePillar(f,m,!1),tt.pointToWorldFrame(i,t,e.pillarOffset,Hc),this._intersectConvex(e.pillarConvex,t,Hc,r,s,O0),this.result.shouldStop)return;e.getConvexTrianglePillar(f,m,!0),tt.pointToWorldFrame(i,t,e.pillarOffset,Hc),this._intersectConvex(e.pillarConvex,t,Hc,r,s,O0)}}}_intersectSphere(e,t,i,r,s){const o=this.from,a=this.to,l=e.radius,c=(a.x-o.x)**2+(a.y-o.y)**2+(a.z-o.z)**2,u=2*((a.x-o.x)*(o.x-i.x)+(a.y-o.y)*(o.y-i.y)+(a.z-o.z)*(o.z-i.z)),d=(o.x-i.x)**2+(o.y-i.y)**2+(o.z-i.z)**2-l**2,h=u**2-4*c*d,f=AN,m=TN;if(!(h<0))if(h===0)o.lerp(a,h,f),f.vsub(i,m),m.normalize(),this.reportIntersection(m,f,s,r,-1);else{const y=(-u-Math.sqrt(h))/(2*c),g=(-u+Math.sqrt(h))/(2*c);if(y>=0&&y<=1&&(o.lerp(a,y,f),f.vsub(i,m),m.normalize(),this.reportIntersection(m,f,s,r,-1)),this.result.shouldStop)return;g>=0&&g<=1&&(o.lerp(a,g,f),f.vsub(i,m),m.normalize(),this.reportIntersection(m,f,s,r,-1))}}_intersectConvex(e,t,i,r,s,o){const a=EN,l=B0,c=o&&o.faceList||null,u=e.faces,d=e.vertices,h=e.faceNormals,f=this.direction,m=this.from,y=this.to,g=m.distanceTo(y),p=c?c.length:u.length,v=this.result;for(let _=0;!v.shouldStop&&_<p;_++){const x=c?c[_]:_,A=u[x],M=h[x],S=t,b=i;l.copy(d[A[0]]),S.vmult(l,l),l.vadd(b,l),l.vsub(m,l),S.vmult(M,a);const T=f.dot(a);if(Math.abs(T)<this.precision)continue;const w=a.dot(l)/T;if(!(w<0)){f.scale(w,Sn),Sn.vadd(m,Sn),ii.copy(d[A[0]]),S.vmult(ii,ii),b.vadd(ii,ii);for(let P=1;!v.shouldStop&&P<A.length-1;P++){xi.copy(d[A[P]]),wi.copy(d[A[P+1]]),S.vmult(xi,xi),S.vmult(wi,wi),b.vadd(xi,xi),b.vadd(wi,wi);const V=Sn.distanceTo(m);!(kt.pointInTriangle(Sn,ii,xi,wi)||kt.pointInTriangle(Sn,xi,ii,wi))||V>g||this.reportIntersection(a,Sn,s,r,x)}}}}_intersectTrimesh(e,t,i,r,s,o){const a=bN,l=DN,c=NN,u=B0,d=CN,h=RN,f=PN,m=IN,y=LN,g=e.indices;e.vertices;const p=this.from,v=this.to,_=this.direction;c.position.copy(i),c.quaternion.copy(t),tt.vectorToLocalFrame(i,t,_,d),tt.pointToLocalFrame(i,t,p,h),tt.pointToLocalFrame(i,t,v,f),f.x*=e.scale.x,f.y*=e.scale.y,f.z*=e.scale.z,h.x*=e.scale.x,h.y*=e.scale.y,h.z*=e.scale.z,f.vsub(h,d),d.normalize();const x=h.distanceSquared(f);e.tree.rayQuery(this,c,l);for(let A=0,M=l.length;!this.result.shouldStop&&A!==M;A++){const S=l[A];e.getNormal(S,a),e.getVertex(g[S*3],ii),ii.vsub(h,u);const b=d.dot(a),T=a.dot(u)/b;if(T<0)continue;d.scale(T,Sn),Sn.vadd(h,Sn),e.getVertex(g[S*3+1],xi),e.getVertex(g[S*3+2],wi);const w=Sn.distanceSquared(h);!(kt.pointInTriangle(Sn,xi,ii,wi)||kt.pointInTriangle(Sn,ii,xi,wi))||w>x||(tt.vectorToWorldFrame(t,a,y),tt.pointToWorldFrame(i,t,Sn,m),this.reportIntersection(y,m,s,r,S))}l.length=0}reportIntersection(e,t,i,r,s){const o=this.from,a=this.to,l=o.distanceTo(t),c=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(c.hitFaceIndex=typeof s<"u"?s:-1,this.mode){case kt.ALL:this.hasHit=!0,c.set(o,a,e,t,i,r,l),c.hasHit=!0,this.callback(c);break;case kt.CLOSEST:(l<c.distance||!c.hasHit)&&(this.hasHit=!0,c.hasHit=!0,c.set(o,a,e,t,i,r,l));break;case kt.ANY:this.hasHit=!0,c.hasHit=!0,c.set(o,a,e,t,i,r,l),c.shouldStop=!0;break}}static pointInTriangle(e,t,i,r){r.vsub(t,Ms),i.vsub(t,Da),e.vsub(t,Yd);const s=Ms.dot(Ms),o=Ms.dot(Da),a=Ms.dot(Yd),l=Da.dot(Da),c=Da.dot(Yd);let u,d;return(u=l*a-o*c)>=0&&(d=s*c-o*a)>=0&&u+d<s*l-o*o}}kt.CLOSEST=qm.CLOSEST;kt.ANY=qm.ANY;kt.ALL=qm.ALL;const U0=new Vn,Kd=[],Da=new E,Yd=new E,xN=new E,wN=new Ft,Sn=new E,ii=new E,xi=new E,wi=new E;new E;new Yu;const O0={faceList:[0]},Hc=new E,SN=new kt,MN=[],AN=new E,TN=new E,EN=new E;new E;new E;const B0=new E,bN=new E,CN=new E,RN=new E,PN=new E,LN=new E,IN=new E;new Vn;const DN=[],NN=new tt,Ms=new E,Gc=new E;function kN(n,e,t){t.vsub(n,Ms);const i=Ms.dot(e);return e.scale(i,Gc),Gc.vadd(n,Gc),t.distanceTo(Gc)}class FN{static defaults(e,t){e===void 0&&(e={});for(let i in t)i in e||(e[i]=t[i]);return e}}class z0{constructor(){this.spatial=new E,this.rotational=new E}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}}class Gl{constructor(e,t,i,r){i===void 0&&(i=-1e6),r===void 0&&(r=1e6),this.id=Gl.idCounter++,this.minForce=i,this.maxForce=r,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new z0,this.jacobianElementB=new z0,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,t,i){const r=t,s=e,o=i;this.a=4/(o*(1+4*r)),this.b=4*r/(1+4*r),this.eps=4/(o*o*s*(1+4*r))}computeB(e,t,i){const r=this.computeGW(),s=this.computeGq(),o=this.computeGiMf();return-s*e-r*t-o*i}computeGq(){const e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,r=this.bj,s=i.position,o=r.position;return e.spatial.dot(s)+t.spatial.dot(o)}computeGW(){const e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,r=this.bj,s=i.velocity,o=r.velocity,a=i.angularVelocity,l=r.angularVelocity;return e.multiplyVectors(s,a)+t.multiplyVectors(o,l)}computeGWlambda(){const e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,r=this.bj,s=i.vlambda,o=r.vlambda,a=i.wlambda,l=r.wlambda;return e.multiplyVectors(s,a)+t.multiplyVectors(o,l)}computeGiMf(){const e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,r=this.bj,s=i.force,o=i.torque,a=r.force,l=r.torque,c=i.invMassSolve,u=r.invMassSolve;return s.scale(c,V0),a.scale(u,H0),i.invInertiaWorldSolve.vmult(o,G0),r.invInertiaWorldSolve.vmult(l,W0),e.multiplyVectors(V0,G0)+t.multiplyVectors(H0,W0)}computeGiMGt(){const e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,r=this.bj,s=i.invMassSolve,o=r.invMassSolve,a=i.invInertiaWorldSolve,l=r.invInertiaWorldSolve;let c=s+o;return a.vmult(e.rotational,Wc),c+=Wc.dot(e.rotational),l.vmult(t.rotational,Wc),c+=Wc.dot(t.rotational),c}addToWlambda(e){const t=this.jacobianElementA,i=this.jacobianElementB,r=this.bi,s=this.bj,o=UN;r.vlambda.addScaledVector(r.invMassSolve*e,t.spatial,r.vlambda),s.vlambda.addScaledVector(s.invMassSolve*e,i.spatial,s.vlambda),r.invInertiaWorldSolve.vmult(t.rotational,o),r.wlambda.addScaledVector(e,o,r.wlambda),s.invInertiaWorldSolve.vmult(i.rotational,o),s.wlambda.addScaledVector(e,o,s.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}Gl.idCounter=0;const V0=new E,H0=new E,G0=new E,W0=new E,Wc=new E,UN=new E;class ON extends Gl{constructor(e,t,i){i===void 0&&(i=1e6),super(e,t,0,i),this.restitution=0,this.ri=new E,this.rj=new E,this.ni=new E}computeB(e){const t=this.a,i=this.b,r=this.bi,s=this.bj,o=this.ri,a=this.rj,l=BN,c=zN,u=r.velocity,d=r.angularVelocity;r.force,r.torque;const h=s.velocity,f=s.angularVelocity;s.force,s.torque;const m=VN,y=this.jacobianElementA,g=this.jacobianElementB,p=this.ni;o.cross(p,l),a.cross(p,c),p.negate(y.spatial),l.negate(y.rotational),g.spatial.copy(p),g.rotational.copy(c),m.copy(s.position),m.vadd(a,m),m.vsub(r.position,m),m.vsub(o,m);const v=p.dot(m),_=this.restitution+1,x=_*h.dot(p)-_*u.dot(p)+f.dot(c)-d.dot(l),A=this.computeGiMf();return-v*t-x*i-e*A}getImpactVelocityAlongNormal(){const e=HN,t=GN,i=WN,r=jN,s=XN;return this.bi.position.vadd(this.ri,i),this.bj.position.vadd(this.rj,r),this.bi.getVelocityAtWorldPoint(i,e),this.bj.getVelocityAtWorldPoint(r,t),e.vsub(t,s),this.ni.dot(s)}}const BN=new E,zN=new E,VN=new E,HN=new E,GN=new E,WN=new E,jN=new E,XN=new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;class j0 extends Gl{constructor(e,t,i){super(e,t,-i,i),this.ri=new E,this.rj=new E,this.t=new E}computeB(e){this.a;const t=this.b;this.bi,this.bj;const i=this.ri,r=this.rj,s=qN,o=KN,a=this.t;i.cross(a,s),r.cross(a,o);const l=this.jacobianElementA,c=this.jacobianElementB;a.negate(l.spatial),s.negate(l.rotational),c.spatial.copy(a),c.rotational.copy(o);const u=this.computeGW(),d=this.computeGiMf();return-u*t-e*d}}const qN=new E,KN=new E;class Ah{constructor(e,t,i){i=FN.defaults(i,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=Ah.idCounter++,this.materials=[e,t],this.friction=i.friction,this.restitution=i.restitution,this.contactEquationStiffness=i.contactEquationStiffness,this.contactEquationRelaxation=i.contactEquationRelaxation,this.frictionEquationStiffness=i.frictionEquationStiffness,this.frictionEquationRelaxation=i.frictionEquationRelaxation}}Ah.idCounter=0;class Th{constructor(e){e===void 0&&(e={});let t="";typeof e=="string"&&(t=e,e={}),this.name=t,this.id=Th.idCounter++,this.friction=typeof e.friction<"u"?e.friction:-1,this.restitution=typeof e.restitution<"u"?e.restitution:-1}}Th.idCounter=0;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new kt;new E;new E;new E;new E(1,0,0),new E(0,1,0),new E(0,0,1);new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;class X0 extends ye{constructor(){super({type:ye.types.PLANE}),this.worldNormal=new E,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(e){const t=this.worldNormal;t.set(0,0,1),e.vmult(t,t),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(e,t){return t===void 0&&(t=new E),t}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,t,i,r){ji.set(0,0,1),t.vmult(ji,ji);const s=Number.MAX_VALUE;i.set(-s,-s,-s),r.set(s,s,s),ji.x===1?r.x=e.x:ji.x===-1&&(i.x=e.x),ji.y===1?r.y=e.y:ji.y===-1&&(i.y=e.y),ji.z===1?r.z=e.z:ji.z===-1&&(i.z=e.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const ji=new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new E;new Vn;new E;new Vn;new E;new E;new E;new E;new E;new E;new E;new Vn;new E;new tt;new Vn;class YN{constructor(){this.equations=[]}solve(e,t){return 0}addEquation(e){e.enabled&&!e.bi.isTrigger&&!e.bj.isTrigger&&this.equations.push(e)}removeEquation(e){const t=this.equations,i=t.indexOf(e);i!==-1&&t.splice(i,1)}removeAllEquations(){this.equations.length=0}}class $N extends YN{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(e,t){let i=0;const r=this.iterations,s=this.tolerance*this.tolerance,o=this.equations,a=o.length,l=t.bodies,c=l.length,u=e;let d,h,f,m,y,g;if(a!==0)for(let x=0;x!==c;x++)l[x].updateSolveMassProperties();const p=QN,v=JN,_=ZN;p.length=a,v.length=a,_.length=a;for(let x=0;x!==a;x++){const A=o[x];_[x]=0,v[x]=A.computeB(u),p[x]=1/A.computeC()}if(a!==0){for(let M=0;M!==c;M++){const S=l[M],b=S.vlambda,T=S.wlambda;b.set(0,0,0),T.set(0,0,0)}for(i=0;i!==r;i++){m=0;for(let M=0;M!==a;M++){const S=o[M];d=v[M],h=p[M],g=_[M],y=S.computeGWlambda(),f=h*(d-y-S.eps*g),g+f<S.minForce?f=S.minForce-g:g+f>S.maxForce&&(f=S.maxForce-g),_[M]+=f,m+=f>0?f:-f,S.addToWlambda(f)}if(m*m<s)break}for(let M=0;M!==c;M++){const S=l[M],b=S.velocity,T=S.angularVelocity;S.vlambda.vmul(S.linearFactor,S.vlambda),b.vadd(S.vlambda,b),S.wlambda.vmul(S.angularFactor,S.wlambda),T.vadd(S.wlambda,T)}let x=o.length;const A=1/u;for(;x--;)o[x].multiplier=_[x]*A}return i}}const ZN=[],QN=[],JN=[];Ue.STATIC;class e2{constructor(){this.objects=[],this.type=Object}release(){const e=arguments.length;for(let t=0;t!==e;t++)this.objects.push(t<0||arguments.length<=t?void 0:arguments[t]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){const t=this.objects;for(;t.length>e;)t.pop();for(;t.length<e;)t.push(this.constructObject());return this}}class t2 extends e2{constructor(){super(...arguments),this.type=E}constructObject(){return new E}}const ft={sphereSphere:ye.types.SPHERE,spherePlane:ye.types.SPHERE|ye.types.PLANE,boxBox:ye.types.BOX|ye.types.BOX,sphereBox:ye.types.SPHERE|ye.types.BOX,planeBox:ye.types.PLANE|ye.types.BOX,convexConvex:ye.types.CONVEXPOLYHEDRON,sphereConvex:ye.types.SPHERE|ye.types.CONVEXPOLYHEDRON,planeConvex:ye.types.PLANE|ye.types.CONVEXPOLYHEDRON,boxConvex:ye.types.BOX|ye.types.CONVEXPOLYHEDRON,sphereHeightfield:ye.types.SPHERE|ye.types.HEIGHTFIELD,boxHeightfield:ye.types.BOX|ye.types.HEIGHTFIELD,convexHeightfield:ye.types.CONVEXPOLYHEDRON|ye.types.HEIGHTFIELD,sphereParticle:ye.types.PARTICLE|ye.types.SPHERE,planeParticle:ye.types.PLANE|ye.types.PARTICLE,boxParticle:ye.types.BOX|ye.types.PARTICLE,convexParticle:ye.types.PARTICLE|ye.types.CONVEXPOLYHEDRON,cylinderCylinder:ye.types.CYLINDER,sphereCylinder:ye.types.SPHERE|ye.types.CYLINDER,planeCylinder:ye.types.PLANE|ye.types.CYLINDER,boxCylinder:ye.types.BOX|ye.types.CYLINDER,convexCylinder:ye.types.CONVEXPOLYHEDRON|ye.types.CYLINDER,heightfieldCylinder:ye.types.HEIGHTFIELD|ye.types.CYLINDER,particleCylinder:ye.types.PARTICLE|ye.types.CYLINDER,sphereTrimesh:ye.types.SPHERE|ye.types.TRIMESH,planeTrimesh:ye.types.PLANE|ye.types.TRIMESH};class n2{get[ft.sphereSphere](){return this.sphereSphere}get[ft.spherePlane](){return this.spherePlane}get[ft.boxBox](){return this.boxBox}get[ft.sphereBox](){return this.sphereBox}get[ft.planeBox](){return this.planeBox}get[ft.convexConvex](){return this.convexConvex}get[ft.sphereConvex](){return this.sphereConvex}get[ft.planeConvex](){return this.planeConvex}get[ft.boxConvex](){return this.boxConvex}get[ft.sphereHeightfield](){return this.sphereHeightfield}get[ft.boxHeightfield](){return this.boxHeightfield}get[ft.convexHeightfield](){return this.convexHeightfield}get[ft.sphereParticle](){return this.sphereParticle}get[ft.planeParticle](){return this.planeParticle}get[ft.boxParticle](){return this.boxParticle}get[ft.convexParticle](){return this.convexParticle}get[ft.cylinderCylinder](){return this.convexConvex}get[ft.sphereCylinder](){return this.sphereConvex}get[ft.planeCylinder](){return this.planeConvex}get[ft.boxCylinder](){return this.boxConvex}get[ft.convexCylinder](){return this.convexConvex}get[ft.heightfieldCylinder](){return this.heightfieldCylinder}get[ft.particleCylinder](){return this.particleCylinder}get[ft.sphereTrimesh](){return this.sphereTrimesh}get[ft.planeTrimesh](){return this.planeTrimesh}constructor(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new t2,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,t,i,r,s,o){let a;this.contactPointPool.length?(a=this.contactPointPool.pop(),a.bi=e,a.bj=t):a=new ON(e,t),a.enabled=e.collisionResponse&&t.collisionResponse&&i.collisionResponse&&r.collisionResponse;const l=this.currentContactMaterial;a.restitution=l.restitution,a.setSpookParams(l.contactEquationStiffness,l.contactEquationRelaxation,this.world.dt);const c=i.material||e.material,u=r.material||t.material;return c&&u&&c.restitution>=0&&u.restitution>=0&&(a.restitution=c.restitution*u.restitution),a.si=s||i,a.sj=o||r,a}createFrictionEquationsFromContact(e,t){const i=e.bi,r=e.bj,s=e.si,o=e.sj,a=this.world,l=this.currentContactMaterial;let c=l.friction;const u=s.material||i.material,d=o.material||r.material;if(u&&d&&u.friction>=0&&d.friction>=0&&(c=u.friction*d.friction),c>0){const h=c*(a.frictionGravity||a.gravity).length();let f=i.invMass+r.invMass;f>0&&(f=1/f);const m=this.frictionEquationPool,y=m.length?m.pop():new j0(i,r,h*f),g=m.length?m.pop():new j0(i,r,h*f);return y.bi=g.bi=i,y.bj=g.bj=r,y.minForce=g.minForce=-h*f,y.maxForce=g.maxForce=h*f,y.ri.copy(e.ri),y.rj.copy(e.rj),g.ri.copy(e.ri),g.rj.copy(e.rj),e.ni.tangents(y.t,g.t),y.setSpookParams(l.frictionEquationStiffness,l.frictionEquationRelaxation,a.dt),g.setSpookParams(l.frictionEquationStiffness,l.frictionEquationRelaxation,a.dt),y.enabled=g.enabled=e.enabled,t.push(y,g),!0}return!1}createFrictionFromAverage(e){let t=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(t,this.frictionResult)||e===1)return;const i=this.frictionResult[this.frictionResult.length-2],r=this.frictionResult[this.frictionResult.length-1];ds.setZero(),ao.setZero(),lo.setZero();const s=t.bi;t.bj;for(let a=0;a!==e;a++)t=this.result[this.result.length-1-a],t.bi!==s?(ds.vadd(t.ni,ds),ao.vadd(t.ri,ao),lo.vadd(t.rj,lo)):(ds.vsub(t.ni,ds),ao.vadd(t.rj,ao),lo.vadd(t.ri,lo));const o=1/e;ao.scale(o,i.ri),lo.scale(o,i.rj),r.ri.copy(i.ri),r.rj.copy(i.rj),ds.normalize(),ds.tangents(i.t,r.t)}getContacts(e,t,i,r,s,o,a){this.contactPointPool=s,this.frictionEquationPool=a,this.result=r,this.frictionResult=o;const l=s2,c=o2,u=i2,d=r2;for(let h=0,f=e.length;h!==f;h++){const m=e[h],y=t[h];let g=null;m.material&&y.material&&(g=i.getContactMaterial(m.material,y.material)||null);const p=m.type&Ue.KINEMATIC&&y.type&Ue.STATIC||m.type&Ue.STATIC&&y.type&Ue.KINEMATIC||m.type&Ue.KINEMATIC&&y.type&Ue.KINEMATIC;for(let v=0;v<m.shapes.length;v++){m.quaternion.mult(m.shapeOrientations[v],l),m.quaternion.vmult(m.shapeOffsets[v],u),u.vadd(m.position,u);const _=m.shapes[v];for(let x=0;x<y.shapes.length;x++){y.quaternion.mult(y.shapeOrientations[x],c),y.quaternion.vmult(y.shapeOffsets[x],d),d.vadd(y.position,d);const A=y.shapes[x];if(!(_.collisionFilterMask&A.collisionFilterGroup&&A.collisionFilterMask&_.collisionFilterGroup)||u.distanceTo(d)>_.boundingSphereRadius+A.boundingSphereRadius)continue;let M=null;_.material&&A.material&&(M=i.getContactMaterial(_.material,A.material)||null),this.currentContactMaterial=M||g||i.defaultContactMaterial;const S=_.type|A.type,b=this[S];if(b){let T=!1;_.type<A.type?T=b.call(this,_,A,u,d,l,c,m,y,_,A,p):T=b.call(this,A,_,d,u,c,l,y,m,_,A,p),T&&p&&(i.shapeOverlapKeeper.set(_.id,A.id),i.bodyOverlapKeeper.set(m.id,y.id))}}}}}sphereSphere(e,t,i,r,s,o,a,l,c,u,d){if(d)return i.distanceSquared(r)<(e.radius+t.radius)**2;const h=this.createContactEquation(a,l,e,t,c,u);r.vsub(i,h.ni),h.ni.normalize(),h.ri.copy(h.ni),h.rj.copy(h.ni),h.ri.scale(e.radius,h.ri),h.rj.scale(-t.radius,h.rj),h.ri.vadd(i,h.ri),h.ri.vsub(a.position,h.ri),h.rj.vadd(r,h.rj),h.rj.vsub(l.position,h.rj),this.result.push(h),this.createFrictionEquationsFromContact(h,this.frictionResult)}spherePlane(e,t,i,r,s,o,a,l,c,u,d){const h=this.createContactEquation(a,l,e,t,c,u);if(h.ni.set(0,0,1),o.vmult(h.ni,h.ni),h.ni.negate(h.ni),h.ni.normalize(),h.ni.scale(e.radius,h.ri),i.vsub(r,jc),h.ni.scale(h.ni.dot(jc),q0),jc.vsub(q0,h.rj),-jc.dot(h.ni)<=e.radius){if(d)return!0;const f=h.ri,m=h.rj;f.vadd(i,f),f.vsub(a.position,f),m.vadd(r,m),m.vsub(l.position,m),this.result.push(h),this.createFrictionEquationsFromContact(h,this.frictionResult)}}boxBox(e,t,i,r,s,o,a,l,c,u,d){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,i,r,s,o,a,l,e,t,d)}sphereBox(e,t,i,r,s,o,a,l,c,u,d){const h=this.v3pool,f=I2;i.vsub(r,Xc),t.getSideNormals(f,o);const m=e.radius;let y=!1;const g=N2,p=k2,v=F2;let _=null,x=0,A=0,M=0,S=null;for(let N=0,G=f.length;N!==G&&y===!1;N++){const L=R2;L.copy(f[N]);const j=L.length();L.normalize();const Y=Xc.dot(L);if(Y<j+m&&Y>0){const ee=P2,Q=L2;ee.copy(f[(N+1)%3]),Q.copy(f[(N+2)%3]);const De=ee.length(),K=Q.length();ee.normalize(),Q.normalize();const ne=Xc.dot(ee),he=Xc.dot(Q);if(ne<De&&ne>-De&&he<K&&he>-K){const ce=Math.abs(Y-j-m);if((S===null||ce<S)&&(S=ce,A=ne,M=he,_=j,g.copy(L),p.copy(ee),v.copy(Q),x++,d))return!0}}}if(x){y=!0;const N=this.createContactEquation(a,l,e,t,c,u);g.scale(-m,N.ri),N.ni.copy(g),N.ni.negate(N.ni),g.scale(_,g),p.scale(A,p),g.vadd(p,g),v.scale(M,v),g.vadd(v,N.rj),N.ri.vadd(i,N.ri),N.ri.vsub(a.position,N.ri),N.rj.vadd(r,N.rj),N.rj.vsub(l.position,N.rj),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult)}let b=h.get();const T=D2;for(let N=0;N!==2&&!y;N++)for(let G=0;G!==2&&!y;G++)for(let L=0;L!==2&&!y;L++)if(b.set(0,0,0),N?b.vadd(f[0],b):b.vsub(f[0],b),G?b.vadd(f[1],b):b.vsub(f[1],b),L?b.vadd(f[2],b):b.vsub(f[2],b),r.vadd(b,T),T.vsub(i,T),T.lengthSquared()<m*m){if(d)return!0;y=!0;const j=this.createContactEquation(a,l,e,t,c,u);j.ri.copy(T),j.ri.normalize(),j.ni.copy(j.ri),j.ri.scale(m,j.ri),j.rj.copy(b),j.ri.vadd(i,j.ri),j.ri.vsub(a.position,j.ri),j.rj.vadd(r,j.rj),j.rj.vsub(l.position,j.rj),this.result.push(j),this.createFrictionEquationsFromContact(j,this.frictionResult)}h.release(b),b=null;const w=h.get(),P=h.get(),V=h.get(),I=h.get(),O=h.get(),F=f.length;for(let N=0;N!==F&&!y;N++)for(let G=0;G!==F&&!y;G++)if(N%3!==G%3){f[G].cross(f[N],w),w.normalize(),f[N].vadd(f[G],P),V.copy(i),V.vsub(P,V),V.vsub(r,V);const L=V.dot(w);w.scale(L,I);let j=0;for(;j===N%3||j===G%3;)j++;O.copy(i),O.vsub(I,O),O.vsub(P,O),O.vsub(r,O);const Y=Math.abs(L),ee=O.length();if(Y<f[j].length()&&ee<m){if(d)return!0;y=!0;const Q=this.createContactEquation(a,l,e,t,c,u);P.vadd(I,Q.rj),Q.rj.copy(Q.rj),O.negate(Q.ni),Q.ni.normalize(),Q.ri.copy(Q.rj),Q.ri.vadd(r,Q.ri),Q.ri.vsub(i,Q.ri),Q.ri.normalize(),Q.ri.scale(m,Q.ri),Q.ri.vadd(i,Q.ri),Q.ri.vsub(a.position,Q.ri),Q.rj.vadd(r,Q.rj),Q.rj.vsub(l.position,Q.rj),this.result.push(Q),this.createFrictionEquationsFromContact(Q,this.frictionResult)}}h.release(w,P,V,I,O)}planeBox(e,t,i,r,s,o,a,l,c,u,d){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,i,r,s,o,a,l,e,t,d)}convexConvex(e,t,i,r,s,o,a,l,c,u,d,h,f){const m=Z2;if(!(i.distanceTo(r)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,i,s,r,o,m,h,f)){const y=[],g=Q2;e.clipAgainstHull(i,s,t,r,o,m,-100,100,y);let p=0;for(let v=0;v!==y.length;v++){if(d)return!0;const _=this.createContactEquation(a,l,e,t,c,u),x=_.ri,A=_.rj;m.negate(_.ni),y[v].normal.negate(g),g.scale(y[v].depth,g),y[v].point.vadd(g,x),A.copy(y[v].point),x.vsub(i,x),A.vsub(r,A),x.vadd(i,x),x.vsub(a.position,x),A.vadd(r,A),A.vsub(l.position,A),this.result.push(_),p++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(_,this.frictionResult)}this.enableFrictionReduction&&p&&this.createFrictionFromAverage(p)}}sphereConvex(e,t,i,r,s,o,a,l,c,u,d){const h=this.v3pool;i.vsub(r,U2);const f=t.faceNormals,m=t.faces,y=t.vertices,g=e.radius;let p=!1;for(let v=0;v!==y.length;v++){const _=y[v],x=V2;o.vmult(_,x),r.vadd(x,x);const A=z2;if(x.vsub(i,A),A.lengthSquared()<g*g){if(d)return!0;p=!0;const M=this.createContactEquation(a,l,e,t,c,u);M.ri.copy(A),M.ri.normalize(),M.ni.copy(M.ri),M.ri.scale(g,M.ri),x.vsub(r,M.rj),M.ri.vadd(i,M.ri),M.ri.vsub(a.position,M.ri),M.rj.vadd(r,M.rj),M.rj.vsub(l.position,M.rj),this.result.push(M),this.createFrictionEquationsFromContact(M,this.frictionResult);return}}for(let v=0,_=m.length;v!==_&&p===!1;v++){const x=f[v],A=m[v],M=H2;o.vmult(x,M);const S=G2;o.vmult(y[A[0]],S),S.vadd(r,S);const b=W2;M.scale(-g,b),i.vadd(b,b);const T=j2;b.vsub(S,T);const w=T.dot(M),P=X2;if(i.vsub(S,P),w<0&&P.dot(M)>0){const V=[];for(let I=0,O=A.length;I!==O;I++){const F=h.get();o.vmult(y[A[I]],F),r.vadd(F,F),V.push(F)}if(C2(V,M,i)){if(d)return!0;p=!0;const I=this.createContactEquation(a,l,e,t,c,u);M.scale(-g,I.ri),M.negate(I.ni);const O=h.get();M.scale(-w,O);const F=h.get();M.scale(-g,F),i.vsub(r,I.rj),I.rj.vadd(F,I.rj),I.rj.vadd(O,I.rj),I.rj.vadd(r,I.rj),I.rj.vsub(l.position,I.rj),I.ri.vadd(i,I.ri),I.ri.vsub(a.position,I.ri),h.release(O),h.release(F),this.result.push(I),this.createFrictionEquationsFromContact(I,this.frictionResult);for(let N=0,G=V.length;N!==G;N++)h.release(V[N]);return}else for(let I=0;I!==A.length;I++){const O=h.get(),F=h.get();o.vmult(y[A[(I+1)%A.length]],O),o.vmult(y[A[(I+2)%A.length]],F),r.vadd(O,O),r.vadd(F,F);const N=O2;F.vsub(O,N);const G=B2;N.unit(G);const L=h.get(),j=h.get();i.vsub(O,j);const Y=j.dot(G);G.scale(Y,L),L.vadd(O,L);const ee=h.get();if(L.vsub(i,ee),Y>0&&Y*Y<N.lengthSquared()&&ee.lengthSquared()<g*g){if(d)return!0;const Q=this.createContactEquation(a,l,e,t,c,u);L.vsub(r,Q.rj),L.vsub(i,Q.ni),Q.ni.normalize(),Q.ni.scale(g,Q.ri),Q.rj.vadd(r,Q.rj),Q.rj.vsub(l.position,Q.rj),Q.ri.vadd(i,Q.ri),Q.ri.vsub(a.position,Q.ri),this.result.push(Q),this.createFrictionEquationsFromContact(Q,this.frictionResult);for(let De=0,K=V.length;De!==K;De++)h.release(V[De]);h.release(O),h.release(F),h.release(L),h.release(ee),h.release(j);return}h.release(O),h.release(F),h.release(L),h.release(ee),h.release(j)}for(let I=0,O=V.length;I!==O;I++)h.release(V[I])}}}planeConvex(e,t,i,r,s,o,a,l,c,u,d){const h=q2,f=K2;f.set(0,0,1),s.vmult(f,f);let m=0;const y=Y2;for(let g=0;g!==t.vertices.length;g++)if(h.copy(t.vertices[g]),o.vmult(h,h),r.vadd(h,h),h.vsub(i,y),f.dot(y)<=0){if(d)return!0;const v=this.createContactEquation(a,l,e,t,c,u),_=$2;f.scale(f.dot(y),_),h.vsub(_,_),_.vsub(i,v.ri),v.ni.copy(f),h.vsub(r,v.rj),v.ri.vadd(i,v.ri),v.ri.vsub(a.position,v.ri),v.rj.vadd(r,v.rj),v.rj.vsub(l.position,v.rj),this.result.push(v),m++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(v,this.frictionResult)}this.enableFrictionReduction&&m&&this.createFrictionFromAverage(m)}boxConvex(e,t,i,r,s,o,a,l,c,u,d){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,i,r,s,o,a,l,e,t,d)}sphereHeightfield(e,t,i,r,s,o,a,l,c,u,d){const h=t.data,f=e.radius,m=t.elementSize,y=uk,g=ck;tt.pointToLocalFrame(r,o,i,g);let p=Math.floor((g.x-f)/m)-1,v=Math.ceil((g.x+f)/m)+1,_=Math.floor((g.y-f)/m)-1,x=Math.ceil((g.y+f)/m)+1;if(v<0||x<0||p>h.length||_>h[0].length)return;p<0&&(p=0),v<0&&(v=0),_<0&&(_=0),x<0&&(x=0),p>=h.length&&(p=h.length-1),v>=h.length&&(v=h.length-1),x>=h[0].length&&(x=h[0].length-1),_>=h[0].length&&(_=h[0].length-1);const A=[];t.getRectMinMax(p,_,v,x,A);const M=A[0],S=A[1];if(g.z-f>S||g.z+f<M)return;const b=this.result;for(let T=p;T<v;T++)for(let w=_;w<x;w++){const P=b.length;let V=!1;if(t.getConvexTrianglePillar(T,w,!1),tt.pointToWorldFrame(r,o,t.pillarOffset,y),i.distanceTo(y)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(V=this.sphereConvex(e,t.pillarConvex,i,y,s,o,a,l,e,t,d)),d&&V||(t.getConvexTrianglePillar(T,w,!0),tt.pointToWorldFrame(r,o,t.pillarOffset,y),i.distanceTo(y)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(V=this.sphereConvex(e,t.pillarConvex,i,y,s,o,a,l,e,t,d)),d&&V))return!0;if(b.length-P>2)return}}boxHeightfield(e,t,i,r,s,o,a,l,c,u,d){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,i,r,s,o,a,l,e,t,d)}convexHeightfield(e,t,i,r,s,o,a,l,c,u,d){const h=t.data,f=t.elementSize,m=e.boundingSphereRadius,y=ak,g=lk,p=ok;tt.pointToLocalFrame(r,o,i,p);let v=Math.floor((p.x-m)/f)-1,_=Math.ceil((p.x+m)/f)+1,x=Math.floor((p.y-m)/f)-1,A=Math.ceil((p.y+m)/f)+1;if(_<0||A<0||v>h.length||x>h[0].length)return;v<0&&(v=0),_<0&&(_=0),x<0&&(x=0),A<0&&(A=0),v>=h.length&&(v=h.length-1),_>=h.length&&(_=h.length-1),A>=h[0].length&&(A=h[0].length-1),x>=h[0].length&&(x=h[0].length-1);const M=[];t.getRectMinMax(v,x,_,A,M);const S=M[0],b=M[1];if(!(p.z-m>b||p.z+m<S))for(let T=v;T<_;T++)for(let w=x;w<A;w++){let P=!1;if(t.getConvexTrianglePillar(T,w,!1),tt.pointToWorldFrame(r,o,t.pillarOffset,y),i.distanceTo(y)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(P=this.convexConvex(e,t.pillarConvex,i,y,s,o,a,l,null,null,d,g,null)),d&&P||(t.getConvexTrianglePillar(T,w,!0),tt.pointToWorldFrame(r,o,t.pillarOffset,y),i.distanceTo(y)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(P=this.convexConvex(e,t.pillarConvex,i,y,s,o,a,l,null,null,d,g,null)),d&&P))return!0}}sphereParticle(e,t,i,r,s,o,a,l,c,u,d){const h=nk;if(h.set(0,0,1),r.vsub(i,h),h.lengthSquared()<=e.radius*e.radius){if(d)return!0;const m=this.createContactEquation(l,a,t,e,c,u);h.normalize(),m.rj.copy(h),m.rj.scale(e.radius,m.rj),m.ni.copy(h),m.ni.negate(m.ni),m.ri.set(0,0,0),this.result.push(m),this.createFrictionEquationsFromContact(m,this.frictionResult)}}planeParticle(e,t,i,r,s,o,a,l,c,u,d){const h=J2;h.set(0,0,1),a.quaternion.vmult(h,h);const f=ek;if(r.vsub(a.position,f),h.dot(f)<=0){if(d)return!0;const y=this.createContactEquation(l,a,t,e,c,u);y.ni.copy(h),y.ni.negate(y.ni),y.ri.set(0,0,0);const g=tk;h.scale(h.dot(r),g),r.vsub(g,g),y.rj.copy(g),this.result.push(y),this.createFrictionEquationsFromContact(y,this.frictionResult)}}boxParticle(e,t,i,r,s,o,a,l,c,u,d){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,i,r,s,o,a,l,e,t,d)}convexParticle(e,t,i,r,s,o,a,l,c,u,d){let h=-1;const f=rk,m=sk;let y=null;const g=ik;if(g.copy(r),g.vsub(i,g),s.conjugate(K0),K0.vmult(g,g),e.pointIsInside(g)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(i,s),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(s);for(let p=0,v=e.faces.length;p!==v;p++){const _=[e.worldVertices[e.faces[p][0]]],x=e.worldFaceNormals[p];r.vsub(_[0],Y0);const A=-x.dot(Y0);if(y===null||Math.abs(A)<Math.abs(y)){if(d)return!0;y=A,h=p,f.copy(x)}}if(h!==-1){const p=this.createContactEquation(l,a,t,e,c,u);f.scale(y,m),m.vadd(r,m),m.vsub(i,m),p.rj.copy(m),f.negate(p.ni),p.ri.set(0,0,0);const v=p.ri,_=p.rj;v.vadd(r,v),v.vsub(l.position,v),_.vadd(i,_),_.vsub(a.position,_),this.result.push(p),this.createFrictionEquationsFromContact(p,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(e,t,i,r,s,o,a,l,c,u,d){return this.convexHeightfield(t,e,r,i,o,s,l,a,c,u,d)}particleCylinder(e,t,i,r,s,o,a,l,c,u,d){return this.convexParticle(t,e,r,i,o,s,l,a,c,u,d)}sphereTrimesh(e,t,i,r,s,o,a,l,c,u,d){const h=p2,f=m2,m=g2,y=v2,g=y2,p=_2,v=M2,_=f2,x=h2,A=A2;tt.pointToLocalFrame(r,o,i,g);const M=e.radius;v.lowerBound.set(g.x-M,g.y-M,g.z-M),v.upperBound.set(g.x+M,g.y+M,g.z+M),t.getTrianglesInAABB(v,A);const S=d2,b=e.radius*e.radius;for(let I=0;I<A.length;I++)for(let O=0;O<3;O++)if(t.getVertex(t.indices[A[I]*3+O],S),S.vsub(g,x),x.lengthSquared()<=b){if(_.copy(S),tt.pointToWorldFrame(r,o,_,S),S.vsub(i,x),d)return!0;let F=this.createContactEquation(a,l,e,t,c,u);F.ni.copy(x),F.ni.normalize(),F.ri.copy(F.ni),F.ri.scale(e.radius,F.ri),F.ri.vadd(i,F.ri),F.ri.vsub(a.position,F.ri),F.rj.copy(S),F.rj.vsub(l.position,F.rj),this.result.push(F),this.createFrictionEquationsFromContact(F,this.frictionResult)}for(let I=0;I<A.length;I++)for(let O=0;O<3;O++){t.getVertex(t.indices[A[I]*3+O],h),t.getVertex(t.indices[A[I]*3+(O+1)%3],f),f.vsub(h,m),g.vsub(f,p);const F=p.dot(m);g.vsub(h,p);let N=p.dot(m);if(N>0&&F<0&&(g.vsub(h,p),y.copy(m),y.normalize(),N=p.dot(y),y.scale(N,p),p.vadd(h,p),p.distanceTo(g)<e.radius)){if(d)return!0;const L=this.createContactEquation(a,l,e,t,c,u);p.vsub(g,L.ni),L.ni.normalize(),L.ni.scale(e.radius,L.ri),L.ri.vadd(i,L.ri),L.ri.vsub(a.position,L.ri),tt.pointToWorldFrame(r,o,p,p),p.vsub(l.position,L.rj),tt.vectorToWorldFrame(o,L.ni,L.ni),tt.vectorToWorldFrame(o,L.ri,L.ri),this.result.push(L),this.createFrictionEquationsFromContact(L,this.frictionResult)}}const T=x2,w=w2,P=S2,V=u2;for(let I=0,O=A.length;I!==O;I++){t.getTriangleVertices(A[I],T,w,P),t.getNormal(A[I],V),g.vsub(T,p);let F=p.dot(V);if(V.scale(F,p),g.vsub(p,p),F=p.distanceTo(g),kt.pointInTriangle(p,T,w,P)&&F<e.radius){if(d)return!0;let N=this.createContactEquation(a,l,e,t,c,u);p.vsub(g,N.ni),N.ni.normalize(),N.ni.scale(e.radius,N.ri),N.ri.vadd(i,N.ri),N.ri.vsub(a.position,N.ri),tt.pointToWorldFrame(r,o,p,p),p.vsub(l.position,N.rj),tt.vectorToWorldFrame(o,N.ni,N.ni),tt.vectorToWorldFrame(o,N.ri,N.ri),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult)}}A.length=0}planeTrimesh(e,t,i,r,s,o,a,l,c,u,d){const h=new E,f=a2;f.set(0,0,1),s.vmult(f,f);for(let m=0;m<t.vertices.length/3;m++){t.getVertex(m,h);const y=new E;y.copy(h),tt.pointToWorldFrame(r,o,y,h);const g=l2;if(h.vsub(i,g),f.dot(g)<=0){if(d)return!0;const v=this.createContactEquation(a,l,e,t,c,u);v.ni.copy(f);const _=c2;f.scale(g.dot(f),_),h.vsub(_,_),v.ri.copy(_),v.ri.vsub(a.position,v.ri),v.rj.copy(h),v.rj.vsub(l.position,v.rj),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult)}}}}const ds=new E,ao=new E,lo=new E,i2=new E,r2=new E,s2=new Ft,o2=new Ft,a2=new E,l2=new E,c2=new E,u2=new E,h2=new E;new E;const d2=new E,f2=new E,p2=new E,m2=new E,g2=new E,v2=new E,y2=new E,_2=new E,x2=new E,w2=new E,S2=new E,M2=new Vn,A2=[],jc=new E,q0=new E,T2=new E,E2=new E,b2=new E;function C2(n,e,t){let i=null;const r=n.length;for(let s=0;s!==r;s++){const o=n[s],a=T2;n[(s+1)%r].vsub(o,a);const l=E2;a.cross(e,l);const c=b2;t.vsub(o,c);const u=l.dot(c);if(i===null||u>0&&i===!0||u<=0&&i===!1){i===null&&(i=u>0);continue}else return!1}return!0}const Xc=new E,R2=new E,P2=new E,L2=new E,I2=[new E,new E,new E,new E,new E,new E],D2=new E,N2=new E,k2=new E,F2=new E,U2=new E,O2=new E,B2=new E,z2=new E,V2=new E,H2=new E,G2=new E,W2=new E,j2=new E,X2=new E;new E;new E;const q2=new E,K2=new E,Y2=new E,$2=new E,Z2=new E,Q2=new E,J2=new E,ek=new E,tk=new E,nk=new E,K0=new Ft,ik=new E;new E;const rk=new E,Y0=new E,sk=new E,ok=new E,ak=new E,lk=[0],ck=new E,uk=new E;class $0{constructor(){this.current=[],this.previous=[]}getKey(e,t){if(t<e){const i=t;t=e,e=i}return e<<16|t}set(e,t){const i=this.getKey(e,t),r=this.current;let s=0;for(;i>r[s];)s++;if(i!==r[s]){for(let o=r.length-1;o>=s;o--)r[o+1]=r[o];r[s]=i}}tick(){const e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,t){const i=this.current,r=this.previous,s=i.length,o=r.length;let a=0;for(let l=0;l<s;l++){let c=!1;const u=i[l];for(;u>r[a];)a++;c=u===r[a],c||Z0(e,u)}a=0;for(let l=0;l<o;l++){let c=!1;const u=r[l];for(;u>i[a];)a++;c=i[a]===u,c||Z0(t,u)}}}function Z0(n,e){n.push((e&4294901760)>>16,e&65535)}const $d=(n,e)=>n<e?`${n}-${e}`:`${e}-${n}`;class hk{constructor(){this.data={keys:[]}}get(e,t){const i=$d(e,t);return this.data[i]}set(e,t,i){const r=$d(e,t);this.get(e,t)||this.data.keys.push(r),this.data[r]=i}delete(e,t){const i=$d(e,t),r=this.data.keys.indexOf(i);r!==-1&&this.data.keys.splice(r,1),delete this.data[i]}reset(){const e=this.data,t=e.keys;for(;t.length>0;){const i=t.pop();delete e[i]}}}class dk extends yM{constructor(e){e===void 0&&(e={}),super(),this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=e.quatNormalizeSkip!==void 0?e.quatNormalizeSkip:0,this.quatNormalizeFast=e.quatNormalizeFast!==void 0?e.quatNormalizeFast:!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new E,e.gravity&&this.gravity.copy(e.gravity),e.frictionGravity&&(this.frictionGravity=new E,this.frictionGravity.copy(e.frictionGravity)),this.broadphase=e.broadphase!==void 0?e.broadphase:new _N,this.bodies=[],this.hasActiveBodies=!1,this.solver=e.solver!==void 0?e.solver:new $N,this.constraints=[],this.narrowphase=new n2(this),this.collisionMatrix=new k0,this.collisionMatrixPrevious=new k0,this.bodyOverlapKeeper=new $0,this.shapeOverlapKeeper=new $0,this.contactmaterials=[],this.contactMaterialTable=new hk,this.defaultMaterial=new Th("default"),this.defaultContactMaterial=new Ah(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,t){return this.contactMaterialTable.get(e.id,t.id)}collisionMatrixTick(){const e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){const t=this.constraints.indexOf(e);t!==-1&&this.constraints.splice(t,1)}rayTest(e,t,i){i instanceof Yu?this.raycastClosest(e,t,{skipBackfaces:!0},i):this.raycastAll(e,t,{skipBackfaces:!0},i)}raycastAll(e,t,i,r){return i===void 0&&(i={}),i.mode=kt.ALL,i.from=e,i.to=t,i.callback=r,Zd.intersectWorld(this,i)}raycastAny(e,t,i,r){return i===void 0&&(i={}),i.mode=kt.ANY,i.from=e,i.to=t,i.result=r,Zd.intersectWorld(this,i)}raycastClosest(e,t,i,r){return i===void 0&&(i={}),i.mode=kt.CLOSEST,i.from=e,i.to=t,i.result=r,Zd.intersectWorld(this,i)}addBody(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof Ue&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;const t=this.bodies.length-1,i=this.bodies,r=i.indexOf(e);if(r!==-1){i.splice(r,1);for(let s=0;s!==i.length;s++)i[s].index=s;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){const t=this.bodies;for(let i=0;i<t.length;i++){const r=t[i].shapes;for(let s=0;s<r.length;s++){const o=r[s];if(o.id===e)return o}}return null}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}removeContactMaterial(e){const t=this.contactmaterials.indexOf(e);t!==-1&&(this.contactmaterials.splice(t,1),this.contactMaterialTable.delete(e.materials[0].id,e.materials[1].id))}fixedStep(e,t){e===void 0&&(e=1/60),t===void 0&&(t=10);const i=Ot.now()/1e3;if(!this.lastCallTime)this.step(e,void 0,t);else{const r=i-this.lastCallTime;this.step(e,r,t)}this.lastCallTime=i}step(e,t,i){if(i===void 0&&(i=10),t===void 0)this.internalStep(e),this.time+=e;else{this.accumulator+=t;const r=Ot.now();let s=0;for(;this.accumulator>=e&&s<i&&(this.internalStep(e),this.accumulator-=e,s++,!(Ot.now()-r>e*1e3)););this.accumulator=this.accumulator%e;const o=this.accumulator/e;for(let a=0;a!==this.bodies.length;a++){const l=this.bodies[a];l.previousPosition.lerp(l.position,o,l.interpolatedPosition),l.previousQuaternion.slerp(l.quaternion,o,l.interpolatedQuaternion),l.previousQuaternion.normalize()}this.time+=t}}internalStep(e){this.dt=e;const t=this.contacts,i=vk,r=yk,s=this.bodies.length,o=this.bodies,a=this.solver,l=this.gravity,c=this.doProfiling,u=this.profile,d=Ue.DYNAMIC;let h=-1/0;const f=this.constraints,m=gk;l.length();const y=l.x,g=l.y,p=l.z;let v=0;for(c&&(h=Ot.now()),v=0;v!==s;v++){const I=o[v];if(I.type===d){const O=I.force,F=I.mass;O.x+=F*y,O.y+=F*g,O.z+=F*p}}for(let I=0,O=this.subsystems.length;I!==O;I++)this.subsystems[I].update();c&&(h=Ot.now()),i.length=0,r.length=0,this.broadphase.collisionPairs(this,i,r),c&&(u.broadphase=Ot.now()-h);let _=f.length;for(v=0;v!==_;v++){const I=f[v];if(!I.collideConnected)for(let O=i.length-1;O>=0;O-=1)(I.bodyA===i[O]&&I.bodyB===r[O]||I.bodyB===i[O]&&I.bodyA===r[O])&&(i.splice(O,1),r.splice(O,1))}this.collisionMatrixTick(),c&&(h=Ot.now());const x=mk,A=t.length;for(v=0;v!==A;v++)x.push(t[v]);t.length=0;const M=this.frictionEquations.length;for(v=0;v!==M;v++)m.push(this.frictionEquations[v]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(i,r,this,t,x,this.frictionEquations,m),c&&(u.narrowphase=Ot.now()-h),c&&(h=Ot.now()),v=0;v<this.frictionEquations.length;v++)a.addEquation(this.frictionEquations[v]);const S=t.length;for(let I=0;I!==S;I++){const O=t[I],F=O.bi,N=O.bj,G=O.si,L=O.sj;let j;if(F.material&&N.material?j=this.getContactMaterial(F.material,N.material)||this.defaultContactMaterial:j=this.defaultContactMaterial,j.friction,F.material&&N.material&&(F.material.friction>=0&&N.material.friction>=0&&F.material.friction*N.material.friction,F.material.restitution>=0&&N.material.restitution>=0&&(O.restitution=F.material.restitution*N.material.restitution)),a.addEquation(O),F.allowSleep&&F.type===Ue.DYNAMIC&&F.sleepState===Ue.SLEEPING&&N.sleepState===Ue.AWAKE&&N.type!==Ue.STATIC){const Y=N.velocity.lengthSquared()+N.angularVelocity.lengthSquared(),ee=N.sleepSpeedLimit**2;Y>=ee*2&&(F.wakeUpAfterNarrowphase=!0)}if(N.allowSleep&&N.type===Ue.DYNAMIC&&N.sleepState===Ue.SLEEPING&&F.sleepState===Ue.AWAKE&&F.type!==Ue.STATIC){const Y=F.velocity.lengthSquared()+F.angularVelocity.lengthSquared(),ee=F.sleepSpeedLimit**2;Y>=ee*2&&(N.wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(F,N,!0),this.collisionMatrixPrevious.get(F,N)||(Na.body=N,Na.contact=O,F.dispatchEvent(Na),Na.body=F,N.dispatchEvent(Na)),this.bodyOverlapKeeper.set(F.id,N.id),this.shapeOverlapKeeper.set(G.id,L.id)}for(this.emitContactEvents(),c&&(u.makeContactConstraints=Ot.now()-h,h=Ot.now()),v=0;v!==s;v++){const I=o[v];I.wakeUpAfterNarrowphase&&(I.wakeUp(),I.wakeUpAfterNarrowphase=!1)}for(_=f.length,v=0;v!==_;v++){const I=f[v];I.update();for(let O=0,F=I.equations.length;O!==F;O++){const N=I.equations[O];a.addEquation(N)}}a.solve(e,this),c&&(u.solve=Ot.now()-h),a.removeAllEquations();const b=Math.pow;for(v=0;v!==s;v++){const I=o[v];if(I.type&d){const O=b(1-I.linearDamping,e),F=I.velocity;F.scale(O,F);const N=I.angularVelocity;if(N){const G=b(1-I.angularDamping,e);N.scale(G,N)}}}this.dispatchEvent(pk),c&&(h=Ot.now());const w=this.stepnumber%(this.quatNormalizeSkip+1)===0,P=this.quatNormalizeFast;for(v=0;v!==s;v++)o[v].integrate(e,w,P);this.clearForces(),this.broadphase.dirty=!0,c&&(u.integrate=Ot.now()-h),this.stepnumber+=1,this.dispatchEvent(fk);let V=!0;if(this.allowSleep)for(V=!1,v=0;v!==s;v++){const I=o[v];I.sleepTick(this.time),I.sleepState!==Ue.SLEEPING&&(V=!0)}this.hasActiveBodies=V}emitContactEvents(){const e=this.hasAnyEventListener("beginContact"),t=this.hasAnyEventListener("endContact");if((e||t)&&this.bodyOverlapKeeper.getDiff(Xi,qi),e){for(let s=0,o=Xi.length;s<o;s+=2)ka.bodyA=this.getBodyById(Xi[s]),ka.bodyB=this.getBodyById(Xi[s+1]),this.dispatchEvent(ka);ka.bodyA=ka.bodyB=null}if(t){for(let s=0,o=qi.length;s<o;s+=2)Fa.bodyA=this.getBodyById(qi[s]),Fa.bodyB=this.getBodyById(qi[s+1]),this.dispatchEvent(Fa);Fa.bodyA=Fa.bodyB=null}Xi.length=qi.length=0;const i=this.hasAnyEventListener("beginShapeContact"),r=this.hasAnyEventListener("endShapeContact");if((i||r)&&this.shapeOverlapKeeper.getDiff(Xi,qi),i){for(let s=0,o=Xi.length;s<o;s+=2){const a=this.getShapeById(Xi[s]),l=this.getShapeById(Xi[s+1]);Ki.shapeA=a,Ki.shapeB=l,a&&(Ki.bodyA=a.body),l&&(Ki.bodyB=l.body),this.dispatchEvent(Ki)}Ki.bodyA=Ki.bodyB=Ki.shapeA=Ki.shapeB=null}if(r){for(let s=0,o=qi.length;s<o;s+=2){const a=this.getShapeById(qi[s]),l=this.getShapeById(qi[s+1]);Yi.shapeA=a,Yi.shapeB=l,a&&(Yi.bodyA=a.body),l&&(Yi.bodyB=l.body),this.dispatchEvent(Yi)}Yi.bodyA=Yi.bodyB=Yi.shapeA=Yi.shapeB=null}}clearForces(){const e=this.bodies,t=e.length;for(let i=0;i!==t;i++){const r=e[i];r.force,r.torque,r.force.set(0,0,0),r.torque.set(0,0,0)}}}new Vn;const Zd=new kt,Ot=globalThis.performance||{};if(!Ot.now){let n=Date.now();Ot.timing&&Ot.timing.navigationStart&&(n=Ot.timing.navigationStart),Ot.now=()=>Date.now()-n}new E;const fk={type:"postStep"},pk={type:"preStep"},Na={type:Ue.COLLIDE_EVENT_NAME,body:null,contact:null},mk=[],gk=[],vk=[],yk=[],Xi=[],qi=[],ka={type:"beginContact",bodyA:null,bodyB:null},Fa={type:"endContact",bodyA:null,bodyB:null},Ki={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},Yi={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};function Q0(n,e){if(e===E1)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===hp||e===GS){let t=n.getIndex();if(t===null){const o=[],a=n.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);n.setIndex(o),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const i=t.count-2,r=[];if(e===hp)for(let o=1;o<=i;o++)r.push(t.getX(0)),r.push(t.getX(o)),r.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(r.push(t.getX(o)),r.push(t.getX(o+1)),r.push(t.getX(o+2))):(r.push(t.getX(o+2)),r.push(t.getX(o+1)),r.push(t.getX(o)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=n.clone();return s.setIndex(r),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}class _k extends pa{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Ak(t)}),this.register(function(t){return new Tk(t)}),this.register(function(t){return new Nk(t)}),this.register(function(t){return new kk(t)}),this.register(function(t){return new Fk(t)}),this.register(function(t){return new bk(t)}),this.register(function(t){return new Ck(t)}),this.register(function(t){return new Rk(t)}),this.register(function(t){return new Pk(t)}),this.register(function(t){return new Mk(t)}),this.register(function(t){return new Lk(t)}),this.register(function(t){return new Ek(t)}),this.register(function(t){return new Dk(t)}),this.register(function(t){return new Ik(t)}),this.register(function(t){return new wk(t)}),this.register(function(t){return new Uk(t)}),this.register(function(t){return new Ok(t)})}load(e,t,i,r){const s=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const c=sl.extractUrlBase(e);o=sl.resolveURL(c,this.path)}else o=sl.extractUrlBase(e);this.manager.itemStart(e);const a=function(c){r?r(c):console.error(c),s.manager.itemError(e),s.manager.itemEnd(e)},l=new mM(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{s.parse(c,o,function(u){t(u),s.manager.itemEnd(e)},a)}catch(u){a(u)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,r){let s;const o={},a={},l=new TextDecoder;if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===EM){try{o[We.KHR_BINARY_GLTF]=new Bk(e)}catch(d){r&&r(d);return}s=JSON.parse(o[We.KHR_BINARY_GLTF].content)}else s=JSON.parse(l.decode(e));else s=e;if(s.asset===void 0||s.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new Qk(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const d=this.pluginCallbacks[u](c);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[d.name]=d,o[d.name]=!0}if(s.extensionsUsed)for(let u=0;u<s.extensionsUsed.length;++u){const d=s.extensionsUsed[u],h=s.extensionsRequired||[];switch(d){case We.KHR_MATERIALS_UNLIT:o[d]=new Sk;break;case We.KHR_DRACO_MESH_COMPRESSION:o[d]=new zk(s,this.dracoLoader);break;case We.KHR_TEXTURE_TRANSFORM:o[d]=new Vk;break;case We.KHR_MESH_QUANTIZATION:o[d]=new Hk;break;default:h.indexOf(d)>=0&&a[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(i,r)}parseAsync(e,t){const i=this;return new Promise(function(r,s){i.parse(e,t,r,s)})}}function xk(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const We={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class wk{constructor(e){this.parser=e,this.name=We.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,r=t.length;i<r;i++){const s=t[i];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let r=t.cache.get(i);if(r)return r;const s=t.json,l=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let c;const u=new Le(16777215);l.color!==void 0&&u.setRGB(l.color[0],l.color[1],l.color[2],Jt);const d=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new vM(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new gM(u),c.distance=d;break;case"spot":c=new ND(u),c.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,Qi(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),r=Promise.resolve(c),t.cache.add(i,r),r}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,s=i.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return i._getNodeRef(t.cache,a,l)})}}class Sk{constructor(){this.name=We.KHR_MATERIALS_UNLIT}getMaterialType(){return bs}extendParams(e,t,i){const r=[];e.color=new Le(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],Jt),e.opacity=o[3]}s.baseColorTexture!==void 0&&r.push(i.assignTexture(e,"map",s.baseColorTexture,pn))}return Promise.all(r)}}class Mk{constructor(e){this.parser=e,this.name=We.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class Ak{constructor(e){this.parser=e,this.name=We.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Fi}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new je(a,a)}return Promise.all(s)}}class Tk{constructor(e){this.parser=e,this.name=We.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Fi}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class Ek{constructor(e){this.parser=e,this.name=We.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Fi}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&s.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&s.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class bk{constructor(e){this.parser=e,this.name=We.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Fi}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new Le(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=r.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],Jt)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&s.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,pn)),o.sheenRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class Ck{constructor(e){this.parser=e,this.name=We.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Fi}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class Rk{constructor(e){this.parser=e,this.name=We.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Fi}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&s.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new Le().setRGB(a[0],a[1],a[2],Jt),Promise.all(s)}}class Pk{constructor(e){this.parser=e,this.name=We.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Fi}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class Lk{constructor(e){this.parser=e,this.name=We.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Fi}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&s.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new Le().setRGB(a[0],a[1],a[2],Jt),o.specularColorTexture!==void 0&&s.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,pn)),Promise.all(s)}}class Ik{constructor(e){this.parser=e,this.name=We.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Fi}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&s.push(i.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(s)}}class Dk{constructor(e){this.parser=e,this.name=We.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Fi}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&s.push(i.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}}class Nk{constructor(e){this.parser=e,this.name=We.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,r=i.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,o)}}class kk{constructor(e){this.parser=e,this.name=We.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=r.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Fk{constructor(e){this.parser=e,this.name=We.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=r.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Uk{constructor(e){this.name=We.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const r=i.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const l=r.byteOffset||0,c=r.byteLength||0,u=r.count,d=r.byteStride,h=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(u,d,h,r.mode,r.filter).then(function(f){return f.buffer}):o.ready.then(function(){const f=new ArrayBuffer(u*d);return o.decodeGltfBuffer(new Uint8Array(f),u,d,h,r.mode,r.filter),f})})}else return null}}class Ok{constructor(e){this.name=We.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const r=t.meshes[i.mesh];for(const c of r.primitives)if(c.mode!==Xn.TRIANGLES&&c.mode!==Xn.TRIANGLE_STRIP&&c.mode!==Xn.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=i.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(u=>(l[c]=u,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const u=c.pop(),d=u.isGroup?u.children:[u],h=c[0].count,f=[];for(const m of d){const y=new Oe,g=new B,p=new ns,v=new B(1,1,1),_=new mD(m.geometry,m.material,h);for(let x=0;x<h;x++)l.TRANSLATION&&g.fromBufferAttribute(l.TRANSLATION,x),l.ROTATION&&p.fromBufferAttribute(l.ROTATION,x),l.SCALE&&v.fromBufferAttribute(l.SCALE,x),_.setMatrixAt(x,y.compose(g,p,v));for(const x in l)if(x==="_COLOR_0"){const A=l[x];_.instanceColor=new pp(A.array,A.itemSize,A.normalized)}else x!=="TRANSLATION"&&x!=="ROTATION"&&x!=="SCALE"&&m.geometry.setAttribute(x,l[x]);Mt.prototype.copy.call(_,m),this.parser.assignFinalMaterial(_),f.push(_)}return u.isGroup?(u.clear(),u.add(...f),u):f[0]}))}}const EM="glTF",Ua=12,J0={JSON:1313821514,BIN:5130562};class Bk{constructor(e){this.name=We.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Ua),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==EM)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-Ua,s=new DataView(e,Ua);let o=0;for(;o<r;){const a=s.getUint32(o,!0);o+=4;const l=s.getUint32(o,!0);if(o+=4,l===J0.JSON){const c=new Uint8Array(e,Ua+o,a);this.content=i.decode(c)}else if(l===J0.BIN){const c=Ua+o;this.body=e.slice(c,c+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class zk{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=We.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const u in o){const d=gp[u]||u.toLowerCase();a[d]=o[u]}for(const u in e.attributes){const d=gp[u]||u.toLowerCase();if(o[u]!==void 0){const h=i.accessors[e.attributes[u]],f=Oo[h.componentType];c[d]=f.name,l[d]=h.normalized===!0}}return t.getDependency("bufferView",s).then(function(u){return new Promise(function(d,h){r.decodeDracoFile(u,function(f){for(const m in f.attributes){const y=f.attributes[m],g=l[m];g!==void 0&&(y.normalized=g)}d(f)},a,c,Jt,h)})})}}class Vk{constructor(){this.name=We.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Hk{constructor(){this.name=We.KHR_MESH_QUANTIZATION}}class bM extends Hl{constructor(e,t,i,r){super(e,t,i,r)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let o=0;o!==r;o++)t[o]=i[s+o];return t}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,u=r-t,d=(i-t)/u,h=d*d,f=h*d,m=e*c,y=m-c,g=-2*f+3*h,p=f-h,v=1-g,_=p-h+d;for(let x=0;x!==a;x++){const A=o[y+x+a],M=o[y+x+l]*u,S=o[m+x+a],b=o[m+x]*u;s[x]=v*A+_*M+g*S+p*b}return s}}const Gk=new ns;class Wk extends bM{interpolate_(e,t,i,r){const s=super.interpolate_(e,t,i,r);return Gk.fromArray(s).normalize().toArray(s),s}}const Xn={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Oo={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},e_={9728:gn,9729:Dn,9984:kS,9985:hu,9986:Ga,9987:nr},t_={33071:kr,33648:Vu,10497:Ko},Qd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},gp={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Er={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},jk={CUBICSPLINE:void 0,LINEAR:Cl,STEP:bl},Jd={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Xk(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new zm({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:fr})),n.DefaultMaterial}function fs(n,e,t){for(const i in t.extensions)n[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function Qi(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function qk(n,e,t){let i=!1,r=!1,s=!1;for(let c=0,u=e.length;c<u;c++){const d=e[c];if(d.POSITION!==void 0&&(i=!0),d.NORMAL!==void 0&&(r=!0),d.COLOR_0!==void 0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(n);const o=[],a=[],l=[];for(let c=0,u=e.length;c<u;c++){const d=e[c];if(i){const h=d.POSITION!==void 0?t.getDependency("accessor",d.POSITION):n.attributes.position;o.push(h)}if(r){const h=d.NORMAL!==void 0?t.getDependency("accessor",d.NORMAL):n.attributes.normal;a.push(h)}if(s){const h=d.COLOR_0!==void 0?t.getDependency("accessor",d.COLOR_0):n.attributes.color;l.push(h)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const u=c[0],d=c[1],h=c[2];return i&&(n.morphAttributes.position=u),r&&(n.morphAttributes.normal=d),s&&(n.morphAttributes.color=h),n.morphTargetsRelative=!0,n})}function Kk(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let i=0,r=t.length;i<r;i++)n.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Yk(n){let e;const t=n.extensions&&n.extensions[We.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+ef(t.attributes):e=n.indices+":"+ef(n.attributes)+":"+n.mode,n.targets!==void 0)for(let i=0,r=n.targets.length;i<r;i++)e+=":"+ef(n.targets[i]);return e}function ef(n){let e="";const t=Object.keys(n).sort();for(let i=0,r=t.length;i<r;i++)e+=t[i]+":"+n[t[i]]+";";return e}function vp(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function $k(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Zk=new Oe;class Qk{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new xk,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,r=!1,s=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,s=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||r&&s<98?this.textureLoader=new ID(this.options.manager):this.textureLoader=new UD(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new mM(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:i,userData:{}};return fs(s,a,r),Qi(a,r),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){for(const l of a.scenes)l.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let r=0,s=t.length;r<s;r++){const o=t[r].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const o=e[r];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const r=i.clone(),s=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,u]of o.children.entries())s(u,a.children[c])};return s(i,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const r=e(t[i]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let r=0;r<t.length;r++){const s=e(t[r]);s&&i.push(s)}return i}getDependency(e,t){const i=e+":"+t;let r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(i,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(s,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[We.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,o){i.load(sl.resolveURL(t.uri,r.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const r=t.byteLength||0,s=t.byteOffset||0;return i.slice(s,s+r)})}loadAccessor(e){const t=this,i=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const o=Qd[r.type],a=Oo[r.componentType],l=r.normalized===!0,c=new a(r.count*o);return Promise.resolve(new _n(c,o,l))}const s=[];return r.bufferView!==void 0?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),r.sparse!==void 0&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(o){const a=o[0],l=Qd[r.type],c=Oo[r.componentType],u=c.BYTES_PER_ELEMENT,d=u*l,h=r.byteOffset||0,f=r.bufferView!==void 0?i.bufferViews[r.bufferView].byteStride:void 0,m=r.normalized===!0;let y,g;if(f&&f!==d){const p=Math.floor(h/f),v="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+p+":"+r.count;let _=t.cache.get(v);_||(y=new c(a,p*f,r.count*f/u),_=new uD(y,f/u),t.cache.add(v,_)),g=new Um(_,l,h%f/u,m)}else a===null?y=new c(r.count*l):y=new c(a,h,r.count*l),g=new _n(y,l,m);if(r.sparse!==void 0){const p=Qd.SCALAR,v=Oo[r.sparse.indices.componentType],_=r.sparse.indices.byteOffset||0,x=r.sparse.values.byteOffset||0,A=new v(o[1],_,r.sparse.count*p),M=new c(o[2],x,r.sparse.count*l);a!==null&&(g=new _n(g.array.slice(),g.itemSize,g.normalized));for(let S=0,b=A.length;S<b;S++){const T=A[S];if(g.setX(T,M[S*l]),l>=2&&g.setY(T,M[S*l+1]),l>=3&&g.setZ(T,M[S*l+2]),l>=4&&g.setW(T,M[S*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(e){const t=this.json,i=this.options,s=t.textures[e].source,o=t.images[s];let a=this.textureLoader;if(o.uri){const l=i.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,t,i){const r=this,s=this.json,o=s.textures[e],a=s.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,i).then(function(u){u.flipY=!1,u.name=o.name||a.name||"",u.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(u.name=a.uri);const h=(s.samplers||{})[o.sampler]||{};return u.magFilter=e_[h.magFilter]||Dn,u.minFilter=e_[h.minFilter]||nr,u.wrapS=t_[h.wrapS]||Ko,u.wrapT=t_[h.wrapT]||Ko,r.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const i=this,r=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const o=r.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=i.getDependency("bufferView",o.bufferView).then(function(d){c=!0;const h=new Blob([d],{type:o.mimeType});return l=a.createObjectURL(h),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(d){return new Promise(function(h,f){let m=h;t.isImageBitmapLoader===!0&&(m=function(y){const g=new Kt(y);g.needsUpdate=!0,h(g)}),t.load(sl.resolveURL(d,s.path),m,void 0,f)})}).then(function(d){return c===!0&&a.revokeObjectURL(l),Qi(d,o),d.userData.mimeType=o.mimeType||$k(o.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[e]=u,u}assignTexture(e,t,i,r){const s=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),s.extensions[We.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[We.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=s.associations.get(o);o=s.extensions[We.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),s.associations.set(o,l)}}return r!==void 0&&(o.colorSpace=r),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const r=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new dM,pi.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new hM,pi.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(r||s||o){let a="ClonedMaterial:"+i.uuid+":";r&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),s&&(l.vertexColors=!0),o&&(l.flatShading=!0),r&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}e.material=i}getMaterialType(){return zm}loadMaterial(e){const t=this,i=this.json,r=this.extensions,s=i.materials[e];let o;const a={},l=s.extensions||{},c=[];if(l[We.KHR_MATERIALS_UNLIT]){const d=r[We.KHR_MATERIALS_UNLIT];o=d.getMaterialType(),c.push(d.extendParams(a,s,t))}else{const d=s.pbrMetallicRoughness||{};if(a.color=new Le(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){const h=d.baseColorFactor;a.color.setRGB(h[0],h[1],h[2],Jt),a.opacity=h[3]}d.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",d.baseColorTexture,pn)),a.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,a.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),o=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(e,a)})))}s.doubleSided===!0&&(a.side=Ti);const u=s.alphaMode||Jd.OPAQUE;if(u===Jd.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===Jd.MASK&&(a.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&o!==bs&&(c.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new je(1,1),s.normalTexture.scale!==void 0)){const d=s.normalTexture.scale;a.normalScale.set(d,d)}if(s.occlusionTexture!==void 0&&o!==bs&&(c.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&o!==bs){const d=s.emissiveFactor;a.emissive=new Le().setRGB(d[0],d[1],d[2],Jt)}return s.emissiveTexture!==void 0&&o!==bs&&c.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,pn)),Promise.all(c).then(function(){const d=new o(a);return s.name&&(d.name=s.name),Qi(d,s),t.associations.set(d,{materials:e}),s.extensions&&fs(r,d,s),d})}createUniqueName(e){const t=at.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,r=this.primitiveCache;function s(a){return i[We.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return n_(l,a,t)})}const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],u=Yk(c),d=r[u];if(d)o.push(d.promise);else{let h;c.extensions&&c.extensions[We.KHR_DRACO_MESH_COMPRESSION]?h=s(c):h=n_(new ki,c,t),r[u]={primitive:c,promise:h},o.push(h)}}return Promise.all(o)}loadMesh(e){const t=this,i=this.json,r=this.extensions,s=i.meshes[e],o=s.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const u=o[l].material===void 0?Xk(this.cache):this.getDependency("material",o[l].material);a.push(u)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],d=[];for(let f=0,m=u.length;f<m;f++){const y=u[f],g=o[f];let p;const v=c[f];if(g.mode===Xn.TRIANGLES||g.mode===Xn.TRIANGLE_STRIP||g.mode===Xn.TRIANGLE_FAN||g.mode===void 0)p=s.isSkinnedMesh===!0?new dD(y,v):new vn(y,v),p.isSkinnedMesh===!0&&p.normalizeSkinWeights(),g.mode===Xn.TRIANGLE_STRIP?p.geometry=Q0(p.geometry,GS):g.mode===Xn.TRIANGLE_FAN&&(p.geometry=Q0(p.geometry,hp));else if(g.mode===Xn.LINES)p=new gD(y,v);else if(g.mode===Xn.LINE_STRIP)p=new Bm(y,v);else if(g.mode===Xn.LINE_LOOP)p=new vD(y,v);else if(g.mode===Xn.POINTS)p=new yD(y,v);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(p.geometry.morphAttributes).length>0&&Kk(p,s),p.name=t.createUniqueName(s.name||"mesh_"+e),Qi(p,s),g.extensions&&fs(r,p,g),t.assignFinalMaterial(p),d.push(p)}for(let f=0,m=d.length;f<m;f++)t.associations.set(d[f],{meshes:e,primitives:f});if(d.length===1)return s.extensions&&fs(r,d[0],s),d[0];const h=new Cs;s.extensions&&fs(r,h,s),t.associations.set(h,{meshes:e});for(let f=0,m=d.length;f<m;f++)h.add(d[f]);return h})}loadCamera(e){let t;const i=this.json.cameras[e],r=i[i.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new mn(J1.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):i.type==="orthographic"&&(t=new km(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Qi(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let r=0,s=t.joints.length;r<s;r++)i.push(this._loadNodeShallow(t.joints[r]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(r){const s=r.pop(),o=r,a=[],l=[];for(let c=0,u=o.length;c<u;c++){const d=o[c];if(d){a.push(d);const h=new Oe;s!==null&&h.fromArray(s.array,c*16),l.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new Om(a,l)})}loadAnimation(e){const t=this.json,i=this,r=t.animations[e],s=r.name?r.name:"animation_"+e,o=[],a=[],l=[],c=[],u=[];for(let d=0,h=r.channels.length;d<h;d++){const f=r.channels[d],m=r.samplers[f.sampler],y=f.target,g=y.node,p=r.parameters!==void 0?r.parameters[m.input]:m.input,v=r.parameters!==void 0?r.parameters[m.output]:m.output;y.node!==void 0&&(o.push(this.getDependency("node",g)),a.push(this.getDependency("accessor",p)),l.push(this.getDependency("accessor",v)),c.push(m),u.push(y))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(u)]).then(function(d){const h=d[0],f=d[1],m=d[2],y=d[3],g=d[4],p=[];for(let v=0,_=h.length;v<_;v++){const x=h[v],A=f[v],M=m[v],S=y[v],b=g[v];if(x===void 0)continue;x.updateMatrix&&x.updateMatrix();const T=i._createAnimationTracks(x,A,M,S,b);if(T)for(let w=0;w<T.length;w++)p.push(T[w])}return new TD(s,void 0,p)})}createNodeMesh(e){const t=this.json,i=this,r=t.nodes[e];return r.mesh===void 0?null:i.getDependency("mesh",r.mesh).then(function(s){const o=i._getNodeRef(i.meshCache,r.mesh,s);return r.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=r.weights.length;l<c;l++)a.morphTargetInfluences[l]=r.weights[l]}),o})}loadNode(e){const t=this.json,i=this,r=t.nodes[e],s=i._loadNodeShallow(e),o=[],a=r.children||[];for(let c=0,u=a.length;c<u;c++)o.push(i.getDependency("node",a[c]));const l=r.skin===void 0?Promise.resolve(null):i.getDependency("skin",r.skin);return Promise.all([s,Promise.all(o),l]).then(function(c){const u=c[0],d=c[1],h=c[2];h!==null&&u.traverse(function(f){f.isSkinnedMesh&&f.bind(h,Zk)});for(let f=0,m=d.length;f<m;f++)u.add(d[f]);return u})}_loadNodeShallow(e){const t=this.json,i=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],o=s.name?r.createUniqueName(s.name):"",a=[],l=r._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),s.camera!==void 0&&a.push(r.getDependency("camera",s.camera).then(function(c){return r._getNodeRef(r.cameraCache,s.camera,c)})),r._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let u;if(s.isBone===!0?u=new cM:c.length>1?u=new Cs:c.length===1?u=c[0]:u=new Mt,u!==c[0])for(let d=0,h=c.length;d<h;d++)u.add(c[d]);if(s.name&&(u.userData.name=s.name,u.name=o),Qi(u,s),s.extensions&&fs(i,u,s),s.matrix!==void 0){const d=new Oe;d.fromArray(s.matrix),u.applyMatrix4(d)}else s.translation!==void 0&&u.position.fromArray(s.translation),s.rotation!==void 0&&u.quaternion.fromArray(s.rotation),s.scale!==void 0&&u.scale.fromArray(s.scale);return r.associations.has(u)||r.associations.set(u,{}),r.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],r=this,s=new Cs;i.name&&(s.name=r.createUniqueName(i.name)),Qi(s,i),i.extensions&&fs(t,s,i);const o=i.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(r.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let u=0,d=l.length;u<d;u++)s.add(l[u]);const c=u=>{const d=new Map;for(const[h,f]of r.associations)(h instanceof pi||h instanceof Kt)&&d.set(h,f);return u.traverse(h=>{const f=r.associations.get(h);f!=null&&d.set(h,f)}),d};return r.associations=c(s),s})}_createAnimationTracks(e,t,i,r,s){const o=[],a=e.name?e.name:e.uuid,l=[];Er[s.path]===Er.weights?e.traverse(function(h){h.morphTargetInfluences&&l.push(h.name?h.name:h.uuid)}):l.push(a);let c;switch(Er[s.path]){case Er.weights:c=ta;break;case Er.rotation:c=na;break;case Er.position:case Er.scale:c=ia;break;default:switch(i.itemSize){case 1:c=ta;break;case 2:case 3:default:c=ia;break}break}const u=r.interpolation!==void 0?jk[r.interpolation]:Cl,d=this._getArrayFromAccessor(i);for(let h=0,f=l.length;h<f;h++){const m=new c(l[h]+"."+Er[s.path],t.array,d,u);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),o.push(m)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=vp(t.constructor),r=new Float32Array(t.length);for(let s=0,o=t.length;s<o;s++)r[s]=t[s]*i;t=r}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const r=this instanceof na?Wk:bM;return new r(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Jk(n,e,t){const i=e.attributes,r=new gr;if(i.POSITION!==void 0){const a=t.json.accessors[i.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(r.set(new B(l[0],l[1],l[2]),new B(c[0],c[1],c[2])),a.normalized){const u=vp(Oo[a.componentType]);r.min.multiplyScalar(u),r.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const a=new B,l=new B;for(let c=0,u=s.length;c<u;c++){const d=s[c];if(d.POSITION!==void 0){const h=t.json.accessors[d.POSITION],f=h.min,m=h.max;if(f!==void 0&&m!==void 0){if(l.setX(Math.max(Math.abs(f[0]),Math.abs(m[0]))),l.setY(Math.max(Math.abs(f[1]),Math.abs(m[1]))),l.setZ(Math.max(Math.abs(f[2]),Math.abs(m[2]))),h.normalized){const y=vp(Oo[h.componentType]);l.multiplyScalar(y)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(a)}n.boundingBox=r;const o=new Ni;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,n.boundingSphere=o}function n_(n,e,t){const i=e.attributes,r=[];function s(o,a){return t.getDependency("accessor",o).then(function(l){n.setAttribute(a,l)})}for(const o in i){const a=gp[o]||o.toLowerCase();a in n.attributes||r.push(s(i[o],a))}if(e.indices!==void 0&&!n.index){const o=t.getDependency("accessor",e.indices).then(function(a){n.setIndex(a)});r.push(o)}return nt.workingColorSpace!==Jt&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${nt.workingColorSpace}" not supported.`),Qi(n,e),Jk(n,e,t),Promise.all(r).then(function(){return e.targets!==void 0?qk(n,e.targets,t):n})}const eF="/kdm-roller/assets/armor-dice-eqhcB1k0.glb",tF="/kdm-roller/assets/d10-tqVaqoYJ.glb",CM=new _k;let yp=null,_p=null;CM.load(eF,function(n){yp=n.scene.children[0],window.dispatchEvent(new Event("loadedArmorDiceMesh"))});CM.load(tF,function(n){_p=n.scene.children[0],window.dispatchEvent(new Event("loadedTenSidedDiceMesh"))});function nF(){const n=t=>{let r=l=>Math.abs(l)<.1,s=l=>Math.abs(l-.5*Math.PI)<.1,o=l=>Math.abs(.5*Math.PI+l)<.1,a=l=>Math.abs(Math.PI-l)<.1||Math.abs(Math.PI+l)<.1;if(r(t.z)){if(r(t.x))return"BODY 1";if(s(t.x))return"LEG";if(o(t.x))return"WAIST";if(a(t.x))return"BODY 2"}else{if(s(t.z))return"ARM";if(o(t.z))return"HEAD"}return null},e=()=>{this.body.allowSleep=!1;const t=new E;this.body.quaternion.toEuler(t);const i=n(t);if(i==null){this.body.allowSleep=!0;return}return i};this.mesh=null,this.body=null,this.load=t=>new Promise(i=>{const r=()=>{window.removeEventListener("loadedArmorDiceMesh",r),this.mesh=yp.clone(),this.mesh.traverse(s=>{s.isMesh&&(s.material=s.material.clone())}),this.body=new Ue({mass:1,shape:new Mh(new E(.55,.55,.55)),sleepTimeLimit:.1,collisionFilterGroup:t,collisionFilterMask:1|t}),this.body.position.copy(this.mesh.position),this.body.quaternion.copy(this.mesh.quaternion),i()};yp!=null?r():window.addEventListener("loadedArmorDiceMesh",r)}),this.roll=({rotation:t,force:i})=>new Promise(r=>{this.body.allowSleep=!0,this.body.position=new E(5,0,0),this.body.velocity.setZero(),this.body.angularVelocity.setZero(),this.mesh.rotation.set(t.x,t.y,t.z),this.body.quaternion.copy(this.mesh.quaternion),this.body.applyImpulse(new E(-i,i,0));const s=()=>{this.body.removeEventListener("sleep",s);const o=e();r(o)};this.body.addEventListener("sleep",s)})}function iF(){const n=t=>{let r=h=>Math.abs(h)<.15,s=h=>Math.abs(h-Math.PI/5)<.15,o=h=>Math.abs(Math.PI/5+h)<.15,a=h=>Math.abs(h-Math.PI/10)<.15,l=h=>Math.abs(Math.PI/10+h)<.15,c=h=>Math.abs(h-3*Math.PI/10)<.15,u=h=>Math.abs(3*Math.PI/10+h)<.15,d=h=>Math.abs(Math.PI-h)<.15||Math.abs(Math.PI+h)<.15;if(u(t.z)&&r(t.x))return 1;if(c(t.z)&&d(t.x))return 8;if(s(t.z)){if(t.x<0)return 3;if(t.x>0)return 5}if(o(t.z)){if(t.x<0)return 4;if(t.x>0)return 6}if(a(t.z)){if(t.x>0)return 2;if(t.x<0)return 10}if(l(t.z)){if(t.x<0)return 7;if(t.x>0)return 9}return null},e=()=>{this.body.allowSleep=!1;const t=new E;this.body.quaternion.toEuler(t);const i=n(t);if(i==null){this.body.allowSleep=!0;return}return i};this.mesh=null,this.body=null,this.load=t=>new Promise(i=>{const r=()=>{window.removeEventListener("loadedTenSidedDiceMesh",r),this.mesh=_p.clone(),this.mesh.traverse(l=>{l.isMesh&&(l.material=l.material.clone())});const s=[new E(0,1,0),new E(0,-1,0)];for(let l=0;l<10;++l){const c=l*Math.PI*2/10;s.push(new E(-Math.cos(c),.105*(l%2?1:-1),-Math.sin(c)))}const o=[[3,2,0],[4,3,0],[5,4,0],[6,5,0],[7,6,0],[8,7,0],[9,8,0],[10,9,0],[11,10,0],[2,11,0],[2,3,1],[3,4,1],[4,5,1],[5,6,1],[6,7,1],[7,8,1],[8,9,1],[9,10,1],[10,11,1],[11,2,1]],a=new Uo({vertices:s,faces:o});this.body=new Ue({mass:1,shape:a,sleepTimeLimit:.1,collisionFilterGroup:t,collisionFilterMask:1|t}),this.body.position.copy(this.mesh.position),this.body.quaternion.copy(this.mesh.quaternion),i()};_p!=null?r():window.addEventListener("loadedTenSidedDiceMesh",r)}),this.roll=({rotation:t,force:i})=>new Promise(r=>{this.body.allowSleep=!0,this.body.position=new E(0,0,-5),this.body.velocity.setZero(),this.body.angularVelocity.setZero(),this.mesh.rotation.set(t.x,t.y,t.z),this.body.quaternion.copy(this.mesh.quaternion),this.body.applyImpulse(new E(0,-i,0));const s=()=>{const o=e();r(o)};this.body.removeEventListener("sleep",s),this.body.addEventListener("sleep",s)})}let qc=[],Kc=[],i_=n=>{};const rF=({scene:n,world:e,setPlayerList:t,focusedPlayer:i,setFocusedPlayer:r,setPriorRolls:s})=>{const a=te.useRef(null),l=te.useRef({});te.useEffect(()=>{u()},[]),te.useEffect(()=>{if(i)for(const d in l.current){const h=l.current[d].dice;for(let f=0;f<h.length;f++)h[f].mesh.material.opacity=d===i?1:.2,h[f].mesh.material.transparent=d!==i}},[i]);async function c(d,h,f,m,y,g){const p=[];console.log(d+" rolled");for(let v=0;v<h.length;v++){if(v<m.length){h[v].mesh.visible=!0,e.addBody(h[v].body);const _=h[v].roll(m[v]);p.push(_)}else h[v].mesh.visible=!1,e.removeBody(h[v].body);f[v].mesh.visible=!1}Promise.all(p).then(v=>{const _={username:d,timestamp:new Date(y).toLocaleTimeString(),faces:v};console.log("rolled -- "+_.faces),i_(_)})}function u(){const d=async()=>{const S=[];for(var b=0;b<5;b++){const T=new nF;await T.load(1),T.mesh.visible=!1,n.add(T.mesh),S.push(T)}return S},h=async()=>{const S=[];for(var b=0;b<5;b++){const T=new iF;await T.load(2),T.mesh.visible=!1,n.add(T.mesh),S.push(T)}return S};d().then(S=>{qc=S}),h().then(S=>{Kc=S});const f=new mn(75,a.current.offsetWidth/a.current.offsetHeight,.1,100);f.rotation.x=-Math.PI/2,f.position.y=5,x(),A(new B(0,0,-5),new B(0,1,0),0),A(new B(-5,0,0),new B(0,1,0),Math.PI/2),A(new B(5,0,0),new B(0,-1,0),Math.PI/2),A(new B(0,0,5),new B(0,1,0),Math.PI),M();const m=new lD({alpha:!0});m.setSize(a.current.offsetWidth,a.current.offsetHeight),window.addEventListener("resize",()=>{m.setSize(a.current.offsetWidth,a.current.offsetHeight)}),a.current.appendChild(m.domElement),m.render(n,f),requestAnimationFrame(_);const y=location.host.includes("discord"),g=y?"wss":"ws",p=new WebSocket(`${g}://${location.host}${y?"/.proxy":""}/api`);let v;y&&(v=""),v="User#"+Math.floor(Math.random()*100),p.onopen=()=>{p.send(JSON.stringify({action:"join",data:v}))},p.onmessage=S=>{const b=JSON.parse(S.data);switch(b.action){case"connect":b.data.filter(L=>!Object.keys(l.current).includes(L)).forEach(L=>{t(Object.keys(l.current))});break;case"disconnect":const P=b.data.username;console.debug(`${P} disconnected`),delete l.current[P],i||r(v),t(Object.keys(l.current));break;case"roll":const{username:V,type:I,rolls:O,timestamp:F}=b.data;let N,G;I==="d10"?(N=Kc,G=qc):(N=qc,G=Kc),c(V,N,G,O,F);break;case"rolled":s(L=>[...L,b.data]);break;default:console.error(`action (${b.action}) not recognized`)}},window.rollDiceCallback=(S,b)=>{isNaN(b)||b<1||b>5||p.readyState===p.OPEN&&p.send(JSON.stringify({action:"roll",data:{type:S,numberOfDice:b}}))},i_=S=>{p.readyState===p.OPEN&&p.send(JSON.stringify({action:"rolled",data:S}))};function _(){e.fixedStep(),qc.forEach(S=>{S.mesh&&(S.mesh.position.copy(S.body.position),S.mesh.quaternion.copy(S.body.quaternion))}),Kc.forEach(S=>{S.mesh&&(S.mesh.position.copy(S.body.position),S.mesh.quaternion.copy(S.body.quaternion))}),m.render(n,f),requestAnimationFrame(_)}function x(){const S=new b0,b=new vn(new ea(10,10),S);b.receiveShadow=!0,b.quaternion.setFromAxisAngle(new B(-1,0,0),Math.PI/2),b.position.x=0,b.position.y=-5,n.add(b);const T=new Ue({type:Ue.STATIC,shape:new X0,collisionFilterGroup:1});T.position.copy(b.position),T.quaternion.copy(b.quaternion),e.addBody(T)}function A(S,b,T){const w=new b0,P=new vn(new ea(15,15),w);P.receiveShadow=!0,P.position.x=S.x,P.position.y=S.y,P.position.z=S.z,P.quaternion.setFromAxisAngle(b,T),n.add(P);const V=new Ue({type:Ue.STATIC,shape:new X0,collisionFilterGroup:1});V.position.copy(P.position),V.quaternion.copy(P.quaternion),e.addBody(V)}function M(){const S=new vM(16777215);n.add(S);const b=new gM(16777215,50,50);n.add(b)}}return Ie.createElement("div",{id:"threejs-canvas",ref:a})},sF="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAGVJREFUOI2lkkESQBEMQ9Pe/87+Bou2qfgyY6HkCQVkjTkkeWOSIB7mA4ARSAlcAGY6prFukexPCVLxRn6ZoASoKpPG4ilNgrD7dyCjkz9plA4wkAHaI7Yp1S5EyNPf2ae/GLf5A9sqFA7P3bagAAAAAElFTkSuQmCC",r_="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAF5JREFUOI3FkjESACEIA/X+/2dsgXETrC4lswQhrvW3NtRjyvdCpBqZlL5sEBfAmihwZOKg240K+wn3DAcN6QaUSpfkcFp7FTqpKO0/wEnUQ0dUKxS5FKxeV5imNNcB2oEUC35tu+gAAAAASUVORK5CYII=",oF="data:image/png;base64,UklGRl4AAABXRUJQVlA4TFEAAAAvY8AYEA8QEfMfwm0k2VIz3CYhECqpEgLmzQCSvC3ZEf2fAADVgZ9hrg+7FIvfqzD+P1xZFqNM/qyydASCK5JVCuwP1RhwaEeoWQeijGQpUgAA",aF="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAFNJREFUOI1jYKAQMELp/zjEiQboBpDsAnyG4HUNE6UuYCIgTzAs8BlAVEDCDCA51IlxAVHhgisdYFNDsguIcgkxLsDrGlINwDCIXAPg+okJA9oCAL5cChQa3AasAAAAAElFTkSuQmCC",lF="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAElJREFUOI1jYBgFjEjs/+TohRnwH10CD8CqllTb4XqYyNCIAljQTGRkwHQiPj5BF+DzGkogEqORUODiNYTkQMamAashFMfCwAMABJUPB5o61EAAAAAASUVORK5CYII=",cF=({priorRolls:n})=>{const[e,t]=te.useState(!1),i={ARM:sF,"BODY 1":r_,"BODY 2":r_,HEAD:oF,LEG:aF,WAIST:lF};return Ie.createElement(Ie.Fragment,null,e&&Ie.createElement("div",{id:"history-list"},n.map((r,s)=>Ie.createElement("div",{key:s},Ie.createElement("span",{id:"username"},r.username),Ie.createElement("span",{id:"timestamp"},r.timestamp),Ie.createElement("br",null),r.faces.map((o,a)=>(console.log(`${o} -- ${i[o]}`),Ie.createElement("img",{key:a,src:i[o],alt:o})))))),Ie.createElement("button",{id:"history-button",onClick:()=>t(!e)},e?"Hide":"History"))},uF="/kdm-roller/assets/founding-stone-M0drDRkM.png",hF="/kdm-roller/assets/cloth-TKi-tOqs.png",s_={BANDAGES:{Keywords:["item"],Stats:{},Origin:"Skinnery",Terms:[],Affinities:["LB","DG"]},CLOTH:{Image:hF,Keywords:["armor"],Stats:{Armor:1,Location:"Waist"},Origin:"Starting Gear",Terms:[],Affinities:[]},"FOUNDING-STONE":{Image:uF,Keywords:["weapon","melee","stone"],Stats:{Speed:2,Accuracy:7,Strength:1},Origin:"Starting Gear",Terms:["Archive"],Affinities:[]},"RAWHIDE-BOOTS":{Keywords:["armor","set","rawhide"],Stats:{Armor:1,Location:"Legs"},Location:"Waist",Origin:"Skinnery",Terms:["Depart"],Affinities:[]},"RAWHIDE-DRUM":{Keywords:["item","rawhide","instrument","noisy"],Origin:"Skinnery",Stats:{},Terms:["Arrival","Encourage"],Affinities:["LG"]},"RAWHIDE-GLOVES":{Keywords:["armor","set","rawhide"],Stats:{Armor:1,Location:"Arms"},Origin:"Skinnery",Terms:["Depart"],Affinities:["LR"]},"RAWHIDE-HEADBAND":{Keywords:["armor","set","rawhide"],Stats:{Armor:1,Location:"Head"},Origin:"Skinnery",Terms:[],Affinities:["DB"]},"RAWHIDE-WHIP":{Keywords:["weapon","melee","whip","rawhide"],Stats:{Speed:3,Accuracy:7,Strength:1},Origin:"Skinnery",Terms:["Provoke","Priority Target"],Affinities:[]},"RAWHIDE-VEST":{Keywords:["armor","set","rawhide"],Stats:{Armor:1,Location:"Chest"},Origin:"Skinnery",Terms:[],Affinities:["UB","RR"]},"RAWHIDE-PANTS":{Keywords:["armor","set","rawhide"],Stats:{Armor:1,Location:"Waist"},Origin:"Skinnery",Terms:[],Affinities:[]}},dF={getCard:async e=>{let t={};return console.log(e),e?(e=e.toUpperCase(),s_.hasOwnProperty(e)?t.image=s_[e].Image:(console.error("Could not find card name for "+e),t.image="")):t.image="",t}};var RM={exports:{}},Eh={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fF=te,pF=Symbol.for("react.element"),mF=Symbol.for("react.fragment"),gF=Object.prototype.hasOwnProperty,vF=fF.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,yF={key:!0,ref:!0,__self:!0,__source:!0};function PM(n,e,t){var i,r={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)gF.call(e,i)&&!yF.hasOwnProperty(i)&&(r[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:pF,type:n,key:s,ref:o,props:r,_owner:vF.current}}Eh.Fragment=mF;Eh.jsx=PM;Eh.jsxs=PM;RM.exports=Eh;var or=RM.exports;const Km=te.createContext({});function bh(n){const e=te.useRef(null);return e.current===null&&(e.current=n()),e.current}const Ch=te.createContext(null),Ym=te.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class _F extends te.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const i=t.offsetParent,r=i instanceof HTMLElement&&i.offsetWidth||0,s=this.props.sizeRef.current;s.height=t.offsetHeight||0,s.width=t.offsetWidth||0,s.top=t.offsetTop,s.left=t.offsetLeft,s.right=r-s.width-s.left}return null}componentDidUpdate(){}render(){return this.props.children}}function xF({children:n,isPresent:e,anchorX:t}){const i=te.useId(),r=te.useRef(null),s=te.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:o}=te.useContext(Ym);return te.useInsertionEffect(()=>{const{width:a,height:l,top:c,left:u,right:d}=s.current;if(e||!r.current||!a||!l)return;const h=t==="left"?`left: ${u}`:`right: ${d}`;r.current.dataset.motionPopId=i;const f=document.createElement("style");return o&&(f.nonce=o),document.head.appendChild(f),f.sheet&&f.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${a}px !important;
            height: ${l}px !important;
            ${h}px !important;
            top: ${c}px !important;
          }
        `),()=>{document.head.removeChild(f)}},[e]),or.jsx(_F,{isPresent:e,childRef:r,sizeRef:s,children:te.cloneElement(n,{ref:r})})}const wF=({children:n,initial:e,isPresent:t,onExitComplete:i,custom:r,presenceAffectsLayout:s,mode:o,anchorX:a})=>{const l=bh(SF),c=te.useId(),u=te.useCallback(h=>{l.set(h,!0);for(const f of l.values())if(!f)return;i&&i()},[l,i]),d=te.useMemo(()=>({id:c,initial:e,isPresent:t,custom:r,onExitComplete:u,register:h=>(l.set(h,!1),()=>l.delete(h))}),s?[Math.random(),u]:[t,u]);return te.useMemo(()=>{l.forEach((h,f)=>l.set(f,!1))},[t]),te.useEffect(()=>{!t&&!l.size&&i&&i()},[t]),o==="popLayout"&&(n=or.jsx(xF,{isPresent:t,anchorX:a,children:n})),or.jsx(Ch.Provider,{value:d,children:n})};function SF(){return new Map}function LM(n=!0){const e=te.useContext(Ch);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:i,register:r}=e,s=te.useId();te.useEffect(()=>{n&&r(s)},[n]);const o=te.useCallback(()=>n&&i&&i(s),[s,i,n]);return!t&&i?[!1,o]:[!0]}const Yc=n=>n.key||"";function o_(n){const e=[];return te.Children.forEach(n,t=>{te.isValidElement(t)&&e.push(t)}),e}const $m=typeof window<"u",IM=$m?te.useLayoutEffect:te.useEffect,DM=({children:n,custom:e,initial:t=!0,onExitComplete:i,presenceAffectsLayout:r=!0,mode:s="sync",propagate:o=!1,anchorX:a="left"})=>{const[l,c]=LM(o),u=te.useMemo(()=>o_(n),[n]),d=o&&!l?[]:u.map(Yc),h=te.useRef(!0),f=te.useRef(u),m=bh(()=>new Map),[y,g]=te.useState(u),[p,v]=te.useState(u);IM(()=>{h.current=!1,f.current=u;for(let A=0;A<p.length;A++){const M=Yc(p[A]);d.includes(M)?m.delete(M):m.get(M)!==!0&&m.set(M,!1)}},[p,d.length,d.join("-")]);const _=[];if(u!==y){let A=[...u];for(let M=0;M<p.length;M++){const S=p[M],b=Yc(S);d.includes(b)||(A.splice(M,0,S),_.push(S))}s==="wait"&&_.length&&(A=_),v(o_(A)),g(u);return}const{forceRender:x}=te.useContext(Km);return or.jsx(or.Fragment,{children:p.map(A=>{const M=Yc(A),S=o&&!l?!1:u===p||d.includes(M),b=()=>{if(m.has(M))m.set(M,!0);else return;let T=!0;m.forEach(w=>{w||(T=!1)}),T&&(x==null||x(),v(f.current),o&&(c==null||c()),i&&i())};return or.jsx(wF,{isPresent:S,initial:!h.current||t?void 0:!1,custom:S?void 0:e,presenceAffectsLayout:r,mode:s,onExitComplete:S?void 0:b,anchorX:a,children:A},M)})})},Fn=n=>n;let NM=Fn;const MF={skipAnimations:!1,useManualTiming:!1};function AF(n){let e=new Set,t=new Set,i=!1,r=!1;const s=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function a(c){s.has(c)&&(l.schedule(c),n()),c(o)}const l={schedule:(c,u=!1,d=!1)=>{const f=d&&i?e:t;return u&&s.add(c),f.has(c)||f.add(c),c},cancel:c=>{t.delete(c),s.delete(c)},process:c=>{if(o=c,i){r=!0;return}i=!0,[e,t]=[t,e],e.forEach(a),e.clear(),i=!1,r&&(r=!1,l.process(c))}};return l}const $c=["read","resolveKeyframes","update","preRender","render","postRender"],TF=40;function kM(n,e){let t=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},s=()=>t=!0,o=$c.reduce((p,v)=>(p[v]=AF(s),p),{}),{read:a,resolveKeyframes:l,update:c,preRender:u,render:d,postRender:h}=o,f=()=>{const p=performance.now();t=!1,r.delta=i?1e3/60:Math.max(Math.min(p-r.timestamp,TF),1),r.timestamp=p,r.isProcessing=!0,a.process(r),l.process(r),c.process(r),u.process(r),d.process(r),h.process(r),r.isProcessing=!1,t&&e&&(i=!1,n(f))},m=()=>{t=!0,i=!0,r.isProcessing||n(f)};return{schedule:$c.reduce((p,v)=>{const _=o[v];return p[v]=(x,A=!1,M=!1)=>(t||m(),_.schedule(x,A,M)),p},{}),cancel:p=>{for(let v=0;v<$c.length;v++)o[$c[v]].cancel(p)},state:r,steps:o}}const{schedule:vt,cancel:Zr,state:$t,steps:tf}=kM(typeof requestAnimationFrame<"u"?requestAnimationFrame:Fn,!0),FM=te.createContext({strict:!1}),a_={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},ra={};for(const n in a_)ra[n]={isEnabled:e=>a_[n].some(t=>!!e[t])};function EF(n){for(const e in n)ra[e]={...ra[e],...n[e]}}const bF=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function $u(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||bF.has(n)}let UM=n=>!$u(n);function CF(n){n&&(UM=e=>e.startsWith("on")?!$u(e):n(e))}try{CF(require("@emotion/is-prop-valid").default)}catch{}function RF(n,e,t){const i={};for(const r in n)r==="values"&&typeof n.values=="object"||(UM(r)||t===!0&&$u(r)||!e&&!$u(r)||n.draggable&&r.startsWith("onDrag"))&&(i[r]=n[r]);return i}function PF(n){if(typeof Proxy>"u")return n;const e=new Map,t=(...i)=>n(...i);return new Proxy(t,{get:(i,r)=>r==="create"?n:(e.has(r)||e.set(r,n(r)),e.get(r))})}const Rh=te.createContext({});function Pl(n){return typeof n=="string"||Array.isArray(n)}function Ph(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const Zm=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Qm=["initial",...Zm];function Lh(n){return Ph(n.animate)||Qm.some(e=>Pl(n[e]))}function OM(n){return!!(Lh(n)||n.variants)}function LF(n,e){if(Lh(n)){const{initial:t,animate:i}=n;return{initial:t===!1||Pl(t)?t:void 0,animate:Pl(i)?i:void 0}}return n.inherit!==!1?e:{}}function IF(n){const{initial:e,animate:t}=LF(n,te.useContext(Rh));return te.useMemo(()=>({initial:e,animate:t}),[l_(e),l_(t)])}function l_(n){return Array.isArray(n)?n.join(" "):n}const DF=Symbol.for("motionComponentSymbol");function Mo(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function NF(n,e,t){return te.useCallback(i=>{i&&n.onMount&&n.onMount(i),e&&(i?e.mount(i):e.unmount()),t&&(typeof t=="function"?t(i):Mo(t)&&(t.current=i))},[e])}const Jm=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),kF="framerAppearId",BM="data-"+Jm(kF),{schedule:eg,cancel:QG}=kM(queueMicrotask,!1),zM=te.createContext({});function FF(n,e,t,i,r){var s,o;const{visualElement:a}=te.useContext(Rh),l=te.useContext(FM),c=te.useContext(Ch),u=te.useContext(Ym).reducedMotion,d=te.useRef(null);i=i||l.renderer,!d.current&&i&&(d.current=i(n,{visualState:e,parent:a,props:t,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:u}));const h=d.current,f=te.useContext(zM);h&&!h.projection&&r&&(h.type==="html"||h.type==="svg")&&UF(d.current,t,r,f);const m=te.useRef(!1);te.useInsertionEffect(()=>{h&&m.current&&h.update(t,c)});const y=t[BM],g=te.useRef(!!y&&!(!((s=window.MotionHandoffIsComplete)===null||s===void 0)&&s.call(window,y))&&((o=window.MotionHasOptimisedAnimation)===null||o===void 0?void 0:o.call(window,y)));return IM(()=>{h&&(m.current=!0,window.MotionIsMounted=!0,h.updateFeatures(),eg.render(h.render),g.current&&h.animationState&&h.animationState.animateChanges())}),te.useEffect(()=>{h&&(!g.current&&h.animationState&&h.animationState.animateChanges(),g.current&&(queueMicrotask(()=>{var p;(p=window.MotionHandoffMarkAsComplete)===null||p===void 0||p.call(window,y)}),g.current=!1))}),h}function UF(n,e,t,i){const{layoutId:r,layout:s,drag:o,dragConstraints:a,layoutScroll:l,layoutRoot:c}=e;n.projection=new t(n.latestValues,e["data-framer-portal-id"]?void 0:VM(n.parent)),n.projection.setOptions({layoutId:r,layout:s,alwaysMeasureLayout:!!o||a&&Mo(a),visualElement:n,animationType:typeof s=="string"?s:"both",initialPromotionConfig:i,layoutScroll:l,layoutRoot:c})}function VM(n){if(n)return n.options.allowProjection!==!1?n.projection:VM(n.parent)}function OF({preloadedFeatures:n,createVisualElement:e,useRender:t,useVisualState:i,Component:r}){var s,o;n&&EF(n);function a(c,u){let d;const h={...te.useContext(Ym),...c,layoutId:BF(c)},{isStatic:f}=h,m=IF(c),y=i(c,f);if(!f&&$m){zF();const g=VF(h);d=g.MeasureLayout,m.visualElement=FF(r,y,h,e,g.ProjectionNode)}return or.jsxs(Rh.Provider,{value:m,children:[d&&m.visualElement?or.jsx(d,{visualElement:m.visualElement,...h}):null,t(r,c,NF(y,m.visualElement,u),y,f,m.visualElement)]})}a.displayName=`motion.${typeof r=="string"?r:`create(${(o=(s=r.displayName)!==null&&s!==void 0?s:r.name)!==null&&o!==void 0?o:""})`}`;const l=te.forwardRef(a);return l[DF]=r,l}function BF({layoutId:n}){const e=te.useContext(Km).id;return e&&n!==void 0?e+"-"+n:n}function zF(n,e){te.useContext(FM).strict}function VF(n){const{drag:e,layout:t}=ra;if(!e&&!t)return{};const i={...e,...t};return{MeasureLayout:e!=null&&e.isEnabled(n)||t!=null&&t.isEnabled(n)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}const HF=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function tg(n){return typeof n!="string"||n.includes("-")?!1:!!(HF.indexOf(n)>-1||/[A-Z]/u.test(n))}function c_(n){const e=[{},{}];return n==null||n.values.forEach((t,i)=>{e[0][i]=t.get(),e[1][i]=t.getVelocity()}),e}function ng(n,e,t,i){if(typeof e=="function"){const[r,s]=c_(i);e=e(t!==void 0?t:n.custom,r,s)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[r,s]=c_(i);e=e(t!==void 0?t:n.custom,r,s)}return e}const xp=n=>Array.isArray(n),GF=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),WF=n=>xp(n)?n[n.length-1]||0:n,ln=n=>!!(n&&n.getVelocity);function fu(n){const e=ln(n)?n.get():n;return GF(e)?e.toValue():e}function jF({scrapeMotionValuesFromProps:n,createRenderState:e,onUpdate:t},i,r,s){const o={latestValues:XF(i,r,s,n),renderState:e()};return t&&(o.onMount=a=>t({props:i,current:a,...o}),o.onUpdate=a=>t(a)),o}const HM=n=>(e,t)=>{const i=te.useContext(Rh),r=te.useContext(Ch),s=()=>jF(n,e,i,r);return t?s():bh(s)};function XF(n,e,t,i){const r={},s=i(n,{});for(const h in s)r[h]=fu(s[h]);let{initial:o,animate:a}=n;const l=Lh(n),c=OM(n);e&&c&&!l&&n.inherit!==!1&&(o===void 0&&(o=e.initial),a===void 0&&(a=e.animate));let u=t?t.initial===!1:!1;u=u||o===!1;const d=u?a:o;if(d&&typeof d!="boolean"&&!Ph(d)){const h=Array.isArray(d)?d:[d];for(let f=0;f<h.length;f++){const m=ng(n,h[f]);if(m){const{transitionEnd:y,transition:g,...p}=m;for(const v in p){let _=p[v];if(Array.isArray(_)){const x=u?_.length-1:0;_=_[x]}_!==null&&(r[v]=_)}for(const v in y)r[v]=y[v]}}}return r}const ma=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Vs=new Set(ma),GM=n=>e=>typeof e=="string"&&e.startsWith(n),ig=GM("--"),qF=GM("var(--"),rg=n=>qF(n)?KF.test(n.split("/*")[0].trim()):!1,KF=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,WM=(n,e)=>e&&typeof n=="number"?e.transform(n):n,pr=(n,e,t)=>t>e?e:t<n?n:t,ga={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},Ll={...ga,transform:n=>pr(0,1,n)},Zc={...ga,default:1},Wl=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),br=Wl("deg"),Li=Wl("%"),Te=Wl("px"),YF=Wl("vh"),$F=Wl("vw"),u_={...Li,parse:n=>Li.parse(n)/100,transform:n=>Li.transform(n*100)},ZF={borderWidth:Te,borderTopWidth:Te,borderRightWidth:Te,borderBottomWidth:Te,borderLeftWidth:Te,borderRadius:Te,radius:Te,borderTopLeftRadius:Te,borderTopRightRadius:Te,borderBottomRightRadius:Te,borderBottomLeftRadius:Te,width:Te,maxWidth:Te,height:Te,maxHeight:Te,top:Te,right:Te,bottom:Te,left:Te,padding:Te,paddingTop:Te,paddingRight:Te,paddingBottom:Te,paddingLeft:Te,margin:Te,marginTop:Te,marginRight:Te,marginBottom:Te,marginLeft:Te,backgroundPositionX:Te,backgroundPositionY:Te},QF={rotate:br,rotateX:br,rotateY:br,rotateZ:br,scale:Zc,scaleX:Zc,scaleY:Zc,scaleZ:Zc,skew:br,skewX:br,skewY:br,distance:Te,translateX:Te,translateY:Te,translateZ:Te,x:Te,y:Te,z:Te,perspective:Te,transformPerspective:Te,opacity:Ll,originX:u_,originY:u_,originZ:Te},h_={...ga,transform:Math.round},sg={...ZF,...QF,zIndex:h_,size:Te,fillOpacity:Ll,strokeOpacity:Ll,numOctaves:h_},JF={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},eU=ma.length;function tU(n,e,t){let i="",r=!0;for(let s=0;s<eU;s++){const o=ma[s],a=n[o];if(a===void 0)continue;let l=!0;if(typeof a=="number"?l=a===(o.startsWith("scale")?1:0):l=parseFloat(a)===0,!l||t){const c=WM(a,sg[o]);if(!l){r=!1;const u=JF[o]||o;i+=`${u}(${c}) `}t&&(e[o]=c)}}return i=i.trim(),t?i=t(e,r?"":i):r&&(i="none"),i}function og(n,e,t){const{style:i,vars:r,transformOrigin:s}=n;let o=!1,a=!1;for(const l in e){const c=e[l];if(Vs.has(l)){o=!0;continue}else if(ig(l)){r[l]=c;continue}else{const u=WM(c,sg[l]);l.startsWith("origin")?(a=!0,s[l]=u):i[l]=u}}if(e.transform||(o||t?i.transform=tU(e,n.transform,t):i.transform&&(i.transform="none")),a){const{originX:l="50%",originY:c="50%",originZ:u=0}=s;i.transformOrigin=`${l} ${c} ${u}`}}const nU={offset:"stroke-dashoffset",array:"stroke-dasharray"},iU={offset:"strokeDashoffset",array:"strokeDasharray"};function rU(n,e,t=1,i=0,r=!0){n.pathLength=1;const s=r?nU:iU;n[s.offset]=Te.transform(-i);const o=Te.transform(e),a=Te.transform(t);n[s.array]=`${o} ${a}`}function d_(n,e,t){return typeof n=="string"?n:Te.transform(e+t*n)}function sU(n,e,t){const i=d_(e,n.x,n.width),r=d_(t,n.y,n.height);return`${i} ${r}`}function ag(n,{attrX:e,attrY:t,attrScale:i,originX:r,originY:s,pathLength:o,pathSpacing:a=1,pathOffset:l=0,...c},u,d){if(og(n,c,d),u){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:h,style:f,dimensions:m}=n;h.transform&&(m&&(f.transform=h.transform),delete h.transform),m&&(r!==void 0||s!==void 0||f.transform)&&(f.transformOrigin=sU(m,r!==void 0?r:.5,s!==void 0?s:.5)),e!==void 0&&(h.x=e),t!==void 0&&(h.y=t),i!==void 0&&(h.scale=i),o!==void 0&&rU(h,o,a,l,!1)}const lg=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),jM=()=>({...lg(),attrs:{}}),cg=n=>typeof n=="string"&&n.toLowerCase()==="svg";function XM(n,{style:e,vars:t},i,r){Object.assign(n.style,e,r&&r.getProjectionStyles(i));for(const s in t)n.style.setProperty(s,t[s])}const qM=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function KM(n,e,t,i){XM(n,e,void 0,i);for(const r in e.attrs)n.setAttribute(qM.has(r)?r:Jm(r),e.attrs[r])}const Il={};function oU(n){for(const e in n)Il[e]=n[e],ig(e)&&(Il[e].isCSSVariable=!0)}function YM(n,{layout:e,layoutId:t}){return Vs.has(n)||n.startsWith("origin")||(e||t!==void 0)&&(!!Il[n]||n==="opacity")}function ug(n,e,t){var i;const{style:r}=n,s={};for(const o in r)(ln(r[o])||e.style&&ln(e.style[o])||YM(o,n)||((i=t==null?void 0:t.getValue(o))===null||i===void 0?void 0:i.liveStyle)!==void 0)&&(s[o]=r[o]);return s}function $M(n,e,t){const i=ug(n,e,t);for(const r in n)if(ln(n[r])||ln(e[r])){const s=ma.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;i[s]=n[r]}return i}function aU(n,e){try{e.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const f_=["x","y","width","height","cx","cy","r"],lU={useVisualState:HM({scrapeMotionValuesFromProps:$M,createRenderState:jM,onUpdate:({props:n,prevProps:e,current:t,renderState:i,latestValues:r})=>{if(!t)return;let s=!!n.drag;if(!s){for(const a in r)if(Vs.has(a)){s=!0;break}}if(!s)return;let o=!e;if(e)for(let a=0;a<f_.length;a++){const l=f_[a];n[l]!==e[l]&&(o=!0)}o&&vt.read(()=>{aU(t,i),vt.render(()=>{ag(i,r,cg(t.tagName),n.transformTemplate),KM(t,i)})})}})},cU={useVisualState:HM({scrapeMotionValuesFromProps:ug,createRenderState:lg})};function ZM(n,e,t){for(const i in e)!ln(e[i])&&!YM(i,t)&&(n[i]=e[i])}function uU({transformTemplate:n},e){return te.useMemo(()=>{const t=lg();return og(t,e,n),Object.assign({},t.vars,t.style)},[e])}function hU(n,e){const t=n.style||{},i={};return ZM(i,t,n),Object.assign(i,uU(n,e)),i}function dU(n,e){const t={},i=hU(n,e);return n.drag&&n.dragListener!==!1&&(t.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(t.tabIndex=0),t.style=i,t}function fU(n,e,t,i){const r=te.useMemo(()=>{const s=jM();return ag(s,e,cg(i),n.transformTemplate),{...s.attrs,style:{...s.style}}},[e]);if(n.style){const s={};ZM(s,n.style,n),r.style={...s,...r.style}}return r}function pU(n=!1){return(t,i,r,{latestValues:s},o)=>{const l=(tg(t)?fU:dU)(i,s,o,t),c=RF(i,typeof t=="string",n),u=t!==te.Fragment?{...c,...l,ref:r}:{},{children:d}=i,h=te.useMemo(()=>ln(d)?d.get():d,[d]);return te.createElement(t,{...u,children:h})}}function mU(n,e){return function(i,{forwardMotionProps:r}={forwardMotionProps:!1}){const o={...tg(i)?lU:cU,preloadedFeatures:n,useRender:pU(r),createVisualElement:e,Component:i};return OF(o)}}function QM(n,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==n.length)return!1;for(let i=0;i<t;i++)if(e[i]!==n[i])return!1;return!0}function Ih(n,e,t){const i=n.getProps();return ng(i,e,t!==void 0?t:i.custom,n)}function hg(n,e){return n?n[e]||n.default||n:void 0}const JM=new Set(["width","height","top","left","right","bottom",...ma]);let pu;function gU(){pu=void 0}const Ii={now:()=>(pu===void 0&&Ii.set($t.isProcessing||MF.useManualTiming?$t.timestamp:performance.now()),pu),set:n=>{pu=n,queueMicrotask(gU)}};function dg(n,e){n.indexOf(e)===-1&&n.push(e)}function fg(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}class pg{constructor(){this.subscriptions=[]}add(e){return dg(this.subscriptions,e),()=>fg(this.subscriptions,e)}notify(e,t,i){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,t,i);else for(let s=0;s<r;s++){const o=this.subscriptions[s];o&&o(e,t,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function eA(n,e){return e?n*(1e3/e):0}const p_=30,vU=n=>!isNaN(parseFloat(n));class yU{constructor(e,t={}){this.version="12.0.5",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(i,r=!0)=>{const s=Ii.now();this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),r&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=Ii.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=vU(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new pg);const i=this.events[e].add(t);return e==="change"?()=>{i(),vt.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){!t||!this.passiveEffect?this.updateAndNotify(e,t):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,t,i){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-i}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Ii.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>p_)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,p_);return eA(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Dl(n,e){return new yU(n,e)}function _U(n,e,t){n.hasValue(e)?n.getValue(e).set(t):n.addValue(e,Dl(t))}function xU(n,e){const t=Ih(n,e);let{transitionEnd:i={},transition:r={},...s}=t||{};s={...s,...i};for(const o in s){const a=WF(s[o]);_U(n,o,a)}}function wU(n){return!!(ln(n)&&n.add)}function wp(n,e){const t=n.getValue("willChange");if(wU(t))return t.add(e)}function tA(n){return n.props[BM]}function mg(n){let e;return()=>(e===void 0&&(e=n()),e)}const SU=mg(()=>window.ScrollTimeline!==void 0);class MU{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,t){for(let i=0;i<this.animations.length;i++)this.animations[i][e]=t}attachTimeline(e,t){const i=this.animations.map(r=>{if(SU()&&r.attachTimeline)return r.attachTimeline(e);if(typeof t=="function")return t(r)});return()=>{i.forEach((r,s)=>{r&&r(),this.animations[s].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let t=0;t<this.animations.length;t++)e=Math.max(e,this.animations[t].duration);return e}runAll(e){this.animations.forEach(t=>t[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class AU extends MU{then(e,t){return Promise.all(this.animations).then(e).catch(t)}}const ar=n=>n*1e3,lr=n=>n/1e3;function gg(n){return typeof n=="function"}function m_(n,e){n.timeline=e,n.onfinish=null}const vg=n=>Array.isArray(n)&&typeof n[0]=="number",TU={linearEasing:void 0};function EU(n,e){const t=mg(n);return()=>{var i;return(i=TU[e])!==null&&i!==void 0?i:t()}}const Zu=EU(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),sa=(n,e,t)=>{const i=e-n;return i===0?1:(t-n)/i},nA=(n,e,t=10)=>{let i="";const r=Math.max(Math.round(e/t),2);for(let s=0;s<r;s++)i+=n(sa(0,r-1,s))+", ";return`linear(${i.substring(0,i.length-2)})`};function iA(n){return!!(typeof n=="function"&&Zu()||!n||typeof n=="string"&&(n in Sp||Zu())||vg(n)||Array.isArray(n)&&n.every(iA))}const ja=([n,e,t,i])=>`cubic-bezier(${n}, ${e}, ${t}, ${i})`,Sp={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:ja([0,.65,.55,1]),circOut:ja([.55,0,1,.45]),backIn:ja([.31,.01,.66,-.59]),backOut:ja([.33,1.53,.69,.99])};function rA(n,e){if(n)return typeof n=="function"&&Zu()?nA(n,e):vg(n)?ja(n):Array.isArray(n)?n.map(t=>rA(t,e)||Sp.easeOut):Sp[n]}const sA=(n,e,t)=>(((1-3*t+3*e)*n+(3*t-6*e))*n+3*e)*n,bU=1e-7,CU=12;function RU(n,e,t,i,r){let s,o,a=0;do o=e+(t-e)/2,s=sA(o,i,r)-n,s>0?t=o:e=o;while(Math.abs(s)>bU&&++a<CU);return o}function jl(n,e,t,i){if(n===e&&t===i)return Fn;const r=s=>RU(s,0,1,n,t);return s=>s===0||s===1?s:sA(r(s),e,i)}const oA=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,aA=n=>e=>1-n(1-e),lA=jl(.33,1.53,.69,.99),yg=aA(lA),cA=oA(yg),uA=n=>(n*=2)<1?.5*yg(n):.5*(2-Math.pow(2,-10*(n-1))),_g=n=>1-Math.sin(Math.acos(n)),hA=aA(_g),dA=oA(_g),fA=n=>/^0[^.\s]+$/u.test(n);function PU(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||fA(n):!0}const ol=n=>Math.round(n*1e5)/1e5,xg=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function LU(n){return n==null}const IU=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,wg=(n,e)=>t=>!!(typeof t=="string"&&IU.test(t)&&t.startsWith(n)||e&&!LU(t)&&Object.prototype.hasOwnProperty.call(t,e)),pA=(n,e,t)=>i=>{if(typeof i!="string")return i;const[r,s,o,a]=i.match(xg);return{[n]:parseFloat(r),[e]:parseFloat(s),[t]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},DU=n=>pr(0,255,n),nf={...ga,transform:n=>Math.round(DU(n))},Rs={test:wg("rgb","red"),parse:pA("red","green","blue"),transform:({red:n,green:e,blue:t,alpha:i=1})=>"rgba("+nf.transform(n)+", "+nf.transform(e)+", "+nf.transform(t)+", "+ol(Ll.transform(i))+")"};function NU(n){let e="",t="",i="",r="";return n.length>5?(e=n.substring(1,3),t=n.substring(3,5),i=n.substring(5,7),r=n.substring(7,9)):(e=n.substring(1,2),t=n.substring(2,3),i=n.substring(3,4),r=n.substring(4,5),e+=e,t+=t,i+=i,r+=r),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}}const Mp={test:wg("#"),parse:NU,transform:Rs.transform},Ao={test:wg("hsl","hue"),parse:pA("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:t,alpha:i=1})=>"hsla("+Math.round(n)+", "+Li.transform(ol(e))+", "+Li.transform(ol(t))+", "+ol(Ll.transform(i))+")"},sn={test:n=>Rs.test(n)||Mp.test(n)||Ao.test(n),parse:n=>Rs.test(n)?Rs.parse(n):Ao.test(n)?Ao.parse(n):Mp.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?Rs.transform(n):Ao.transform(n)},kU=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function FU(n){var e,t;return isNaN(n)&&typeof n=="string"&&(((e=n.match(xg))===null||e===void 0?void 0:e.length)||0)+(((t=n.match(kU))===null||t===void 0?void 0:t.length)||0)>0}const mA="number",gA="color",UU="var",OU="var(",g_="${}",BU=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Nl(n){const e=n.toString(),t=[],i={color:[],number:[],var:[]},r=[];let s=0;const a=e.replace(BU,l=>(sn.test(l)?(i.color.push(s),r.push(gA),t.push(sn.parse(l))):l.startsWith(OU)?(i.var.push(s),r.push(UU),t.push(l)):(i.number.push(s),r.push(mA),t.push(parseFloat(l))),++s,g_)).split(g_);return{values:t,split:a,indexes:i,types:r}}function vA(n){return Nl(n).values}function yA(n){const{split:e,types:t}=Nl(n),i=e.length;return r=>{let s="";for(let o=0;o<i;o++)if(s+=e[o],r[o]!==void 0){const a=t[o];a===mA?s+=ol(r[o]):a===gA?s+=sn.transform(r[o]):s+=r[o]}return s}}const zU=n=>typeof n=="number"?0:n;function VU(n){const e=vA(n);return yA(n)(e.map(zU))}const Qr={test:FU,parse:vA,createTransformer:yA,getAnimatableNone:VU},HU=new Set(["brightness","contrast","saturate","opacity"]);function GU(n){const[e,t]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[i]=t.match(xg)||[];if(!i)return n;const r=t.replace(i,"");let s=HU.has(e)?1:0;return i!==t&&(s*=100),e+"("+s+r+")"}const WU=/\b([a-z-]*)\(.*?\)/gu,Ap={...Qr,getAnimatableNone:n=>{const e=n.match(WU);return e?e.map(GU).join(" "):n}},jU={...sg,color:sn,backgroundColor:sn,outlineColor:sn,fill:sn,stroke:sn,borderColor:sn,borderTopColor:sn,borderRightColor:sn,borderBottomColor:sn,borderLeftColor:sn,filter:Ap,WebkitFilter:Ap},Sg=n=>jU[n];function _A(n,e){let t=Sg(n);return t!==Ap&&(t=Qr),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const XU=new Set(["auto","none","0"]);function qU(n,e,t){let i=0,r;for(;i<n.length&&!r;){const s=n[i];typeof s=="string"&&!XU.has(s)&&Nl(s).values.length&&(r=n[i]),i++}if(r&&t)for(const s of e)n[s]=_A(t,r)}const v_=n=>n===ga||n===Te,y_=(n,e)=>parseFloat(n.split(", ")[e]),__=(n,e)=>(t,{transform:i})=>{if(i==="none"||!i)return 0;const r=i.match(/^matrix3d\((.+)\)$/u);if(r)return y_(r[1],e);{const s=i.match(/^matrix\((.+)\)$/u);return s?y_(s[1],n):0}},KU=new Set(["x","y","z"]),YU=ma.filter(n=>!KU.has(n));function $U(n){const e=[];return YU.forEach(t=>{const i=n.getValue(t);i!==void 0&&(e.push([t,i.get()]),i.set(t.startsWith("scale")?1:0))}),e}const oa={width:({x:n},{paddingLeft:e="0",paddingRight:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),height:({y:n},{paddingTop:e="0",paddingBottom:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:__(4,13),y:__(5,14)};oa.translateX=oa.x;oa.translateY=oa.y;const Is=new Set;let Tp=!1,Ep=!1;function xA(){if(Ep){const n=Array.from(Is).filter(i=>i.needsMeasurement),e=new Set(n.map(i=>i.element)),t=new Map;e.forEach(i=>{const r=$U(i);r.length&&(t.set(i,r),i.render())}),n.forEach(i=>i.measureInitialState()),e.forEach(i=>{i.render();const r=t.get(i);r&&r.forEach(([s,o])=>{var a;(a=i.getValue(s))===null||a===void 0||a.set(o)})}),n.forEach(i=>i.measureEndState()),n.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}Ep=!1,Tp=!1,Is.forEach(n=>n.complete()),Is.clear()}function wA(){Is.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(Ep=!0)})}function ZU(){wA(),xA()}class Mg{constructor(e,t,i,r,s,o=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=i,this.motionValue=r,this.element=s,this.isAsync=o}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Is.add(this),Tp||(Tp=!0,vt.read(wA),vt.resolveKeyframes(xA))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:i,motionValue:r}=this;for(let s=0;s<e.length;s++)if(e[s]===null)if(s===0){const o=r==null?void 0:r.get(),a=e[e.length-1];if(o!==void 0)e[0]=o;else if(i&&t){const l=i.readValue(t,a);l!=null&&(e[0]=l)}e[0]===void 0&&(e[0]=a),r&&o===void 0&&r.set(e[0])}else e[s]=e[s-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Is.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Is.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const SA=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),QU=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function JU(n){const e=QU.exec(n);if(!e)return[,];const[,t,i,r]=e;return[`--${t??i}`,r]}function MA(n,e,t=1){const[i,r]=JU(n);if(!i)return;const s=window.getComputedStyle(e).getPropertyValue(i);if(s){const o=s.trim();return SA(o)?parseFloat(o):o}return rg(r)?MA(r,e,t+1):r}const AA=n=>e=>e.test(n),e3={test:n=>n==="auto",parse:n=>n},TA=[ga,Te,Li,br,$F,YF,e3],x_=n=>TA.find(AA(n));class EA extends Mg{constructor(e,t,i,r,s){super(e,t,i,r,s,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:i}=this;if(!t||!t.current)return;super.readKeyframes();for(let l=0;l<e.length;l++){let c=e[l];if(typeof c=="string"&&(c=c.trim(),rg(c))){const u=MA(c,t.current);u!==void 0&&(e[l]=u),l===e.length-1&&(this.finalKeyframe=c)}}if(this.resolveNoneKeyframes(),!JM.has(i)||e.length!==2)return;const[r,s]=e,o=x_(r),a=x_(s);if(o!==a)if(v_(o)&&v_(a))for(let l=0;l<e.length;l++){const c=e[l];typeof c=="string"&&(e[l]=parseFloat(c))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,i=[];for(let r=0;r<e.length;r++)PU(e[r])&&i.push(r);i.length&&qU(e,i,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:i}=this;if(!e||!e.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=oa[i](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const r=t[t.length-1];r!==void 0&&e.getValue(i,r).jump(r,!1)}measureEndState(){var e;const{element:t,name:i,unresolvedKeyframes:r}=this;if(!t||!t.current)return;const s=t.getValue(i);s&&s.jump(this.measuredOrigin,!1);const o=r.length-1,a=r[o];r[o]=oa[i](t.measureViewportBox(),window.getComputedStyle(t.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([l,c])=>{t.getValue(l).set(c)}),this.resolveNoneKeyframes()}}const w_=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(Qr.test(n)||n==="0")&&!n.startsWith("url("));function t3(n){const e=n[0];if(n.length===1)return!0;for(let t=0;t<n.length;t++)if(n[t]!==e)return!0}function n3(n,e,t,i){const r=n[0];if(r===null)return!1;if(e==="display"||e==="visibility")return!0;const s=n[n.length-1],o=w_(r,e),a=w_(s,e);return!o||!a?!1:t3(n)||(t==="spring"||gg(t))&&i}const i3=n=>n!==null;function Dh(n,{repeat:e,repeatType:t="loop"},i){const r=n.filter(i3),s=e&&t!=="loop"&&e%2===1?0:r.length-1;return!s||i===void 0?r[s]:i}const r3=40;class bA{constructor({autoplay:e=!0,delay:t=0,type:i="keyframes",repeat:r=0,repeatDelay:s=0,repeatType:o="loop",...a}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Ii.now(),this.options={autoplay:e,delay:t,type:i,repeat:r,repeatDelay:s,repeatType:o,...a},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>r3?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&ZU(),this._resolved}onKeyframesResolved(e,t){this.resolvedAt=Ii.now(),this.hasAttemptedResolve=!0;const{name:i,type:r,velocity:s,delay:o,onComplete:a,onUpdate:l,isGenerator:c}=this.options;if(!c&&!n3(e,i,r,s))if(o)this.options.duration=0;else{l&&l(Dh(e,this.options,t)),a&&a(),this.resolveFinishedPromise();return}const u=this.initPlayback(e,t);u!==!1&&(this._resolved={keyframes:e,finalKeyframe:t,...u},this.onPostResolved())}onPostResolved(){}then(e,t){return this.currentFinishedPromise.then(e,t)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const bp=2e4;function CA(n){let e=0;const t=50;let i=n.next(e);for(;!i.done&&e<bp;)e+=t,i=n.next(e);return e>=bp?1/0:e}const wt=(n,e,t)=>n+(e-n)*t;function rf(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function s3({hue:n,saturation:e,lightness:t,alpha:i}){n/=360,e/=100,t/=100;let r=0,s=0,o=0;if(!e)r=s=o=t;else{const a=t<.5?t*(1+e):t+e-t*e,l=2*t-a;r=rf(l,a,n+1/3),s=rf(l,a,n),o=rf(l,a,n-1/3)}return{red:Math.round(r*255),green:Math.round(s*255),blue:Math.round(o*255),alpha:i}}function Qu(n,e){return t=>t>0?e:n}const sf=(n,e,t)=>{const i=n*n,r=t*(e*e-i)+i;return r<0?0:Math.sqrt(r)},o3=[Mp,Rs,Ao],a3=n=>o3.find(e=>e.test(n));function S_(n){const e=a3(n);if(!e)return!1;let t=e.parse(n);return e===Ao&&(t=s3(t)),t}const M_=(n,e)=>{const t=S_(n),i=S_(e);if(!t||!i)return Qu(n,e);const r={...t};return s=>(r.red=sf(t.red,i.red,s),r.green=sf(t.green,i.green,s),r.blue=sf(t.blue,i.blue,s),r.alpha=wt(t.alpha,i.alpha,s),Rs.transform(r))},l3=(n,e)=>t=>e(n(t)),Xl=(...n)=>n.reduce(l3),Cp=new Set(["none","hidden"]);function c3(n,e){return Cp.has(n)?t=>t<=0?n:e:t=>t>=1?e:n}function u3(n,e){return t=>wt(n,e,t)}function Ag(n){return typeof n=="number"?u3:typeof n=="string"?rg(n)?Qu:sn.test(n)?M_:f3:Array.isArray(n)?RA:typeof n=="object"?sn.test(n)?M_:h3:Qu}function RA(n,e){const t=[...n],i=t.length,r=n.map((s,o)=>Ag(s)(s,e[o]));return s=>{for(let o=0;o<i;o++)t[o]=r[o](s);return t}}function h3(n,e){const t={...n,...e},i={};for(const r in t)n[r]!==void 0&&e[r]!==void 0&&(i[r]=Ag(n[r])(n[r],e[r]));return r=>{for(const s in i)t[s]=i[s](r);return t}}function d3(n,e){var t;const i=[],r={color:0,var:0,number:0};for(let s=0;s<e.values.length;s++){const o=e.types[s],a=n.indexes[o][r[o]],l=(t=n.values[a])!==null&&t!==void 0?t:0;i[s]=l,r[o]++}return i}const f3=(n,e)=>{const t=Qr.createTransformer(e),i=Nl(n),r=Nl(e);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?Cp.has(n)&&!r.values.length||Cp.has(e)&&!i.values.length?c3(n,e):Xl(RA(d3(i,r),r.values),t):Qu(n,e)};function PA(n,e,t){return typeof n=="number"&&typeof e=="number"&&typeof t=="number"?wt(n,e,t):Ag(n)(n,e)}const p3=5;function LA(n,e,t){const i=Math.max(e-p3,0);return eA(t-n(i),e-i)}const bt={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},of=.001;function m3({duration:n=bt.duration,bounce:e=bt.bounce,velocity:t=bt.velocity,mass:i=bt.mass}){let r,s,o=1-e;o=pr(bt.minDamping,bt.maxDamping,o),n=pr(bt.minDuration,bt.maxDuration,lr(n)),o<1?(r=c=>{const u=c*o,d=u*n,h=u-t,f=Rp(c,o),m=Math.exp(-d);return of-h/f*m},s=c=>{const d=c*o*n,h=d*t+t,f=Math.pow(o,2)*Math.pow(c,2)*n,m=Math.exp(-d),y=Rp(Math.pow(c,2),o);return(-r(c)+of>0?-1:1)*((h-f)*m)/y}):(r=c=>{const u=Math.exp(-c*n),d=(c-t)*n+1;return-of+u*d},s=c=>{const u=Math.exp(-c*n),d=(t-c)*(n*n);return u*d});const a=5/n,l=v3(r,s,a);if(n=ar(n),isNaN(l))return{stiffness:bt.stiffness,damping:bt.damping,duration:n};{const c=Math.pow(l,2)*i;return{stiffness:c,damping:o*2*Math.sqrt(i*c),duration:n}}}const g3=12;function v3(n,e,t){let i=t;for(let r=1;r<g3;r++)i=i-n(i)/e(i);return i}function Rp(n,e){return n*Math.sqrt(1-e*e)}const y3=["duration","bounce"],_3=["stiffness","damping","mass"];function A_(n,e){return e.some(t=>n[t]!==void 0)}function x3(n){let e={velocity:bt.velocity,stiffness:bt.stiffness,damping:bt.damping,mass:bt.mass,isResolvedFromDuration:!1,...n};if(!A_(n,_3)&&A_(n,y3))if(n.visualDuration){const t=n.visualDuration,i=2*Math.PI/(t*1.2),r=i*i,s=2*pr(.05,1,1-(n.bounce||0))*Math.sqrt(r);e={...e,mass:bt.mass,stiffness:r,damping:s}}else{const t=m3(n);e={...e,...t,mass:bt.mass},e.isResolvedFromDuration=!0}return e}function IA(n=bt.visualDuration,e=bt.bounce){const t=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:i,restDelta:r}=t;const s=t.keyframes[0],o=t.keyframes[t.keyframes.length-1],a={done:!1,value:s},{stiffness:l,damping:c,mass:u,duration:d,velocity:h,isResolvedFromDuration:f}=x3({...t,velocity:-lr(t.velocity||0)}),m=h||0,y=c/(2*Math.sqrt(l*u)),g=o-s,p=lr(Math.sqrt(l/u)),v=Math.abs(g)<5;i||(i=v?bt.restSpeed.granular:bt.restSpeed.default),r||(r=v?bt.restDelta.granular:bt.restDelta.default);let _;if(y<1){const A=Rp(p,y);_=M=>{const S=Math.exp(-y*p*M);return o-S*((m+y*p*g)/A*Math.sin(A*M)+g*Math.cos(A*M))}}else if(y===1)_=A=>o-Math.exp(-p*A)*(g+(m+p*g)*A);else{const A=p*Math.sqrt(y*y-1);_=M=>{const S=Math.exp(-y*p*M),b=Math.min(A*M,300);return o-S*((m+y*p*g)*Math.sinh(b)+A*g*Math.cosh(b))/A}}const x={calculatedDuration:f&&d||null,next:A=>{const M=_(A);if(f)a.done=A>=d;else{let S=0;y<1&&(S=A===0?ar(m):LA(_,A,M));const b=Math.abs(S)<=i,T=Math.abs(o-M)<=r;a.done=b&&T}return a.value=a.done?o:M,a},toString:()=>{const A=Math.min(CA(x),bp),M=nA(S=>x.next(A*S).value,A,30);return A+"ms "+M}};return x}function T_({keyframes:n,velocity:e=0,power:t=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:s=500,modifyTarget:o,min:a,max:l,restDelta:c=.5,restSpeed:u}){const d=n[0],h={done:!1,value:d},f=b=>a!==void 0&&b<a||l!==void 0&&b>l,m=b=>a===void 0?l:l===void 0||Math.abs(a-b)<Math.abs(l-b)?a:l;let y=t*e;const g=d+y,p=o===void 0?g:o(g);p!==g&&(y=p-d);const v=b=>-y*Math.exp(-b/i),_=b=>p+v(b),x=b=>{const T=v(b),w=_(b);h.done=Math.abs(T)<=c,h.value=h.done?p:w};let A,M;const S=b=>{f(h.value)&&(A=b,M=IA({keyframes:[h.value,m(h.value)],velocity:LA(_,b,h.value),damping:r,stiffness:s,restDelta:c,restSpeed:u}))};return S(0),{calculatedDuration:null,next:b=>{let T=!1;return!M&&A===void 0&&(T=!0,x(b),S(b)),A!==void 0&&b>=A?M.next(b-A):(!T&&x(b),h)}}}const w3=jl(.42,0,1,1),S3=jl(0,0,.58,1),DA=jl(.42,0,.58,1),M3=n=>Array.isArray(n)&&typeof n[0]!="number",A3={linear:Fn,easeIn:w3,easeInOut:DA,easeOut:S3,circIn:_g,circInOut:dA,circOut:hA,backIn:yg,backInOut:cA,backOut:lA,anticipate:uA},E_=n=>{if(vg(n)){NM(n.length===4);const[e,t,i,r]=n;return jl(e,t,i,r)}else if(typeof n=="string")return A3[n];return n};function T3(n,e,t){const i=[],r=t||PA,s=n.length-1;for(let o=0;o<s;o++){let a=r(n[o],n[o+1]);if(e){const l=Array.isArray(e)?e[o]||Fn:e;a=Xl(l,a)}i.push(a)}return i}function E3(n,e,{clamp:t=!0,ease:i,mixer:r}={}){const s=n.length;if(NM(s===e.length),s===1)return()=>e[0];if(s===2&&e[0]===e[1])return()=>e[1];const o=n[0]===n[1];n[0]>n[s-1]&&(n=[...n].reverse(),e=[...e].reverse());const a=T3(e,i,r),l=a.length,c=u=>{if(o&&u<n[0])return e[0];let d=0;if(l>1)for(;d<n.length-2&&!(u<n[d+1]);d++);const h=sa(n[d],n[d+1],u);return a[d](h)};return t?u=>c(pr(n[0],n[s-1],u)):c}function b3(n,e){const t=n[n.length-1];for(let i=1;i<=e;i++){const r=sa(0,e,i);n.push(wt(t,1,r))}}function C3(n){const e=[0];return b3(e,n.length-1),e}function R3(n,e){return n.map(t=>t*e)}function P3(n,e){return n.map(()=>e||DA).splice(0,n.length-1)}function Ju({duration:n=300,keyframes:e,times:t,ease:i="easeInOut"}){const r=M3(i)?i.map(E_):E_(i),s={done:!1,value:e[0]},o=R3(t&&t.length===e.length?t:C3(e),n),a=E3(o,e,{ease:Array.isArray(r)?r:P3(e,r)});return{calculatedDuration:n,next:l=>(s.value=a(l),s.done=l>=n,s)}}const L3=n=>{const e=({timestamp:t})=>n(t);return{start:()=>vt.update(e,!0),stop:()=>Zr(e),now:()=>$t.isProcessing?$t.timestamp:Ii.now()}},I3={decay:T_,inertia:T_,tween:Ju,keyframes:Ju,spring:IA},D3=n=>n/100;class Tg extends bA{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:l}=this.options;l&&l()};const{name:t,motionValue:i,element:r,keyframes:s}=this.options,o=(r==null?void 0:r.KeyframeResolver)||Mg,a=(l,c)=>this.onKeyframesResolved(l,c);this.resolver=new o(s,a,t,i,r),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:t="keyframes",repeat:i=0,repeatDelay:r=0,repeatType:s,velocity:o=0}=this.options,a=gg(t)?t:I3[t]||Ju;let l,c;a!==Ju&&typeof e[0]!="number"&&(l=Xl(D3,PA(e[0],e[1])),e=[0,100]);const u=a({...this.options,keyframes:e});s==="mirror"&&(c=a({...this.options,keyframes:[...e].reverse(),velocity:-o})),u.calculatedDuration===null&&(u.calculatedDuration=CA(u));const{calculatedDuration:d}=u,h=d+r,f=h*(i+1)-r;return{generator:u,mirroredGenerator:c,mapPercentToKeyframes:l,calculatedDuration:d,resolvedDuration:h,totalDuration:f}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,t=!1){const{resolved:i}=this;if(!i){const{keyframes:b}=this.options;return{done:!0,value:b[b.length-1]}}const{finalKeyframe:r,generator:s,mirroredGenerator:o,mapPercentToKeyframes:a,keyframes:l,calculatedDuration:c,totalDuration:u,resolvedDuration:d}=i;if(this.startTime===null)return s.next(0);const{delay:h,repeat:f,repeatType:m,repeatDelay:y,onUpdate:g}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-u/this.speed,this.startTime)),t?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const p=this.currentTime-h*(this.speed>=0?1:-1),v=this.speed>=0?p<0:p>u;this.currentTime=Math.max(p,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=u);let _=this.currentTime,x=s;if(f){const b=Math.min(this.currentTime,u)/d;let T=Math.floor(b),w=b%1;!w&&b>=1&&(w=1),w===1&&T--,T=Math.min(T,f+1),!!(T%2)&&(m==="reverse"?(w=1-w,y&&(w-=y/d)):m==="mirror"&&(x=o)),_=pr(0,1,w)*d}const A=v?{done:!1,value:l[0]}:x.next(_);a&&(A.value=a(A.value));let{done:M}=A;!v&&c!==null&&(M=this.speed>=0?this.currentTime>=u:this.currentTime<=0);const S=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&M);return S&&r!==void 0&&(A.value=Dh(l,this.options,r)),g&&g(A.value),S&&this.finish(),A}get duration(){const{resolved:e}=this;return e?lr(e.calculatedDuration):0}get time(){return lr(this.currentTime)}set time(e){e=ar(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=lr(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=L3,onPlay:t,startTime:i}=this.options;this.driver||(this.driver=e(s=>this.tick(s))),t&&t();const r=this.driver.now();this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=r):this.startTime=i??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const N3=new Set(["opacity","clipPath","filter","transform"]);function k3(n,e,t,{delay:i=0,duration:r=300,repeat:s=0,repeatType:o="loop",ease:a="easeInOut",times:l}={}){const c={[e]:t};l&&(c.offset=l);const u=rA(a,r);return Array.isArray(u)&&(c.easing=u),n.animate(c,{delay:i,duration:r,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:s+1,direction:o==="reverse"?"alternate":"normal"})}const F3=mg(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),eh=10,U3=2e4;function O3(n){return gg(n.type)||n.type==="spring"||!iA(n.ease)}function B3(n,e){const t=new Tg({...e,keyframes:n,repeat:0,delay:0,isGenerator:!0});let i={done:!1,value:n[0]};const r=[];let s=0;for(;!i.done&&s<U3;)i=t.sample(s),r.push(i.value),s+=eh;return{times:void 0,keyframes:r,duration:s-eh,ease:"linear"}}const NA={anticipate:uA,backInOut:cA,circInOut:dA};function z3(n){return n in NA}class b_ extends bA{constructor(e){super(e);const{name:t,motionValue:i,element:r,keyframes:s}=this.options;this.resolver=new EA(s,(o,a)=>this.onKeyframesResolved(o,a),t,i,r),this.resolver.scheduleResolve()}initPlayback(e,t){let{duration:i=300,times:r,ease:s,type:o,motionValue:a,name:l,startTime:c}=this.options;if(!a.owner||!a.owner.current)return!1;if(typeof s=="string"&&Zu()&&z3(s)&&(s=NA[s]),O3(this.options)){const{onComplete:d,onUpdate:h,motionValue:f,element:m,...y}=this.options,g=B3(e,y);e=g.keyframes,e.length===1&&(e[1]=e[0]),i=g.duration,r=g.times,s=g.ease,o="keyframes"}const u=k3(a.owner.current,l,e,{...this.options,duration:i,times:r,ease:s});return u.startTime=c??this.calcStartTime(),this.pendingTimeline?(m_(u,this.pendingTimeline),this.pendingTimeline=void 0):u.onfinish=()=>{const{onComplete:d}=this.options;a.set(Dh(e,this.options,t)),d&&d(),this.cancel(),this.resolveFinishedPromise()},{animation:u,duration:i,times:r,type:o,ease:s,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:t}=e;return lr(t)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:t}=e;return lr(t.currentTime||0)}set time(e){const{resolved:t}=this;if(!t)return;const{animation:i}=t;i.currentTime=ar(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:t}=e;return t.playbackRate}set speed(e){const{resolved:t}=this;if(!t)return;const{animation:i}=t;i.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:t}=e;return t.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:t}=e;return t.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:t}=this;if(!t)return Fn;const{animation:i}=t;m_(i,e)}return Fn}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:t}=e;t.playState==="finished"&&this.updateFinishedPromise(),t.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:t}=e;t.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:t,keyframes:i,duration:r,type:s,ease:o,times:a}=e;if(t.playState==="idle"||t.playState==="finished")return;if(this.time){const{motionValue:c,onUpdate:u,onComplete:d,element:h,...f}=this.options,m=new Tg({...f,keyframes:i,duration:r,type:s,ease:o,times:a,isGenerator:!0}),y=ar(this.time);c.setWithVelocity(m.sample(y-eh).value,m.sample(y).value,eh)}const{onStop:l}=this.options;l&&l(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:t,name:i,repeatDelay:r,repeatType:s,damping:o,type:a}=e;if(!t||!t.owner||!(t.owner.current instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:c}=t.owner.getProps();return F3()&&i&&N3.has(i)&&!l&&!c&&!r&&s!=="mirror"&&o!==0&&a!=="inertia"}}const V3={type:"spring",stiffness:500,damping:25,restSpeed:10},H3=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),G3={type:"keyframes",duration:.8},W3={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},j3=(n,{keyframes:e})=>e.length>2?G3:Vs.has(n)?n.startsWith("scale")?H3(e[1]):V3:W3;function X3({when:n,delay:e,delayChildren:t,staggerChildren:i,staggerDirection:r,repeat:s,repeatType:o,repeatDelay:a,from:l,elapsed:c,...u}){return!!Object.keys(u).length}const Eg=(n,e,t,i={},r,s)=>o=>{const a=hg(i,n)||{},l=a.delay||i.delay||0;let{elapsed:c=0}=i;c=c-ar(l);let u={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-c,onUpdate:h=>{e.set(h),a.onUpdate&&a.onUpdate(h)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:n,motionValue:e,element:s?void 0:r};X3(a)||(u={...u,...j3(n,u)}),u.duration&&(u.duration=ar(u.duration)),u.repeatDelay&&(u.repeatDelay=ar(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let d=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(u.duration=0,u.delay===0&&(d=!0)),d&&!s&&e.get()!==void 0){const h=Dh(u.keyframes,a);if(h!==void 0)return vt.update(()=>{u.onUpdate(h),u.onComplete()}),new AU([])}return!s&&b_.supports(u)?new b_(u):new Tg(u)};function q3({protectedKeys:n,needsAnimating:e},t){const i=n.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,i}function kA(n,e,{delay:t=0,transitionOverride:i,type:r}={}){var s;let{transition:o=n.getDefaultTransition(),transitionEnd:a,...l}=e;i&&(o=i);const c=[],u=r&&n.animationState&&n.animationState.getState()[r];for(const d in l){const h=n.getValue(d,(s=n.latestValues[d])!==null&&s!==void 0?s:null),f=l[d];if(f===void 0||u&&q3(u,d))continue;const m={delay:t,...hg(o||{},d)};let y=!1;if(window.MotionHandoffAnimation){const p=tA(n);if(p){const v=window.MotionHandoffAnimation(p,d,vt);v!==null&&(m.startTime=v,y=!0)}}wp(n,d),h.start(Eg(d,h,f,n.shouldReduceMotion&&JM.has(d)?{type:!1}:m,n,y));const g=h.animation;g&&c.push(g)}return a&&Promise.all(c).then(()=>{vt.update(()=>{a&&xU(n,a)})}),c}function Pp(n,e,t={}){var i;const r=Ih(n,e,t.type==="exit"?(i=n.presenceContext)===null||i===void 0?void 0:i.custom:void 0);let{transition:s=n.getDefaultTransition()||{}}=r||{};t.transitionOverride&&(s=t.transitionOverride);const o=r?()=>Promise.all(kA(n,r,t)):()=>Promise.resolve(),a=n.variantChildren&&n.variantChildren.size?(c=0)=>{const{delayChildren:u=0,staggerChildren:d,staggerDirection:h}=s;return K3(n,e,u+c,d,h,t)}:()=>Promise.resolve(),{when:l}=s;if(l){const[c,u]=l==="beforeChildren"?[o,a]:[a,o];return c().then(()=>u())}else return Promise.all([o(),a(t.delay)])}function K3(n,e,t=0,i=0,r=1,s){const o=[],a=(n.variantChildren.size-1)*i,l=r===1?(c=0)=>c*i:(c=0)=>a-c*i;return Array.from(n.variantChildren).sort(Y3).forEach((c,u)=>{c.notify("AnimationStart",e),o.push(Pp(c,e,{...s,delay:t+l(u)}).then(()=>c.notify("AnimationComplete",e)))}),Promise.all(o)}function Y3(n,e){return n.sortNodePosition(e)}function $3(n,e,t={}){n.notify("AnimationStart",e);let i;if(Array.isArray(e)){const r=e.map(s=>Pp(n,s,t));i=Promise.all(r)}else if(typeof e=="string")i=Pp(n,e,t);else{const r=typeof e=="function"?Ih(n,e,t.custom):e;i=Promise.all(kA(n,r,t))}return i.then(()=>{n.notify("AnimationComplete",e)})}const Z3=Qm.length;function FA(n){if(!n)return;if(!n.isControllingVariants){const t=n.parent?FA(n.parent)||{}:{};return n.props.initial!==void 0&&(t.initial=n.props.initial),t}const e={};for(let t=0;t<Z3;t++){const i=Qm[t],r=n.props[i];(Pl(r)||r===!1)&&(e[i]=r)}return e}const Q3=[...Zm].reverse(),J3=Zm.length;function eO(n){return e=>Promise.all(e.map(({animation:t,options:i})=>$3(n,t,i)))}function tO(n){let e=eO(n),t=C_(),i=!0;const r=l=>(c,u)=>{var d;const h=Ih(n,u,l==="exit"?(d=n.presenceContext)===null||d===void 0?void 0:d.custom:void 0);if(h){const{transition:f,transitionEnd:m,...y}=h;c={...c,...y,...m}}return c};function s(l){e=l(n)}function o(l){const{props:c}=n,u=FA(n.parent)||{},d=[],h=new Set;let f={},m=1/0;for(let g=0;g<J3;g++){const p=Q3[g],v=t[p],_=c[p]!==void 0?c[p]:u[p],x=Pl(_),A=p===l?v.isActive:null;A===!1&&(m=g);let M=_===u[p]&&_!==c[p]&&x;if(M&&i&&n.manuallyAnimateOnMount&&(M=!1),v.protectedKeys={...f},!v.isActive&&A===null||!_&&!v.prevProp||Ph(_)||typeof _=="boolean")continue;const S=nO(v.prevProp,_);let b=S||p===l&&v.isActive&&!M&&x||g>m&&x,T=!1;const w=Array.isArray(_)?_:[_];let P=w.reduce(r(p),{});A===!1&&(P={});const{prevResolvedValues:V={}}=v,I={...V,...P},O=G=>{b=!0,h.has(G)&&(T=!0,h.delete(G)),v.needsAnimating[G]=!0;const L=n.getValue(G);L&&(L.liveStyle=!1)};for(const G in I){const L=P[G],j=V[G];if(f.hasOwnProperty(G))continue;let Y=!1;xp(L)&&xp(j)?Y=!QM(L,j):Y=L!==j,Y?L!=null?O(G):h.add(G):L!==void 0&&h.has(G)?O(G):v.protectedKeys[G]=!0}v.prevProp=_,v.prevResolvedValues=P,v.isActive&&(f={...f,...P}),i&&n.blockInitialAnimation&&(b=!1),b&&(!(M&&S)||T)&&d.push(...w.map(G=>({animation:G,options:{type:p}})))}if(h.size){const g={};h.forEach(p=>{const v=n.getBaseTarget(p),_=n.getValue(p);_&&(_.liveStyle=!0),g[p]=v??null}),d.push({animation:g})}let y=!!d.length;return i&&(c.initial===!1||c.initial===c.animate)&&!n.manuallyAnimateOnMount&&(y=!1),i=!1,y?e(d):Promise.resolve()}function a(l,c){var u;if(t[l].isActive===c)return Promise.resolve();(u=n.variantChildren)===null||u===void 0||u.forEach(h=>{var f;return(f=h.animationState)===null||f===void 0?void 0:f.setActive(l,c)}),t[l].isActive=c;const d=o(l);for(const h in t)t[h].protectedKeys={};return d}return{animateChanges:o,setActive:a,setAnimateFunction:s,getState:()=>t,reset:()=>{t=C_(),i=!0}}}function nO(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!QM(e,n):!1}function ps(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function C_(){return{animate:ps(!0),whileInView:ps(),whileHover:ps(),whileTap:ps(),whileDrag:ps(),whileFocus:ps(),exit:ps()}}class is{constructor(e){this.isMounted=!1,this.node=e}update(){}}class iO extends is{constructor(e){super(e),e.animationState||(e.animationState=tO(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Ph(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let rO=0;class sO extends is{constructor(){super(...arguments),this.id=rO++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===i)return;const r=this.node.animationState.setActive("exit",!e);t&&!e&&r.then(()=>t(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const oO={animation:{Feature:iO},exit:{Feature:sO}},ri={x:!1,y:!1};function UA(){return ri.x||ri.y}function aO(n){return n==="x"||n==="y"?ri[n]?null:(ri[n]=!0,()=>{ri[n]=!1}):ri.x||ri.y?null:(ri.x=ri.y=!0,()=>{ri.x=ri.y=!1})}const bg=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1;function kl(n,e,t,i={passive:!0}){return n.addEventListener(e,t,i),()=>n.removeEventListener(e,t)}function ql(n){return{point:{x:n.pageX,y:n.pageY}}}const lO=n=>e=>bg(e)&&n(e,ql(e));function al(n,e,t,i){return kl(n,e,lO(t),i)}const R_=(n,e)=>Math.abs(n-e);function cO(n,e){const t=R_(n.x,e.x),i=R_(n.y,e.y);return Math.sqrt(t**2+i**2)}class OA{constructor(e,t,{transformPagePoint:i,contextWindow:r,dragSnapToOrigin:s=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const d=lf(this.lastMoveEventInfo,this.history),h=this.startEvent!==null,f=cO(d.offset,{x:0,y:0})>=3;if(!h&&!f)return;const{point:m}=d,{timestamp:y}=$t;this.history.push({...m,timestamp:y});const{onStart:g,onMove:p}=this.handlers;h||(g&&g(this.lastMoveEvent,d),this.startEvent=this.lastMoveEvent),p&&p(this.lastMoveEvent,d)},this.handlePointerMove=(d,h)=>{this.lastMoveEvent=d,this.lastMoveEventInfo=af(h,this.transformPagePoint),vt.update(this.updatePoint,!0)},this.handlePointerUp=(d,h)=>{this.end();const{onEnd:f,onSessionEnd:m,resumeAnimation:y}=this.handlers;if(this.dragSnapToOrigin&&y&&y(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=lf(d.type==="pointercancel"?this.lastMoveEventInfo:af(h,this.transformPagePoint),this.history);this.startEvent&&f&&f(d,g),m&&m(d,g)},!bg(e))return;this.dragSnapToOrigin=s,this.handlers=t,this.transformPagePoint=i,this.contextWindow=r||window;const o=ql(e),a=af(o,this.transformPagePoint),{point:l}=a,{timestamp:c}=$t;this.history=[{...l,timestamp:c}];const{onSessionStart:u}=t;u&&u(e,lf(a,this.history)),this.removeListeners=Xl(al(this.contextWindow,"pointermove",this.handlePointerMove),al(this.contextWindow,"pointerup",this.handlePointerUp),al(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Zr(this.updatePoint)}}function af(n,e){return e?{point:e(n.point)}:n}function P_(n,e){return{x:n.x-e.x,y:n.y-e.y}}function lf({point:n},e){return{point:n,delta:P_(n,BA(e)),offset:P_(n,uO(e)),velocity:hO(e,.1)}}function uO(n){return n[0]}function BA(n){return n[n.length-1]}function hO(n,e){if(n.length<2)return{x:0,y:0};let t=n.length-1,i=null;const r=BA(n);for(;t>=0&&(i=n[t],!(r.timestamp-i.timestamp>ar(e)));)t--;if(!i)return{x:0,y:0};const s=lr(r.timestamp-i.timestamp);if(s===0)return{x:0,y:0};const o={x:(r.x-i.x)/s,y:(r.y-i.y)/s};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}const zA=1e-4,dO=1-zA,fO=1+zA,VA=.01,pO=0-VA,mO=0+VA;function On(n){return n.max-n.min}function gO(n,e,t){return Math.abs(n-e)<=t}function L_(n,e,t,i=.5){n.origin=i,n.originPoint=wt(e.min,e.max,n.origin),n.scale=On(t)/On(e),n.translate=wt(t.min,t.max,n.origin)-n.originPoint,(n.scale>=dO&&n.scale<=fO||isNaN(n.scale))&&(n.scale=1),(n.translate>=pO&&n.translate<=mO||isNaN(n.translate))&&(n.translate=0)}function ll(n,e,t,i){L_(n.x,e.x,t.x,i?i.originX:void 0),L_(n.y,e.y,t.y,i?i.originY:void 0)}function I_(n,e,t){n.min=t.min+e.min,n.max=n.min+On(e)}function vO(n,e,t){I_(n.x,e.x,t.x),I_(n.y,e.y,t.y)}function D_(n,e,t){n.min=e.min-t.min,n.max=n.min+On(e)}function cl(n,e,t){D_(n.x,e.x,t.x),D_(n.y,e.y,t.y)}function yO(n,{min:e,max:t},i){return e!==void 0&&n<e?n=i?wt(e,n,i.min):Math.max(n,e):t!==void 0&&n>t&&(n=i?wt(t,n,i.max):Math.min(n,t)),n}function N_(n,e,t){return{min:e!==void 0?n.min+e:void 0,max:t!==void 0?n.max+t-(n.max-n.min):void 0}}function _O(n,{top:e,left:t,bottom:i,right:r}){return{x:N_(n.x,t,r),y:N_(n.y,e,i)}}function k_(n,e){let t=e.min-n.min,i=e.max-n.max;return e.max-e.min<n.max-n.min&&([t,i]=[i,t]),{min:t,max:i}}function xO(n,e){return{x:k_(n.x,e.x),y:k_(n.y,e.y)}}function wO(n,e){let t=.5;const i=On(n),r=On(e);return r>i?t=sa(e.min,e.max-i,n.min):i>r&&(t=sa(n.min,n.max-r,e.min)),pr(0,1,t)}function SO(n,e){const t={};return e.min!==void 0&&(t.min=e.min-n.min),e.max!==void 0&&(t.max=e.max-n.min),t}const Lp=.35;function MO(n=Lp){return n===!1?n=0:n===!0&&(n=Lp),{x:F_(n,"left","right"),y:F_(n,"top","bottom")}}function F_(n,e,t){return{min:U_(n,e),max:U_(n,t)}}function U_(n,e){return typeof n=="number"?n:n[e]||0}const O_=()=>({translate:0,scale:1,origin:0,originPoint:0}),To=()=>({x:O_(),y:O_()}),B_=()=>({min:0,max:0}),Lt=()=>({x:B_(),y:B_()});function jn(n){return[n("x"),n("y")]}function HA({top:n,left:e,right:t,bottom:i}){return{x:{min:e,max:t},y:{min:n,max:i}}}function AO({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function TO(n,e){if(!e)return n;const t=e({x:n.left,y:n.top}),i=e({x:n.right,y:n.bottom});return{top:t.y,left:t.x,bottom:i.y,right:i.x}}function cf(n){return n===void 0||n===1}function Ip({scale:n,scaleX:e,scaleY:t}){return!cf(n)||!cf(e)||!cf(t)}function _s(n){return Ip(n)||GA(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function GA(n){return z_(n.x)||z_(n.y)}function z_(n){return n&&n!=="0%"}function th(n,e,t){const i=n-t,r=e*i;return t+r}function V_(n,e,t,i,r){return r!==void 0&&(n=th(n,r,i)),th(n,t,i)+e}function Dp(n,e=0,t=1,i,r){n.min=V_(n.min,e,t,i,r),n.max=V_(n.max,e,t,i,r)}function WA(n,{x:e,y:t}){Dp(n.x,e.translate,e.scale,e.originPoint),Dp(n.y,t.translate,t.scale,t.originPoint)}const H_=.999999999999,G_=1.0000000000001;function EO(n,e,t,i=!1){const r=t.length;if(!r)return;e.x=e.y=1;let s,o;for(let a=0;a<r;a++){s=t[a],o=s.projectionDelta;const{visualElement:l}=s.options;l&&l.props.style&&l.props.style.display==="contents"||(i&&s.options.layoutScroll&&s.scroll&&s!==s.root&&bo(n,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,WA(n,o)),i&&_s(s.latestValues)&&bo(n,s.latestValues))}e.x<G_&&e.x>H_&&(e.x=1),e.y<G_&&e.y>H_&&(e.y=1)}function Eo(n,e){n.min=n.min+e,n.max=n.max+e}function W_(n,e,t,i,r=.5){const s=wt(n.min,n.max,r);Dp(n,e,t,s,i)}function bo(n,e){W_(n.x,e.x,e.scaleX,e.scale,e.originX),W_(n.y,e.y,e.scaleY,e.scale,e.originY)}function jA(n,e){return HA(TO(n.getBoundingClientRect(),e))}function bO(n,e,t){const i=jA(n,t),{scroll:r}=e;return r&&(Eo(i.x,r.offset.x),Eo(i.y,r.offset.y)),i}const XA=({current:n})=>n?n.ownerDocument.defaultView:null,CO=new WeakMap;class RO{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Lt(),this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const r=u=>{const{dragSnapToOrigin:d}=this.getProps();d?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(ql(u).point)},s=(u,d)=>{const{drag:h,dragPropagation:f,onDragStart:m}=this.getProps();if(h&&!f&&(this.openDragLock&&this.openDragLock(),this.openDragLock=aO(h),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),jn(g=>{let p=this.getAxisMotionValue(g).get()||0;if(Li.test(p)){const{projection:v}=this.visualElement;if(v&&v.layout){const _=v.layout.layoutBox[g];_&&(p=On(_)*(parseFloat(p)/100))}}this.originPoint[g]=p}),m&&vt.postRender(()=>m(u,d)),wp(this.visualElement,"transform");const{animationState:y}=this.visualElement;y&&y.setActive("whileDrag",!0)},o=(u,d)=>{const{dragPropagation:h,dragDirectionLock:f,onDirectionLock:m,onDrag:y}=this.getProps();if(!h&&!this.openDragLock)return;const{offset:g}=d;if(f&&this.currentDirection===null){this.currentDirection=PO(g),this.currentDirection!==null&&m&&m(this.currentDirection);return}this.updateAxis("x",d.point,g),this.updateAxis("y",d.point,g),this.visualElement.render(),y&&y(u,d)},a=(u,d)=>this.stop(u,d),l=()=>jn(u=>{var d;return this.getAnimationState(u)==="paused"&&((d=this.getAxisMotionValue(u).animation)===null||d===void 0?void 0:d.play())}),{dragSnapToOrigin:c}=this.getProps();this.panSession=new OA(e,{onSessionStart:r,onStart:s,onMove:o,onSessionEnd:a,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:c,contextWindow:XA(this.visualElement)})}stop(e,t){const i=this.isDragging;if(this.cancel(),!i)return;const{velocity:r}=t;this.startAnimation(r);const{onDragEnd:s}=this.getProps();s&&vt.postRender(()=>s(e,t))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,i){const{drag:r}=this.getProps();if(!i||!Qc(e,r,this.currentDirection))return;const s=this.getAxisMotionValue(e);let o=this.originPoint[e]+i[e];this.constraints&&this.constraints[e]&&(o=yO(o,this.constraints[e],this.elastic[e])),s.set(o)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:i}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,s=this.constraints;t&&Mo(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&r?this.constraints=_O(r.layoutBox,t):this.constraints=!1,this.elastic=MO(i),s!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&jn(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=SO(r.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Mo(e))return!1;const i=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const s=bO(i,r.root,this.visualElement.getTransformPagePoint());let o=xO(r.layout.layoutBox,s);if(t){const a=t(AO(o));this.hasMutatedConstraints=!!a,a&&(o=HA(a))}return o}startAnimation(e){const{drag:t,dragMomentum:i,dragElastic:r,dragTransition:s,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),l=this.constraints||{},c=jn(u=>{if(!Qc(u,t,this.currentDirection))return;let d=l&&l[u]||{};o&&(d={min:0,max:0});const h=r?200:1e6,f=r?40:1e7,m={type:"inertia",velocity:i?e[u]:0,bounceStiffness:h,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...s,...d};return this.startAxisValueAnimation(u,m)});return Promise.all(c).then(a)}startAxisValueAnimation(e,t){const i=this.getAxisMotionValue(e);return wp(this.visualElement,e),i.start(Eg(e,i,0,t,this.visualElement,!1))}stopAnimation(){jn(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){jn(e=>{var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.pause()})}getAnimationState(e){var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,i=this.visualElement.getProps(),r=i[t];return r||this.visualElement.getValue(e,(i.initial?i.initial[e]:void 0)||0)}snapToCursor(e){jn(t=>{const{drag:i}=this.getProps();if(!Qc(t,i,this.currentDirection))return;const{projection:r}=this.visualElement,s=this.getAxisMotionValue(t);if(r&&r.layout){const{min:o,max:a}=r.layout.layoutBox[t];s.set(e[t]-wt(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:i}=this.visualElement;if(!Mo(t)||!i||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};jn(o=>{const a=this.getAxisMotionValue(o);if(a&&this.constraints!==!1){const l=a.get();r[o]=wO({min:l,max:l},this.constraints[o])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),jn(o=>{if(!Qc(o,e,null))return;const a=this.getAxisMotionValue(o),{min:l,max:c}=this.constraints[o];a.set(wt(l,c,r[o]))})}addListeners(){if(!this.visualElement.current)return;CO.set(this.visualElement,this);const e=this.visualElement.current,t=al(e,"pointerdown",l=>{const{drag:c,dragListener:u=!0}=this.getProps();c&&u&&this.start(l)}),i=()=>{const{dragConstraints:l}=this.getProps();Mo(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,s=r.addEventListener("measure",i);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),vt.read(i);const o=kl(window,"resize",()=>this.scalePositionWithinConstraints()),a=r.addEventListener("didUpdate",({delta:l,hasLayoutChanged:c})=>{this.isDragging&&c&&(jn(u=>{const d=this.getAxisMotionValue(u);d&&(this.originPoint[u]+=l[u].translate,d.set(d.get()+l[u].translate))}),this.visualElement.render())});return()=>{o(),t(),s(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:i=!1,dragPropagation:r=!1,dragConstraints:s=!1,dragElastic:o=Lp,dragMomentum:a=!0}=e;return{...e,drag:t,dragDirectionLock:i,dragPropagation:r,dragConstraints:s,dragElastic:o,dragMomentum:a}}}function Qc(n,e,t){return(e===!0||e===n)&&(t===null||t===n)}function PO(n,e=10){let t=null;return Math.abs(n.y)>e?t="y":Math.abs(n.x)>e&&(t="x"),t}class LO extends is{constructor(e){super(e),this.removeGroupControls=Fn,this.removeListeners=Fn,this.controls=new RO(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Fn}unmount(){this.removeGroupControls(),this.removeListeners()}}const j_=n=>(e,t)=>{n&&vt.postRender(()=>n(e,t))};class IO extends is{constructor(){super(...arguments),this.removePointerDownListener=Fn}onPointerDown(e){this.session=new OA(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:XA(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:i,onPanEnd:r}=this.node.getProps();return{onSessionStart:j_(e),onStart:j_(t),onMove:i,onEnd:(s,o)=>{delete this.session,r&&vt.postRender(()=>r(s,o))}}}mount(){this.removePointerDownListener=al(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const mu={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function X_(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const Oa={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(Te.test(n))n=parseFloat(n);else return n;const t=X_(n,e.target.x),i=X_(n,e.target.y);return`${t}% ${i}%`}},DO={correct:(n,{treeScale:e,projectionDelta:t})=>{const i=n,r=Qr.parse(n);if(r.length>5)return i;const s=Qr.createTransformer(n),o=typeof r[0]!="number"?1:0,a=t.x.scale*e.x,l=t.y.scale*e.y;r[0+o]/=a,r[1+o]/=l;const c=wt(a,l,.5);return typeof r[2+o]=="number"&&(r[2+o]/=c),typeof r[3+o]=="number"&&(r[3+o]/=c),s(r)}};class NO extends te.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:i,layoutId:r}=this.props,{projection:s}=e;oU(kO),s&&(t.group&&t.group.add(s),i&&i.register&&r&&i.register(s),s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions({...s.options,onExitComplete:()=>this.safeToRemove()})),mu.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:i,drag:r,isPresent:s}=this.props,o=i.projection;return o&&(o.isPresent=s,r||e.layoutDependency!==t||t===void 0?o.willUpdate():this.safeToRemove(),e.isPresent!==s&&(s?o.promote():o.relegate()||vt.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),eg.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:i}=this.props,{projection:r}=e;r&&(r.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(r),i&&i.deregister&&i.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function qA(n){const[e,t]=LM(),i=te.useContext(Km);return or.jsx(NO,{...n,layoutGroup:i,switchLayoutGroup:te.useContext(zM),isPresent:e,safeToRemove:t})}const kO={borderRadius:{...Oa,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Oa,borderTopRightRadius:Oa,borderBottomLeftRadius:Oa,borderBottomRightRadius:Oa,boxShadow:DO};function FO(n,e,t){const i=ln(n)?n:Dl(n);return i.start(Eg("",i,e,t)),i.animation}function UO(n){return n instanceof SVGElement&&n.tagName!=="svg"}const OO=(n,e)=>n.depth-e.depth;class BO{constructor(){this.children=[],this.isDirty=!1}add(e){dg(this.children,e),this.isDirty=!0}remove(e){fg(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(OO),this.isDirty=!1,this.children.forEach(e)}}function zO(n,e){const t=Ii.now(),i=({timestamp:r})=>{const s=r-t;s>=e&&(Zr(i),n(s-e))};return vt.read(i,!0),()=>Zr(i)}const KA=["TopLeft","TopRight","BottomLeft","BottomRight"],VO=KA.length,q_=n=>typeof n=="string"?parseFloat(n):n,K_=n=>typeof n=="number"||Te.test(n);function HO(n,e,t,i,r,s){r?(n.opacity=wt(0,t.opacity!==void 0?t.opacity:1,GO(i)),n.opacityExit=wt(e.opacity!==void 0?e.opacity:1,0,WO(i))):s&&(n.opacity=wt(e.opacity!==void 0?e.opacity:1,t.opacity!==void 0?t.opacity:1,i));for(let o=0;o<VO;o++){const a=`border${KA[o]}Radius`;let l=Y_(e,a),c=Y_(t,a);if(l===void 0&&c===void 0)continue;l||(l=0),c||(c=0),l===0||c===0||K_(l)===K_(c)?(n[a]=Math.max(wt(q_(l),q_(c),i),0),(Li.test(c)||Li.test(l))&&(n[a]+="%")):n[a]=c}(e.rotate||t.rotate)&&(n.rotate=wt(e.rotate||0,t.rotate||0,i))}function Y_(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const GO=YA(0,.5,hA),WO=YA(.5,.95,Fn);function YA(n,e,t){return i=>i<n?0:i>e?1:t(sa(n,e,i))}function $_(n,e){n.min=e.min,n.max=e.max}function Wn(n,e){$_(n.x,e.x),$_(n.y,e.y)}function Z_(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function Q_(n,e,t,i,r){return n-=e,n=th(n,1/t,i),r!==void 0&&(n=th(n,1/r,i)),n}function jO(n,e=0,t=1,i=.5,r,s=n,o=n){if(Li.test(e)&&(e=parseFloat(e),e=wt(o.min,o.max,e/100)-o.min),typeof e!="number")return;let a=wt(s.min,s.max,i);n===s&&(a-=e),n.min=Q_(n.min,e,t,a,r),n.max=Q_(n.max,e,t,a,r)}function J_(n,e,[t,i,r],s,o){jO(n,e[t],e[i],e[r],e.scale,s,o)}const XO=["x","scaleX","originX"],qO=["y","scaleY","originY"];function ex(n,e,t,i){J_(n.x,e,XO,t?t.x:void 0,i?i.x:void 0),J_(n.y,e,qO,t?t.y:void 0,i?i.y:void 0)}function tx(n){return n.translate===0&&n.scale===1}function $A(n){return tx(n.x)&&tx(n.y)}function nx(n,e){return n.min===e.min&&n.max===e.max}function KO(n,e){return nx(n.x,e.x)&&nx(n.y,e.y)}function ix(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function ZA(n,e){return ix(n.x,e.x)&&ix(n.y,e.y)}function rx(n){return On(n.x)/On(n.y)}function sx(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class YO{constructor(){this.members=[]}add(e){dg(this.members,e),e.scheduleRender()}remove(e){if(fg(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(r=>e===r);if(t===0)return!1;let i;for(let r=t;r>=0;r--){const s=this.members[r];if(s.isPresent!==!1){i=s;break}}return i?(this.promote(i),!0):!1}promote(e,t){const i=this.lead;if(e!==i&&(this.prevLead=i,this.lead=e,e.show(),i)){i.instance&&i.scheduleRender(),e.scheduleRender(),e.resumeFrom=i,t&&(e.resumeFrom.preserveOpacity=!0),i.snapshot&&(e.snapshot=i.snapshot,e.snapshot.latestValues=i.animationValues||i.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:i}=e;t.onExitComplete&&t.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function $O(n,e,t){let i="";const r=n.x.translate/e.x,s=n.y.translate/e.y,o=(t==null?void 0:t.z)||0;if((r||s||o)&&(i=`translate3d(${r}px, ${s}px, ${o}px) `),(e.x!==1||e.y!==1)&&(i+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:c,rotate:u,rotateX:d,rotateY:h,skewX:f,skewY:m}=t;c&&(i=`perspective(${c}px) ${i}`),u&&(i+=`rotate(${u}deg) `),d&&(i+=`rotateX(${d}deg) `),h&&(i+=`rotateY(${h}deg) `),f&&(i+=`skewX(${f}deg) `),m&&(i+=`skewY(${m}deg) `)}const a=n.x.scale*e.x,l=n.y.scale*e.y;return(a!==1||l!==1)&&(i+=`scale(${a}, ${l})`),i||"none"}const xs={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Xa=typeof window<"u"&&window.MotionDebug!==void 0,uf=["","X","Y","Z"],ZO={visibility:"hidden"},ox=1e3;let QO=0;function hf(n,e,t,i){const{latestValues:r}=e;r[n]&&(t[n]=r[n],e.setStaticValue(n,0),i&&(i[n]=0))}function QA(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const t=tA(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:r,layoutId:s}=n.options;window.MotionCancelOptimisedAnimation(t,"transform",vt,!(r||s))}const{parent:i}=n;i&&!i.hasCheckedOptimisedAppear&&QA(i)}function JA({attachResizeListener:n,defaultParent:e,measureScroll:t,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(o={},a=e==null?void 0:e()){this.id=QO++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Xa&&(xs.totalNodes=xs.resolvedTargetDeltas=xs.recalculatedProjection=0),this.nodes.forEach(tB),this.nodes.forEach(oB),this.nodes.forEach(aB),this.nodes.forEach(nB),Xa&&window.MotionDebug.record(xs)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new BO)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new pg),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const l=this.eventHandlers.get(o);l&&l.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o,a=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=UO(o),this.instance=o;const{layoutId:l,layout:c,visualElement:u}=this.options;if(u&&!u.current&&u.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),a&&(c||l)&&(this.isLayoutDirty=!0),n){let d;const h=()=>this.root.updateBlockedByResize=!1;n(o,()=>{this.root.updateBlockedByResize=!0,d&&d(),d=zO(h,250),mu.hasAnimatedSinceResize&&(mu.hasAnimatedSinceResize=!1,this.nodes.forEach(lx))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&u&&(l||c)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:h,hasRelativeLayoutChanged:f,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const y=this.options.transition||u.getDefaultTransition()||dB,{onLayoutAnimationStart:g,onLayoutAnimationComplete:p}=u.getProps(),v=!this.targetLayout||!ZA(this.targetLayout,m),_=!h&&f;if(this.options.layoutRoot||this.resumeFrom||_||h&&(v||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(d,_);const x={...hg(y,"layout"),onPlay:g,onComplete:p};(u.shouldReduceMotion||this.options.layoutRoot)&&(x.delay=0,x.type=!1),this.startAnimation(x)}else h||lx(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Zr(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(lB),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&QA(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const d=this.path[u];d.shouldResetTransform=!0,d.updateScroll("snapshot"),d.options.layoutRoot&&d.willUpdate(!1)}const{layoutId:a,layout:l}=this.options;if(a===void 0&&!l)return;const c=this.getTransformTemplate();this.prevTransformTemplateValue=c?c(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(ax);return}this.isUpdating||this.nodes.forEach(rB),this.isUpdating=!1,this.nodes.forEach(sB),this.nodes.forEach(JO),this.nodes.forEach(eB),this.clearAllSnapshots();const a=Ii.now();$t.delta=pr(0,1e3/60,a-$t.timestamp),$t.timestamp=a,$t.isProcessing=!0,tf.update.process($t),tf.preRender.process($t),tf.render.process($t),$t.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,eg.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(iB),this.sharedNodes.forEach(cB)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,vt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){vt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Lt(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a){const l=i(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:l,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!r)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!$A(this.projectionDelta),l=this.getTransformTemplate(),c=l?l(this.latestValues,""):void 0,u=c!==this.prevTransformTemplateValue;o&&(a||_s(this.latestValues)||u)&&(r(this.instance,c),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let l=this.removeElementScroll(a);return o&&(l=this.removeTransform(l)),fB(l),{animationId:this.root.animationId,measuredBox:a,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){var o;const{visualElement:a}=this.options;if(!a)return Lt();const l=a.measureViewportBox();if(!(((o=this.scroll)===null||o===void 0?void 0:o.wasRoot)||this.path.some(pB))){const{scroll:u}=this.root;u&&(Eo(l.x,u.offset.x),Eo(l.y,u.offset.y))}return l}removeElementScroll(o){var a;const l=Lt();if(Wn(l,o),!((a=this.scroll)===null||a===void 0)&&a.wasRoot)return l;for(let c=0;c<this.path.length;c++){const u=this.path[c],{scroll:d,options:h}=u;u!==this.root&&d&&h.layoutScroll&&(d.wasRoot&&Wn(l,o),Eo(l.x,d.offset.x),Eo(l.y,d.offset.y))}return l}applyTransform(o,a=!1){const l=Lt();Wn(l,o);for(let c=0;c<this.path.length;c++){const u=this.path[c];!a&&u.options.layoutScroll&&u.scroll&&u!==u.root&&bo(l,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),_s(u.latestValues)&&bo(l,u.latestValues)}return _s(this.latestValues)&&bo(l,this.latestValues),l}removeTransform(o){const a=Lt();Wn(a,o);for(let l=0;l<this.path.length;l++){const c=this.path[l];if(!c.instance||!_s(c.latestValues))continue;Ip(c.latestValues)&&c.updateSnapshot();const u=Lt(),d=c.measurePageBox();Wn(u,d),ex(a,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,u)}return _s(this.latestValues)&&ex(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==$t.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var a;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(o||c&&this.isSharedProjectionDirty||this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:d,layoutId:h}=this.options;if(!(!this.layout||!(d||h))){if(this.resolvedRelativeTargetAt=$t.timestamp,!this.targetDelta&&!this.relativeTarget){const f=this.getClosestProjectingParent();f&&f.layout&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Lt(),this.relativeTargetOrigin=Lt(),cl(this.relativeTargetOrigin,this.layout.layoutBox,f.layout.layoutBox),Wn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Lt(),this.targetWithTransforms=Lt()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),vO(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Wn(this.target,this.layout.layoutBox),WA(this.target,this.targetDelta)):Wn(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const f=this.getClosestProjectingParent();f&&!!f.resumingFrom==!!this.resumingFrom&&!f.options.layoutScroll&&f.target&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Lt(),this.relativeTargetOrigin=Lt(),cl(this.relativeTargetOrigin,this.target,f.target),Wn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Xa&&xs.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||Ip(this.parent.latestValues)||GA(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var o;const a=this.getLead(),l=!!this.resumingFrom||this!==a;let c=!0;if((this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===$t.timestamp&&(c=!1),c)return;const{layout:u,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||d))return;Wn(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,f=this.treeScale.y;EO(this.layoutCorrected,this.treeScale,this.path,l),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=Lt());const{target:m}=a;if(!m){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Z_(this.prevProjectionDelta.x,this.projectionDelta.x),Z_(this.prevProjectionDelta.y,this.projectionDelta.y)),ll(this.projectionDelta,this.layoutCorrected,m,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==f||!sx(this.projectionDelta.x,this.prevProjectionDelta.x)||!sx(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m)),Xa&&xs.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var a;if((a=this.options.visualElement)===null||a===void 0||a.scheduleRender(),o){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=To(),this.projectionDelta=To(),this.projectionDeltaWithTransform=To()}setAnimationOrigin(o,a=!1){const l=this.snapshot,c=l?l.latestValues:{},u={...this.latestValues},d=To();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const h=Lt(),f=l?l.source:void 0,m=this.layout?this.layout.source:void 0,y=f!==m,g=this.getStack(),p=!g||g.members.length<=1,v=!!(y&&!p&&this.options.crossfade===!0&&!this.path.some(hB));this.animationProgress=0;let _;this.mixTargetDelta=x=>{const A=x/1e3;cx(d.x,o.x,A),cx(d.y,o.y,A),this.setTargetDelta(d),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(cl(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),uB(this.relativeTarget,this.relativeTargetOrigin,h,A),_&&KO(this.relativeTarget,_)&&(this.isProjectionDirty=!1),_||(_=Lt()),Wn(_,this.relativeTarget)),y&&(this.animationValues=u,HO(u,c,this.latestValues,A,v,p)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=A},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Zr(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=vt.update(()=>{mu.hasAnimatedSinceResize=!0,this.currentAnimation=FO(0,ox,{...o,onUpdate:a=>{this.mixTargetDelta(a),o.onUpdate&&o.onUpdate(a)},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(ox),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:l,layout:c,latestValues:u}=o;if(!(!a||!l||!c)){if(this!==o&&this.layout&&c&&eT(this.options.animationType,this.layout.layoutBox,c.layoutBox)){l=this.target||Lt();const d=On(this.layout.layoutBox.x);l.x.min=o.target.x.min,l.x.max=l.x.min+d;const h=On(this.layout.layoutBox.y);l.y.min=o.target.y.min,l.y.max=l.y.min+h}Wn(a,l),bo(a,u),ll(this.projectionDeltaWithTransform,this.layoutCorrected,a,u)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new YO),this.sharedNodes.get(o).add(a);const c=a.options.initialPromotionConfig;a.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var o;const{layoutId:a}=this.options;return a?((o=this.getStack())===null||o===void 0?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:a}=this.options;return a?(o=this.getStack())===null||o===void 0?void 0:o.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:l}={}){const c=this.getStack();c&&c.promote(this,l),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:l}=o;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(a=!0),!a)return;const c={};l.z&&hf("z",o,c,this.animationValues);for(let u=0;u<uf.length;u++)hf(`rotate${uf[u]}`,o,c,this.animationValues),hf(`skew${uf[u]}`,o,c,this.animationValues);o.render();for(const u in c)o.setStaticValue(u,c[u]),this.animationValues&&(this.animationValues[u]=c[u]);o.scheduleRender()}getProjectionStyles(o){var a,l;if(!this.instance||this.isSVG)return;if(!this.isVisible)return ZO;const c={visibility:""},u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,c.opacity="",c.pointerEvents=fu(o==null?void 0:o.pointerEvents)||"",c.transform=u?u(this.latestValues,""):"none",c;const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){const y={};return this.options.layoutId&&(y.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,y.pointerEvents=fu(o==null?void 0:o.pointerEvents)||""),this.hasProjected&&!_s(this.latestValues)&&(y.transform=u?u({},""):"none",this.hasProjected=!1),y}const h=d.animationValues||d.latestValues;this.applyTransformsToTarget(),c.transform=$O(this.projectionDeltaWithTransform,this.treeScale,h),u&&(c.transform=u(h,c.transform));const{x:f,y:m}=this.projectionDelta;c.transformOrigin=`${f.origin*100}% ${m.origin*100}% 0`,d.animationValues?c.opacity=d===this?(l=(a=h.opacity)!==null&&a!==void 0?a:this.latestValues.opacity)!==null&&l!==void 0?l:1:this.preserveOpacity?this.latestValues.opacity:h.opacityExit:c.opacity=d===this?h.opacity!==void 0?h.opacity:"":h.opacityExit!==void 0?h.opacityExit:0;for(const y in Il){if(h[y]===void 0)continue;const{correct:g,applyTo:p,isCSSVariable:v}=Il[y],_=c.transform==="none"?h[y]:g(h[y],d);if(p){const x=p.length;for(let A=0;A<x;A++)c[p[A]]=_}else v?this.options.visualElement.renderState.vars[y]=_:c[y]=_}return this.options.layoutId&&(c.pointerEvents=d===this?fu(o==null?void 0:o.pointerEvents)||"":"none"),c}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var a;return(a=o.currentAnimation)===null||a===void 0?void 0:a.stop()}),this.root.nodes.forEach(ax),this.root.sharedNodes.clear()}}}function JO(n){n.updateLayout()}function eB(n){var e;const t=((e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&t&&n.hasListeners("didUpdate")){const{layoutBox:i,measuredBox:r}=n.layout,{animationType:s}=n.options,o=t.source!==n.layout.source;s==="size"?jn(d=>{const h=o?t.measuredBox[d]:t.layoutBox[d],f=On(h);h.min=i[d].min,h.max=h.min+f}):eT(s,t.layoutBox,i)&&jn(d=>{const h=o?t.measuredBox[d]:t.layoutBox[d],f=On(i[d]);h.max=h.min+f,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[d].max=n.relativeTarget[d].min+f)});const a=To();ll(a,i,t.layoutBox);const l=To();o?ll(l,n.applyTransform(r,!0),t.measuredBox):ll(l,i,t.layoutBox);const c=!$A(a);let u=!1;if(!n.resumeFrom){const d=n.getClosestProjectingParent();if(d&&!d.resumeFrom){const{snapshot:h,layout:f}=d;if(h&&f){const m=Lt();cl(m,t.layoutBox,h.layoutBox);const y=Lt();cl(y,i,f.layoutBox),ZA(m,y)||(u=!0),d.options.layoutRoot&&(n.relativeTarget=y,n.relativeTargetOrigin=m,n.relativeParent=d)}}}n.notifyListeners("didUpdate",{layout:i,snapshot:t,delta:l,layoutDelta:a,hasLayoutChanged:c,hasRelativeLayoutChanged:u})}else if(n.isLead()){const{onExitComplete:i}=n.options;i&&i()}n.options.transition=void 0}function tB(n){Xa&&xs.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function nB(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function iB(n){n.clearSnapshot()}function ax(n){n.clearMeasurements()}function rB(n){n.isLayoutDirty=!1}function sB(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function lx(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function oB(n){n.resolveTargetDelta()}function aB(n){n.calcProjection()}function lB(n){n.resetSkewAndRotation()}function cB(n){n.removeLeadSnapshot()}function cx(n,e,t){n.translate=wt(e.translate,0,t),n.scale=wt(e.scale,1,t),n.origin=e.origin,n.originPoint=e.originPoint}function ux(n,e,t,i){n.min=wt(e.min,t.min,i),n.max=wt(e.max,t.max,i)}function uB(n,e,t,i){ux(n.x,e.x,t.x,i),ux(n.y,e.y,t.y,i)}function hB(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const dB={duration:.45,ease:[.4,0,.1,1]},hx=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),dx=hx("applewebkit/")&&!hx("chrome/")?Math.round:Fn;function fx(n){n.min=dx(n.min),n.max=dx(n.max)}function fB(n){fx(n.x),fx(n.y)}function eT(n,e,t){return n==="position"||n==="preserve-aspect"&&!gO(rx(e),rx(t),.2)}function pB(n){var e;return n!==n.root&&((e=n.scroll)===null||e===void 0?void 0:e.wasRoot)}const mB=JA({attachResizeListener:(n,e)=>kl(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),df={current:void 0},tT=JA({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!df.current){const n=new mB({});n.mount(window),n.setOptions({layoutScroll:!0}),df.current=n}return df.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),gB={pan:{Feature:IO},drag:{Feature:LO,ProjectionNode:tT,MeasureLayout:qA}};function vB(n,e,t){var i;if(n instanceof Element)return[n];if(typeof n=="string"){let r=document;e&&(r=e.current);const s=(i=t==null?void 0:t[n])!==null&&i!==void 0?i:r.querySelectorAll(n);return s?Array.from(s):[]}return Array.from(n)}function nT(n,e){const t=vB(n),i=new AbortController,r={passive:!0,...e,signal:i.signal};return[t,r,()=>i.abort()]}function px(n){return!(n.pointerType==="touch"||UA())}function yB(n,e,t={}){const[i,r,s]=nT(n,t),o=a=>{if(!px(a))return;const{target:l}=a,c=e(l,a);if(typeof c!="function"||!l)return;const u=d=>{px(d)&&(c(d),l.removeEventListener("pointerleave",u))};l.addEventListener("pointerleave",u,r)};return i.forEach(a=>{a.addEventListener("pointerenter",o,r)}),s}function mx(n,e,t){const{props:i}=n;n.animationState&&i.whileHover&&n.animationState.setActive("whileHover",t==="Start");const r="onHover"+t,s=i[r];s&&vt.postRender(()=>s(e,ql(e)))}class _B extends is{mount(){const{current:e}=this.node;e&&(this.unmount=yB(e,(t,i)=>(mx(this.node,i,"Start"),r=>mx(this.node,r,"End"))))}unmount(){}}class xB extends is{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Xl(kl(this.node.current,"focus",()=>this.onFocus()),kl(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const iT=(n,e)=>e?n===e?!0:iT(n,e.parentElement):!1,wB=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function SB(n){return wB.has(n.tagName)||n.tabIndex!==-1}const qa=new WeakSet;function gx(n){return e=>{e.key==="Enter"&&n(e)}}function ff(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const MB=(n,e)=>{const t=n.currentTarget;if(!t)return;const i=gx(()=>{if(qa.has(t))return;ff(t,"down");const r=gx(()=>{ff(t,"up")}),s=()=>ff(t,"cancel");t.addEventListener("keyup",r,e),t.addEventListener("blur",s,e)});t.addEventListener("keydown",i,e),t.addEventListener("blur",()=>t.removeEventListener("keydown",i),e)};function vx(n){return bg(n)&&!UA()}function AB(n,e,t={}){const[i,r,s]=nT(n,t),o=a=>{const l=a.currentTarget;if(!vx(a)||qa.has(l))return;qa.add(l);const c=e(l,a),u=(f,m)=>{window.removeEventListener("pointerup",d),window.removeEventListener("pointercancel",h),!(!vx(f)||!qa.has(l))&&(qa.delete(l),typeof c=="function"&&c(f,{success:m}))},d=f=>{u(f,t.useGlobalTarget||iT(l,f.target))},h=f=>{u(f,!1)};window.addEventListener("pointerup",d,r),window.addEventListener("pointercancel",h,r)};return i.forEach(a=>{!SB(a)&&a.getAttribute("tabindex")===null&&(a.tabIndex=0),(t.useGlobalTarget?window:a).addEventListener("pointerdown",o,r),a.addEventListener("focus",c=>MB(c,r),r)}),s}function yx(n,e,t){const{props:i}=n;n.animationState&&i.whileTap&&n.animationState.setActive("whileTap",t==="Start");const r="onTap"+(t==="End"?"":t),s=i[r];s&&vt.postRender(()=>s(e,ql(e)))}class TB extends is{mount(){const{current:e}=this.node;e&&(this.unmount=AB(e,(t,i)=>(yx(this.node,i,"Start"),(r,{success:s})=>yx(this.node,r,s?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Np=new WeakMap,pf=new WeakMap,EB=n=>{const e=Np.get(n.target);e&&e(n)},bB=n=>{n.forEach(EB)};function CB({root:n,...e}){const t=n||document;pf.has(t)||pf.set(t,{});const i=pf.get(t),r=JSON.stringify(e);return i[r]||(i[r]=new IntersectionObserver(bB,{root:n,...e})),i[r]}function RB(n,e,t){const i=CB(e);return Np.set(n,t),i.observe(n),()=>{Np.delete(n),i.unobserve(n)}}const PB={some:0,all:1};class LB extends is{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:i,amount:r="some",once:s}=e,o={root:t?t.current:void 0,rootMargin:i,threshold:typeof r=="number"?r:PB[r]},a=l=>{const{isIntersecting:c}=l;if(this.isInView===c||(this.isInView=c,s&&!c&&this.hasEnteredView))return;c&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",c);const{onViewportEnter:u,onViewportLeave:d}=this.node.getProps(),h=c?u:d;h&&h(l)};return RB(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(IB(e,t))&&this.startObserver()}unmount(){}}function IB({viewport:n={}},{viewport:e={}}={}){return t=>n[t]!==e[t]}const DB={inView:{Feature:LB},tap:{Feature:TB},focus:{Feature:xB},hover:{Feature:_B}},NB={layout:{ProjectionNode:tT,MeasureLayout:qA}},kp={current:null},rT={current:!1};function kB(){if(rT.current=!0,!!$m)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>kp.current=n.matches;n.addListener(e),e()}else kp.current=!1}const FB=[...TA,sn,Qr],UB=n=>FB.find(AA(n)),_x=new WeakMap;function OB(n,e,t){for(const i in e){const r=e[i],s=t[i];if(ln(r))n.addValue(i,r);else if(ln(s))n.addValue(i,Dl(r,{owner:n}));else if(s!==r)if(n.hasValue(i)){const o=n.getValue(i);o.liveStyle===!0?o.jump(r):o.hasAnimated||o.set(r)}else{const o=n.getStaticValue(i);n.addValue(i,Dl(o!==void 0?o:r,{owner:n}))}}for(const i in t)e[i]===void 0&&n.removeValue(i);return e}const xx=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class BB{scrapeMotionValuesFromProps(e,t,i){return{}}constructor({parent:e,props:t,presenceContext:i,reducedMotionConfig:r,blockInitialAnimation:s,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Mg,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const f=Ii.now();this.renderScheduledAt<f&&(this.renderScheduledAt=f,vt.render(this.render,!1,!0))};const{latestValues:l,renderState:c,onUpdate:u}=o;this.onUpdate=u,this.latestValues=l,this.baseTarget={...l},this.initialValues=t.initial?{...l}:{},this.renderState=c,this.parent=e,this.props=t,this.presenceContext=i,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=a,this.blockInitialAnimation=!!s,this.isControllingVariants=Lh(t),this.isVariantNode=OM(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...h}=this.scrapeMotionValuesFromProps(t,{},this);for(const f in h){const m=h[f];l[f]!==void 0&&ln(m)&&m.set(l[f],!1)}}mount(e){this.current=e,_x.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,i)=>this.bindToMotionValue(i,t)),rT.current||kB(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:kp.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){_x.delete(this.current),this.projection&&this.projection.unmount(),Zr(this.notifyUpdate),Zr(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const i=Vs.has(e),r=t.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&vt.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0)}),s=t.on("renderRequest",this.scheduleRender);let o;window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{r(),s(),o&&o(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in ra){const t=ra[e];if(!t)continue;const{isEnabled:i,Feature:r}=t;if(!this.features[e]&&r&&i(this.props)&&(this.features[e]=new r(this)),this.features[e]){const s=this.features[e];s.isMounted?s.update():(s.mount(),s.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Lt()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let i=0;i<xx.length;i++){const r=xx[i];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const s="on"+r,o=e[s];o&&(this.propEventSubscriptions[r]=this.on(r,o))}this.prevMotionValues=OB(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const i=this.values.get(e);t!==i&&(i&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let i=this.values.get(e);return i===void 0&&t!==void 0&&(i=Dl(t===null?void 0:t,{owner:this}),this.addValue(e,i)),i}readValue(e,t){var i;let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(i=this.getBaseTargetFromProps(this.props,e))!==null&&i!==void 0?i:this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(SA(r)||fA(r))?r=parseFloat(r):!UB(r)&&Qr.test(t)&&(r=_A(e,t)),this.setBaseTarget(e,ln(r)?r.get():r)),ln(r)?r.get():r}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:i}=this.props;let r;if(typeof i=="string"||typeof i=="object"){const o=ng(this.props,i,(t=this.presenceContext)===null||t===void 0?void 0:t.custom);o&&(r=o[e])}if(i&&r!==void 0)return r;const s=this.getBaseTargetFromProps(this.props,e);return s!==void 0&&!ln(s)?s:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new pg),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class sT extends BB{constructor(){super(...arguments),this.KeyframeResolver=EA}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:i}){delete t[e],delete i[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;ln(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}}function zB(n){return window.getComputedStyle(n)}class VB extends sT{constructor(){super(...arguments),this.type="html",this.renderInstance=XM}readValueFromInstance(e,t){if(Vs.has(t)){const i=Sg(t);return i&&i.default||0}else{const i=zB(e),r=(ig(t)?i.getPropertyValue(t):i[t])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:t}){return jA(e,t)}build(e,t,i){og(e,t,i.transformTemplate)}scrapeMotionValuesFromProps(e,t,i){return ug(e,t,i)}}class HB extends sT{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Lt}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(Vs.has(t)){const i=Sg(t);return i&&i.default||0}return t=qM.has(t)?t:Jm(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,i){return $M(e,t,i)}build(e,t,i){ag(e,t,this.isSVGTag,i.transformTemplate)}renderInstance(e,t,i,r){KM(e,t,i,r)}mount(e){this.isSVGTag=cg(e.tagName),super.mount(e)}}const GB=(n,e)=>tg(n)?new HB(e):new VB(e,{allowProjection:n!==te.Fragment}),WB=mU({...oO,...DB,...gB,...NB},GB),Ci=PF(WB);class jB{constructor(){this.componentControls=new Set}subscribe(e){return this.componentControls.add(e),()=>this.componentControls.delete(e)}start(e,t){this.componentControls.forEach(i=>{i.start(e.nativeEvent||e,t)})}}const XB=()=>new jB;function qB(){return bh(XB)}const nh=({whileHover:n,whileTap:e,onTapStart:t,name:i,clickListener:r,classes:s})=>{const[o,a]=te.useState({image:"",origin:""});te.useEffect(()=>{dF.getCard(i).then(c=>a(c))},[i]);const l={backgroundImage:`url(${o.image})`};return Ie.createElement(Ci.div,{whileTap:e,whileHover:n,onTapStart:t,className:i+" card"+(s?` ${s}`:""),style:l,onTap:()=>r?r({name:i,...o}):!0,layout:!0})},KB=te.forwardRef(({index:n,dragStart:e,dragActive:t,dragEnd:i,activeIndex:r,onTapStart:s,clickListener:o,dragConstraints:a,cardName:l},c)=>Ie.createElement("div",{id:n,ref:c,className:"loadout-space",style:r===n?{zIndex:2}:{zIndex:1}},l?Ie.createElement(Ci.div,{className:"cardDrag",drag:!0,onDragStart:e,onDrag:t,onDragEnd:i,dragElastic:0,dragConstraints:a,layout:!0},Ie.createElement(nh,{whileTap:{scale:1.2},onTapStart:s,name:l,clickListener:o})):Ie.createElement("div",{className:"card"}))),YB=({cells:n,gridArray:e,activeIndex:t,tapStart:i,dragStart:r,dragActive:s,dragEnd:o,clickListener:a,dragConstraints:l})=>Ie.createElement("div",{id:"loadout-grid"},n.map((c,u)=>Ie.createElement(KB,{index:u,activeIndex:t,key:`cell-${u}`,onTapStart:i,clickListener:a,dragStart:r,dragActive:s,dragEnd:o,ref:c,dragConstraints:l,cardName:e[u]}))),$B="Skills and techniques learned by survivors, usually through story events, and recorded on the Survivor Record Sheet.",ZB="The Watcher's instinct. Described on the Watcher's showdown story event and basic action card.",QB="A gear special rule. Accessory gear may be worn in addition to armor on a hit location. Each accessory specifies the hit location it covers.",JB="The part of the survivors' turn in which an individual survivor gains movement and activation. Each survivor must complete their act before another may start theirs, and all unused movement and activations are lost when a survivor ends their act.",ez="Most things a survivor or monster can do during the Showdown Phase, like moving and attacking, are actions.",tz="Activation can be spent to attack, activate some gear, and interact with terrain. Survivors gain one activation during that survivor's act.",nz="The Tyrant's instinct. Described on the Tyrant's showdown story event and basic action card.",iz="The end of a Showdown Phase. Contains different outcomes based on the survivors' success or failure.",rz="An ability. You may hunt if you are retired. When you gain Hunt XP, you may instead choose not to gain it.",sz="Actions following an alert contain important conditional information that must be considered to determine if the action is performed. Continue to perform any further actions on the AI card unless stated otherwise. Survival may not be spent during an alert.",oz="A gear keyword. This gear is substantively crafted of amber.",az="A gear keyword. This gear is ammunition for another weapon gear.",lz="The Slenderman's instinct. Described on the Slenderman's showdown story event and basic action card.",cz="An ability. At the start of the survivors' turn, if you are adjacent to the monster, reveal the top AI card, then place it back on top of the deck.",uz="Remove this card from play and return it to the game box. Unless it is recorded into settlement storage or the survivor's record sheet, any archived card is permanently lost. It must be returned to its respective deck and be re-drawn to be gained again.",hz="Gear with this keyword is armor. Protects the survivor from injury. Each piece of armor will have the hit location symbol for the hit location it can be worn on. Each hit location may only wear one piece of armor.",dz="A survivor hit location. Damage to the arms beyond the heavy injury level results in a roll on the Arms section of the Severe Injury table.",fz='The start of the showdown. Any survivors who have "On Arrival" effects apply them in the order of their choice.',pz="A gear keyword. This gear card is an arrow.",mz="The process of making attack rolls and resolving damage, wounds, or other effects.",gz="An aspect of a survivor or monster described by a numerical value.",vz="Gear with this keyword is an axe weapon. Survivors may gain levels of axe weapon proficiency with this weapon.",yz="The direction opposite the monster's facing.",_z="A gear keyword. Balm items work by rubbing them on a survivor's skin.",xz="Causes survivors to be knocked down.",wz="A survivor hit location. Damage to the body beyond the heavy injury level results in a roll on the Body section of the Severe Injury table. This is the only hit location that appears twice on the hit location dice.",Sz="Gear with this keyword is a bow weapon. Survivors may gain levels of bow weapon proficiency with this weapon.",Mz="The Brain is a survivor location different from hit locations, and represents a survivor's mental fitness. Since the human mind is fragile, there is only one injury level for the Brain (indicated by the light-lined unfilled box). Any damage beyond the light injury level results in a roll on the Brain Trauma table. The Brain is only damaged by brain damage.",Az='Before making an attack roll, you may declare "Caratosis X" in a loud, booming voice. If you do, that attack gains X automatic hits. X cannot be more than your total red affinities. When the attack ends, gain +X Hunt XP. When you trigger Age 2, gain the Beast of Caratosis secret fighting art.',Tz="The Lion Knight's instinct. Described on the Lion Knight's showdown story event and basic action card.",Ez="A gear special rule. Survivors spend movement and activation to move the maximum available spaces in a straight line in one direction. At the end of movement, if in range, perform an attack using a melee weapon, adding the number of spaces moved in this way to your strength for the attack. Charge does not impact any further attacks this turn.",bz="Gear with this keyword is a club weapon. Survivors may gain levels of club weapon proficiency with this weapon.",Cz="If a monster moves through a space occupied by a survivor, they collide and the survivor suffers collision. If a monster ends its movement on a survivor, they collide, the survivor suffers collision and knockback 5. If a survivor is knocked back into impassable terrain, they collide with it and the survivor suffers collision. If a survivor suffers knockback into another survivor, complete the knockback movement normally. Both survivors suffer collision at the end of knockback. If the survivors would occupy the same space, instead place the knocked back survivor in the closest unoccupied space.",Rz="When a survivor suffers collision, they are knocked down.",Pz="You need to focus your mind to perform extraordinary feats. At the start of your act declare your intent to Concentrate. Immediately end your act and attempt to Concentrate until the start of your next act. To successfully Concentrate you cannot: perform any kind of actions, move for any reason, suffer knocked down, suffer any kind of damage, gain any bleeding or negative attribute tokens.",Lz="Constellations are powerful upgrades available only to People of the Stars. Survivors can only have one constellation. Once a survivor has gained a constellation, they no longer record new Dragon Traits on their record sheet. If a survivor would gain two or more constellations at the same time, they choose which of them to gain.",Iz="A keyword. This may be consumed by survivors.",Dz="A special rule. This consumable gear or resources may be ingested by survivors for a listed result. Some are archived after use.",Nz="A survivor attribute listed on the survivor record sheet. Courage is a survivor's potentially ill-advised bravery, Reaching a courage level of 3 will trigger the Bold Story Event, while reaching a level of 9 will trigger the See the Truth Story Event.",kz="A gear special rule. Survivors must spend both movement and activation to activate Cumbersome gear.",Fz="A gear special rule. This gear cannot be removed from the gear grid for any reason. If the survivor dies, archive this gear.",Uz='A hundred-sided die. This is accomplished by using 2d10, with one die nominated to represent the "tens" digit and the other to represent the "ones" digit. Note that a roll showing 2 lanterns (result of 10 on each) indicates a result of 100.',Oz="Roll 1d10, divide the result by two and round up to the nearest whole number.",Bz="Gear with this keyword is a dagger weapon. Survivors may gain levels of dagger weapon proficiency with this weapon.",zz="A survival action. When opportunity permits, a survivor may spend 1 survival to dash. They gain +1m which must be spent immediately. Each survivor may only Dash once per round, and only after the settlement has innovated the Paint innovation.",Vz="A gear special rule. Gain +1 luck while attacking with this weapon. This increases the odds of inflicting critical wounds.",Hz="The survivor cannot hear, or be impacted by encourage and other audible effects.",Gz="When the survivors are defeated by a monster, follow the defeat rules in the Aftermath section of the monster's story event.",Wz="These rules apply to departing survivors at the end of the Settlement Phase.",jz="A terrain special rule. When a survivor collides with destructible terrain, stop their movement and archive the terrain. The survivor suffers 1 damage to a random hit location. When a monster collides with destructible terrain, archive the terrain.",Xz="Put the card into the appropriate discard pile. It is no longer in play.",qz="The Phoenix's instinct. Described on the Phoenix's showdown story event and basic action card.",Kz="A mental impairment. Disorders are found on disorder cards. When a disorder is gained, record its rules on the survivor record sheet and return the card to the box. Survivors can have up to 3 disorders. Additional disorders gained must replace a disorder of your choice. If a survivor would gain a disorder they already have, nothing happens.",Yz="A survival action. When a survivor is hit, after rolling hit location dice but before damage, they may spend 1 survival to dodge, canceling one hit. The dodged hit becomes a failed attack roll and does not cause damage. Any additional un-dodged hits resolve normally. Dodge is the only survival action that knocked down survivors can perform. Each survivor may only Dodge once per round.",$z="While a survivor is doomed, they cannot perform any actions or spend survival. If a survivor is doomed by a monster's AI or Hit Location card, they are doomed until all actions on the card are performed and the card is resolved.",Zz='An ability. When you suffer damage, you may declare "Dormenatus X" in a loud, booming voice, if you do, gain X armor points to each hit location. X cannot be more than your total green affinities. After the damage is resolved, gain +X hunt XP. When you trigger Age 2, gain the Grace of Dormenatus secret fighting art.',Qz='Duration cards are drawn twice. The first time a duration card is drawn, perform any "when drawn face down" actions. Then, instead of discarding it, place the duration card face up on top of the AI deck. The next time a monster draws an AI card, it draws the duration card for a second time. Perform any "when drawn face up" actions, then discard the card after resolving. Some duration cards have persistent effects while they are face up on top of the AI deck.',Jz="A unique survival action in People of the Sun. Once per round, if you have no +1 strength tokens, spend 1 survival to gain a +1 strength token. When you are knocked down, lose all +1 strength tokens.",eV="A survival action. A standing survivor may spend 1 survival at any time to encourage a knocked down survivor, letting them stand. Deaf survivors may not be encouraged. Each survivor may only Encourage once per round, and only if the settlement has the Language innovation.",tV="Each returning survivor contributes +1 endeavor (+1t) to the settlement. Survivors can spend endeavors to innovate, build new settlement locations, or perform unique actions. To spend an endeavor, nominate a survivor, reduce the settlement's total endeavors by 1, and follow the rules for the action the endeavor was spent on. Unless stated otherwise, the action's effects apply only to the nominated survivor.",nV="You may spend 7 survival minus your Luck to ignore a severe injury before you roll a result. Your Luck is determined by the sum of your permanent luck attribute, any luck modifiers, and any other gear or abilities affecting your luck at the time you endure.",iV="Equipping refers to putting a piece of weapon gear into your gear grid. If an effect restricts the type of gear you can equip, you cannot place that type of gear into your gear grid.",rV="When a monster or survivor with evasion is the target of an attack, increase the accuracy on the attack profile by the amount of evasion the target possesses. Evasion can be a negative number, in which case it is subtracted from the attack profile's accuracy. Regardless of evasion, a Lantern 10 on the attack roll is always a Perfect Hit, and an attack roll result of 1 will always be unsuccessful.",sV="An ability. When you roll on an investigate table, add +2 to your roll result.",oV="A monster is facing all spaces on the board that are in front of the miniature.",aV="A gear keyword. This gear requires finesse to use. This keyword does not interact with the core game in any way and is one of those annoying keywords for expansions.",lV="A gear keyword. Fire can destroy this gear.",cV="A space adjacent to the monster that is not in the monster's facing or blind spot.",uV="Flows are hesitations between monster actions. They give the survivors an opportunity to use survival actions. They are represented by a bar with an arrow.",hV="A survivor ability. Gain +2 evasion. Forgettable survivors cannot be encouraged.",dV="The direction the miniature is facing.",fV="A gear keyword. This gear is easily broken.",pV="A gear special rule. Frail weapons are destroyed if a survivor attempts to wound a Super-dense location with them. Archive the weapon at the end of the attack.",mV='A brain trauma result. A survivor who suffers this is Frenzied until the end of the Showdown Phase. Gain +1 strength token, +1 speed token, and 1d5 insanity. Ignore the "slow" special rule on melee weapons. A frenzied survivor may not spend survival or use fighting arts, weapon specialization, or weapon mastery. A survivor may be Frenzied multiple times.',gV="A gear keyword. This gear is substantively crafted of thick fur.",vV="Objects that survivors may carry and wear, represented by gear cards. Survivors may only use the gear in their individual gear grids. Except for gear with the weapon keyword, no survivor may have more than one copy of a gear card in their grid.",yV="The Flower Knight's instinct. Described on the Flower Knight's showdown story event and basic action card.",_V="A gear keyword. This gear has an unnatural gloom to it.",xV="A gear keyword. This gear is substantively crafted of gormskin.",wV="Grab is an action performed by some monsters. To perform Grab, place target knocked down in front of the monster (in an unoccupied space). Target suffers 1 damage per monster level.",SV="Gear with this keyword is a grand weapon. Survivors may gain levels of grand weapon proficiency with this weapon.",MV="The Screaming Antelope's instinct. Described on the Screaming Antelope's showdown story event and basic action card.",AV="The Lonely Tree's instinct. Described on the Lonely Tree's showdown story event and basic action card.",TV="A survivor hit location. Damage to the head beyond the heavy injury box will prompt a roll on the Head section of the Severe Injury table.",EV="A resource and gear keyword. This item is an herb.",bV="The Gorm's instinct. Described on the Gorm's showdown story event and basic action card.",CV="Permanent changes or injuries suffered by a survivor and recorded on the survivor record sheet. These often result from the severe injury table.",RV="A terrain special rule. A survivor cannot voluntarily move into or through any spaces this terrain occupies. Impassable terrain stops all movement, including knockback. If a survivor is knocked back into a space occupied by impassable terrain, they collide with the terrain and their movement ends just before the terrain.",PV="The Manhunter's instinct. Described on the Manhunter's showdown story event and basic action card.",LV="A type of monster hit location. Impervious hit locations cannot be wounded, even with a Lantern 10 wound roll. Wound attempts will never remove AI cards. However, critical effects may still occur.",IV="A terrain special rule. This terrain cannot be destroyed or removed from the showdown board for any reason until the end of the showdown.",DV="An endeavor action that survivors can take. Spend one endeavor, one bone, one hide, and one organ resource each to draw from your Innovation deck to see what your settlement innovates. This action is limited to once per lantern year.",NV="A type of advancement for a settlement, gained at the Lantern Hoard. Innovations alter the settlement and the survivors' capabilities. Record new innovations on your settlement record sheet.",kV="A survivor with 3+ insanity.",FV="Protects a survivor from brain damage.",UV="The action the monster undertakes if it cannot find a target to attack. Each monster has a unique instinct described on its showdown story event.",OV="A gear keyword. This gear can be used to play music.",BV="A gear special rule. If a survivor dies, archive all irreplaceable gear in their gear grids.",zV="A gear keyword. Gear that is neither a weapon nor armor.",VV="A gear keyword. Decorative and functional!",HV="Gear with this keyword is a katana weapon. Survivors may gain levels of Katana weapons proficiency with this weapon only if they have certain expansions.",GV="Gear with this keyword is a katar weapon. Survivors may gain levels of katar weapon proficiency with this weapon.",WV="A gear keyword. A lantern illuminates the darkness.",jV="A gear special rule. Spend MA to leap into the air! Place your survivor on an unoccupied space exactly 5 spaces away in a straight line, then activate a melee weapon with +2 accuracy and +5 strength.",XV="A gear keyword. Cured hides are a crucial component of this gear.",qV='An ability. Once a lifetime, on a hunt board space after Overwhelming Darkness, in place of rolling a random hunt event, use "53" as your result.',KV="A survivor hit location. Damage to the legs beyond the heavy injury box will prompt a roll on the Legs section of the Severe Injury table.",YV="A survivor impairment. Reduce all damage suffered by 1 to a minimum of 1. Suffer -2 to severe injury rolls.",$V="An ability. For every blue affinity you have, your ranged weapons gain this amount of range and your melee weapons gain this amount of reach.",ZV="A gear keyword. An accessory worn on the head.",QV="An ability. When you are a returning survivor, once per lantern year, you may spend t to s Intimacy.",JV="Remove the monster from the showdown board and place it adjacent to the target. It must be placed so its base covers as many other survivors as possible, colliding with the survivors.",eH="A weapon gear keyword. To attack with a melee weapon, survivors must be in a space adjacent to the monster. Melee weapons with Reach can attack from further away.",tH="The Butcher's instinct. Described on the Butcher's showdown story event and basic action card.",nH="A gear keyword. This gear is substantively crafted of metal.",iH="The physical representation of a monster or survivor, used in the Hunt and Showdown phases.",rH="Minions are small monsters that appear in expansions. They often have their own Minion Actions, toughness, and unique attributes that are described on cards or in their rulebooks. Refer to the appropriate expansion rules for all details regarding the minions present in that expansion.",sH="A type of monster AI card. Once mood cards are drawn, leave them in the play area instead of discarding them at the end of the monster turn. Moods can be removed by some items or through conditions listed on the card. If a monster suffers a wound when it has an empty AI deck and discard pile but one or more active moods, it is defeated.",oH="The Lion God's instinct. Described on the Lion God's showdown story event and basic action card.",aH="A gear keyword. This gear is hard to keep quiet.",lH="A gear keyword. This gear is crafted from a nuclear core, radiating with power.",cH="A terrain rule. This terrain blocks survivor and monster field of view, interrupting ranged weapon attacks and monster targeting. To check if field of view is blocked, draw an imaginary line from the center for the miniature's base to the center of the intended target's base. If the line comes in contact with a space occupied by an obstacle, the field of view is blocked and the target is not in field of view.",uH="A gear keyword. The effects of this gear are otherworldly. Saviors may never have Other gear in their gear grids.",hH="This completes an armor set if you're wearing the rest of the set and it shares a material keyword with the missing armor gear. For example, if you're wearing an Oxidized Lantern Helm and Phoenix Armor on every other hit location, you would gain the Phoenix Armor set bonus because the Phoenix Helm also has the metal keyword.",dH="A unique survival action in People of the Sun. If you have any +1 strength tokens, you may spend 1 survival and remove them all to give your next attack this round devastating 1. Limit once per round.",fH="A gear special rule. Paired weapons are two identical weapons that can be used as one. Add the speed of the second weapon when attacking with the first. These weapons must have the same name, and both must be in your gear grid.",pH="A type of hit location. This hit location represents the monster skillfully deflecting an attack. When attempting to wound Parry hit locations, all wound attempts fail unless the wound roll result is critical. This failure triggers any Failure and Reflex reactions as normal.",mH="An ability. When you gain insanity, you may also gain an equal amount of survival.",gH="A resource rule. This cannot be added to settlement storage. At the end of the settlement phase, it is lost. Archive it.",vH="A gear keyword. In certain situations, this can be used to mine minerals.",yH="Change the location of a miniature from one space on the showdown board to another. This does not count as movement.",_H="An ability. The survivor cannot use weapon specialization, weapon mastery, or fighting arts.",xH="A gear special rule. Spend m and q to move 3 spaces forward in a straight line and activate a melee weapon. This attack gains +1 strength.",wH="An ability. When rolling to determine a straggler, add your Hunt XP to your roll result.",SH="The Witch constellation ability. Each time you attack, before drawing hit locations, loudly say a name. You lightly bite the eye in your cheek to see what it sees. If you draw any hit locations with that name, gain +3 insanity and +10 strength when attempting to wound them.",MH="Principles are your settlement's guiding philosophies. When a principle's story event triggers, your settlement must make a choice. Record the chosen principle on the settlement record sheet and add that principle's card to the settlement play area.",AH="An ability. Your complete affinities and incomplete affinity halves count as all colors.",TH="A survivor ability. When you suffer a dismembered severe injury, ignore it and gain a bleeding token instead.",EH="A survivor is proficient with the weapon they have declared and listed on their survivor record sheet next to their proficiency attribute. They are also proficient with the weapon if they have its Specialization or Mastery.",bH="A gear special rule. When you wound with this weapon, gain the priority target token.",CH="The Reaper constellation ability. Once per showdown, you may eat an adjacent survivor's disorder. If you do, remove the disorder. They gain 1 bleeding token and you gain +1 permanent strength. At the end of the showdown, if you haven't eaten a disorder, you die.",RH="A status survivors can have. Some cards and story events care if a survivor is Purified.",PH="The monster that the survivors have elected to hunt.",LH="A gear keyword. A ranged weapon, like a bow or dart, allows survivors to attack from a distance.",IH="A gear keyword. This gear is crafted of uncured hides.",DH="A hit location rule. The 3 types of reactions are Wound, Failure, and Reflex. Each specifies the conditions for a reaction to occur. Reactions occur after rolling to wound the hit location they are found on and before resolving the next hit location.",NH="A survivor ability. Your complete affinities and incomplete affinity halves count as all colors. You may dodge at any time and as many times as you like each round. When you attack from a blind spot, add +1d10 to all wound attempts for that attack.",kH="A survivor ability. Your complete affinities and incomplete affinity halves count as all colors. During the Showdown, after you perform a survival action, gain +1 survival.",FH="A type of monster AI Card. At the end of a Relentless card, if there are any threats in the monster's field of view, reveal the next AI card. If it is relentless, play it.",UH="A card is resolved when there are no more instructions to follow on it. This may be due to performing every indicated action, or as a result of specific instructions on the card.",OH="Resource cards are gained from defeating monsters and from events. They are spent to develop the settlement and craft gear. In the core game, there are 4 kinds: Basic, Monster, Strange, and Vermin.",BH="When the final Hunt XP box is filled in, the survivor retires. Some disorders and severe injuries also force retirement. Retired survivors cannot depart, but still contribute to the total population of the settlement and may participate in settlement events and endeavors.",zH="Turn a card face up and examine it. (Do not play it.) Do not reshuffle a deck to reveal more cards than are in a deck.",VH="Rewards are gained by defeating monsters. They are listed on the monster's showdown story event. Gain rewards as a group, once per victorious showdown (unless stated otherwise).",HH="A Flower Knight gear card. This gear lets you take resources from the settlement storage back out onto a hunt and/or showdown. A Satchel allows the survivor to circumvent the Perishable resource rule.",GH="A gear special rule. After the first critical wound in an attack, savage weapons cause 1 additional wound. This rule does not trigger on Impervious hit locations.",WH="A gear keyword. This gear is substantively crafted of scales.",jH="Gear with this keyword is a scimitar weapon. Survivors may not gain levels of scimitar weapon proficiency.",XH="Gear with this keyword is a scythe weapon. Survivors may gain levels of Scythe weapon proficiency with this weapon only if they have certain expansions.",qH='A gear special rule. Selfish gear cannot be in the same gear grid with any gear with the "other" keyword.',KH="A gear special rule. A survivor must be insane to activate this gear.",YH="A typical session is comprised of three phases: Hunt Phase, Showdown Phase, and Settlement Phase. Some events may make survivors skip one or more of these phases. For example, Nemesis Encounters have no Hunt Phase.",$H="The unique collection of locations, innovations, principles, gear, resources, and survivors that represent the survivors' home. Survivors are at the settlement during the Settlement Phase.",ZH="A gear special rule. Add 1d10 strength to each wound attempt using this gear. This d10 is not a wound roll, and cannot cause critical wounds nor automatically fail.",QH="Gear with this keyword is a shield weapon. Survivors may gain levels of shield weapon proficiency with this weapon.",JH="A gear keyword. In certain situations, this can be used to harvest herbs.",eG="After you Slam, spend q to move 1 space and activate a melee weapon with +2 strength. If you wound with a spear, apply that wound roll result to the next selected hit location this attack.",tG="A gear special rule. Spend m and full move forward in a straight line. If you move 4+ spaces and stop adjacent to a monster, it suffers knock back 1 and -1 toughness until the end of the round.",nG="A gear special rule. Slow weapons always have an attack speed of 1. Do not add speed modifiers.",iG="The White Lion's instinct. Described on the White Lion's showdown story event and basic action card.",rG="A gear keyword. Able to be dissolved in liquid.",sG="Gear with this keyword is a spear weapon. Survivors may gain levels of spear weapon proficiency with this weapon.",oG="The Spidicules's instinct. Described on the Spidicules's showdown story event and basic action card.",aG="An ability. Ignore knocked down effects of brain trauma, disorders, and Intimidate actions.",lG="If the survivors move into this space (including starting the showdown), apply the rules listed on the hunt board.",cG="A gear keyword. This item has a strong odor.",uG="Straggler is a survivor condition gained during hunt events that affects survivor while resolving the hunt event.",hG="A type of survival action. When opportunity permits, a survivor may spend 1 survival to Surge. Gain +1 q which must be spent immediately. This allows them to activate a weapon, interact with terrain, use gear, and anything else spending an activation allows them to do. Resolve the results of Surge (including any monster reactions) before resuming the turn. Each survivor may only Surge once per round, and only if the settlement has the Inner Lantern innovation.",dG="Survival is the desperate desire to cling to life. Survival points are gained and lost throughout the campaign. They are spent to perform extraordinary feats and change your fate. Update the survival box on your survivor record sheet as it is gained and lost.",fG="Gear with this keyword is a sword weapon. Survivors may gain levels of sword weapon proficiency with this weapon.",pG="Tactics are often found in expansions with Knight monsters. They provide survivors with new ways to fight, using what they've learned from fighting Knights. Tactics are drawn from a Tactics deck by any badge-wearers at the start of the showdown. During the showdown, the badge-wearer may use their current Tactic(s) to help defeat their foes.",mG="The recipient of an attack or effect. Some attacks or effects may impact survivors other than the target.",gG="A threat is any survivor that is not knocked down or using special gear, terrain, or abilities to prevent being considered a threat.",vG="Gear with this keyword is a thrown weapon. Survivors may not gain levels of thrown weapon proficiency.",yG='An ability. Once a lifetime, on a hunt board space after Overwhelming Darkness, in place of rolling a random hunt event, use "100" as your result.',_G="Tracks the number of lantern years since the establishment of your settlement on the Settlement Record Sheet. Trigger story and settlement events as the timeline advances.",xG="An ability. When you are a returning survivor, gain +1 t.",wG="A gear keyword. Some tools trigger story events or grant bonuses.",SG="Toughness is the number a wound attempt total must meet or exceed to successfully wound a monster.",MG="A type of monster AI card. Describes permanent changes to the characteristics or behaviors of the monster. Trait cards are not discarded at the end of the monster turn.",AG="A special action at the Gormchymy settlement location. Spend 2 organ resources and roll 1d10. Add 1d10 for each Gormchymy innovation in your settlement. Add the roll results and gain the corresponding gear or resources.",TG="A type of monster hit location. A trap cancels all the attacker's hits, ends their attack, and causes the monster to stand, in addition to the actions listed on the card. After the Trap's actions are resolved, shuffle the entire hit location deck.",EG="Part of a monster's attack profile. Indicates that an Attack Effect is part of this attack.",bG="A gear special rule. If the survivor would die, roll 1d10. On a result of 6+, instead the survivor lives. If this roll occurs from the survivor having a lethal amount of bleeding tokens, the survivor will not die until they gain another bleeding token.",CG="A survivor attribute listed on the survivor record sheet. Represents a survivor's insight about the world. Reaching an understanding level of 3 will trigger the Insight Story Event, while reaching a level of 9 will trigger the White Secret Story Event.",RG="A gear special rule. A settlement may only have one copy of this gear card at a time.",PG="A gear special rule. When this survivor draws a trap card, roll 1d10. On a result of 6+, ignore the trap. Discard it and shuffle the hit location deck.",LG="A gear special rule. Replace all wound rolls with a 1d10 roll. On a 1-5, fail to wound, on 6+ wound. You cannot cause a critical wound while using this rule.",IG="A gear special rule. If any attack dice roll results are 1, the weapon causes 1 random damage to the survivor for each 1 rolled. Continue the attack as normal.",DG="Part of a monster's Aftermath. Use this result if the monster is defeated. Add that monster to the Defeated Monsters section of the settlement record sheet. If a Nemesis monster was defeated, update the Nemesis monster section as well.",NG="A gear special rule. If the settlement has any gear with this rule, the survivors cannot depart without this gear. If the survivor holding Vital gear perishes before the showdown, another survivor must pick up the Vital gear (discarding gear to make room in their grid if needed).",kG="A survivor hit location. Damage to the waist beyond the heavy injury level results in a roll on the Waist section of the Severe Injury table.",FG="A type of gear card. Weapon types in the core game include axe, blow, club, dagger, fist & tooth, grand, katar, shield. spear, sword, twilight sword and whip.",UG="Wearing a piece of gear refers to a piece of armor or accessory gear in your gear grid. If an effect restricts the type of gear you can wear, you cannot place that type of gear into your gear grid.",OG="Gear with this keyword is a whip weapon. Survivors may gain levels of whip weapon proficiency with this weapon.",BG="When a survivor successfully wounds a monster, remove the top card from its AI Deck and place it in the Wound Stack. If the AI Deck is empty, shuffle the AI discard to create a new deck first.",zG={Abilities:$B,Absorb:ZB,Accessory:QB,"Accuracy (Attribute)":"Represents permanent changes to attack rolls. Positive attribute adds to the dice roll, while negative attribute subtracts from the dice roll.","Accuracy (Weapon/Attack Profile)":"The number that each attack roll result must meet or exceed in order to be considered a hit. Listed on monster attack profiles and weapon gear.","Acid Palms":"An ability. Add 1d10 strength to wound attempts when attacking with Fist & Tooth.",Act:JB,Action:ez,Activation:tz,"Activation Limit X":"A gear special rule. A survivor may only activate/spend A on this gear the listed number of times during a showdown.","Adjacent (Miniature)":"A miniature is adjacent to another when it occupies a space one space in a cardinal (non-diagonal) direction from a square occupied by the other miniature.",Advance:nz,"Affinity Bonus":"A type of gear special rule. Having the indicated number of colored affinities will trigger the effect. Each affinity bonus only applies once, regardless of how many extra affinities a survivor has.","Affinity (Completed)":"Some gear cards have red, blue, or green half-squares on the card edge. If a half-square is adjacent to a half-square of the same color on another gear card, the complete square they form is one affinity.","After Damage":"An attack trigger found on some monster AI attack profiles. If there are any successful hits in the attack, resolve all damage from all hits in this attack (roll hit location dice, apply damage to hit location), then apply this trigger's attack effects. If there is no damage dealt from the attack, do not apply this effect.",Aftermath:iz,Ageless:rz,"Ageless Apprentice":"A secret fighting art from the Lion Knight expansion. It allows the survivor to rotate up to 3 gear cards in their gear grid. Each of these gear cards may be rotated 90, 180, or 270 degrees in either direction, as long as the card remains aligned with the printed square on the survivor's gear grid. This changes the positions of the affinities and arrows on those gear cards. The rules of the cards themselves remain unchanged.","Aggression Overload":"Add an attack roll to an attack. During your attack, after making your attack rolls but before drawing hit locations, you may roll the Death Die as an additional attack roll.","AI Card":"AI cards are made up of actions, flows and alerts. Some cards also have persistent injury and/or definition boxes. There are four kinds of AI cards - Basic, Advanced, Legendary, and Special.",Alerts:sz,"All Is Ash":"The Gold Smoke Knight's instinct. Described on the Gold Smoke Knight's showdown story event and basic action card.","All Survivors":"An effect during the showdown that refers to all survivors applies to all survivors currently on the showdown board.",Amber:oz,"Ambush (Monster)":"If the monster moves into the survivors' hunt board space, it ambushes the survivors. End any current hunt events and start the showdown immediately. Survivors skip their first turn. In most cases, this means that the monster will take two turns in a row.","Ambush (Survivors)":"Some hunt events allow the survivors to ambush the monster. If they do, survivors may go first in the showdown. Do not follow the setup rules on the monster's story event. Instead, place the listed showdown terrain, the monster, and survivors on the showdown board as the players decide (setup rules on terrain cards must still be followed).","Ammo - Bow":"A gear special rule. You must have a bow in your gear grid to activate this card. Ammo has the range of a bow in your gear grid.",Ammunition:az,Amnesia:lz,Analyze:cz,Archive:uz,Armor:hz,"Armor Points M":"Recorded on the survivor record sheet. Determined by armor gear in the survivor's gear grid, as well as other effects and events. Each point negates one point of damage to the hit location. Armor points decrease by 1 for each damage they negate.","Armor Set":"Each armor set is comprised of all armor from a single settlement location with the keyword 'set'. For example, while a survivor is wearing the White Lion Helm, White Lion Gauntlets, White Lion Coat, White Lion Skirt, and White Lion Boots, they have completed the White Lion armor set.","Armor Set Bonus":"A survivor wearing a completed armor set gains the benefits of the armor set bonus listed on its corresponding armor set card.",Arms:dz,Arrival:fz,Arrow:pz,Attack:mz,"Attack Effects":"Attack effects are rules contained in a box below the attack profile on some AI cards, and applied when the trigger occurs. These effects are applied only once, even if the target is hit or damaged multiple times by this attack.","Attack Profile":"Part of monster AI cards and basic actions. Lists the speed, accuracy, damage, and any triggers for a monster attack.","Attack Roll":"The dice roll that represents an attempt to hit a target. A Lantern 10 will always result in a hit.",Attribute:gz,"Attribute Modifier Token":"Attribute modifier tokens are used to indicate temporary changes to attributes. Attribute modifier tokens are double-sided to represent gains and losses for that attribute, and are combined with permanent attribute totals to determine the current level of each attribute. All tokens are removed at the end of each showdown.","Automatic Hit(s)":"Automatic hits happen in the place of attack rolls. When a survivor attacks, they make attack rolls equal to their weapon's Speed (plus modifiers). Each automatic hit foregoes one of these rolls and adds 1 to the total number of hits when hits are determined. The remaining attack rolls are performed normally, and all hits (rolled or automatic) are drawn and resolved together. Automatic hits are not Perfect hits.","Away (Movement)":"A movement that puts the most possible spaces between two points on the showdown board, such as a monster, survivor, terrain, or board edge.",Axe:vz,Back:yz,Balm:_z,Bash:xz,"Basic Action":"A Monster's basic action is detailed on its Basic Action card. A basic action consists of a target action and an attack action with an attack profile. Monsters will perform a basic action on some AI cards, in some reactions, or if the AI deck and discard are both empty. Performing a basic action does not count as an AI card being drawn.","Basic Action / Reference Card":"Double-sided Basic Action/Reference cards contain a monster's basic action on one side and an overview of the monster's characteristics on the other side.","Basic Hunt Event":"100 events survivors may encounter out in the darkness. Found in the Basic Hunt Event section of the rulebook.","Basic Resources":"Generic resources that can be gained from most quarry monsters and many events.","Before Damage":"A trigger found on some monster attack profiles. Apply this trigger's attack effect after hits and hit location dice are rolled, but before damage is dealt to hit locations.","Bitter Frenzy":"An ability. You may spend survival and use fighting arts, weapon specialization, and weapon mastery while Frenzied.","Bleeding Token":"Survivors can gain bleeding tokens from severe injuries, monster attacks, and some events. If a survivor has 5 or more bleeding tokens, they are dead. All tokens are removed at the end of each showdown.","Bleed X":"The target gains X bleeding tokens.","Blind Spot":"Usually the spaces directly behind the monster. Survivors in the monster's blind spot are outside of its field of view, and gain +1 accuracy when attacking.","Block X":"A gear special rule. Spend activation to ignore X hits the next time you are attacked. Lasts until your next act. A survivor may not use block more than once per attack.",Body:wz,"Body Blow":"An attack that always hits a survivor's body location. Do not roll hit location dice for this attack.","Bone (Gear)":"A gear keyword. Bone is one of the primary materials used to craft this gear.","Bone (Resource)":"A common resource keyword.",Bow:Sz,Brain:Mz,"Brain Damage":"Brain damage only affects the Brain location.","Brain Trauma Table":"Contains possible outcomes of excess damage to the Brain location.","Broken Lantern (Resource)":"A basic resource with the Scrap keyword.","Build (Location)":"When a new location is built, place that settlement location in the play area and add the new location to your settlement record sheet. This is a permanent addition to your settlement.","Burnt Nerves":"An ability. You are immune to bash.","Campaign End (Strain Milestone)":"A specific type of Strain Milestone that is checked at the end of a Campaign. If achieved, resolve its Permanent Effect and remove the achieved strain milestone card from your game. It can never be used again.","Canceled Attack":"A canceled attack immediately ends. Discard all unresolved hit locations. Do not perform any actions, special rules, critical effects, or reactions on these cards. This most commonly happens when the attacker is knocked down, draws a trap card, or is no longer in range of the monster during their attack.",Caratosis:Az,Catwalk:Tz,Charge:Ez,"Child of the Sun":"A special newborn blessed under a Solar Eclipse. Some cards and story events care about Children of the Sun.","Closest Survivor":"The survivor the least number of cardinal spaces away from the monster.","Closest Threat":"The threat the least number of cardinal spaces away from the monster.",Club:bz,Collides:Cz,Collision:Rz,Concentrate:Pz,Constellation:Lz,Consumable:Iz,Consume:Dz,"Core Countdown":"The Dragon King's instinct. Described on the Dragon King's showdown story event and basic action card.",Courage:Nz,"Critical Wound":"Critical wounds are lucky blows that always wound a monster, even if the wound attempt does not exceed the monster's toughness. A critical wound occurs when a wound roll result is a Lantern 10 on a hit location with a critical wound effect. The luck attribute modifies the roll needed for a critical wound.","Critical Wound Effects":"Critical wound effects on monster AI cards are represented by the critical wound symbol, followed by rules that specify what happens when a monster is critically wounded at that location. Critical wounds effects are not reactions. On a critical wound, cancel all reactions on that hit location card.","Crystal Skin":"You ignore cursed and cannot wear armor. When you depart gain 3 to all hit locations. Suffer -2 to the result of all severe injury rolls. When you participate in Intimacy, newborns gain Crystal Skin in addition to any other roll results.",Cumbersome:kz,Cursed:Fz,d100:Uz,d5:Oz,Dagger:Bz,"Damage (Attack Profile)":"The amount of damage dealt for each hit in a monster's attack. Roll separate hit locations for each hit.","Damage (Attribute)":"Damage is added to the damage listed on an attack profile to calculate the total damage of an attack.","Damage (Condition)":"A hit damages a survivor if it removes armor points or causes an injury. Hits which are dodged, blocked, or ignored do not cause damage.",Dash:zz,"Dead Inside":"A survivor impairment. Survivors with Dead Inside cannot gain survival.",Deadly:Vz,Deaf:Hz,"Death Count":"Part of the settlement record sheet. During the Settlement Phase, if any survivors perished during the previous Hunt or Showdown Phase, update the death count. If survivors perish during the Settlement Phase, update the death count immediately. The first time a settlement's death count is updated, trigger the Principle: Death story event.","Death Die":"A special orange ten-sided die. The Death Die replaces the Monster Controller tile. The player of the survivor with the Death Die controls the monster. At the start of the showdown, the player with the Final Lantern starts with the Death Die on Horripilation. At the start of each subsequent round, pass the Death Die to the Horripilation card to the left. The Watcher's final emanations continue to jump between lanterns of survivors that cannot act, including dead or absent survivors. Instead of the benefits on the Monster Controller tile, you may use Pulse Discoveries based on your settlements Lantern Research Level. Once per round, the survivor with the Death Die may use one of the settlement's unlocked Pulse Discoveries. After rolling the Death Die, return it to its current Horripilation card. In the Final Lantern is lost or archived, it is gone forever. Survivors cannot use the Death Die. Return to using the Monster Controller tile.","Death (Monster)":"A monster is defeated when it is wounded and there are no AI cards in the AI deck or AI discard pile to move to the wound stack.","Death (Survivor)":"A survivor can die in a variety of ways. Remove their miniature from the board. They can no longer participate in the hunt or showdown. Return their gear to the settlement storage and move their resources to another survivor. If all the survivors die during the showdown, all of their gear returns to the settlement and all resources not in the settlement storage are lost.",Defeat:Gz,"Defensive Spit Salve":"The Dung Beetle Knight's instinct. Described on the Dung Beetle Knight's showdown story event and basic action card.","Deflect X":"A gear special rule. When you Deflect X, gain (or lose) deflect tokens until you have X of them. When you are hit, if you have any deflect tokens, you ignore that hit and lose a deflect token. When you Deflect X, you lose the benefits of Block.",Depart:Wz,"Departing Survivors":"The survivors nominated to take part in the next hunt and showdown.","Destroy Armor":"An attack effect that reduces armor points of a survivor hit location to 0 before applying damage.",Destructible:jz,"Devastating X":"A gear special rule. When a devastating weapon wounds a monster, it will inflict X additional wounds.",Discard:Xz,Disdain:qz,Disorder:Kz,Dodge:Yz,Doomed:$z,Dormenatus:Zz,"Double-Sided Innovation":"A double-sided innovation has two sides with two distinct innovations. A settlement may only have one of them at a time. If the settlement gains one innovation while it has the other, simply flip the innovation card to reflect this change and modify your settlement record sheet as appropriate.","Double-Sided Terrain Tiles":"These terrain tiles have two corresponding terrain cards. Use the rules on the terrain card corresponding to the currently visible side of a terrain tile. Outside of specific showdowns, you will only use the side of the terrain tile corresponding to the terrain card you drew.","Dragon Traits":"Dragon Traits are a collection of abilities, fighting arts, attribute modifiers, disorders, secret fighting arts, and surnames that survivors gain throughout a People of the Stars campaign. Dragon Traits are mentioned in bold, red text to remind players to mark them on their record sheet as they are gained. Once marked, Dragon Traits are permanent. Even if a survivor loses the original source of the trait, they are still considered to have that Dragon Trait. When a survivor has four Dragon Traits in a row (vertically or horizontally), they gain a Constellation via the Faces in the Sky story event.","Draw AI":"The monster controller draws the top AI card of the monster's AI deck and plays it. If the AI deck is empty, shuffle the discard pile into it and draw the top card. If the AI deck and discard pile are empty, the monster performs its Basic Action.","Dung (Resource)":"A resource keyword. Dung is prized by the Dung Beetle Knight.",Duration:Qz,"Early Iron":"A gear special rule. When any of your attack roll results are a 1, cancel your attack.",Embolden:Jz,Encourage:eV,Endeavors:tV,"Endless Babble":"An impairment. When you *depart*, *departing survivors* gain +1 insanity. You cannot encourage.",Endure:nV,Equip:iV,Evasion:rV,"Event Damage":"Some damage is incurred from events. Typically, this damage cannot be dodged or blocked. Event damage is non-lethal, and will reduce armor points and cause light and heavy injuries, but will not cause severe injuries or brain trauma.","Event Revealer":"The event revealer reveals a hunt event, reads it aloud, and follows the rules on the card, making all decisions along for that hunt event.",Explore:sV,Facing:oV,"Failure (Reaction)":"A monster reaction. Performed in response to unsuccessful wound attempts at certain monster hit locations.","Fairy Ring":"The Fairy Ring is a special feature of the Flower Knight showdown. It is not terrain. The Fairy Ring is always placed in the center of the showdown board, ignoring any effects that say otherwise (e.g. Ambush rules). If a terrain card or other effect directs you to place a terrain tile inside the Fairy Ring during the showdown or showdown setup, do not place it. If a rule or effect directs you to move a terrain tile into the Fairy Ring during the showdown, it inexplicably stops short at its border.","Fated Battle":"An ability. At the start of a showdown with the picked monster, gain +1 speed token.","Feather (Gear)":"A gear keyword. This gear is substantively crafted of feathers.","Field of View":"A survivor is in a monster's field of view unless they are in the monster's blind spot or the monster's line of sight is blocked by terrain with the Obstacle rule.","Fighting Arts":"Powerful battle techniques found on fighting art cards. When a fighting art is gained, record its rules on the survivor record sheet and return the card to the box. Survivors can have up to 3 fighting arts. Additional fighting arts gained replace a fighting art of your choice. If a survivor would gain a fighting art they already have, nothing happens.",Finesse:aV,"First Strike":"A type of monster hit location. This hit location must be resolved before any others, except Traps. If multiple First Strike locations are drawn, the player decides the order in which to resolve them. Traps still precede and cancel all other hits.","Fish (Resource)":"A resource keyword. These resources can be acquired via the special hunt event Sky Fishing.","Fist & Tooth":"Fist & Tooth is a weapon always available to a survivor. The attack attributes for First & Tooth are listed on the gear grid. Survivors may gain levels of Fist & Tooth weapon proficiency with this weapon.",Flammable:lV,Flank:cV,Flow:uV,"Flower (Resource)":"A resource keyword. Flowers are perishable resources that can be harvested in specific areas.",Forgettable:hV,Forward:dV,Fragile:fV,Frail:pV,Frenzy:mV,"Full Move":"A game term that describes a monster's or survivor's maximum available movement, taking into account all movement modifier tokens.",Fur:gV,Gear:vV,"Gear Grid":"A mat with space for 9 gear cards. Gear cards can be arranged in any configuration, but must remain right-side up. They cannot be rotated. Gear in gear grids can only be rearranged during the Settlement Phase.","Gear Keyword":"Located directly under the name of a gear card,. They describe information about gear, such as weapon type, materials, use, or limiting factors. Keywords are referenced by other cards and events.","Gear Recipe":"Found on the backs of Green Knight Armor. These recipes list the requirements needed to craft these rare and powerful gear cards.","Gear Special Rule":"Located on the bottom portion of a gear card. These list gear abilities, bonuses and requirements.",Germinate:yV,Gloomy:_V,Gormskin:xV,Grab:wV,Grand:SV,Graze:MV,Growth:AV,"Guard (Gorm)":"A gear special ability. At the end of your attack, if you are standing and have a shield in your gear grid, spend 1 survival to move 3 spaces directly away from the monster and Block 1 for free.","Guard (Instinct)":"The King's Man's instinct. Described on the King's Man's showdown story event and basic action card.",Head:TV,"Head Hunter":"An attack that always hits a survivor's head hit location. Do not roll hit location dice for this attack.","Healing (Survivors)":"When survivors heal, erase all filled injury levels and restore all lost armor points.","Heal Injury Level":"A heavy lined injury level box. When a survivor's heavy injury level is filled, they are knocked down. Once it is filled, this injury level cannot be suffered again this showdown unless it is healed.","Heal X":"When a monster performs heal X, return X AI cards from the Wound Stack to the bottom of the AI deck without looking at them.","Heart of the Sword":"The Storm constellation ability. If you gain weapon proficiency during the Aftermath, gain an additional 3 levels. You cough up a hunk of your own solidified blood and gain 1 Iron strange resource.","Heavy (Gear)":"A gear keyword. This gear has substantial weight.",Herb:EV,"Herb Gathering":"A story event that may be placed on the Hunt Board when a survivor has a sickle. Every survivor with a sickle rolls on the Herb Gathering table.","Hide (Resource)":"A common resource keyword.","Hit Location Dice":"Used to determine the survivor hit location hit by an attack.","Hit Location (Monster)":"Each monster has a unique hit location deck composed of hit location cards. There are 5 types of hit location card: First Strike, Impervious, Super-dense, Trap, and Normal. Any hit location that has no listed type is Normal.","Hit Location (Survivors)":"Hit locations are areas of the survivors' body that can wear armor and suffer damage. The hit locations are: Head, Arms, Body, Waist, and Legs. Hit locations may gain armor points from armor. Without armor, hit locations have 0 armor points.","Hit (Monster)":"A hit is the result of an attack roll that meets or exceeds the accuracy for an attack using an attack profile. Hits which are dodged, blocked, or ignored are misses. Damage outside of an attack profile is not considered to be from a hit.","Hit (Survivors)":"A hit is the result of an attack roll that meets or exceeds the accuracy for an attack using a weapon.","Homing Instinct":"A survivor ability. Add +5 to your rolls on the Run Away story event.","Hunt Board":"The Hunt Board is used during the Hunt Phase to track a quarry monster.","Hunt Board Diagram":"Part of a monster's showdown story event. It indicates how to set up the hunt board for that monster.","Hunt Event":"A hunt event describes an encounter the survivors face on their journey. They can be disastrous, bizarre, or even beneficial. These appear on basic hunt event cards and monster hunt event cards.","Hunt Event Card (Monster)":"Monster hunt event cards are only encountered when hunting a particular monster. They describe pitfalls and wonders specific to this monster. Each quarry monster has a unique set of hunt event cards.","Hunt Event Cards (Basic)":"All basic hunt event cards are identical. They direct the event revealer to roll on the hunt event table.","Hunt Experience (XP)":"Survivors gain Hunt Experience during the Aftermath of a victorious showdown. When a survivor gains Hunt XP, fill in the next unfilled Hunt XP box on their survivor record sheet. Some hunt experience levels are milestones (indicated by a heavy-lined box) that trigger the Age story event. The number of milestones filled indicates which Age rules apply. When the final hunt experience box is filled, the survivor is too old to hunt, and must retire.","Hunt Phase":"The part of each session spent locating a quarry monster. When survivors determine what type and level of monster to hunt.","Hybrid Armor Set":"A survivor wearing all armor listed on a hybrid armor set will have completed the set and gains the benefits of the corresponding armor set card if the settlement has acquired it. When a survivor departs with a hybrid armor set bonus, set their armor points at all hit locations to the number of armor points printed on the hybrid armor set card (before adding modifiers). Losing an armor set bonus during the hunt or showdown does not change armor points at any hit locations. Multiple survivors may gain the same hybrid armor set bonus despite there being only one copy of the hybrid armor set card.","Ignore a Hit":"Reduce the number of hits by 1. This happens before hit locations are determined.",Illuminate:bV,Impairments:CV,Impassable:RV,Impatience:PV,Impervious:LV,"In Darkness":"During the Showdown, a survivor is in darkness if something is casting a shadow and they are in that shadow. (Traditionally, this only occurs with a Sunspot Lantern or during the Sunstalker showdown.) Some cards care about survivors being in darkness.",Indestructible:IV,"Injury Level":"Indicates damage to a hit location. Recorded on the survivor record sheet. Most hit locations feature two levels, light and heavy, except for the Head (which only has a heavy injury level).",Innovate:DV,Innovation:NV,"Innovation Consequences":"When a settlement gains an innovation, they may find themselves adding its consequences to their innovation deck (a persistently evolving deck). Find all appropriate cards in your game box that have the correct consequence and shuffle them into your innovation deck.","Innovation Deck":"A settlement's innovation deck is a persistent deck that grows as the settlement innovates.","In play":"All cards are considered in play after they have been drawn and until they resolve. Most cards are discarded after resolving. Others, such as Moods, remain in play indefinitely or until a condition is satisfied.","In Range":`A survivor is in a monster's range if the number of spaces between them is less than or equal to its current movement (including modifiers). If "in range" is followed by a number, such as range (8), that number replaces the monster's movement when calculating to see if a survivor is in range.`,Insane:kV,Insanity:FV,Instinct:UV,Instrument:OV,"Intimidate Actions":"Intimidate actions cause brain damage. Intimidate actions are not attacks or hits (survivors cannot spend survival to dodge Intimidate actions). Monsters don't need to be adjacent to their targets to intimidate.","Iridescent Hide":"A survivor ability. When you depart, add 1 to each hit location for each different-colored affinity in your gear grid.","Iron Will":"An ability. You cannot be knocked down. Reduce all knockback you suffer to knockback 1.",Irreplaceable:BV,Item:zV,Jewelry:VV,Katana:HV,Katar:GV,"Knight (Gear)":"A gear keyword. These gear have knightly qualities to them, bestowing tactical prowess upon their wearer.","Knight's Charge":"Spend MA, full move in a straight line. At the end of the movement, activate Griswaldo and attack. If you moved more than 5 spaces, this attack gains devastating 2.","Knockback X":"Move the target of knockback x spaces directly away from the cause of this effect.","Knocked Down (Monster)":"While a monster is knocked down, attack rolls hit on 3+ (in place of normal accuracy). Cancel all reactions, including reactions that might be beneficial to survivors. This does not cancel critical wounds effects (since they are not reactions). If the monster is knocked down during a flow, cancel any remaining actions on its card. A knocked down monster stands when: it draws an AI card, a trap is played, or at the start of the next turn (monster or survivors').","Knocked Down (Survivor)":"When a survivor is knocked down, turn the miniature on its side. Knocked down survivors always stand at the end of the next monster turn. If a survivor is knocked down in the middle of their attack, the remainder of that attack is canceled. Knocked down survivors may only spend survival to dodge (remaining knocked down), and cannot spend activation or movement.",Lantern:WV,"Lantern 10":"A die roll result with the lantern face up. Equivalent to a 10 for other 10-sided die.","Lantern Research":"A story event. Survivors can improve their Lantern Research Level during the settlement phase and expand the range of Pulse Discoveries available to them, allowing them to access further powers with the Death Die.","Lantern Year":"Survivors' basic unit of time. The settlement typically advances by one lantern year as part of each Settlement Phase.","Last to Wound":"The survivor who last wounded the monster.",Leap:jV,Leather:XV,Legendcaller:qV,Legs:KV,"Legs Locked":"When you gain the Death Die, you stand. While you have the Death Die, you can not be knocked down for any reason.",Leprosy:YV,"Leyline Walker":"An ability. While there is no armor or accessory gear in your gear grid, gain +3 evasion.","Life Exchange":"An ability. In the Aftermath, gain 1 additional Hunt XP. You may not wear other gear. If you trigger the White Secret story event, you cease to exist. When you retire, you cease to exist.","Life Trait":"A core game variant. Instead wounding by removing AI cards to the wound stack, wound the monster by reducing the number on its Life trait. When the number is reduced to 0, the monster is dead.","Light Speed":"A type of monster hit location. Light Speed hit locations are faster than First Strike hit locations. An attacker must select Light Speed hit locations before First Strike hit locations and before any other type of hit location cards. If multiple Light Speed hit locations are drawn in an attack, the attacker chooses which one to resolve first.","Limb-maker":"The Sculptor constellation ability. Once per settlement phase, spend 2 E to carve a prosthetic limb. Remove a survivor's dismembered severe injury and add 1 Bone basic resource to the settlement storage.","Limit, once per lifetime":"This can only happen once to a survivor. If it occurs again, nothing happens. In rare cases, it is possible for a survivor to be part of a new campaign; the survivor still has only one lifetime and anything that already happened to them (with limit, once per lifetime) cannot happen again. If a survivor somehow dies and is reborn, they may gain these benefits again. Record once per lifetime effects on the survivor record sheet.",Lucernae:$V,"Luck (Monster Attribute)":"Every positive monster luck token reduces the range of wound roll results considered critical. Normally, critical wounds occur only on Lantern tens. Unless survivors have positive luck modifiers, a critical wound against a monster with 1 or more luck tokens is impossible. Each negative monster luck token increases the attackers' critical wound range by 1. The rule of Lantern 10 always applies, so even if a monster's luck makes critically wounding impossible, a wound roll of a Lantern 10 will still cause a normal wound.","Luck (Player Attribute)":"Luck modifies a survivor's chance to cause a critical wound from a wound roll. +1 luck causes a critical wound on a wound roll result of 9 or 10, +2 luck on 8, 9, or 10, and so on. A luck modifier can be negative, making it impossible to critically wound.","Mad Oracle":"An ability. Once per showdown, as a monster draws an AI, name a card. If the AI card drawn is the named card, gain +1 evasion token.","Marrow Hunger":"An impairment. If the Murder or Skull Eater settlement events are drawn, nominate this survivor.",Mask:ZV,Matchmaker:QV,Materialize:JV,Melee:eH,Menace:tH,"Metabolic Surrender":"An ability and a pulse discovery. Any time during the showdown, you may roll the Death Die. Gain twice that much survival. This round, ignore negative effects of permanent injuries, impairments, disorders, and negative attributes (including tokens). At the end of the round, you die.",Metal:nH,"Metal Maw":"An ability. Your Fist & Tooth attacks gain Sharp (add 1d10 strength to each wound attempt).","Mineral Gathering":"A story event that may be placed on the Hunt Board when a survivor has a pickaxe. Every survivor with a pickaxe rolls on the Mineral Gathering table.","Mineral (Gear)":"A gear keyword. This gear has substantial amounts of minerals in its structure, making it a prime choice for Calcification.",Miniature:iH,Minion:rH,"Monster AI Deck":"Each monster has a unique AI deck. Its showdown story event describes how to construct a Monster AI Deck at the appropriate level.","Monster Controller":"The player who draws the monster's AI card. They make any decisions and rolls to resolve a monster's actions for that round. Designated by the Monster Controller tile. Monster controller changes at the start of each round.","Monster Controller Bonus":"When a monster controller's survivor becomes the target (or one of the targets) from a Pick Target list on an AI card, this foolhardy action earns that player's survivor +1 insanity.","Monster Controller Tile":"Designates the monster controller. Moves clockwise to the next player or survivor at the start of each round.","Monster Fruit":"A special terrain present in the Lonely Tree expansion (represented by the fruit miniatures). When a monster has Monster Fruit in play, perform the actions listed on Monster Fruit before any other actions during the monster turn. Proceed through the rest of the monster turn normally.","Monster Hit Location Card":"Represents a location on the monster's body. These are hit by a survivor's successful attack roll. Many hit location cards feature special effects or actions.","Monster Hit Location Deck":"The cards that collectively make up the locations a survivor may hit a given monster. Unique to each monster.","Monster-Impassable":"A terrain special rule. Monster-Impassable terrain has all of the characteristics of impassable terrain, but with the following addition: Monsters may not move through spaces occupied by monster-impassable terrain. Monsters must move around monster-impassable terrain tiles, if possible. If this is not possible (such as when the monster is instructed to move in a straight line), they instead end their movement in the space before the terrain tile.","Monster Level":"Monster level determines the difficulty of the showdown and the monster's placement on the hunt board. Higher-level monsters have longer hunts and more difficult showdowns.","Monster Reference Card / Basic Action":"Contains a small overview of each monster's characteristics. They serve as a compact reminder of frequently-used monster information.","Monster Resources":"Monster resource cards are gained only from fighting that monster. Each huntable monster has a unique deck. Monster resources can be used and spent as their resource type or as their specific resource name. Some monster resources have additional rules.","Monster Showdown Story Event":"Contains relevant information for a particular monster's showdown and hunt, including instructions on constructing a monster AI deck, hunt and showdown board setup, the monster's instinct and basic attack, and information on the aftermath of the showdown.",Mood:sH,"Most/Least X:":"The survivor with the most/least of the listed condition. Zero can count as most or least unless otherwise stated.",Mourn:oH,"Move and Attack Target Action":"A component of most AI cards. A Move and Attack Target Action follows a Pick Target Action. Full move the monster towards the target and perform the following attack profile.","Move into Range and Attack":"Some monsters use Move into Range and Attack actions. When the monster is instructed to do so, end the monster's movement the specified number of spaces away from the target based on the Range. If the monster is closer to the target than the Range, move it until it is exactly in Range.","Movement (Attribute)":"The maximum amount of spaces a monster or survivor may move with in single move action. A monster or survivor with less than 1 movement may still move 1 space each move action.","Move Through Target (Monster)":"When a monster is instructed to move through a target, it moves towards the target but instead of stopping when adjacent, its movement continues. This will normally cause collision with the target.","Necromancer (Secret Fighting Art)":"A secret fighting art from the Lion God expansion. Necromancers gain a bonus on the Death Reading story event and from the event's rare gear. Necromancers roll on the Worm Trauma table instead of the severe injury table (for random severe injuries). If the Necromancer dies or loses the secret fighting art, the resilient worm returns to the settlement and they regain the Knowledge Worm innovation. This happens regardless of whether or not the Necromancer is hamstrung, frenzied, or otherwise unable to use fighting arts.","Next Monster Turn":"Some effects persist until the next monster turn. If it is the survivors' turn, the effect will end on the monster turn immediately following this turn. If it is the monster's turn when this effect begins, it will end on the following monster turn.","Next Round":"Some effects persist until the end of the next complete round. These effects will end after the monster, then the survivors, take another turn.","Nightmare Blood":"A survivor ability. Whenever you gain a bleeding token, add 1 to all hit locations.","Nightmare Membrane":"A survivor ability. You may spend AM to exchange any 1 of your tokens for a +1 strength token.","Nightmare Spurs":"A survivor ability. Once per showdown, you may spend all your survival (at least 1) to lose all your +1 strength tokens and gain that many +1 luck tokens.",Noisy:aH,"Non-deaf Survivor":"Survivors not suffering from the deaf severe head injury.","No Target":"The last option on a monster's Pick Target list. It indicates what to do if no target is found. This is most often a monster's Instinct action. When a monster cannot find a target, subsequent actions on the card are not performed.",Nuclear:lH,"Object of Desire":"A hunt event unique to the Lonely Tree expansion. It has a basic hunt event card back. It is shuffled into the basic hunt event cards, and can be randomly drawn from any hunt board space. The event is archived after it is resolved -- it is permanently removed from the basic hunt events and returned to the game box.",Obstacle:cH,"On Collision":'"On collision" is shorthand for when a monster, survivor, or terrain tile collides with something else. Cards that read "on collision" have special rules describing what happens when two things collide. Refer to the Kingdom Death: Monster core game for full collision rules.',"Oracle's Eye":"A survivor ability. At the start of the showdown, look through the AI deck, then shuffle it.","Organ (Resource)":"A common resource keyword.",Other:uH,Outfit:hH,Overcharge:dH,"Overwhelming Darkness":"A space on the Hunt Board. The first time each hunt the survivors move into the Overwhelming Darkness space, they trigger the Overwhelming Darkness story event. The survivors cannot skip Overwhelming Darkness. If they move through the space, instead stop all movement and resolve Overwhelming Darkness before any other events or effects. Then, resolve other events or effects on this space. If, for some reason, the survivors move into or through Overwhelming Darkness more than once in a single Hunt Phase, treat it as a blank space. If the monster is on the Overwhelming Darkness space when the survivors move into it, skip its event and start the showdown immediately.",Paired:fH,Parry:pH,'Partner - "(Partner Name)"':"An ability. When you both Arrive, gain survival up to the survival limit. Partners may only nominate each other for Intimacy. When a partner dies, the remaining partner gains a random disorder and loses this ability.",Peerless:mH,"Perfect Hit":"An attack dice roll result of a Lantern 10. This always results in a hit. When there are multiple Perfect hits in a single attack, trigger any rules applying to Perfect hits that many times.",Perishable:gH,"Permanent Injury":"An injury to a survivor that does not heal with time. Its effects always apply to that survivor unless canceled by another effect.","Persistent Injury":"A special injury found on some hit location cards. When a monster suffers a critical wound on a hit location with a persistent injury, leave the card in play instead of discarding it. Some persistent injuries modify a monster's behavior, while others affect specific AI cards.","Persistent Injury Actions":"Found on some AI cards. Persistent injury actions are conditional actions that replace the normal rules of an AI card. They are only performed when the monster draws an AI card with a persistent injury action that matches a persistent injury in play. If a persistent injury action is performed, ignore other actions on the card.",Pickaxe:vH,"Pick Target":"A component of most AI cards. A Pick Target list has a series of conditions. The monster controller checks to see if each targeting condition is met, starting from the first and stopping when one is et. Sometimes targets are determined by an area or zone (such as adjacent survivors or all survivors in a zone). Some AI cards pick more than one target.",Place:yH,Possessed:_H,Pounce:xH,Prepared:wH,Presage:SH,Principle:MH,"Priority Target":"When a survivor gains the priority target token, they have captured the monster's attention. Only one survivor may have the priority target token at a time. Whenever a monster performs a Pick Target action, the survivor with the priority target token will always be picked. The priority target token is removed when the survivor with the token is picked, another survivor gains the priority target token, or an effect causes the priority target token to be removed.",Prismatic:AH,Pristine:TH,Proficiency:EH,Provoke:bH,"Proxy Cards":"There are 8 proxy cards. These can be used to replace lost cards or create game variants.",Psychovore:CH,"Pulse Discoveries":"A series of abilities that can be unlocked via Lantern Research. A Pulse Discovery can be performed by a survivor with the Death Die.",Purified:RH,"Puzzle Affinity":"A gear special rule. Puzzle affinity bonuses can only be gained if the affinities are completed using the affinities on that specific gear card (indicated by puzzle pieces instead of boxes).",Quarry:PH,"Random Hit Location (Survivor)":"Determine using the included hit location dice.","Random Hunt Event":"Roll d100 and apply the hunt event corresponding to this number on the Hunt Event table.","Random Survivor":"The monster controller or event revealer typically determines a survivor by chance, using an equal probability of all possible outcomes.",Ranged:LH,"Ranged Attack (Monster)":"Some monsters can attack their targets at range. Refer to the monster's cards and rulebook to determine its range. Traditionally, the Range of a monster's attack will be stated on the card, but some monsters can attack with unlimited range.","Range: X (Gear)":"A gear special rule. Survivors this many or fewer spaces away from a monster may attack with this weapon. Ranged weapons cannot be used if field of view to the monster is blocked (by terrain with the Obstacle rule).",Rawhide:IH,"Reach X":"A gear special rule. Reach weapons are long enough to attack monsters when the survivor is not adjacent. Reach specifies the maximum number of spaces away that a survivor can attack with this weapon.",Reaction:DH,"Record and Archive":"An instruction on certain cards, such as disorders and fighting arts. Make a note of the listed effects and return the card to the game box.",Reflection:NH,"Reflex (Reaction)":"A type of monster reaction. This reaction occurs regardless of whether a wound attempt succeeds or fails.",Refraction:kH,Relentless:FH,"Remove from the Showdown Board (Monster)":"Remove the monster miniature from the showdown board. Some cards will direct you to remove the monster from the showdown board. Set it aside and only place it back on the board when instructed to. Survivors cannot attack a monster while it is removed from the showdown board. Monsters still draw AI cards while removed from the showdown board, unless otherwise stated.","Remove from the Showdown Board (Survivor)":"Remove the survivor miniature from the showdown board. Place it on its survivor status card, if it has one. A survivor removed from the showdown board has an Act, but may not spend movement, activation, or perform survival actions. Unless stated otherwise, they do not affect and are not affected by anything on the showdown board. When the showdown ends, any survivors who are removed from the board (but not dead) continue to the Aftermath as normal.",Resolved:UH,Resources:OH,"Resource Types":"In addition to the specific name listed, all resource cards have one or more types that the card may be used as. Common examples include Bone, Hide, Organ, and Scrap.",Retired:BH,"Returning Survivors":"All survivors that endured the previous showdown are returning survivors.",Reveal:zH,Rewards:VH,"Rival's Scar":"A survivor ability. This survivor gains +1 permanent strength and suffers -1 permanent evasion.","Role Cards":"When beginning a showdown with the Lion Knight, these are distributed randomly to the survivors during the setup phase. They may move from one survivor to another during the showdown, but a survivor may never have more than one at a time. When a survivor dies, archive their role card unless playing with 5-6 players. In that case, a random survivor without a Role Card gains the dead survivor's role card. This modification continues until you are back to four survivors (then you archive the Role Cards of dead survivors as normal).","Rooted to All":"The Absolute constellation ability. If you are standing at the start of your act, reveal the top 2 cards of the AI deck and put them back in any order.","Round (Showdown)":"The showdown proceeds in rounds, consisting of the monster's turn followed by the survivors' turn. Rounds will continue until the monster or all the survivors are dead.","Run Away":"Once a settlement has innovated Pictograph, survivors may abandon a Hunt or Showdown Phase at any time. Follow the instructions on the Run Away story event.",Satchel:HH,Savage:GH,Scale:WH,Scimitar:jH,"Scrap (Resource)":"A common resource keyword.",Scythe:XH,"Secret Fighting Arts":"Secret Fighting Arts are fighting arts that cannot be gained normally. Each secret fighting art has a corresponding card that describes the rules for using it. These count toward your fighting art maximum of 3.",Selfish:qH,"Sense Memory":"A Flower Knight story event. Survivors can perform Inspired Crafting to craft Flower Knight gear with the Flowers they harvest from the Flower Knight. They can also take special actions with the right innovations.",Sentient:KH,Session:YH,Set:"A gear keyword listed on some armor cards. This means this armor is part of an armor set.",Settlement:$H,"Settlement Board":"The settlement board is located on the reverse side of the Hunt Board. The spaces on the board correspond to steps in the Settlement Phase to guide players along.","Settlement Phase":"During the Settlement Phase, survivors experience settlement and story events, spend endeavors, craft gear, and determine which survivors depart on the next hunt. This is the only phase where survivors may change or rearrange their gear grids.","Settlement Record Sheet":"Helps the players keep track of the development of their settlement.","Severe Injury Tables":"Contains sections of possible severe injuries to hit locations. Each hit that causes a severe injury prompts a roll on that location's severe injury table.","Severe [Location] Injury":"When survivors' armor points and injury levels are exhausted, they may accumulate temporary or permanent severe injuries from the severe injury table. When a survivor suffers permanent injuries, note the name and rules on your record sheet and adjust their attributes as necessary. Some injuries fill the Skip Next Hunt box on the survivor record sheet. Otherwise, severe injuries last until the end of the showdown and are marked by attribute tokens.","Shadow Vibrations":"The Sunstalker's instinct. Described on the Sunstalker's showdown story event and basic action card.","Shadow Walk":"A special type of movement. When you Shadow Walk, you may move through spaces survivors occupy without causing collision. (You cannot end your movement on spaces survivors occupy.)",Sharp:ZH,Shield:QH,"Showdown Board":"Used to represent the area where the survivors face the monster in battle. Specific rules for setting up the showdown board are found on each monster's showdown story event.","Showdown Board Edge":"Generally, monster or survivors cannot move off the edge of the showdown board. Any knockback or full move effects that would bring a miniature past a board edge stops at the edge instead.","Showdown Phase":"The part of a session where survivors face off against a monster. See individual monster showdown pages for instructions on how to start and end the Showdown Phase.","Showdown Setup":"A component of each monster's showdown story event. Contains instructions for setting up terrain tiles and monster and survivor miniatures on the showdown board before a battle.",Sickle:JH,"Silk (Gear)":"A gear keyword. This gear is substantively crafted of silk.","Silk (Resource)":"A resource keyword. These resources can be used and refined to craft silk gear.",Skewer:eG,"Skip Next Hunt":"Fill in the Skip Next Hunt box on the survivor's record sheet. The survivor may not be selected as a departing survivor. After departing survivors are chosen, erase all filled Skip Next Hunt boxes on all survivor record sheets.",Slam:tG,Slow:nG,Sniff:iG,"Solar Flare":"A special action. When the third space of the Solar Track is occupied by a face down AI card, perform the steps listed on that space. (Any effects that trigger on or after a Solar Flare occur at the appropriate time.)","Solar Track":"A special tracker used in the Sunstalker expansion. This tracker helps determine the direction where light is coming from, the power level of the Sun, and directions to perform a Solar Flare.",Soluble:rG,"Sour Death":"An ability. When you are knocked down, you may encourage yourself (even if you are deaf). If you do, gain +1 strength token.",Spear:sG,"Special Innovate":`An endeavor action that survivors can take to gain a specified innovation. This does not count towards your settlement's usual "Innovate once per lantern year" rules.`,"Special Showdown":"Special Showdowns interrupt the Settlement Phase. After they conclude (regardless of Victory or Defeat), the Settlement Phase returns to the Update Death Count step. Do not generate endeavors or draw a new settlement event card. Each Special Showdown's details are listed on the story event or innovation that triggered it.","Speed (Attack Profile/Weapon)":"The number of attack rolls (number of dice rolled). Usually determined by a monster AI card's attack profile or speed on a survivor's weapon.","Speed (Attribute/Modifier/Bonus)":"Speed is added to a survivor's weapon speed or a monster's attack profile speed to determine the number of attack rolls. If speed is negative, subtract it from the number of dice rolled for an attack. A monster or survivor attack with less than one speed still has one attack roll. Weapons with the Slow keyword cannot benefit from positive speed bonuses.",Spin:oG,Stalwart:aG,Starvation:lG,Stinky:cG,"Stinky Threat or Survivor (Targeting)":"Survivors become stinky as a result of carrying gear with the stinky keyword in their gear grids, or through status cards, disorders, or other effects that make them stinky targets.","Story Event":"An event which impacts the settlement/survivors. Common triggers include: the settlement timeline, survivor milestones in Hunt XP/courage/understanding, monster cards, and settlement events. When s appears, trigger the story event by turning to the appropriate page in the rulebook and following its instructions.","Story of the Forsaker":"An ability. You cannot be knocked down during a showdown with a Nemesis monster.","Story of the Goblin":"An ability. Once per showdown, you may roll 1d10. On a 3+, gain the priority target token and the monster gains a +1 damage token.","Story of the Young Hero":"An ability. At the start of each of your acts, you may choose to gain +1 survival and 2 bleeding tokens.",Straggler:uG,"Strain Milestone":"A strain milestone describes a rare milestone event that, if reached, will permanently alter the future of your Kingdom Death: Monster campaigns. During the Check Milestones step (#6) of the settlement phase, check to see if you have achieved a strain's Milestone's Condition. If you have, resolve its Permanent Effect and remove the achieved strain milestone card from your game. It can never be used again.","Strange Resources":"Resource cards only gained in specific circumstances. Strange monster resources are not shuffled into monster resource decks.","Strength (Attribute/Modifiers/Bonus)":"Strength is added to the result of a wound attempt. If strength is a negative number, subtract is from the wound attempt result.","Strength (Weapon)":"The number a weapon adds to wound attempts.","Sun Symbol":"An icon used in the Sunstalker expansion. This symbol is equal to the number of face down cards currently on the Solar Track.","Super-dense":"A type of hit location. This hit location is unusually hard. If a survivor attempts to wound one of these locations with a frail weapon, it is destroyed and archived at the end of the attack.","Super Hair":"A survivor ability. You may spend A to freely exchange any tokens with adjacent survivors who have Super Hair.",Surge:hG,"Surpass X":"A gear special rule. I wonder how this works...?",Survival:dG,"Survival Action":"Survival actions are the most common uses for survival points. In the core game, there are 5: Dodge, Encourage, Dash, Surge, and Endure.","Survival Limit":"Survival limit is the maximum amount of survival a survivor may have. Survival limit is recorded on the settlement record sheet. Innovations and events raise the settlement's survival limit. At the start of the campaign, the survival limit is 1. Survival gained over the survival limit is lost.","Survival Opportunity":"The only times that survivors may Dash or Surge. Survival opportunities exist at the following times: during flows on monster AI cards, between actions on the survivors' turn, before performing reactions, after critical wound effects, or when a monster is knocked down.","Survivor Record Sheet":"Represents the permanent status of a survivor. Some sections include: attributes, Hunt XP, Weapon Proficiency and permanent changes.","Survivor Status Card":"Special (S) AI cards that track conditions for an individual survivor rather than the monster. When a survivor gains a survivor status card, place it next to their gear grid. The card's effects apply only to them. Some status cards change and need to be tracked. Some grant survivors unique actions. If a monster's story event has a Survivor Status card in its setup, all survivors gain the card at the start of the showdown.","Sweet Battle":"An ability. Once per round, you may Surge without spending survival. If you do, the activation gained must be used to activate a weapon. You may use Sweet Battle even if your settlement cannot normally Surge. You may also use Sweet Battle when you have no survival and/or cannot spend survival. This does not let you Surge more than once per round.",Sword:fG,Symbol:"A gear keyword. Symbols are strange gear traditionally gained through the Death Reading story event.",Tactics:pG,Target:mG,"Terrain Cards":"Represent terrain that can be encountered during the Showdown Phase and contain rules for how monsters and survivors interact with them. Terrain cards place one or more terrain tiles on the showdown board.","Terrain Tile":"Terrain tiles are placed on the Showdown Board to represent physical features. The type and amount of terrain added to the Showdown Board is determined by the terrain card specified in the setup section of each monster's showdown story event.","The Forest Wants What It Wants":"A special hunt event card that replaces/covers Overwhelming Darkness. When survivors encounter this space, trigger The Forest Wants What It Wants story event instead of the Overwhelming Darkness story event. The space retains all of its normal rules and cannot be skipped or ignored.","The Penalty":"The Hand's instinct. Described on The Hand's showdown story event and basic action card.","Thin-Skinned":"A survivor impairment. You cannot gain insanity for any reason.",Threat:gG,Thrown:vG,Thundercaller:yG,Timeline:_G,Tinker:xG,Tool:wG,Toughness:SG,"Toward (Movement)":"A direction used in reference to another point on the showdown board, such as a monster, survivor, terrain tile., or board edge.",Trait:MG,Transmute:AG,Trap:TG,Trigger:EG,"Turn (Monster)":'The first part of a round, when the monster acts. The monster controller should apply any "at start of turn" effects, draw and play AI cards, then apply any "at end of turn" effects.',"Turn (Survivors')":"The second part of a round is the survivors' turn. During the survivors' turn, survivors act one at a time, each completing their entire act before another survivor may take their act. Survivors may choose to act in any order.","Twelve Fingers":"The Gambler constellation ability. You cannot carry two-handed gear. On a Perfect hit, your right hand pulses. Gain +5 insanity and +1 luck for the attack. However, for each natural 1 rolled when attempting to hit, your left hand shakes. Suffer 5 brain damage and -1 luck for the attack.","Two-handed":"A gear keyword. This weapon requires two hands to use. Some gear and rules do not work with two-handed weapons.",Undeathable:bG,Understanding:CG,"Uninhibited Rage":"Add +1d10 strength to a wound attempt. After a wound attempt is rolled you may roll the Death Die and add the result to the strength of your wound attempt.",Unique:RG,Unshakable:PG,Unstoppable:LG,Unwieldy:IG,"Vermin Resources":"Vermin resources can be found in Bug Patches during showdowns or as a result of events. Vermin cards describe how each vermin can be used. Vermin can also be used in the Cooking Story Event.",Victory:DG,Vital:NG,Waist:kG,"Way of the Rust":"The Rust constellation ability. Your bleeding tokens are also +1 evasion tokens.",Weapon:FG,"Weapon Mastery":"Achieved when a survivor has eight or more levels of weapon proficiency. When any survivor attains a weapon mastery, add that mastery to the settlement as an innovation. All survivors automatically gain the Specialist bonus for that weapon type in addition to any weapon proficiencies they already have.","Weapon Proficiency":"A survivor attribute listed on the survivor record sheet. Weapon proficiency represents a survivor's skill with a weapon type. May be earned for the following weapon types: axe, bow, club, dagger, fist & tooth, grand, katar, shield, spear, sword, twilight sword and whip. After reaching the first Hunt XP milestone, survivors can declare a weapon type to gain weapon proficiency in. A survivor must first declare a weapon type before departing on a hunt (write it in the space on the record sheet) and then wound a monster at least once during a showdown with that weapon type in order to gain levels of weapon proficiency.","Weapon Specialization":"Achieved when a survivor has three or more levels of weapon proficiency. Survivors develop new skills which often empower that weapon,",Wear:UG,Whip:OG,"Worm Trauma Table":"A special severe injury table that the Necromancer rolls on in place of the traditional severe injury table. Refer to the back side of the Necromancer secret fighting art card for this table. (Specified severe injuries remain unchanged.)",Wound:BG,"Wound Attempt":"The total power of a survivor's hit. Add the wound roll result (1d10) to the attacking weapon's strength, along with any other strength modifiers. If a wound attempt total meets or exceeds the monster's toughness, then the hit location is wounded.","Wound (Reaction)":"Listed on some monster hit location cards. An action that a monster performs in response to a successful wound attempt at certain hit locations.","Wound Roll":"Represents the variable ferocity of a survivor's hit. Roll 1d10 and add the result to the wound attempt. The result of this d10 (adding luck modifiers) determines whether or not a critical wound is caused on locations with critical wound effects.","(X)d10":'A number (X) of ten-sided dice. The included dice feature a Lantern on the "10" face.',"Zone of [ ]/[ ] Zone":"The indicated area for actions and reactions on some monster AI and hit location cards."},VG=({terms:n,isShown:e})=>{const[t,i]=te.useState("");return te.useEffect(()=>{setTimeout(()=>i(""),500)},[e]),React.createElement(Ci.div,{className:"TermsList",initial:{marginTop:0},animate:{marginTop:["1rem","3rem","2rem"]},transition:{marginTop:{type:"spring",duration:.75}}},React.createElement(DM,null,t&&React.createElement(Ci.div,{id:"term-definition",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{marginTop:{type:"spring",duration:.1}}},React.createElement("h2",null,t),React.createElement("hr",null),React.createElement("p",null,zG[t]),React.createElement(Ci.div,{id:"return",onTap:()=>i("")}))),React.createElement("ul",null,n.map(r=>React.createElement(Ci.li,{key:r.replace(/ /g,"-"),onTap:()=>i(r)},React.createElement("div",{className:"term"},r)))))},HG=({focusedCard:n,setFocusedCard:e})=>{const[t,i]=te.useState(!1);return Ie.createElement(Ci.div,{id:"Overlay",initial:{opacity:0,marginTop:0},animate:{opacity:1,marginTop:"10vmin"},exit:{opacity:0,marginTop:0},transition:{opacity:{type:"tween",duration:.3},marginTop:{type:"tween",duration:.3}}},Ie.createElement("div",{id:"card-preview"},Ie.createElement(Ci.div,{id:"flip-card",className:t?"is-flipped":"",onTap:()=>i(!t),initial:{marginTop:0},animate:{marginTop:"2rem"}},Ie.createElement(nh,{whileTap:{scale:1.1},name:n.name,classes:"card-front"}),Ie.createElement(nh,{whileTap:{scale:1.1},name:n.Origin,classes:"card-back"})),n.Terms&&n.Terms.length?Ie.createElement(VG,{terms:n.Terms}):""),Ie.createElement(Ci.div,{id:"overlay-bg",onTap:()=>{e({name:"",origin:""})}}))},GG=n=>{const[e,t]=te.useState({name:"",origin:""}),[i,r]=te.useState(!1),[s,o]=te.useState(null),[a,l]=te.useState(""),[c,u]=te.useState([null,null,null,null,"founding-stone","cloth",null,null,null]),d=te.useRef(null),h=te.useRef(null),f=te.useRef(null),m=te.useRef(null),y=te.useRef(null),g=te.useRef(null),p=te.useRef(null),v=te.useRef(null),_=te.useRef(null),x=[d,h,f,m,y,g,p,v,_],A=te.useRef(null),M=qB(),S=({point:V})=>x.findIndex(O=>{const{left:F,right:N,top:G,bottom:L}=O.current.getBoundingClientRect();return V.x>=F&&V.x<=N&&V.y>=G&&V.y<=L}),b=()=>{r(!0)},T=(V,I)=>{V.target.classList},w=(V,I)=>{r(!1);const O=S(I),F=[...c],N=V.srcElement;if(document.querySelector(".removable"))F[s]=null;else if(O>=0&&O!==s)if(s===null||isNaN(s))F[O]=N.classList[0];else{const L=F[O];F[O]=F[s],F[s]=L}u(F),o(null)},P=V=>{const I=V.target.parentElement;I&&(I.parentElement.style.zIndex=2,o(parseInt(I.parentElement.id)))};return Ie.createElement("div",{id:"loadout-view",ref:A},Ie.createElement(DM,null,e.name&&Ie.createElement(HG,{focusedCard:e,setFocusedCard:t})),Ie.createElement(Ci.div,{drag:!0,layout:!0,whileDrag:{zIndex:5,scale:1.3,opacity:1},onDragStart:b,onDragEnd:w,dragControls:M,style:{position:"absolute",width:"10rem",zIndex:-5,opacity:0},transition:{opacity:{duration:0}}},Ie.createElement(nh,{name:a,clickListener:t})),Ie.createElement("section",{id:"grid-section"},Ie.createElement(YB,{cells:x,gridArray:c,activeIndex:s,tapStart:P,dragStart:b,dragActive:T,dragEnd:w,clickListener:t,dragConstraints:A})))},WG=()=>{const[n,e]=te.useState(0);return Ie.createElement("div",{id:"dice-chooser"},Ie.createElement("button",{onClick:()=>window.rollDiceCallback("armor",n)},"Armor Dice"),Ie.createElement("input",{type:"textbox",maxLength:"1",value:n,onChange:t=>{e(Number(t.key))},onKeyDown:t=>{isNaN(Number(t.key))||e(Number(t.key))}}),Ie.createElement("button",{onClick:()=>window.rollDiceCallback("d10",n)},"d10"))},jG=new cD,oT=new dk({allowSleep:!0,gravity:new E(0,-50,0)});oT.defaultContactMaterial.restitution=.5;const XG=LS(document.getElementById("app")),qG=()=>{const[n,e]=te.useState([]),[t,i]=te.useState(""),[r,s]=te.useState([]);return Ie.createElement(Ie.Fragment,null,Ie.createElement(GG,{isShowingCardsTray:!1,isShowingDiceTray:!1}),Ie.createElement(rF,{scene:jG,world:oT,setPlayerList:e,focusedPlayer:t,setFocusedPlayer:i,setPriorRolls:s}),Ie.createElement(WG,null),Ie.createElement(cF,{priorRolls:r}))};XG.render(Ie.createElement(qG,null));
